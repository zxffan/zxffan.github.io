[{"title":"JavaScriptåŸå‹æ±¡æŸ“","url":"/posts/54b3fc67.html","content":"\n## åŸå‹æ±¡æŸ“\n\n> åŸå‹æ±¡æŸ“å°±æ˜¯ï¼Œé€šè¿‡æŸç§æ‰‹æ®µè¾¾åˆ°ä¿®æ”¹JavaScriptåŸå‹çš„ç›®çš„\n\næ¯”å¦‚\n\n```javascript\nvar a = {}\n```\n\nå®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡aï¼Œaæœ‰ä¸€ä¸ª`constructor`å±æ€§æŒ‡å‘açš„æ„é€ å™¨ï¼ˆ`Object`ï¼‰\n\n```javascript\na.constructor === Object // true\n```\n\nObjectå¾ˆå¸¸ç”¨ï¼Œæ¯”å¦‚ï¼š`Object.prototype.toString`\n\n```javascript\nObject.prototype.toString.call(a) // \"[object Object]\" è·å–ç±»å‹\n```\n\nä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œé€šè¿‡aå¯¹è±¡å¯ä»¥è®¿é—®å¹¶ä¿®æ”¹Objectå¯¹è±¡\n\n```javascript\na.constructor.prototype.toString = () => console.log(\"attack\")\n\n// å†ä½¿ç”¨ toString\nObject.prototype.toString.call(a) // \"attack\"\n```\n\nè¿™å°±å‘ç”Ÿäº†**åŸå‹æ±¡æŸ“**\n\n> lodashå‘ç”Ÿè¿‡ä¸€æ¬¡ä¸¥é‡çš„åŸå‹æ±¡æŸ“bugï¼Œåœºæ™¯æ˜¯ä¸¤ä¸ªå¯¹è±¡åˆå¹¶`merge(a, b)`ï¼Œ \n\n## é¢„é˜²\n\n### è¿‡æ»¤å±é™©å±æ€§\n\nä¸¤ä¸ªå¯¹è±¡åˆå¹¶ï¼ŒæŠŠ`constructor`å±æ€§å’Œ`__proto__`è¿™æ ·çš„æ•æ„Ÿè¿‡æ»¤æ‰ã€‚\n\n### Object.freeze\n\n`Object.freeze`å¯ä»¥å†»ç»“ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸èƒ½è¢«ä¿®æ”¹ã€‚\n\nåŸç†å°±æ˜¯ä¿®æ”¹å¯¹è±¡çš„`descriptor`ä¸­çš„`writable:false`\n\n```javascript\nObject.freeze(Object.prototype);\n\nObject.prototype.toString = \"attack\"\n\nconsoel.log(Object.prototype.toString) // Æ’ toString() { [native code] }\n```\n\n### Object.create(null)\n\nåˆ›å»ºä¸€ä¸ªåŸå‹å¯¹è±¡ä¸ºnullçš„å¯¹è±¡ï¼Œè¿™æ ·å°±ä¸å­˜åœ¨æ±¡æŸ“åŸå‹çš„æƒ…å†µ\n\n### Mapä»£æ›¿å¯¹è±¡å­—é¢é‡\n\n`map.set(\"__proto__\", xx)`å¹¶ä¸ä¼šä¿®æ”¹åŸå‹å¯¹è±¡\n\n## æé†’\n\næ·±åˆå¹¶å’Œæ·±æ‹·è´ç®—æ³•æ³¨æ„**åŸå‹æ±¡æŸ“**","tags":["JavaScript","Promise"],"categories":["JavaScript"]},{"title":"Webpackæ„å»ºæµç¨‹æºç è§£æ","url":"/posts/aef11e42.html","content":"\nwebpackçš„æ„å»ºåˆ†ä¸º3ä¸ªé˜¶æ®µï¼š\n\n- å‡†å¤‡é˜¶æ®µï¼šç”Ÿæˆ `compiler`å’Œ`compilation`å¯¹è±¡\n- ç¼–è¯‘é˜¶æ®µï¼šé€’å½’ç”Ÿæˆæ¨¡å—ä¾èµ–å›¾\n- äº§å‡ºé˜¶æ®µï¼šä¼˜åŒ–modulesï¼Œç”Ÿæˆchunksã€‚æœ€ç»ˆè¾“å‡ºæ–‡ä»¶\n\næœ¬æ–‡è®¨è®ºçš„æ˜¯`webpack@5.34.0`\n\n## å‡†å¤‡é˜¶æ®µ\n\n### åˆ›å»ºcompiler\n\nå¯¹äºæ¯ä¸€ä¸ªwepbackçš„æ„å»ºé…ç½®ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ª`compiler`å¯¹è±¡ï¼Œè®°å½•ç€æ•´ä¸ª Webpack çš„ç”Ÿå‘½å‘¨æœŸ\n\n```javascript\nimport webpack from \"webpack\"\n\nconst compiler = webpack(options)\n// webpack(options, () => {})\n```\n\nè°ƒç”¨webpackå‡½æ•°ä¼šè¿”å›`compiler`å¯¹è±¡ï¼Œå…¶å†…éƒ¨å¤§è‡´é€»è¾‘å¦‚ä¸‹ï¼š\n\n```javascript\nconst webpack = (options, callback) => {\n  // 1. åˆ›å»ºcompiler\n  let compiler;\n  if (Array.isArray(options)) compiler = createMultiCompiler(options, options);\n  else compiler = createCompiler(options);\n  \n  // 2.\n  // æœ‰callbackå‚æ•°å°±ä¼šè‡ªåŠ¨æ‰§è¡Œcompiler.run\n  // optionsä¸­watchä¸ºtrueå°±ä¼šè‡ªåŠ¨è°ƒç”¨compiler.watch\n  \n  // 3. è¿”å›compiler\n  return compiler\n}\n```\n\n> ç¤ºä¾‹ä»£ç å¹¶éæ˜¯webpackä¸­çš„æºç ã€‚åªæ˜¯å°†æºç ä¸­çš„æ ¸å¿ƒé€»è¾‘æç‚¼å‡ºæ¥çš„ä¼ªä»£ç ï¼Œè¿™æ ·æ›´æ–¹ä¾¿ç†è§£webpackçš„ä¸»æµç¨‹ã€‚ä¸‹åŒã€‚\n\n`createCompiler`å’Œ`createMultiCompiler`æ‰æ˜¯çœŸæ­£åˆ›å»º`compiler`çš„é€»è¾‘\n\n```javascript\nconst createCompiler = rawOptions => {\n\t// 1. normalize options\n  // å°±æ˜¯å¯¹ä¼ å…¥çš„optionsåšäº›åˆå§‹åŒ–ï¼Œæ·»åŠ é»˜è®¤å‚æ•°ä¹‹ç±»çš„å·¥ä½œ\n  \n  // 2. ä»–æ¥äº†ï¼Œåˆ›å»ºcompilerå¯¹è±¡\n\tconst compiler = new Compiler(options.context);\n\tcompiler.options = options;\n  \n  // 2. æ–°å»ºNodeEvniromentPluginï¼Œè¿™æ˜¯wepbackå¯ç”¨çš„ç¬¬ä¸€ä¸ªplugin\n  // ä¸»è¦ä½œç”¨æ˜¯ \n  // - åˆ›å»ºæ—¥å¿—ï¼ˆæ–¹ä¾¿webpackè¾“å‡ºæ„å»ºæ—¥å¿—ï¼‰\n  // - è®¾ç½®compilerçš„æ–‡ä»¶ç³»ç»Ÿ inputFileSystem...\n\tnew NodeEnvironmentPlugin({\n\t\tinfrastructureLogging: options.infrastructureLogging\n\t}).apply(compiler);\n  \n  // 3. æ‰§è¡Œæ‰€æœ‰plugin\n  // - å‡½æ•°pluginï¼Œæ‰§è¡Œå‡½æ•°\n  // - class pluginï¼Œæ‰§è¡Œå…¶applyæ–¹æ³•\n\tif (Array.isArray(options.plugins)) {\n\t\tfor (const plugin of options.plugins) {\n\t\t\tif (typeof plugin === \"function\") {\n\t\t\t\tplugin.call(compiler, compiler);\n\t\t\t} else {\n\t\t\t\tplugin.apply(compiler);\n\t\t\t}\n\t\t}\n\t}\n  \n  applyWebpackOptionsDefaults(options);\n\tcompiler.hooks.environment.call(); // hook\n\tcompiler.hooks.afterEnvironment.call(); // hook\n  \n  // 5.æ·»åŠ é»˜è®¤å†…ç½®plugin\n  // æ ¹æ®optionsçš„è®¾ç½®æ¥é…ç½®å“åº”å†…ç½®plugin\n\tnew WebpackOptionsApply().process(options, compiler); \n\tcompiler.hooks.initialize.call();\n  \n  return compiler\n}\n\nconst createMultiCompiler = (childOptions, options) => {\n  // ç»™æ¯ä¸€ä¸ªoptionåˆ›å»ºä¸€ä¸ªcompiler\n\tconst compilers = childOptions.map(options => createCompiler(options));\n  // åˆ›å»ºMultiCompilerå¯¹è±¡\n\tconst compiler = new MultiCompiler(compilers, options);\n\t\n  // ...\n  \n\treturn compiler;\n};\n```\n\nè¿™é‡Œæ³¨æ„ä¸€ç‚¹ï¼šåœ¨`compiler`å¯¹è±¡åˆ›å»ºåï¼š\n\n1. é€ä¸€æ‰§è¡Œ`options.plugins`ä¸­æ‰€æœ‰çš„pluginã€‚\n2. æ ¹æ®optionsçš„å†…å®¹ï¼Œæ·»åŠ webpackå†…ç½®çš„pluginã€‚æ¯”å¦‚`EntryOptionPlugin`ã€‚é’ˆå¯¹ä¸åŒç¯å¢ƒ(node electron browser)ä¼šè®¾ç½®ä¸åŒçš„pluginã€‚\n\n> webpackæœ‰å¤§é‡çš„å†…ç½®pluginï¼Œè¿™éƒ½æ˜¯åœ¨`WebpackOptionsApply`ä¸­çš„`process`æ¥è®¾ç½®çš„ã€‚å¯ä»¥è¯´webpackçš„æ‰€æœ‰åŠŸèƒ½(resolve optimization moduleè§£æ...)éƒ½æ˜¯ç”±ç›¸åº”çš„pluginå®Œæˆçš„ã€‚\n\nè·å¾—`compiler`å¯¹è±¡åï¼Œä¸‹ä¸€æ­¥å°±æ—¶è¿›è¡Œæ„å»ºï¼Œè¿™æ˜¯é€šè¿‡`compiler.run`æ–¹æ³•å®ç°çš„ã€‚\n\n`run`æ–¹æ³•ä¸»è¦åšäº†2ä»¶äº‹ï¼š\n\n- æ‰§è¡Œcompilerçš„hook `beforeRun` `run` `readRecords`ã€‚åœ¨åˆ›å»ºcompilerå¯¹è±¡æ—¶ä¼šæ‰§è¡Œæ‰€æœ‰pluginã€‚å¦‚æœåœ¨è¿™ä¸‰ä¸ªhookç»‘å®šçš„äº†äº‹ä»¶ï¼Œåœ¨æ­¤æ—¶ä¼šè¢«æ‰§è¡Œã€‚ï¼ˆè¿™ä¸‰ä¸ªhookæ—¶ä¸²è¡Œæ‰§è¡Œçš„ï¼Œä»£ç æ˜¯åµŒå¥—çš„ï¼‰\n- æ‰§è¡Œ`compiler.compile`æ–¹æ³•è¿›è¡Œæ„å»º\n\n```javascript\nthis.hooks.beforeRun.callAsync(this, err => {\n  if (err) return finalCallback(err);\n\n  this.hooks.run.callAsync(this, err => {\n    if (err) return finalCallback(err);\n\n    this.readRecords(err => {\n      if (err) return finalCallback(err);\n\n      this.compile(onCompiled);\n    });\n  });\n});\n```\n\n### åˆ›å»ºCompilation\n\n`compilation`å¯¹è±¡å±äº`compiler`ã€‚æ¯ä¸€æ¬¡æ„å»ºï¼Œ`compiler`éƒ½ä¼šåˆ›å»ºä¸€ä¸ª`compilation`å¯¹è±¡\n\n`compiler.compile`æ–¹æ³•ä¼šçœŸæ­£åœ°åˆ›å»º`compilation`å¯¹è±¡\n\n```javascript\n// ./lib/Compiler.js\n// compile\nconst params = this.newCompilationParams();\nthis.hooks.beforeCompile.callAsync(params, err => {\n  if (err) return callback(err);\n\n  this.hooks.compile.call(params);\n\t\n  // åˆ›å»ºcompilationå¯¹è±¡\n  const compilation = this.newCompilation(params);\n\n  // ...\n  // æ‰§è¡Œcompilerçš„å„ç§hook\n  // ä»¥åŠæ‰§è¡Œcompilationçš„ finish å’Œ sealæ–¹æ³•\n});\n```\n\nä»£ç å¾ˆé•¿ï¼Œä¸»è¦æµç¨‹å¦‚ä¸‹:\n\n1. `compiler.hooks.beforeCompile` \n2. åˆ›å»º`compilation`å¯¹è±¡ã€‚è¿™é‡Œè°ƒç”¨äº†`compiler.newCompilation`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åšäº†ä»¥ä¸‹å‡ ä»¶äº‹\n   1. åˆ›å»º`compilation`ï¼Œä¼šå…ˆæ¸…ç†ä¸Šä¸€æ¬¡æ„å»ºçš„`compilation`å¯¹è±¡\n   2. `compiler.hooks.thisCompilation`\n   3. `compiler.hooks.compilation`\n3. `compiler.hooks.make` \n4.  `compiler.hooks.finishMake`\n5. `compilation.finish`\n6. `compilation.seal`\n7. `compiler.hooks.afterCompile`\n\nè¿™äº›hookséƒ½æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ã€‚`afterCompile`è¿™ä¸ªhookçš„æ‰§è¡Œè¡¨ç¤ºä¸€æ¬¡æ„å»ºå·²ç»å®Œæˆã€‚é‚£ä¹ˆä»compilationå¯¹è±¡åˆ›å»ºå®Œæˆåˆ°`afterCompile`è§¦å‘ä¹‹å‰ï¼ŒåŒ…å«äº†**ç¼–è¯‘é˜¶æ®µ**å’Œ**äº§å‡ºé˜¶æ®µ**\n\n## ç¼–è¯‘é˜¶æ®µ\n\n`compiler.hooks.make`è¿™ä¸ªhookè¢«è§¦å‘æ‰§è¡Œï¼Œå°±ä»£è¡¨äº†ç¼–è¯‘å¼€å§‹ã€‚\n\nåœ¨`compiler`åˆ›å»ºæ—¶(`new WebpackOptionsApply().process(options, compiler); `)ï¼Œè¿™é‡Œç»™compileræ·»åŠ äº†è®¸å¤šå¹¶ç»‘å®šäº†è®¸å¤šå†…ç½®pluginã€‚å…¶ä¸­æœ‰ä¸€ä¸ª`EntryOptionsPlugin`ï¼Œä»–æ˜¯ç”¨äºè§£æå…¥å£(entry)é…ç½®ã€‚æ ¹æ®entryå­—æ®µç±»å‹å†é€‰æ‹©ä¸åŒçš„plugin\n\n- entryä¸ºfunctionï¼š`DynamicEntryPlugin`\n- entryä¸ä¸ºfunctionï¼š`EntryPlugin`\n\nç¼–è¯‘é˜¶æ®µçš„å¼€å§‹å°±æ˜¯ä»`entry`æ–‡ä»¶å¼€å§‹è§£æ`module`ã€‚\n\nä»¥`EntryPlugin`ä¸ºä¾‹ï¼Œå…¶applyæ–¹æ³•ï¼š\n\n```javascript\ncompiler.hooks.make.tapAsync(\"EntryPlugin\", (compilation, callback) => {\n  const { entry, options, context } = this;\n\n  const dep = EntryPlugin.createDependency(entry, options);\n  compilation.addEntry(context, dep, options, err => {\n    callback(err);\n  });\n});\n```\n\n`EntryPlugin`åœ¨`compile.make`è¿™ä¸ªhookä¸Šæ³¨å†Œäº†ä¸€ä¸ªäº‹ä»¶ã€‚`compiler.hooks.make`è¿™ä¸ªhookè¢«è§¦å‘æ‰§è¡Œæ—¶ï¼Œhookä¸Šæ³¨å†Œçš„äº‹ä»¶å…¨éƒ½ä¼šè¢«æ‰§è¡Œã€‚\n\n`EntryPlugin`ä¼šè°ƒç”¨`compilation.addEntry`æ–¹æ³•ã€‚\n\næ¥ä¸‹çœ‹å°±çœ‹`compilation`çš„è¡¨æ¼”ï¼š\n\n1. addEntryæ·»åŠ å…¥å£æ–‡ä»¶\n2. å°†èµ„æºæ–‡ä»¶è½¬æˆ`NormalModule`å¯¹è±¡ï¼ˆç®€ç§°moduleå¯¹è±¡ï¼‰ï¼Œä¸€ä¸ªæ–‡ä»¶(js css img)éƒ½æ˜¯ä¸€ä¸ªmodule\n3. è°ƒç”¨`module.build`æ–¹æ³•\n4. è°ƒç”¨`runLoaders`ï¼Œæ‰¾åˆ°ç›¸åº”çš„loaderå¤„ç†è¯¥module\n5. å¯¹äºjs moduleï¼Œä¼šé€šè¿‡`acorn`è½¬æˆ`AST`ã€‚åˆ†ææ¨¡å—ä¾èµ–å…³ç³»ï¼Œå¦‚æœæœ‰ä¾èµ–æ¨¡å— è°ƒç”¨`compilation.addEntry`ï¼ˆç¬¬1æ­¥ï¼‰\n6. æœ€ç»ˆè·å–æ‰€æœ‰module\n\n> ç¼–è¯‘é˜¶æ®µæ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹\n>\n> æ¯ä¸€ä¸ªmodule buildå®Œæˆéƒ½ä¼šè§¦å‘`compilation.hooks.succeedModule`ï¼Œå¹¶ä¼ å…¥å½“å‰moduleå¯¹è±¡\n\n## äº§å‡ºé˜¶æ®µ\n\nè°ƒç”¨`compilation.seal`æ–¹æ³•ï¼Œå°å­˜æ–‡ä»¶å°±æ˜¯å¤„ç†æ–‡ä»¶ç”Ÿæˆchunkã€‚\n\n### Seal\n\né¦–å…ˆè§¦å‘`compilation.hooks.optimizeDependencies`è¿™ä¸ªhookä¸Šçš„æ‰€æœ‰äº‹ä»¶ã€‚å¯¹moduleåšä¸€äº›ä¼˜åŒ–æ“ä½œï¼ˆæ¯”å¦‚`tree-shaking`ï¼‰\n\næ ¹æ®å…¥å£ç”Ÿæˆchunkï¼Œæœ‰å‡ ä¸ªå…¥å£å°±ä¼šæœ‰å‡ ä¸ªchunkã€‚\n\nç„¶åå°±æ˜¯é€’å½’åˆ†æchunkï¼Œå¦‚æœæœ‰åŠ¨æ€å¯¼å…¥(`import()`)å°±ä¼šå•ç‹¬æ‹†åˆ†å‡ºchunk\n\n> è¿™ä¸ªè¿‡ç¨‹è¿˜æœ‰ä¸€å †hooksï¼Œè¿™äº›å¯ä»¥åœ¨è¿™äº›hooksä¸Šåšäº›ä¼˜åŒ–æ“ä½œã€‚æ¯”å¦‚`optimizeModules`å’Œ`optimizeChunks`\n\nç”Ÿæˆchunckçš„`hash`\n\nç”Ÿæˆchunkçš„`sourceMap`\n\n### Assets\n\n`createChunkAssets`ç”Ÿæˆassets ï¼Œä¼šå°†ç”Ÿæˆçš„Assetså­˜æ”¾åˆ°`compilation.assets`æ•°ç»„ä¸­\n\n`emitAsset`å°†æ–‡ä»¶è¾“å‡º\n\n## Watchæ¨¡å¼\n\nå½“è°ƒç”¨`compiler.watch`ï¼Œä¼šå¯ç”¨watchæ¨¡å¼ã€‚å½“æ–‡ä»¶å‘ç”Ÿæ›´æ”¹æ˜¯ï¼Œä¼šè‡ªåŠ¨é‡æ–°æ„å»º.\n\n```javascript\n{\n  watch(watchOptions, handler) {\n\t\t// ...\n\t\tthis.watching = new Watching(this, watchOptions, handler);\n    \n\t\treturn this.watching;\n\t}\n}\n```\n\nwatchæ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª`Watching`å®ä¾‹ã€‚\n\n```javascript\nclass Watch {\n  contstructor() {\n    // ...\n    this._invalidate()\n  }\n  _invalidate() {\n    // é˜²æ­¢é‡å¤æ„å»º\n    this._go()\n  }\n  _go() {\n    // æ„å»ºé€»è¾‘\n    compiler.compile() // è°ƒç”¨compilerçš„compileæ–¹æ³•è¿›è¡Œæ„å»º\n  }\n  _done() {\n    // æ„å»ºå®Œæˆäº†\n    // è·å–æ„å»ºå®Œåçš„ä¾èµ–\n    this.watch() // ç›‘å¬è¿™äº›ä¾èµ–\n  }\n  watch() {\n    // ç›‘å¬æ–‡ä»¶å˜åŒ–\n    this.compiler.watchFileSystem.watch()\n    \n    // æ–‡ä»¶å‘ç”Ÿå˜åŒ– ç›‘å¬çš„å›è°ƒä¼šè¢«è°ƒç”¨\n    this._invalidate() // è¿›è¡Œä¸‹ä¸€è½®æ„å»º\n  }\n}\n```\n\nç›‘å¬æ–‡ä»¶æ˜¯é€šè¿‡`this.compiler.watchFileSystem.watch()`æ–¹æ³•æ¥å®ç°çš„ã€‚è¿™ä¸ª`watchFileSystem`æ˜¯åœ¨åˆ›å»º`compiler`å¯¹è±¡æ—¶ï¼Œåˆå§‹åŒ–çš„ã€‚\n\nåˆ›å»º`compiler`æ—¶ï¼Œæ‰§è¡Œäº†`NodeEvniromentPlugin`ã€‚è¿™ä¸ªpluginä¼šè®¾ç½®æ–‡ä»¶ç³»ç»Ÿã€‚å°†`watchFleSystem`è®¾ç½®æˆ`NodeWatchFileSystem`ï¼Œè€Œå…¶å†…éƒ¨åˆä¼šåˆ›å»ºä¸€ä¸ª`watchpack`å¯¹è±¡æ¥ç›‘å¬æ–‡ä»¶å˜åŒ–ã€‚\n\n```javascript\nclass NodeEnvironmentPlugin {\n\tapply(compiler) {\n\t\t//...\n\t\tcompiler.inputFileSystem = new CachedInputFileSystem(fs, 60000);\n\t\t// ...\n\t\tcompiler.watchFileSystem = new NodeWatchFileSystem(\n\t\t\tcompiler.inputFileSystem\n\t\t);\n    // ...\n\t}\n}\n\n```\n\n> å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå½“æ–‡ä»¶çŸ­æ—¶é—´å˜åŒ–å¤šæ¬¡ï¼Œä¼šè§¦å‘å¤šæ¬¡æ„å»ºå—ï¼Ÿ\n>\n> å…¶å®æ˜¯ä¸ä¼šçš„ï¼Œ`watchpack`æ·»åŠ äº†é˜²æŠ–æœºåˆ¶ã€‚åªä¼šè§¦å‘æœ€åä¸€æ¬¡ã€‚\n\n## æ€»ç»“\n\nä¸€å¼ å›¾æ€»ç»“æµç¨‹\n\n![webpackæ„å»ºæµç¨‹](../../images/framework/webpackæ„å»ºæµç¨‹.svg)","tags":["javascript","webpack","æ¶æ„"],"categories":["Webpack"]},{"title":"Vue2ä»åˆ›å»ºåˆ°é¡µé¢æ¸²æŸ“","url":"/posts/bdeefbce.html","content":"\n## Vue2ç”Ÿå‘½å‘¨æœŸå›¾\n\n![ç”Ÿå‘½å‘¨æœŸ](../../images/Vue/vue2ä»åˆ›å»ºåˆ°æ¸²æŸ“.svg)\n\n## ç»„ä»¶åˆ›å»ºåˆ°é¡µé¢æ¸²æŸ“\n\n### åˆå§‹åŒ–\n\n`new Vue()`çš„æ‰§è¡Œï¼Œä¼šåˆ›å»ºä¸€ä¸ªç»„ä»¶å®ä¾‹ï¼ˆæ ¹ç»„ä»¶ï¼‰`vm`ï¼Œç„¶åè¿›è¡Œå„ç§åˆå§‹åŒ–å·¥ä½œ\n\n1. åˆå¹¶ optionsï¼Œä¹Ÿå°±æ˜¯åˆå§‹åŒ–ç»„ä»¶çš„optionsé€‰é¡¹\n2. åˆå§‹åŒ–vmï¼ˆç»„ä»¶å®ä¾‹ï¼‰ä¸Šçš„å„ä¸ªå±æ€§\n3. åˆå§‹åŒ–ç»‘å®šåœ¨å½“å‰ç»„ä»¶ä¸Šçš„listener(v-on)\n4. åˆå§‹åŒ–renderå‡½æ•°ï¼Œåœ¨vmä¸Šç»‘å®šcreateElementæ–¹æ³•\n5. **`beforeCreated`**é’©å­è°ƒç”¨\n6. å°†injectå®šä¹‰ä¸ºå“åº”å¼\n7. .åˆå§‹åŒ–, å®šä¹‰å“åº”å¼æ•°æ® `props`  `methods` `data` ` computed` `watch`\n8. åˆå§‹åŒ–vm._provideå±æ€§\n9. **`creted`**é’©å­è°ƒç”¨\n\n### æ¸²æŸ“\n\nå¦‚æœ`new Vue`ä¼ å…¥äº†`el`å±æ€§ï¼Œå°±ä¼šè‡ªåŠ¨è°ƒç”¨`vm.$mount`æ–¹æ³•ï¼Œæ¸²æŸ“å®ä¾‹\n\n1. è°ƒç”¨`mountComponent`\n2. æ–°å»ºWatcherï¼Œä¼ å…¥`updateComponent`é€»è¾‘\n3. Watcherè°ƒç”¨`updateComponent`é€»è¾‘\n4. è¿›å…¥`patch`é€»è¾‘\n\n## å“åº”å¼\n\nvue2çš„å“åº”å¼æ¶‰åŠåˆ°ä¸‰ç§è§’è‰²â€”â€”`reactiveObj(å“åº”å¼å¯¹è±¡)` `Watcher`  `Dep`\n\n- å“åº”å¼å¯¹è±¡é€šè¿‡`Object.defineProperty`æ‹¦æˆªgetterå’Œsetter\n- Watcherç”¨äºè§¦å‘ç»„ä»¶æ›´æ–°\n- æ¯ä¸ªå“åº”å¼å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªdepå¯¹è±¡ï¼Œå®ƒæœ‰ä¸€ä¸ªsubsçš„Watcheræ•°ç»„ï¼Œç”¨äºè®°å½•ä¾èµ–è¯¥å“åº”å¼å¯¹è±¡çš„æ‰€æœ‰watcher\n\nå½“ç»„ä»¶å¼€å§‹æ¸²æŸ“æ—¶ï¼š\n\n- ä¼šåˆ›å»ºä¸€ä¸ª`Watcher`å¯¹è±¡ã€‚å°†ç»„ä»¶æ›´æ–°çš„é€»è¾‘ï¼ˆ`updateComponent`ï¼‰è®°å½•åˆ°Watcher\n- å°†Dep.targetè®¾ç½®ä¸º åˆ›å»ºçš„ `Watcher`å¯¹è±¡\n\néšå³æ‰§è¡Œrenderæ–¹æ³•ï¼Œä¼šè§¦å‘å“åº”å¼å¯¹è±¡çš„getterã€‚å°†`Dep.target`æ·»åŠ åˆ°`dep.subs`ä¸­ï¼Œå³ä¾èµ–æ”¶é›†\n\nåœ¨ä¿®æ”¹å“åº”å¼å¯¹è±¡ï¼Œä¼šè§¦å‘setterã€‚\n\n- æ‰§è¡Œ`dep.notify`ï¼Œè§¦å‘`dpe.subs`ä¸­æ‰€æœ‰`watcher`çš„`update`æ–¹æ³•\n- `watcher.update()`ä¼šè§¦å‘`updateComponent`ï¼Œä»è€Œä½¿å¾—ç»„ä»¶æ›´æ–°","tags":["Vue","sc-vue"],"categories":["Vue"]},{"title":"Webpackä¹‹SplitChunks","url":"/posts/110bf707.html","content":"\n## SplitChunks\n\n`splitChunks`å¯ä»¥æŒ‡å®š`webpack`æ‰“åŒ…çš„æ‹†åˆ†è§„åˆ™ã€‚\n\n```javascript\nmodule.exports = {\n  // ...\n  optimization: {\n    splitChunks: {\n      chunks: \"async\", // ä¸‰é€‰ä¸€ï¼š \"initial\" | \"all\" | \"async\" (é»˜è®¤)\n      minSize: 30000, // æœ€å°å°ºå¯¸ï¼Œ30Kï¼Œdevelopment ä¸‹æ˜¯10kï¼Œè¶Šå¤§é‚£ä¹ˆå•ä¸ªæ–‡ä»¶è¶Šå¤§ï¼Œchunk æ•°å°±ä¼šå˜å°‘ï¼ˆé’ˆå¯¹äºæå–å…¬å…± chunkçš„æ—¶å€™ï¼Œä¸ç®¡å†å¤§ä¹Ÿä¸ä¼šæŠŠåŠ¨æ€åŠ è½½çš„æ¨¡å—åˆå¹¶åˆ°åˆå§‹åŒ–æ¨¡å—ä¸­ï¼‰å½“è¿™ä¸ªå€¼å¾ˆå¤§çš„æ—¶å€™å°±ä¸ä¼šåšå…¬å…±éƒ¨åˆ†çš„æŠ½å–äº†\n      maxSize: 0, // æ–‡ä»¶çš„æœ€å¤§å°ºå¯¸ï¼Œ0ä¸ºä¸é™åˆ¶ï¼Œä¼˜å…ˆçº§ï¼šmaxInitialRequest/maxAsyncRequests < maxSize < minSize\n      minChunks: 1, // é»˜è®¤1ï¼Œè¢«æå–çš„ä¸€ä¸ªæ¨¡å—è‡³å°‘éœ€è¦åœ¨å‡ ä¸ª chunk ä¸­è¢«å¼•ç”¨ï¼Œè¿™ä¸ªå€¼è¶Šå¤§ï¼ŒæŠ½å–å‡ºæ¥çš„æ–‡ä»¶å°±è¶Šå°\n      maxAsyncRequests: 5, // åœ¨åšä¸€æ¬¡æŒ‰éœ€åŠ è½½çš„æ—¶å€™æœ€å¤šæœ‰å¤šå°‘ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œä¸º 1 çš„æ—¶å€™å°±ä¸ä¼šæŠ½å–å…¬å…± chunk äº†\n      maxInitialRequests: 3, // é’ˆå¯¹ä¸€ä¸ª entry åšåˆå§‹åŒ–æ¨¡å—åˆ†éš”çš„æ—¶å€™çš„æœ€å¤§æ–‡ä»¶æ•°ï¼Œä¼˜å…ˆçº§é«˜äº cacheGroupï¼Œæ‰€ä»¥ä¸º 1 çš„æ—¶å€™å°±ä¸ä¼šæŠ½å– initial common äº†\n      automaticNameDelimiter: \"~\", // æ‰“åŒ…æ–‡ä»¶ååˆ†éš”ç¬¦\n      name: true, // æ‹†åˆ†å‡ºæ¥æ–‡ä»¶çš„åå­—ï¼Œé»˜è®¤ä¸º trueï¼Œè¡¨ç¤ºè‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶åï¼Œå¦‚æœè®¾ç½®ä¸ºå›ºå®šçš„å­—ç¬¦ä¸²é‚£ä¹ˆæ‰€æœ‰çš„ chunk éƒ½ä¼šè¢«åˆå¹¶æˆä¸€ä¸ª\n      cacheGroups: {\n        vendors: {\n          test: /[\\\\/]node_modules[\\\\/]/, // æ­£åˆ™è§„åˆ™ï¼Œå¦‚æœç¬¦åˆå°±æå– chunk\n          priority: -10, // ç¼“å­˜ç»„ä¼˜å…ˆçº§ï¼Œå½“ä¸€ä¸ªæ¨¡å—å¯èƒ½å±äºå¤šä¸ª chunkGroupï¼Œè¿™é‡Œæ˜¯ä¼˜å…ˆçº§\n        },\n        default: {\n          minChunks: 2,\n          priority: -20, // ä¼˜å…ˆçº§\n          reuseExistingChunk: true, // å¦‚æœè¯¥chunkåŒ…å«çš„moduleséƒ½å·²ç»å¦ä¸€ä¸ªè¢«åˆ†å‰²çš„chunkä¸­å­˜åœ¨ï¼Œé‚£ä¹ˆç›´æ¥å¼•ç”¨å·²å­˜åœ¨çš„chunkï¼Œä¸ä¼šå†é‡æ–°äº§ç”Ÿä¸€ä¸ª\n        },\n      },\n    },\n  },\n};\n```\n\nä½¿ç”¨åŠ¨æ€å¯¼å…¥`import()`æˆ–è€…`requre.ensure()`ï¼Œå°±ä¼šæ ¹æ®\n\n## SplitChunkså‚æ•°\n\n### chunks\n\næœ‰ä¸‰ä¸ªå€¼â€”â€”`async` `all` `initial`\n\n#### async(é»˜è®¤)\n\nåªä¼šå°†å¼‚æ­¥æ¨¡å—ï¼ˆ`import()`å¯¼å…¥çš„æ¨¡å—ï¼‰æå‡ºå‡ºæ¥\n\n#### initial\n\næå–åŒæ­¥æ¨¡å—å’Œå¼‚æ­¥æ¨¡å—ã€‚å¦‚æœä¸€ä¸ªæ¨¡å—åœ¨moduleAä¸­æ˜¯åŒæ­¥å¯¼å…¥ï¼Œåœ¨moduleBä¸­æ˜¯å¼‚æ­¥å¯¼å…¥ã€‚é‚£ä¹ˆç”±äºå¯¼å…¥æ–¹å¼ä¸åŒï¼Œè¿™ä¸ªæ¨¡å—ä¼šè¢«æŠ½ç¦»å‡ºä¸åŒçš„æ–‡ä»¶ã€‚\n\n#### all\n\næå–åŒæ­¥æ¨¡å—å’Œå¼‚æ­¥æ¨¡å—ï¼Œæ— è®ºæ˜¯åŒæ­¥importè¿˜æ˜¯å¼‚æ­¥importã€‚éƒ½ä¼šæŠ½ç¦»åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚`all`ä¼šæœ€å¤§ç¨‹åº¦å¤ç”¨æ–‡ä»¶ã€‚\n\n### maxInitialRequestså’ŒmaxAsyncRequests\n\næµè§ˆå™¨å¯¹ç›¸åŒåŸŸåçš„å¹¶æ³•è¯·æ±‚æ˜¯æœ‰é™åˆ¶çš„ã€‚æ¯”å¦‚chrome é™åˆ¶6ä¸ªç›¸åŒåŸŸåçš„è¯·æ±‚ã€‚å¦‚æœåŒä¸€æ—¶é—´å‘é€10ä¸ªè¯·æ±‚ã€‚åˆ™å¦å¤–4ä¸ªå°±ä¼šè¢«é˜»å¡\n\næ‰€ä»¥ï¼Œ`splitChunks`æŠŠæ–‡ä»¶æ‹†å¾—å¤ªç¢ï¼Œåè€Œä¼šå½±å“åŠ è½½æ—¶é—´ã€‚\n\n`maxInitialRequests`è®¾ç½®ä¸º`3`ï¼Œè¡¨ç¤ºæµè§ˆå™¨åˆå§‹æœ€å¤šå‘é€3ä¸ªè¯·æ±‚ã€‚å®ƒä¼šå°†å…¥å£æ–‡ä»¶æ‹†æˆ<3ä»½ã€‚\n\n`maxAsyncRequests`æ˜¯ç”¨æ¥é™åˆ¶å¼‚æ­¥æ¨¡å—å¹¶è¡Œæœ€å¤§è¯·æ±‚æ•°çš„ã€‚\n\n> å‰è€…æ˜¯é™å®šå…¥å£çš„æ–‡ä»¶çš„æ‹†åˆ†ï¼Œåè€…æ˜¯é™å®šå¼‚æ­¥æ¨¡å—çš„æ‹†åˆ†\n\n### minSizeå’ŒmaxSize\n\n`minSize`ï¼šæ»¡è¶³æ‹†åˆ†çš„æœ€å°ä½“ç§¯ï¼ˆå•ä½å­—èŠ‚ï¼‰ã€‚å¤§äºè¿™ä¸ªå¤§å°å¹¶æ»¡è¶³æ‹†åˆ†è§„åˆ™å°±ä¼šè¢«æ‹†åˆ†\n\n`maxSize`ï¼šé»˜è®¤ä¸º0è¡¨ç¤ºä¸ä½œé™åˆ¶ã€‚å¦‚æœé0ã€‚å¾…æ‹†åˆ†æ¨¡å—å¤§å°å¤§äº`maxSize`æ—¶å°±ä¼šæ‹†åˆ†\n\n> è§„åˆ™ä¼˜å…ˆçº§ï¼šmaxInitialRequest/maxAsyncRequests < maxSize < minSize\n\n### cacheGroups\n\nè¿™æ˜¯`splitChunks`æœ€é‡è¦çš„éƒ¨åˆ†ã€‚å®ƒå®šä¹‰äº†æ‹†åˆ†è§„åˆ™ã€‚\n\n```javascript\ncacheGroups: {\n  vendors: {\n    test: /[\\\\/]node_modules[\\\\/]/, // æ­£åˆ™è§„åˆ™ï¼Œå¦‚æœç¬¦åˆå°±æå– chunk\n    priority: -10, // ç¼“å­˜ç»„ä¼˜å…ˆçº§ï¼Œå½“ä¸€ä¸ªæ¨¡å—å¯èƒ½å±äºå¤šä¸ª chunkGroupï¼Œè¿™é‡Œæ˜¯ä¼˜å…ˆçº§\n  },\n}\n```\n\n`test`è¡¨ç¤ºåŒ¹é…è§„åˆ™ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæ­£åˆ™ã€‚`/[\\\\/]node_modules[\\\\/]`è¡¨ç¤ºåŒ¹é…`/node_modules/`æˆ–ç€`\\node_modules\\`\n\n`priority`ï¼šç¼“å­˜ç»„ä¼˜å…ˆçº§ï¼Œå½“ä¸€ä¸ªæ¨¡å—å¯èƒ½å±äºå¤šä¸ª chunkGroupæ—¶ï¼Œå–ä¼˜å…ˆçº§é«˜çš„\n\n`reuseExistingChunk`: trueè¡¨ç¤ºå¤ç”¨å…¶ä»–chunkå†…å·²æ‹¥æœ‰çš„æ¨¡å— å½“chunkså¼•ç”¨äº†å·²ç»å­˜åœ¨çš„è¢«æŠ½ç¦»çš„chunksæ—¶ä¸ä¼šæ–°åˆ›å»ºä¸€ä¸ªchunkè€Œæ˜¯å¤ç”¨chunkã€‚\n\nå…¶å®ƒå±æ€§ï¼š`chunks` `maxInitialRequests` `maxAsyncRequests` `minSize`.......\n\n> cacheGroupsä¸‹æ‰¾ä¸åˆ°`chunks`ç­‰å±æ€§ï¼Œå°±ä¼šå»splitChunksä¸­çš„é…ç½®ã€‚\n\n","tags":["javascript","webpack","æ¶æ„"],"categories":["Webpack"]},{"title":"çŸ¥è¯†ä¸²è”ï¼šJavaScriptæ‰§è¡Œæœºåˆ¶","url":"/posts/1b8392cc.html","content":"\nè¿™ç¯‡æ–‡ç« å°†æ¢³ç†JavaScriptçš„æ‰§è¡Œæœºåˆ¶ï¼Œå¹¶ä¸”ä¸²è”ä¼—å¤šçŸ¥è¯†ç‚¹ï¼šä½œç”¨åŸŸã€ä½œç”¨åŸŸé“¾ã€é—­åŒ…ã€å˜é‡æå‡ã€å‡½æ•°æå‡ã€`this`æŒ‡å‘\n\n## JavaScript æ‰§è¡Œçš„é˜¶æ®µ\n\nåœ¨ V8 å¼•æ“ä¸­ JavaScript ä»£ç çš„è¿è¡Œè¿‡ç¨‹ä¸»è¦åˆ†æˆä¸‰ä¸ªé˜¶æ®µã€‚\n\n- è¯­æ³•åˆ†æé˜¶æ®µã€‚ è¯¥é˜¶æ®µä¼šå¯¹ä»£ç è¿›è¡Œè¯­æ³•åˆ†æï¼Œæ£€æŸ¥æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ï¼ˆSyntaxErrorï¼‰ï¼Œå¦‚æœå‘ç°è¯­æ³•é”™è¯¯ï¼Œä¼šåœ¨æ§åˆ¶å°æŠ›å‡ºå¼‚å¸¸å¹¶ç»ˆæ­¢æ‰§è¡Œã€‚\n\n- ç¼–è¯‘é˜¶æ®µã€‚ è¯¥é˜¶æ®µä¼šè¿›è¡Œå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecution Contextï¼‰çš„åˆ›å»ºï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿè¢«ç§°ä¸ºé¢„è§£æé˜¶æ®µã€‚\n\n- æ‰§è¡Œé˜¶æ®µã€‚ å°†ç¼–è¯‘é˜¶æ®µä¸­åˆ›å»ºçš„æ‰§è¡Œä¸Šä¸‹æ–‡å‹å…¥æ‰§è¡Œæ ˆï¼Œå¹¶æˆä¸ºæ­£åœ¨è¿è¡Œçš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œä»£ç æ‰§è¡Œç»“æŸåï¼Œå°†å…¶å‡ºæ ˆã€‚åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œåˆå¯èƒ½ä¼šäº§ç”Ÿæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆæ¯”å¦‚è°ƒç”¨äº†å‡½æ•°ï¼‰ã€‚å†å°†æ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡å…¥æ ˆï¼Œæ‰§è¡Œå®Œå‡ºæ ˆ\n\n## ä¸‰ç§æ‰§è¡Œä¸Šä¸‹æ–‡\n\næ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯å¯¹æ‰§è¡Œç¯å¢ƒçš„æŠ½è±¡ï¼Œå®ƒä»£è¡¨JavaScriptæ‰§è¡Œæ—¶å½“å‰çš„æ‰§è¡Œç¯å¢ƒï¼Œç”¨äºã€‚JavaScriptä¸­ä¸€å…±æœ‰ä¸‰ç§æ‰§è¡Œä¸Šä¸‹æ–‡\n\n- å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼šæœ‰ä¸”ä»…æœ‰ä¸€ä¸ª\n- å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡\n- `eval`æ‰§è¡Œä¸Šä¸‹æ–‡ï¼šä¸è®¨è®º\n\nå¦‚ä¸‹ä»£ç :\n\n```javascript\nconst name = \"zxfan\"\n\nfunction sayName() {\n  console.log(name)\n}\n\nsayName()\n```\n\nç¼–è¯‘æ—¶ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡`GlobalContext`ï¼Œå¹¶å°†å…¶æ”¾å…¥æ‰§è¡Œæ ˆ\n\næ‰§è¡Œæ—¶ï¼Œæ‰§è¡Œæ ˆæ ˆé¡¶çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå½“æ‰§è¡Œåˆ°`sayName`å‡½æ•°æ—¶ï¼Œåˆä¼šåˆ›å»ºä¸€ä¸ªå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡`FunctionContext`ï¼Œå¹¶å°†å…¶å…¥æ ˆã€‚å½“å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡æ‰§è¡Œå®Œæ¯•ï¼Œå‡ºæ ˆã€‚å…¨å±€ä¸Šä¸‹æ–‡ä¹Ÿæ‰§è¡Œå®Œæ¯•ï¼Œå‡ºæ ˆã€‚\n\n> å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯ç¼–è¯‘æ—¶è¢«åˆ›å»ºçš„\n>\n> å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯æ‰§è¡Œæ—¶è¢«åˆ›å»ºçš„\n\n## æ‰§è¡Œæ ˆ\n\næ‰§è¡Œæ ˆæ˜¯ç”¨æ¥å­˜æ”¾æ‰§è¡Œä¸Šä¸‹æ–‡çš„ã€‚\n\nä»¥å‡½æ•°ä¸ºä¾‹ï¼Œå‡½æ•°æ‰§è¡Œçš„æ—¶å€™åˆ›å»ºå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¹¶å°†å…¶å…¥æ ˆï¼Œå½“å‡½æ•°æ‰§è¡Œå®Œæˆåå†å‡ºæ ˆã€‚å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ç¬¬ä¸€ä¸ªå…¥æ ˆæœ€åä¸€ä¸ªå‡ºæ ˆã€‚\n\n## æ‰§è¡Œä¸Šä¸‹æ–‡åšäº†ä»€ä¹ˆï¼Ÿ\n\næ‰§è¡Œä¸Šä¸‹æ–‡è¢«åˆ›å»ºæ—¶ï¼Œåšäº†ä¸‰ä»¶äº‹ï¼š\n\n- ç¡®å®š`this`çš„æŒ‡å‘\n- åˆ›å»ºç¯å¢ƒè®°å½•\n  - åˆ›å»ºè¯æ³•ç¯å¢ƒ(LexicalEnvironment)\n  - åˆ›å»ºå˜é‡ç¯å¢ƒ(VariableEnvironment)\n\n### thisçš„æŒ‡å‘\n\nthisçš„å–å€¼å–å†³äºå…·ä½“çš„åœºæ™¯ï¼š\n\n- å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼šthiså–å…¨å±€å¯¹è±¡ï¼ˆæµè§ˆå™¨æ˜¯windowå¯¹è±¡ï¼Œnodejsæ˜¯globalå¯¹è±¡ï¼‰\n- å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼š\n  - æ„é€ å‡½æ•°ä¸­ï¼šæŒ‡å‘åˆ›å»ºçš„å®ä¾‹å¯¹è±¡\n  - å¯¹è±¡æ–¹æ³•ï¼šthisæŒ‡å‘è¿™ä¸ªå¯¹è±¡\n  - ç®­å¤´å‡½æ•°ï¼šå¤–å±‚æ‰§è¡Œä¸Šä¸‹æ–‡çš„this\n  - `call` `apply` `bind`ï¼šå¯ä»¥æŒ‡å®šthis\n  - å…¶å®ƒæƒ…å†µï¼šthisä¸ºundefinedï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹ï¼‰\n\n### ç¯å¢ƒè®°å½•(Environment Record)\n\nåŸºäºJavaScriptè¿™ç§åµŒå¥—çš„ä»£ç ç»“æ„ï¼Œç¯å¢ƒè®°å½•ç”¨æ¥è®°å½•ç‰¹å®šçš„**æ ‡è¯†ç¬¦**å’Œä»£ç ä¸­æ‰€å®šä¹‰çš„**å˜é‡å’Œå‡½æ•°**ä¹‹é—´çš„å…³ç³»ã€‚\n\næ¢å¥è¯è¯´ï¼Œç¯å¢ƒè®°å½•å°±æ˜¯è®°å½•ä¸€å †æ ‡è¯†ç¬¦ï¼Œè¿™äº›æ ‡è¯†ç¬¦æŒ‡å‘å…·ä½“ä»£ç ä¸­çš„æ•°æ®ã€‚\n\n```java\nconst name = \"zxfan\"\nvar age = 18\n\nfunction sayName() {\n  console.log(name)\n}\n```\n\nå…¶ç¯å¢ƒè®°å½•\n\n```json\nEnvironment Record {\n\tname: <uninitialized> // ä»£ç æ‰§è¡Œå®Œå name: <\"zxfan\">\n  age: <18> // var å…·æœ‰å˜é‡æå‡ï¼Œæ‰€ä»¥è¿™é‡Œä¸æ˜¯uninitialized\n\tsayName: <function> // functionæœ‰å‡½æ•°æå‡ï¼Œæ‰€ä»¥è¿™é‡Œä¸æ˜¯uninitialized\n}\n```\n\nç¯å¢ƒè®°å½•åˆ†ç±»ä¸‰ç§ç±»å‹ï¼ˆå£°æ˜ç¯å¢ƒè®°å½•åˆåˆ†ä¸ºä¸¤ç§ï¼‰ï¼š\n\n- å£°æ˜ç¯å¢ƒè®°å½•ï¼š åŒ…å«`var` `let` `const` `class` `function`  `import`å£°æ˜çš„å˜é‡çš„æ ‡è¯†ç¬¦ã€‚\n  - å‡½æ•°ç¯å¢ƒè®°å½•ï¼š `function`\n  - æ¨¡å—ç¯å¢ƒè®°å½•ï¼š`import`\n- å¯¹è±¡ç¯å¢ƒè®°å½•ï¼šä¸ºå¯¹è±¡åˆ›å»ºä¸€ä¸ªç¯å¢ƒè®°å½•ï¼Œå®ƒæœ‰ä¸€ä¸ª**å…³è”çš„ç»‘å®šå¯¹è±¡[[BindingObject]]**ã€‚æ¯”å¦‚å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡ç¯å¢ƒè®°å½•ï¼Œå…¶å…³è”ç»‘å®šçš„å¯¹è±¡æ˜¯å…¨å±€å¯¹è±¡ï¼ˆwindowæˆ–globalï¼‰\n- å…¨å±€ç¯å¢ƒè®°å½•ï¼šæœ€å¤–å±‚ç¯å¢ƒè®°å½•ï¼ŒåŒ…å«å£°æ˜ç¯å¢ƒè®°å½•å’Œå¯¹è±¡ç¯å¢ƒè®°å½•\n\n**è¯æ³•ç¯å¢ƒå’Œå˜é‡ç¯å¢ƒæœ¬è´¨ä¸Šéƒ½æ˜¯ç¯å¢ƒè®°å½•**ï¼Œè¿™ä¹ˆåšæ˜¯ä¸ºäº†å•ç‹¬åŒºåˆ†`var`\n\n#### è¯æ³•ç¯å¢ƒï¼ˆä½œç”¨åŸŸï¼‰\n\nè¯æ³•ç¯å¢ƒå¯ä»¥ç†è§£ä¸º**ä½œç”¨åŸŸ**ï¼Œä»è¯æ³•ç¯å¢ƒçš„è§’åº¦èƒ½æ›´å¥½åœ°ç†è§£ä½œç”¨åŸŸã€‚è¯æ³•ç¯å¢ƒæœ‰ä¸¤ä¸ªæˆå‘˜ï¼š\n\n- ç¯å¢ƒè®°å½•ï¼ˆEnvironment Recordï¼‰ï¼šç”¨äºè®°å½•è‡ªèº«è¯æ³•ç¯å¢ƒä¸­çš„å˜é‡å¯¹è±¡ã€‚\n- å¤–éƒ¨è¯æ³•ç¯å¢ƒå¼•ç”¨ï¼ˆOuter Lexical Environmentï¼‰ï¼šè®°å½•å¤–å±‚è¯æ³•ç¯å¢ƒçš„å¼•ç”¨ã€‚\n\n##### ç¯å¢ƒè®°å½•\n\nè¯æ³•ç¯å¢ƒçš„ç¯å¢ƒè®°å½•ï¼Œä¼šä¿å­˜**å‡½æ•°å£°æ˜**å’Œ**å˜é‡å£°æ˜**(`let`å’Œ`const`å£°æ˜çš„å˜é‡)ï¼Œå¦‚\n\n```javascript\nfunction sayFullName() {\n  const firstName = \"Donald\"\n  const lastName = \"Trump\"\n  console.log(firstName, lastName)\n}\nsayFullName()\n```\n\n`sayFullNmae`çš„è¯æ³•ç¯å¢ƒ\n\n```json\nLexicalEnciroment {\n\tEnviroment Record {\n\t\tfirstName: <uninitialize>\n\t\tlastName: <uninitialize>\n\t\targuments: <{}>\n\t}\n\touter: <Global or outer function environment reference>  \n}\n```\n\næ³¨æ„ï¼š`let`å’Œ`const`å®šä¹‰çš„å˜é‡åˆå§‹éƒ½æ˜¯`uninitialize`ã€‚å½“ä»£ç æ‰§è¡Œåæ‰ä¼šèµ‹å€¼ã€‚\n\n##### å¤–éƒ¨è¯æ³•ç¯å¢ƒå¼•ç”¨ï¼ˆä½œç”¨åŸŸé“¾ï¼‰\n\nä»»ä½•ä¸€ä¸ªè¯æ³•ç¯å¢ƒï¼ˆå…¨å±€è¯æ³•ç¯å¢ƒé™¤å¤–ï¼‰éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘å¤–å±‚è¯æ³•ç¯å¢ƒçš„å¼•ç”¨ã€‚è¿™æ„æˆäº†è¯æ³•ç¯å¢ƒé“¾å³**ä½œç”¨åŸŸé“¾**ã€‚å½“è®¿é—®ä¸€ä¸ªå˜é‡æ—¶ï¼Œå…ˆä¼šåœ¨å½“å‰è¯æ³•ç¯å¢ƒä¸­å¯»æ‰¾ï¼Œæ‰¾ä¸åˆ°å°±å»å¤–éƒ¨è¯æ³•ç¯å¢ƒä¸­å¯»æ‰¾ã€‚å°±è¿™æ ·ï¼Œä¸€ç›´æ‰¾åˆ°å…¨å±€è¯æ³•ç¯å¢ƒã€‚\n\n#### å˜é‡ç¯å¢ƒ\n\nå˜é‡ç¯å¢ƒå’Œè¯æ³•ç¯å¢ƒçš„ç»“æ„ä¸€è‡´ï¼ŒåŒºåˆ«æ˜¯å…¶ç¯å¢ƒè®°å½•æ‰€è®°å½•çš„æ•°æ®ä¸åŒã€‚\n\nè¯­æ³•ç¯å¢ƒçš„ç¯å¢ƒè®°å½•ï¼Œæ˜¯è®°å½•`var`å£°æ˜ã€‚\n\n\n\n> ç¯å¢ƒè®°å½• è¯æ³•ç¯å¢ƒ ä½œç”¨åŸŸ å…¶å®éƒ½æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œè¿™ä¹ˆåŒºåˆ†æ˜¯ä¸ºäº†é’ˆå¯¹ä¸åŒåœºæ™¯æ–¹ä¾¿ç†è§£ã€‚\n\n## å¸¸è§é—®é¢˜\n\n### è§£é‡Šä½œç”¨åŸŸä¸ä½œç”¨åŸŸé“¾\n\nJSçš„ä½œç”¨åŸŸæ—¶è¯æ³•ä½œç”¨åŸŸï¼Œæœ‰è¯æ³•ç»“æ„å†³å®šã€‚jsä»£ç ç¼–è¯‘æ—¶åˆ›å»ºå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡åˆä¼šåˆ›å»ºå½“å‰ç¯å¢ƒçš„ç¯å¢ƒè®°å½•ï¼ˆåˆ†ä¸ºè¯æ³•ç¯å¢ƒå’Œå˜é‡ç¯å¢ƒï¼‰ã€‚å½“æ‰§è¡Œjsä»£ç æ—¶ï¼ˆæ¯”å¦‚è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼‰ï¼Œåˆä¼šåˆ›å»ºå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚éšä¹‹å‡½æ•°ç¯å¢ƒçš„ç¯å¢ƒå°±åˆä¼šåˆ›å»ºã€‚\n\næ¯ä¸ªç¯å¢ƒè®°å½•éƒ½æœ‰ä¸ªouterå¼•ç”¨ï¼ŒæŒ‡å‘å¤–å±‚ç¯å¢ƒè®°å½•ã€‚å¤–å±‚å†æŒ‡å‘å¤–å±‚ï¼Œä¸€ç›´åˆ°æœ€å¤–å±‚ã€‚è¿™ä¾¿æ„æˆäº†ä½œç”¨åŸŸé“¾ã€‚\n\n### é—­åŒ…\n\nè§£é‡Šé—­åŒ…å°±æ˜¯è§£é‡Š**ä½œç”¨åŸŸ**å’Œ**åƒåœ¾å›æ”¶æœºåˆ¶**\n\n[é—­åŒ…](https://en.wikipedia.org/wiki/Closure_(computer_programming)) æ˜¯æŒ‡å†…éƒ¨å‡½æ•°æ€»æ˜¯å¯ä»¥è®¿é—®å…¶æ‰€åœ¨çš„å¤–éƒ¨å‡½æ•°ä¸­å£°æ˜çš„å˜é‡å’Œå‚æ•°ï¼Œå³ä½¿åœ¨å…¶å¤–éƒ¨å‡½æ•°è¢«è¿”å›ï¼ˆå¯¿å‘½ç»ˆç»“ï¼‰äº†ä¹‹åã€‚\n\næ­£å¸¸æƒ…å†µä¸‹ï¼Œä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå…¶ç›¸åº”çš„æ‰§è¡Œä¸Šä¸‹æ–‡å‡ºæ ˆï¼Œç›¸åº”çš„å†…å­˜ç©ºé—´ä¼šè¢«å›æ”¶ã€‚ç„¶è€Œï¼Œé—­åŒ…æƒ…å†µä¸‹ï¼Œå†…å±‚è¯æ³•ç¯å¢ƒï¼ˆä½œç”¨åŸŸï¼‰å¯ä»¥è®¿é—®åˆ°ï¼Œæ‰€ä»¥å¤–å±‚è¯æ³•ç¯å¢ƒä¸ä¼šè¢«å›æ”¶ï¼Œä»ç„¶å¯ä»¥è®¿é—®åˆ°ï¼Œä½†ä»…é™åœ¨å†…å±‚è¯æ³•ç¯å¢ƒè®¿é—®ã€‚\n\n### å˜é‡æå‡å’Œå‡½æ•°æå‡\n\nç¯å¢ƒè®°å½•åˆ›å»ºæ—¶ï¼Œä¼šè®°å½•å½“å‰ç¯å¢ƒä¸‹æ‰€æœ‰å˜é‡ï¼Œé‡åˆ°ï¼š\n\n- varå˜é‡å£°æ˜ï¼šæ­¤æ—¶ä¼šç»™å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºundefinedï¼ˆè¯¥è¿‡ç¨‹åªè¿›è¡Œå®šä¹‰å£°æ˜ï¼Œæ‰§è¡Œé˜¶æ®µæ‰æ‰§è¡Œèµ‹å€¼è¯­å¥ï¼‰ã€‚\n\n- å‡½æ•°å£°æ˜ï¼šæ­¤æ—¶ä¼šåœ¨å†…å­˜é‡Œåˆ›å»ºå‡½æ•°å¯¹è±¡ï¼Œå¹¶ä¸”ç›´æ¥åˆå§‹åŒ–ä¸ºè¯¥å‡½æ•°å¯¹è±¡ã€‚\n\n### thisæŒ‡å‘\n\nthisæŒ‡å‘æ˜¯åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºæ—¶æ‰ç¡®å®šçš„ï¼Œå…·ä½“æŒ‡å‘è°å–å†³äºå…·ä½“åœºæ™¯ã€‚ä¸Šæ–‡å·²è®¨è®ºã€‚\n\n","tags":["JavaScript"],"categories":["JavaScript"]},{"title":"XSSæ”»å‡»ä¸é˜²å¾¡","url":"/posts/df6ed6ff.html","content":"\n`xss(cross-site script)`æŒ‡**ç½‘ç«™å¯¹ç”¨æˆ·è¾“å…¥æ•°æ®æœªåšæœ‰æ•ˆè¿‡æ»¤ï¼Œæ”»å‡»è€…å¯ä»¥å°†æ¶æ„è„šæœ¬æ³¨å…¥ç½‘ç«™é¡µé¢ä¸­ï¼Œè¾¾åˆ°æ‰§è¡Œæ¶æ„ä»£ç çš„ç›®çš„**\n\næ”»å‡»è€…åªéœ€è¦è¯±ä½¿å—å®³è€…æ‰“å¼€ç‰¹å®šçš„ç½‘å€ï¼Œå°±å¯ä»¥åœ¨å—å®³è€…çš„æµè§ˆå™¨ä¸­æ‰§è¡Œè¢«æ³¨å…¥çš„æ¶æ„ä»£ç ï¼Œä»è€Œçªƒå–ç”¨æˆ·èº«ä»½ï¼Œæ‰§è¡Œä¸€äº›æ•æ„Ÿæ“ä½œ\n\n## XSSæ”»å‡»ç±»å‹\n\nXSSæ”»å‡»å¯ä»¥åˆ†æˆä¸‰ç§ç±»å‹ï¼š\n\n- åå°„å‹XSS\n\n- å­˜å‚¨å‹XSS\n- DOMå‹XSS\n\n### åå°„å‹\n\nåå°„å‹æŒ‡çš„æ˜¯**å°†æ”»å‡»ä»£ç å­˜æ”¾åœ¨URLå‚æ•°ä¸­**ï¼Œä¾‹å¦‚`http://localhost/home?name=<script>alert(1)</script>`ã€‚\n\nå¦‚æœæœåŠ¡ç«¯ç›´æ¥å»urlä¸­çš„nameå‚æ•°ï¼Œå¹¶å½“ä½œhtmlè¿”å›ç»™å®¢æˆ·ç«¯ã€‚æ”»å‡»ä»£ç å°±ä¼šæ‰§è¡Œã€‚\n\n### å­˜å‚¨å‹\n\nå­˜å‚¨å‹æ˜¯æŒ‡**å°†æ¶æ„ä»£ç å­˜å‚¨åˆ°æœåŠ¡å™¨ä¸Š**ï¼Œåªè¦è¯±ä½¿å—å®³è€…è®¿é—®è¢«æ’å…¥æ¶æ„ä»£ç çš„é¡µé¢å³å¯è§¦å‘ã€‚å­˜å‚¨å‹ XSS ç»å¸¸å‡ºç°åœ¨ä¸€äº›å¯ä»¥å‘è¡¨è¯„è®ºçš„åœ°æ–¹ï¼Œå¦‚å¸–å­ã€åšå®¢\n\nå½“ç”¨æˆ·åœ¨è¯„è®ºä¸­è¾“å…¥ä¸€æ®µæ”»å‡»ä»£ç ï¼Œç½‘ç«™åˆæ²¡æœ‰è¿‡æ»¤ã€‚è¿™æ®µä»£ç ä¼šå­˜å‚¨åˆ°æ•°æ®åº“ä¸­ã€‚å½“å…¶å®ƒç”¨æˆ·è®¿é—®è¯„è®ºæ—¶ï¼Œè¿™æ®µæ”»å‡»ä»£ç è¢«å½“ä½œhtmlå†…å®¹è¾“å‡ºå°±ä¼šå¼•å‘æ”»å‡»ä»£ç çš„æ‰§è¡Œ\n\n### DOMå‹\n\n**å‰ä¸¤ç§éƒ½æ˜¯æœåŠ¡ç«¯çš„XSSï¼ŒDOMå‹æ˜¯å®¢æˆ·ç«¯çš„XSS**\n\nJavaScript èƒ½å¤Ÿæ“ä½œDOMã€‚é€šè¿‡JavaScriptæ§åˆ¶è·å–**æºæ•°æ®ï¼ˆå†…å«æ”»å‡»ä»£ç ï¼‰**ï¼Œåˆæœªè¿›è¡Œå¤„ç†ã€‚ç›´æ¥**å½“ä½œHTMLè¾“å‡ºï¼ˆinnerHTMLï¼‰æˆ–è„šæœ¬æ‰§è¡Œ**\n\nå°±ä¼šå‘ç”ŸDOMå‹XSSæ”»å‡»\n\nå¸¸è§çš„æºæ•°æ®æœ‰ï¼š`document` `location` `localStorage` `sessionStorage`ç­‰\n\nå¸¸è§çš„è§¦å‘æ”»å‡»çš„ç‚¹ï¼š`document.write` `eval` `innerHTML` `açš„hrefå±æ€§`ç­‰\n\n## XSSå¸¸è§çš„æ”»å‡»æ–¹å¼\n\n### çªƒå–cookie\n\nè®¸å¤šç½‘ç«™éƒ½ä½¿ç”¨`cookie`æ¥å­˜æ”¾ç”¨æˆ·ç™»é™†ä¿¡æ¯ã€‚\n\næ”»å‡»è€…åˆ©ç”¨`xss`æ¼æ´æ¥æ³¨å…¥è„šæœ¬ã€‚`document.cookie`å°±å¯ä»¥è·å–åˆ°cookieã€‚ç„¶åå†å°†è·å–åˆ°çš„cookieä¸ŠæŠ¥ã€‚ä¹‹åå°±å¯ä»¥æœ¬åœ°ä¿®æ”¹ Cookie æ¥ç™»å½•å—å®³è€…çš„è´¦å·\n\n### è •è™«æ”»å‡»\n\nä»¥å¾®åšXSSè •è™«æ”»å‡»ä¸ºä¾‹ï¼š\n\n- åˆ©ç”¨ XSS æ¼æ´æ’å…¥æ¶æ„ JS ä»£ç ï¼›\n\n- åˆ©ç”¨ XMLHttpRequest å‘é€è¯·æ±‚å»å‘è¡¨å¾®åšã€å…³æ³¨ç”¨æˆ·ã€è·å–å…³æ³¨è€…åˆ—è¡¨å¹¶å‘å…¶å‘é€ç§ä¿¡ï¼›\n\n- å¾®åšæ¶ˆæ¯å’Œç§ä¿¡éƒ½åŒ…å«æœ‰æ¶æ„æ”»å‡»é“¾æ¥ï¼Œç­‰äºå®ç°äº†æ”»å‡»ä»£ç çš„è‡ªæˆ‘å¤åˆ¶å’Œä¼ æ’­ã€‚\n\n### è·å–ç”¨æˆ·é”®ç›˜è®°å½•\n\n```javascript\nkeys = \"\"\ndocument.onkeypress = function(){\n  keys += String.fromCharCode(window.event.keyCode);\n}\n```\n\n### è·å–å‰ªè´´æ¿å†…å®¹\n\n```javascript\ndocument.addEventListener('paste', function (evt) {\n  clipdata = evt.clipboardData || window.clipboardData;\n  console.log(clipdata.getData('text/plain'));\n});\n```\n\n### é’“é±¼æ¬ºéª—ç”¨æˆ·è¾“å…¥è´¦å·ã€å¯†ç \n\nå¼¹ä¸ªå¼¹çª—ï¼Œè®©ç”¨æˆ·è¾“å…¥è´¦å·å¯†ç \n\n## XSSæ¼æ´æŒ–æ˜\n\n#### æ”¶é›†ç”¨ä¾‹\n\näººå·¥æµ‹è¯•çš„ä¸»è¦æ€è·¯å°±æ˜¯åœ¨ä¸€åˆ‡å¯è¾“å…¥æ•°æ®çš„åœ°æ–¹è¾“å…¥â€œXSS payloadâ€ï¼ˆæµ‹è¯•ç”¨ä¾‹ï¼‰ï¼Œè¿™äº›åœ°æ–¹åŒ…æ‹¬æ‰€æœ‰çš„ GETã€POSTã€Cookieã€HTTP å¤´ã€‚æäº¤æ•°æ®ä¹‹åï¼Œçœ‹ç½‘ç«™çš„è¾“å‡ºæ˜¯å¦è§£æäº†å‰é¢è¾“å…¥çš„ XSS payloadã€‚\n\næˆ‘å¸¸ç”¨çš„ XSS payload æœ‰ä»¥ä¸‹å‡ ä¸ªã€‚æœç´¢â€œXSS cheat sheetâ€ï¼Œä¹Ÿå¯ä»¥æ‰¾åˆ°å¾ˆå¤šè¿™ç§æµ‹è¯•ç”¨ä¾‹ã€‚\n\n[Cross-site scripting (XSS) cheat sheet](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet)\n\n[XSS Filter Evasion Cheat Sheet](https://owasp.org/www-community/xss-filter-evasion-cheatsheet)\n\n[HTML5 Security Cheatsheet](http://html5sec.org/)\n\n#### æµ‹è¯•\n\nè¿™ä¸€æ­¥å¯ä»¥æ‰‹åŠ¨æµ‹è¯•ä¹Ÿå¯ä»¥é‡‡ç”¨è‡ªåŠ¨æµ‹è¯•å·¥å…·ã€‚\n\næ‰‹åŠ¨ï¼šå¯ä»¥å…ˆä¸€æ¬¡æ€§æ‰¹é‡è¾“å…¥æµ‹è¯•ï¼Œå¦‚æœæ— æ•ˆï¼Œå†è¾“å…¥ä¸€äº›ç‰¹æ®Šå­—ç¬¦çœ‹è¿‡æ»¤æƒ…å†µï¼Œæ ¹æ®è¿”å›æ•°æ®ä½œç›¸åº”çš„è°ƒæ•´æµ‹è¯•ã€‚\n\nè‡ªåŠ¨ï¼š[XSStrike](https://github.com/s0md3v/XSStrike)ï¼Œå®ƒå†…ç½®äº†å¾ˆå¤šæµ‹è¯•ç”¨ä¾‹ï¼Œä¹Ÿå¯ä»¥æ·»åŠ è‡ªå®šä¹‰æµ‹è¯•ç”¨ä¾‹\n\n## XSSé˜²å¾¡\n\n### åšå¥½æ£€æŸ¥\n\n#### è¾“å…¥æ£€æŸ¥\n\næ£€æŸ¥æ”»å‡»è€…æ‰€æœ‰å¯èƒ½çš„è¾“å…¥çš„åœ°æ–¹\n\n- `URL`å‚æ•°\n- ï¼ˆå¯Œï¼‰æ–‡æœ¬æ¡†\n- æ¥å£è¿”å›çš„æ•°æ®\n\n> æœåŠ¡ç«¯ä¹Ÿéœ€è¦è¿›è¡Œæ£€æŸ¥ï¼Œå‰ç«¯æ˜¯å¯ä»¥ç»•è¿‡å»çš„\n\n#### è¾“å‡ºæ£€æŸ¥\n\nä»å‰ç«¯è§’åº¦æ¥çœ‹ï¼Œæœ‰ä¸¤ä¸ªåœ°æ–¹å¯èƒ½å¯¼è‡´æ¶æ„ä»£ç æ‰§è¡Œâ€”â€”`HTML`å’Œ`JavaScript`\n\n- HTMLï¼š`innerHTML` `outerHTML` `document.write()` `v-html` `danderousSetInnerHTML`\n\n  å°†åŸæ•°æ®å½“ä½œHTMLè¾“å‡ºï¼Œæå®¹æ˜“å¯¼è‡´XSSæ”»å‡»ã€‚å°½é‡é¿å…è¿™ä¹ˆåšï¼Œä½¿ç”¨`textContent`æ¥ä»£æ›¿ã€‚å¦‚æœå¿…é¡»è¾“å‡ºï¼ˆå¦‚è¯„è®ºå†…å®¹ï¼‰ï¼Œéœ€è¦è¿›è¡Œ**è½¬ä¹‰**ã€‚é€šå¸¸ä½¿ç”¨**ç™½åå•**çš„æ–¹å¼è¿›è¡Œè½¬ä¹‰ã€‚\n\n  > [xss](https://www.npmjs.com/package/xss)æ˜¯npmä¸Šçš„ä¸€ä¸ªä¸é”™çš„HTMLè½¬ä¹‰åº“\n\n- JavaScriptï¼š\n\n  - å†…è”äº‹ä»¶ç›‘å¬å™¨ï¼š`location` `onclick` `onerror` `onload` `onmousemove`ç­‰ç­‰ç­‰\n  - aæ ‡ç­¾çš„hrefå±æ€§ä½¿ç”¨ä¼ªåè®®ï¼š`<a href=\"javascript:alert('attack')\" />`\n  - `eval` `setTimeout` `setInterval`éƒ½èƒ½å¤ŸæŠŠå­—ç¬¦ä¸²å½“ä½œjsæ‰§è¡Œ\n\n  è¿™äº›apiçš„ä¸æ°å½“ä½¿ç”¨ä¼šå¯¼è‡´XSSæ”»å‡»ï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶è¦æ ¼å¤–æ³¨æ„ã€‚å¥½åœ¨å®ƒä»¬å¤§å¤šéƒ½æœ‰å¯æ›¿ä»£æ–¹æ¡ˆã€‚\n\n### HttpOnlyç¦æ­¢cookieè®¿é—®\n\nå¦‚æœç»™æŸä¸ª cookie è®¾ç½®äº† `HttpOnly` å±æ€§ï¼Œåˆ™æ— æ³•é€šè¿‡ JS è„šæœ¬ è¯»å–åˆ°è¯¥ cookie çš„ä¿¡æ¯ï¼Œä½†è¿˜æ˜¯èƒ½é€šè¿‡ Application ä¸­æ‰‹åŠ¨ä¿®æ”¹ cookieï¼Œæ‰€ä»¥åªæ˜¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥é˜²æ­¢ XSS æ”»å‡»ï¼Œä¸æ˜¯ç»å¯¹çš„å®‰å…¨\n\n```text\nSet-Cookie: Name=Value; expires=Wednesday, 01-May-2014 12:45:10 GMT; HttpOnly\n```\n\n> cookieç”±æœåŠ¡ç«¯åˆ›å»ºè¿”å›ç»™æµè§ˆå™¨çš„ï¼ˆå“åº”å¤´ï¼š`Set-Cookie`ï¼‰ã€‚ä¹‹åçš„è¯·æ±‚ä¼šè‡ªåŠ¨æºå¸¦cookieã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒéšç€seesionçš„ç»“æŸè€Œç»“æŸã€‚\n>\n> èƒ½ä¸ä½¿ç”¨cookieå°±åˆ«ä½¿ç”¨äº†\n\n### CSP å†…å®¹å®‰å…¨ç­–ç•¥\n\nå†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆContent Security Policyï¼ŒCSPï¼‰ä¹Ÿæ˜¯å‡å°‘ XSS æ”»å‡»çš„ä¸€ç§æ–¹å¼ ï¼Œæ˜¯æµè§ˆå™¨æä¾›ä¸€ç§é˜²å¾¡æœºåˆ¶ã€‚å®ƒé‡‡ç”¨çš„æ˜¯ç™½åå•æœºåˆ¶ï¼Œå‘Šè¯‰æµè§ˆå™¨å¯ä»¥åŠ è½½å’Œæ‰§è¡Œå“ªäº›å¤–éƒ¨èµ„æºï¼Œè¿™æ ·å°±èƒ½é˜²æ­¢è¢«ä¸€äº›ç¬¬ä¸‰æ–¹æ¶æ„è„šæœ¬æ³¨å…¥æ‰§è¡Œã€‚\n\nå¼€å¯ CSP æœ‰ä¸¤ç§æ–¹å¼ï¼š\n\n1. é€šè¿‡ HTTP å¤´ä¿¡æ¯çš„ Content-Security-Policy çš„å­—æ®µï¼š(åœ¨è¿”å›htmlæ–‡ä»¶çš„è¯·æ±‚çš„å“åº”å¤´ä¸ŠåŠ )\n\n   ```text\n   Content-Security-Policy: script-src 'self'; object-src 'none';style-src cdn.example.org third-party.org; child-src https:ï¼ˆ2ï¼‰é€šè¿‡ç½‘é¡µçš„<meta>æ ‡ç­¾è®¾ç½®ï¼š\n   ```\n\n2. é€šè¿‡ç½‘é¡µçš„`<meta>`æ ‡ç­¾è®¾ç½®\n\n   ```html\n   <meta\n     http-equiv=\"Content-Security-Policy\"\n     content=\"script-src 'self'; object-src 'none'; style-src cdn.example.org third-party.org; child-src https:\"\n   />\n   ```\n\nå¦‚ä½•æŒ‡å®šcspï¼š**æŒ‡ä»¤ ç­–ç•¥**\n\næŒ‡ä»¤å­—æ®µå«ä¹‰ï¼š\n\n| æŒ‡ä»¤          | ç­–ç•¥ç¤ºä¾‹             | å«ä¹‰                                                     |\n| ------------- | -------------------- | -------------------------------------------------------- |\n| `default-src` | `'self' www.aaa.com` | é»˜è®¤èµ„æºåŠ è½½ç­–ç•¥ï¼Œæ²¡æœ‰æŒ‡å®šç­–ç•¥çš„æŒ‡ä»¤ä½¿ç”¨æœ¬ç­–ç•¥           |\n| `script-src`  | `'selft' js.a.com`   | é’ˆå¯¹jsæ–‡ä»¶çš„ç­–ç•¥                                         |\n| `style-src`   | `'selft' css.a.com`  | é’ˆå¯¹cssæ–‡ä»¶çš„ç­–ç•¥                                        |\n| `img-src`     | `'selft' img.a.com`  | é’ˆå¯¹imgå›¾ç‰‡èµ„æºçš„ç­–ç•¥                                    |\n| `connect-src` | `'selft'`            | é’ˆå¯¹ajaxã€websocketçš„ç­–ç•¥ï¼Œä¸å…è®¸ä¼šè¿”å›400               |\n| `font-src`    | `font.a.com`         | é’ˆå¯¹å­—ä½“çš„åŠ è½½ç­–ç•¥                                       |\n| `media-src`   | `media.a.com`        | é’ˆå¯¹videoå’Œaudioå¼•å…¥èµ„æºçš„ç­–ç•¥                           |\n| `frame-src`   | `'self'`             | é’ˆå¯¹frameçš„åŠ è½½ç­–ç•¥                                      |\n| `sandbox`     | `allow-forms`        | å¯¹è¯·æ±‚èµ„æºå¯ç”¨`sandbox`                                  |\n| `report-uri`  | `/report-uri`        | å‘ŠçŸ¥æµè§ˆå™¨ï¼Œå½“è¯·æ±‚èµ„æºä¸è¢«ç­–ç•¥å…è®¸æ—¶ï¼Œå¾€é‚£ä¸ªæ¥å£æäº¤ä¿¡æ¯ |\n\næŒ‡ä»¤å€¼å­—æ®µå«ä¹‰ï¼š\n\n- `none` è¡¨ç¤ºä¸æ‰§è¡Œä»»ä½•åŒ¹é…ã€‚\n-  `self`è¡¨ç¤ºä¸å½“å‰æ¥æºï¼ˆè€Œä¸æ˜¯å…¶å­åŸŸï¼‰åŒ¹é…ã€‚\n-  `unsafe-inline`è¡¨ç¤ºå…è®¸ä½¿ç”¨å†…è” JavaScript å’Œ CSSã€‚\n-  `unsafe-eval` è¡¨ç¤ºå…è®¸ä½¿ç”¨ç±»ä¼¼ eval çš„ text-to-JavaScript æœºåˆ¶ã€‚\n- `www.aasd.com`å…è®¸åŠ è½½æŒ‡å®šåŸŸåçš„èµ„æº\n\n","tags":["FrontEnd","å®‰å…¨"],"categories":["Security"]},{"title":"æ’åºé—®é¢˜æ¢³ç†","url":"/posts/88f2a5b3.html","content":"\n## å½’å¹¶æ’åº\n\n### æ•°ç»„çš„å½’å¹¶æ’åº\n\n[912. æ’åºæ•°ç»„](https://leetcode-cn.com/problems/sort-an-array/)\n\nå½’å¹¶æ’åºç±»ä¼¼äºŒå‰æ ‘çš„ååºéå†ï¼Œæ€æƒ³ä¹Ÿä¸€è‡´ï¼šåˆ©ç”¨å­æ ‘çš„ä¿¡æ¯æ¨ç®—å‡ºæ•´æ£µæ ‘çš„ä¿¡æ¯\n\nè®°å¿†ï¼š\n\n1. å°†liståˆ’åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œ\n2. ååºéå†\n3. åˆå¹¶ä¸¤ä¸ªæœ‰åºlist\n\n```typescript\nfunction sortArray(nums: number[], low = 0, high = nums.length - 1): number[] {\n  // ååºéå†\n  if (low < high) {\n    // 1. åˆ’åˆ†\n    const mid = low + ((high - low) >> 1);\n    \n    // 2.åç»­éå†\n    sortArray(nums, low, mid);\n    sortArray(nums, mid + 1, high);\n    \n    // 3. åˆå¹¶ä¸¤ä¸ªæœ‰åºlist\n    merge(nums, low, mid, high);\n  }\n\n  return nums;\n}\n\n// åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„\n// æ•°ç»„Aï¼š nums[low ... mid]\n// æ•°ç»„Bï¼šnums[mid+1 ... high]\nfunction merge(nums: number[], low: number, mid: number, high: number) {\n  const store: number[] = [];\n\n  // ä¸¤ä¸ªæ•°ç»„çš„èµ·å§‹ç´¢å¼•\n  let i = low;\n  let j = mid + 1;\n\n  while (i <= mid && j <= high) {\n    if (nums[i] < nums[j]) store.push(nums[i++]);\n    else store.push(nums[j++]);\n  }\n\n  while (i <= mid) store.push(nums[i++]);\n  while (j <= high) store.push(nums[j++]);\n\n  store.forEach((num) => (nums[low++] = num));\n}\n```\n\næ—¶é—´å¤æ‚åº¦ O(nlgn)ï¼Œç©ºé—´å¤æ‚åº¦ O(n)\n\n### é“¾è¡¨çš„å½’å¹¶æ’åº\n\n[148. æ’åºé“¾è¡¨](https://leetcode-cn.com/problems/sort-list/)\n\næ€è·¯éƒ½ä¸€æ ·ï¼ŒåŒæ ·çš„ä¸‰æ­¥\n\n```typescript\nfunction sortList(head: ListNode | null): ListNode | null {\n  if (head === null || head.next === null) return head;\n  const dummy = new ListNode();\n\n  // 1.åˆ’åˆ†\n  const [back, front] = divide(head);\n\n  // 2.åç»­éå†\n  const left = sortList(back);\n  const right = sortList(front);\n\n  // 3.åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨\n  dummy.next = merge(left, right);\n\n  return dummy.next;\n}\n\n// å°†é“¾è¡¨åˆ’åˆ†æˆä¸¤éƒ¨åˆ†\nfunction divide(head: ListNode) {\n  let back = head;\n  let front = head;\n\n  while (front.next) {\n    front = front.next;\n    if (front.next === null) break;\n    front = front.next;\n    back = back;\n  }\n  const result = [head, back.next!];\n  back.next = null;\n  return result;\n}\n\n// åˆå¹¶ä¸¤ä¸ªæœ‰åºåˆ—è¡¨ l1 l2\nfunction merge(l1: ListNode | null, l2: ListNode | null) {\n  const dummy = new ListNode();\n  let tail = dummy;\n  while (l1 && l2) {\n    if (l1.val < l2.val) {\n      tail.next = l1;\n      l1 = l1.next;\n    } else {\n      tail.next = l2;\n      l2 = l2.next;\n    }\n    tail = tail.next;\n  }\n  if (l1) tail.next = l1;\n  if (l2) tail.next = l2;\n\n  return dummy.next;\n}\n```\n\n### æ•°ç»„ä¸­çš„é€†åºå¯¹\n\n[å‰‘æŒ‡ Offer 51. æ•°ç»„ä¸­çš„é€†åºå¯¹](https://leetcode-cn.com/problems/shu-zu-zhong-de-ni-xu-dui-lcof/)\n\nè¿™é“é¢˜ä¹Ÿæ˜¯åˆ©ç”¨å½’å¹¶æ’åºä¸­çš„**åˆ†æ²»æ€æƒ³**ã€‚ç°å°†æ•°ç»„ä¸æ–­åˆ’åˆ†ï¼Œç„¶ååˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„`a[low...mid]`å’Œ`a[mid+1...high]`ï¼Œå¾ªç¯æ¯”è¾ƒ`a[i]`å’Œ`a[j]`çš„å¤§å°\n\n- å¦‚æœ`a[j]`å°ï¼Œå³`a[i...mid]`æ‰€æœ‰å…ƒç´ éƒ½æ¯”`a[j]`å¤§ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬æ„æˆäº†é€†åºå¯¹ã€‚é€†åºå¯¹çš„æ•°é‡åŠ ä¸Š`mid-i+1`\n- å¦‚æœ`a[i]`å°ï¼Œæ— éœ€å¤„ç†\n\n### å³ä¾§è¾ƒå°å…ƒç´ ä¸ªæ•°\n\n[315. è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°](https://leetcode-cn.com/problems/count-of-smaller-numbers-after-self/)\n\n## å¿«é€Ÿæ’åº\n\n```typescript\nfunction sortArray(nums: number[], low = 0, high = nums.length - 1): number[] {\n  if (low < high) {\n    const index = partition(nums, low, high);\n    sortArray(nums, low, index - 1);\n    sortArray(nums, index + 1, high);\n  }\n  return nums;\n}\n\n// åˆ’åˆ†æ“ä½œ\nfunction partition(nums: number[], low: number, high: number) {\n  const target = nums[low];\n  while (low < high) {\n    while (low < high && nums[high] >= target) high--;\n    nums[low] = nums[high];\n    while (low < high && nums[low] <= target) low++;\n    nums[high] = nums[low];\n  }\n  nums[low] = target;\n  return low;\n}\n```","tags":["JavaScript","TypeScript","Algorithm"],"categories":["Algorithm"]},{"title":"é˜Ÿåˆ—é—®é¢˜æ¢³ç†","url":"/posts/631e9859.html","content":"\n## BFS å¹¿åº¦ä¼˜å…ˆéå†\n\nBFSã€å¹¿åº¦ä¼˜å…ˆã€å±‚åºéå†éƒ½æ˜¯ä¸€å›äº‹ã€‚éœ€è¦é€šè¿‡é˜Ÿåˆ—æ¥å®ç°\n\n###  é˜Ÿåˆ—å®ç°BFS\n\n```typescript\n/**\n * Definition for a binary tree node.\n * class TreeNode {\n *     val: number\n *     left: TreeNode | null\n *     right: TreeNode | null\n *     constructor(val?: number, left?: TreeNode | null, right?: TreeNode | null) {\n *         this.val = (val===undefined ? 0 : val)\n *         this.left = (left===undefined ? null : left)\n *         this.right = (right===undefined ? null : right)\n *     }\n * }\n */\n\nfunction levelOrder(root: TreeNode | null): number[][] {\n  const queue: TreeNode[] = [root]\n  const ans = []\n\n  if (root === null) return ans\n  while (queue.length > 0) {\n    const node = queue.shift()\n    ans.push(node.val)\n    if (node.left) queue.push(node.left)\n    if (node.right) queue.push(node.right)\n  }\n\n  return ans\n};\n```\n\n### æŒ‰å±‚æ¬¡è¾“å‡ºå±‚åºéå†\n\nåœ¨å±‚åºéå†çš„è¿‡ç¨‹ä¸­è¿˜è¦è®°ä½å½“å‰å¤„åœ¨æ‹¿ä¸€å±‚\n\n- ç”¨ä¸€ä¸ªlastæŒ‡é’ˆæŒ‡å‘æ¯ä¸€å±‚æœ€åä¸€ä¸ªèŠ‚ç‚¹\n- æˆ–è€…ï¼Œå‰åºéå†ã€‚é€ä¸ªç»™æ¯ä¸€å±‚æ·»åŠ å…ƒç´ ã€‚å‰åºéå†æ˜¯å…ˆéå†ç¬¬ä¸€ä¸ªç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åç¬¬äºŒå±‚ç¬¬ä¸€ä¸ªå…ƒç´ ....\n\n[102. äºŒå‰æ ‘çš„å±‚åºéå†](https://leetcode-cn.com/problems/binary-tree-level-order-traversal/)\n\nå¾€å¾€ï¼Œè€ƒé¢˜ä¸ä¼šåªé é˜Ÿåˆ—è¿™ä¸€ä¸ªç‚¹ã€‚å±‚åºéå†åªæ˜¯è§£å†³é—®é¢˜çš„ä¸€ä¸ªæ‰‹æ®µ\n\n### å¡«å……å³ä¾§èŠ‚ç‚¹\n\n[117. å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ II](https://leetcode-cn.com/problems/populating-next-right-pointers-in-each-node-ii/)\n\nè€ƒç‚¹ï¼šå±‚åºéå†+lastæŒ‡é’ˆè®°ä½å±‚æ¬¡\n\nå±‚æ¬¡éå†åˆ°å½“å‰èŠ‚ç‚¹æ—¶ï¼š\n\n- å½“å‰èŠ‚ç‚¹æ˜¯lastï¼šä¸ä¿®æ”¹nextæŒ‡é’ˆ\n- ä¸æ˜¯lastï¼šå°†å½“å‰èŠ‚ç‚¹çš„nextæŒ‡å‘é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ \n\n## å¾ªç¯é˜Ÿåˆ—\n\n### å®ç°\n\n[622. è®¾è®¡å¾ªç¯é˜Ÿåˆ—](https://leetcode-cn.com/problems/design-circular-queue/)\n\nå¾ªç¯é˜Ÿåˆ—æœ‰ä¸¤ç§å®ç°æ–¹å¼\n\n#### fornt+rear+used\n\n![å¾ªç¯é˜Ÿåˆ—](../../images/algorithm/å¾ªç¯é˜Ÿåˆ—1.png)\n\nfrontå’Œrearåˆ†åˆ«æŒ‡å‘é˜Ÿå¤´å’Œé˜Ÿå°¾ï¼Œusedè®°å½•é˜Ÿåˆ—çš„å…ƒç´ ä¸ªæ•°ï¼Œå½“ï¼š\n\n- é˜Ÿåˆ—ä¸ºç©ºï¼šfront = rearä¸”used=0\n- é˜Ÿåˆ—æ»¡äº†ï¼šfront=rearä¸”used=é˜Ÿåˆ—é•¿åº¦\n- å…¶å®ƒæƒ…å†µï¼šfront != rearï¼Œused=é˜Ÿåˆ—å…ƒç´ ä¸ªæ•°\n\n#### æµªè´¹ä¸€ä¸ªç©ºé—´\n\n![å¾ªç¯é˜Ÿåˆ—2](../../images/algorithm/å¾ªç¯é˜Ÿåˆ—2.png)\n\nfrontå’Œrearåˆ†åˆ«æŒ‡å‘é˜Ÿå¤´å’Œé˜Ÿå°¾ï¼Œå½“ï¼š\n\n- é˜Ÿåˆ—ä¸ºç©ºï¼šfront = rear\n- é˜Ÿåˆ—æ»¡äº†ï¼š(rear + 1) % capacity == front\n- å…¶å®ƒæƒ…å†µï¼šfront != rear\n\n### ğŸŒŸåœ¨jsä¸­å®ç°å¾ªç¯é˜Ÿåˆ—\n\næ— éœ€æŒ‡é’ˆï¼Œç›´æ¥è°ƒç”¨æ•°ç»„å¯¹è±¡çš„`push`å’Œ`shift`æ–¹æ³•æ¨¡æ‹Ÿé˜Ÿåˆ—ã€‚\n\nå¾ªç¯é˜Ÿåˆ—çš„å‡ºç°æ˜¯å› ä¸ºå…¶å®ƒè¯­è¨€çš„æ•°ç»„æ˜¯å®šé•¿çš„ï¼Œåœ¨å£°æ˜æ—¶å°±è¦æŒ‡å®šé•¿åº¦ï¼Œæ‰€ä»¥éœ€è¦å……åˆ†åˆ©ç”¨ç©ºé—´ã€‚è€ŒJavaScriptä¸­çš„æ•°ç»„ï¼Œæ— éœ€å£°æ˜æ˜¯æŒ‡å®šé•¿åº¦ã€‚æ‰€ä»¥å¹¶ä¸éœ€è¦å¾ªç¯é˜Ÿåˆ—è¿™ç§æ•°æ®ç»“æ„ã€‚\n\nç†è®ºä¸Š`shift`åˆ é™¤é˜Ÿåˆ—é¦–å…ƒç´ ï¼Œä¼šå¯¼è‡´åé¢æ‰€æœ‰å…ƒç´ å‘å‰ç§»åŠ¨ä¸€ä½ã€‚ä½†æ˜¯åœ¨`v8`çš„ä¼˜åŒ–ä¸‹ï¼Œè¿™ç§æ–¹å¼æ¯”`front`+`rear`ä¸¤ä¸ªæŒ‡é’ˆè¦å¿«\n\n```typescript\nclass MyCircularQueue {\n  private size: number;\n  private queue: number[] = [];\n\n  constructor(k: number) {\n    this.size = k;\n  }\n\n  enQueue(value: number): boolean {\n    if (this.isFull()) return false;\n    this.queue.push(value);\n    return true;\n  }\n\n  deQueue(): boolean {\n    if (this.isEmpty()) return false;\n    this.queue.shift();\n    return true;\n  }\n\n  Front(): number {\n    if (this.isEmpty()) return -1;\n    return this.queue[0];\n  }\n\n  Rear(): number {\n    if (this.isEmpty()) return -1;\n    return this.queue[this.queue.length - 1];\n  }\n\n  isEmpty(): boolean {\n    return this.queue.length === 0;\n  }\n\n  isFull(): boolean {\n    return this.queue.length === this.size;\n  }\n}\n```\n\n## å•è°ƒé˜Ÿåˆ—\n\nå•è°ƒé˜Ÿåˆ—ï¼š\n\n- åŸºäºåŒç«¯é˜Ÿåˆ—ï¼šä¸¤ç«¯éƒ½å¯ä»¥å…¥é˜Ÿå’Œå‡ºé˜Ÿ\n- é˜Ÿåˆ—å…ƒç´ æ»¡è¶³**å•è°ƒé€’å¢**æˆ–è€…**å•è°ƒé€’å‡**\n\n### æ»‘åŠ¨çª—å£æœ€å¤§å€¼\n\n[239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼](https://leetcode-cn.com/problems/sliding-window-maximum/)\n\n","tags":["JavaScript","TypeScript","Algorithm"],"categories":["Algorithm"]},{"title":"Vue3ä»»åŠ¡è°ƒåº¦-vue3æºç ","url":"/posts/d2a05aba.html","content":"\nåœ¨vue3ä¸­ï¼Œä¿®æ”¹ä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œåƒæ˜¯è¿™æ ·ï¼š\n\n```typescript\n<template>\n  <span class=\"my-name\">name: {{ name }}</span>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ref, watchEffect } from 'vue'\n\nconst name = ref(\"zxfan\")\n\nname.value += ' yes!'\n\n</script>\n```\n\nå½“æ‰§è¡Œ`name.value += ' yes!'`ï¼Œ`vue3`å¹¶ä¸ä¼šç«‹å³è§¦å‘å½“å‰ç»„ä»¶çš„æ›´æ–°ã€‚è€Œæ˜¯å°†æ›´æ–°ä»»åŠ¡æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚è¿™ä¸€ç‚¹ä¸vue2ä¸€è‡´ã€‚\n\n## ä»»åŠ¡é˜Ÿåˆ—\n\nè°ƒåº¦ç›¸å…³çš„æºç ä½äº`runtime-core/src/schduler.ts`ä¸­\n\nåœ¨ä»»åŠ¡è°ƒåº¦è¿‡ç¨‹ä¸­ï¼Œä»»åŠ¡ä¼šè¢«æ”¾å…¥ä¸‰ç±»ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼š\n\n- preFlushCbsï¼šè¦åœ¨æ‰§è¡Œqueueä¹‹å‰æ‰§è¡Œçš„é˜Ÿåˆ—\n\n- queueï¼šä»»åŠ¡é˜Ÿåˆ—\n- postFlushï¼šè¦åœ¨æ‰§è¡Œqueueä¹‹åæ‰§è¡Œçš„é˜Ÿåˆ—\n\næ¯ä¸€æ¬¡flushçš„è¿‡ç¨‹ï¼ˆæˆ–è€…è¯´ä¸€ä¸ª`Tick`ï¼‰ï¼Œéƒ½æ˜¯æŒ‰ç…§**æ¸…ç©ºpreFlushCbsé˜Ÿåˆ—->æ¸…ç©ºqueueé˜Ÿåˆ—->æ¸…ç©ºpostFlushé˜Ÿåˆ—**çš„é¡ºåº\n\n> flush æŒ‡åˆ·æ–°ä»»åŠ¡é˜Ÿåˆ—ï¼Œæˆ–è€…è¯´ æ‰§è¡Œå®Œä»»åŠ¡é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„ä»»åŠ¡\n\n## å…¥é˜Ÿqueueçš„æ—¶æœº\n\n`queue`å­˜æ”¾çš„éƒ½æ˜¯ç»„ä»¶æ¸²æŸ“ä»»åŠ¡\n\n### ç»„ä»¶æ›´æ–°\n\nå…ˆæä¸€ä¸‹vueä¸­çš„å“åº”å¼ï¼š\n\n```typescript\nimport {effect, ref} from '@vue/reactivity'\n\nconst age = ref(20)\n\neffect(() => {\n  console.log(age.value) // ä¼šè¾“å‡ºä¸¤æ¬¡ï¼Œåˆ†åˆ«æ˜¯ 20 å’Œ 21\n})\n\nage.value = 21\n```\n\n`effect`çš„å›è°ƒå‡½æ•°ä¼šè¢«å“åº”å¼å¾—é‡å†™è§¦å‘æ‰§è¡Œã€‚\n\né‚£ä¹ˆå›åˆ°æœ¬æ–‡æœ€å¼€å§‹çš„ä¾‹å­ä¸­ï¼Œå½“æ‰§è¡Œ`name.value += ' yes!'`ã€‚å“åº”å¼æ•°æ®å˜åŒ–äº†ï¼Œè§¦å‘ï¼ˆ`trigger`ï¼‰å…¶å…³è”åˆ°çš„`effect`é‡æ–°æ‰§è¡Œã€‚é‚£ä¹ˆéœ€è¦é‡æ–°æ‰§è¡Œçš„`effect`åœ¨å“ªé‡Œå£°æ˜çš„å‘¢ï¼Ÿ\n\n```typescript\n// runtie-core/src/renderer.ts\nconst setupRenderEffect: SetupRenderEffectFn = (\n  instance,\n  initialVNode,\n  container,\n  anchor,\n  parentSuspense,\n  isSVG,\n  optimized\n) => {\n  // create reactive effect for rendering\n  instance.update = effect(function componentEffect() {\n    // çœç•¥ã€‚ã€‚ã€‚åˆ›å»ºæˆ–æ›´æ–° VNode\n  }, __DEV__ ? createDevEffectOptions(instance) : prodEffectOptions)\n}\n```\n\n`setupRenderEffect`ç»™ç»„ä»¶å¥—ä¸Šäº†ä¸ª`effect`ã€‚è¿™ä¸ªå‡½æ•°æ˜¯ç»„ä»¶å®ä¾‹åˆ›å»ºçš„æ—¶å€™è°ƒç”¨çš„ã€‚\n\nå½“ä¿®æ”¹ç»„ä»¶å†…çš„å“åº”å¼æ•°æ®æ—¶ï¼Œä¼šè§¦å‘è¯¥`effect`é‡æ–°æ‰§è¡Œã€‚\n\nå½“ç„¶ä¸ä¼šç›´æ¥å°±æ‰§è¡Œäº†ï¼Œæ³¨æ„åˆ°äº†å—ï¼Œeffectè¿˜æœ‰ç¬¬äºŒä¸ªå‚æ•°ã€‚ç¬¬äºŒä¸ªå‚æ•°çš„ç±»å‹å¦‚ä¸‹ï¼š\n\n```typescript\nexport interface ReactiveEffectOptions {\n  lazy?: boolean // è¯¥effectæ˜¯å¦\n  scheduler?: (job: ReactiveEffect) => void // è°ƒåº¦\n  onTrack?: (event: DebuggerEvent) => void\n  onTrigger?: (event: DebuggerEvent) => void\n  onStop?: () => void\n  allowRecurse?: boolean\n}\n```\n\nå…¶å®ƒå…ˆä¸å…³æ³¨ï¼Œæˆ‘ä»¬åªçœ‹`scheduler`å±æ€§ã€‚\n\nå¦‚æœæœ‰è¿™ä¸ªå±æ€§ï¼Œå°±ä¸ä¼šç›´æ¥æ‰§è¡Œ`effect`ï¼Œè€Œæ˜¯è°ƒç”¨è¿™ä¸ª`scheduler`å‡½æ•°ï¼Œå¹¶ä¸”å°†`effect`ä½œä¸ºå‚æ•°ä¼ ç»™å®ƒ\n\n```typescript\nexport function trigger(\n  target: object,\n  type: TriggerOpTypes,\n  key?: unknown,\n  newValue?: unknown,\n  oldValue?: unknown,\n  oldTarget?: Map<unknown, unknown> | Set<unknown>\n) {\n  \n  // çœç•¥...\n  \n  const run = (effect: ReactiveEffect) => {\n\n    // æœ‰scheduler è°ƒç”¨ scheduler\n    if (effect.options.scheduler) {\n      effect.options.scheduler(effect)\n    } else {\n      // å¦åˆ™ç›´æ¥æ‰§è¡Œ effect\n      effect()\n    }\n  }\n\n  effects.forEach(run)\n}\n```\n\né‚£ä¹ˆåœ¨ç»™ç»„ä»¶å®ä¾‹å¥—ä¸Š`effect`çš„æ—¶å€™ï¼Œä¼ ç»™`effect`çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n\n```typescript\n// runtie-core/src/renderer.ts\n\nconst prodEffectOptions = {\n  scheduler: queueJob,\n  // #1801, #2043 component render effects should allow recursive updates\n  allowRecurse: true\n}\n\nfunction createDevEffectOptions(\n  instance: ComponentInternalInstance\n): ReactiveEffectOptions {\n  return {\n    scheduler: queueJob,\n    allowRecurse: true,\n    onTrack: instance.rtc ? e => invokeArrayFns(instance.rtc!, e) : void 0,\n    onTrigger: instance.rtg ? e => invokeArrayFns(instance.rtg!, e) : void 0\n  }\n}\n```\n\n`__DEV__ ? createDevEffectOptions(instance) : prodEffectOptions)`æ ¹æ®ä¸åŒçš„ç¯å¢ƒä¼ é€’çš„å‚æ•°æœ‰ä¸€äº›å·®å¼‚æ€§ã€‚ä½†æ˜¯æˆ‘ä»¬åªå…³æ³¨schedulerï¼Œ`scheduler`çš„å€¼éƒ½æ˜¯`queueJob`è¿™ä¸ªå‡½æ•°\n\n`queueJob`çš„ä½œç”¨å°±æ˜¯å°†`effect`æ”¾å…¥`queue`ä»»åŠ¡é˜Ÿåˆ—ã€‚\n\nç¨ååœ¨è®¨è®º`queueJob`å…·ä½“éƒ½åšäº†äº›ä»€ä¹ˆï¼Œå…ˆæ€»ç»“ä¸€ä¸‹ç»„ä»¶æ›´æ–°çš„è°ƒåº¦æµç¨‹\n\n1. ç»„ä»¶å®ä¾‹åˆ›å»ºæ—¶ï¼Œå¥—ä¸Šäº†effectæ–¹æ³•\n\n2. ä¿®æ”¹å“åº”å¼æ•°æ®ï¼Œè§¦å‘effecté‡æ–°æ‰§è¡Œï¼ˆå…ˆè°ƒç”¨triggerå‡½æ•°ï¼‰\n\n3. effectçš„ç¬¬äºŒä¸ªå‚æ•°ä¸­æœ‰`scheduler`å±æ€§ï¼Œæ‰€ä»¥ä¸ä¼šç›´æ¥æ‰§è¡Œeffectæ–¹æ³•ï¼Œè€Œæ˜¯å°†è°ƒç”¨`scheduler`æ–¹æ³•å³`queueJob`\n4. å°†ç»„ä»¶æ›´æ–°effectæ”¾å…¥`queue`é˜Ÿåˆ—ä¸­\n\n### è°ƒç”¨forceUpdate\n\nåœ¨`vue2`ä¸­å¯ä»¥ä½¿ç”¨`this.$forceUpdate`å¼ºåˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚è¿™ä¸€APIåœ¨vue3 Options APIä¸­ä¿ç•™äº†ä¸‹æ¥\n\n```typescript\n// runtime-core/src/componentPublicInstance.ts\n\nconst publicPropertiesMap: PublicPropertiesMap = extend(Object.create(null), {\n  // çœç•¥...\n  \n  $forceUpdate: i => () => queueJob(i.update),\n  \n  // çœç•¥...\n} as PublicPropertiesMap)\n```\n\nå¯ä»¥è§‚å¯Ÿåˆ°ï¼Œ`forceUpdate`å°±æ˜¯ç›´æ¥è°ƒç”¨`queueJob`ï¼Œå¹¶å°†`effect`(i.updateå°±æ˜¯effect)ä¼ å…¥ã€‚\n\n### hmr\n\nå¼€å‘ç¯å¢ƒä¸‹ï¼Œçƒ­æ›´æ–°ä¹Ÿä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚ä¹Ÿæ˜¯è°ƒç”¨`queueJob`å°†æ›´æ–°ä»»åŠ¡åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—\n\n## å…¥é˜ŸpreFlushCbså’ŒpostFlushCbsçš„æ—¶æœº\n\n`preFlushCbs`å­˜æ”¾çš„æ˜¯ç»„ä»¶æ¸²æŸ“å‰éœ€è¦å®Œæˆçš„ä»»åŠ¡\n\n`postFlushCbs`å­˜æ”¾çš„æ˜¯ç»„ä»¶æ¸²æŸ“å®Œæˆåè¦å®Œæˆçš„ä»»åŠ¡\n\n### watchEffectå’Œwatch\n\nä»¥`watchEffect`ä¸ºä¾‹ï¼Œçœ‹ä¸€ä¸‹å®ƒçš„ç±»å‹å£°æ˜ï¼š\n\n```typescript\nfunction watchEffect(\n  effect: (onInvalidate: InvalidateCbRegistrator) => void,\n  options?: WatchEffectOptions\n): StopHandle\n\ninterface WatchEffectOptions {\n  flush?: 'pre' | 'post' | 'sync' // é»˜è®¤ï¼š'pre'\n  onTrack?: (event: DebuggerEvent) => void\n  onTrigger?: (event: DebuggerEvent) => void\n}\n```\n\n`watchEffect`çš„ç¬¬äºŒä¸ªå‚æ•°ä¸­æœ‰ä¸ª`flush`å±æ€§ï¼Œæœ‰ä¸‰ç§å–å€¼\n\n- `pre`ï¼ˆé»˜è®¤ï¼‰ï¼šåœ¨ç»„ä»¶æ¸²æŸ“å‰å¼‚æ­¥è°ƒç”¨ï¼Œä¼šå°†ä»»åŠ¡æ”¾å…¥`preFlushCbs`é˜Ÿåˆ—ä¸­\n- `post`ï¼šåœ¨ç»„ä»¶æ¸²æŸ“åå¼‚æ­¥è°ƒç”¨ï¼Œä¼šå°†ä»»åŠ¡æ”¾å…¥`postFlushCbs`é˜Ÿåˆ—ä¸­\n- `sync`ï¼šåŒæ­¥è°ƒç”¨\n\nåˆ†ææºç ï¼Œæ¥çœ‹ä¸€ä¸‹å…·ä½“æ”¾å…¥é˜Ÿåˆ—çš„æ“ä½œï¼š\n\n```typescript\nexport function watchEffect(\n  effect: WatchEffect,\n  options?: WatchOptionsBase\n): WatchStopHandle {\n  // è°ƒç”¨doWatchæ–¹æ³•\n  return doWatch(effect, null, options)\n}\n\n\nfunction doWatch(\n  source: WatchSource | WatchSource[] | WatchEffect | object,\n  cb: WatchCallback | null,\n  { immediate, deep, flush, onTrack, onTrigger }: WatchOptions = EMPTY_OBJ,\n  instance = currentInstance\n): WatchStopHandle {\n  \n  // çœç•¥...\n    \n  const job: SchedulerJob = () => {\n    // çœç•¥\n    // ä¼šæ‰§è¡Œä¼ å…¥çš„å›è°ƒ cb\n  }\n\n  // èµ‹å€¼scheduler\n  let scheduler: ReactiveEffectOptions['scheduler']\n  if (flush === 'sync') {\n    scheduler = job\n  } else if (flush === 'post') {\n    scheduler = () => queuePostRenderEffect(job, instance && instance.suspense)\n  } else {\n    // default: 'pre'\n    scheduler = () => {\n      if (!instance || instance.isMounted) {\n        queuePreFlushCb(job)\n      } else {\n        // ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œç»„ä»¶æœªæ¸²æŸ“çš„è¯ï¼ŒåŒæ­¥æ‰§è¡Œ\n        job()\n      }\n    }\n  }\n\n  // åˆ›å»ºeffect\n  const runner = effect(getter, {\n    lazy: true, // trueçš„è¯ï¼Œ effectç¬¬ä¸€æ¬¡ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œè€Œæ˜¯ç›´æ¥è¿”å›effect\n    onTrack,\n    onTrigger,\n    scheduler\n  })\n  \n  // çœç•¥...\n}\n```\n\næ€»ç»“ä¸€ä¸‹ï¼š\n\n1. å“åº”å¼éƒ½æ˜¯é€šè¿‡`effect`æ¥å®ç°çš„\n2. å…ˆèµ‹å€¼`sheduler`ï¼Œæœ‰ä¸‰ç§æƒ…å†µ\n   - `flush: sync`ï¼šç›´æ¥èµ‹å€¼`job`ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥è§¦å‘effectæ‰§è¡Œ\n   - `flush: post`ï¼šèµ‹å€¼ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°ä¼šæ‰§è¡Œ`queuePostRenderEffect`ï¼Œå³å°†`job`æ”¾å…¥`postFlushCbs`é˜Ÿåˆ—\n   - `flush: pre`ï¼šèµ‹å€¼ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°ä¼šæ‰§è¡Œ`queuePreRenderEffect`ï¼Œå³å°†`job`æ”¾å…¥`preFlushCbs`é˜Ÿåˆ—\n\n3. åˆ›å»º`effect`ï¼Œä»¥å®ç°å“åº”å¼ å¹¶å°†`scheduler`ä¼ å…¥ã€‚å½“å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šè°ƒç”¨`scheduler`å‡½æ•°\n\n\n\né™¤æ­¤ä¹‹å¤–ï¼Œåœ¨Vnodeåˆ›å»ºã€æ›´æ–°å’Œé”€æ¯çš„è¿‡ç¨‹ä¸­ï¼Œè®¸å¤šç¯èŠ‚éœ€è¦åœ¨ç»„ä»¶æ›´æ–°å®Œä¹‹åå†å»æ‰§è¡Œç›¸åº”æ“ä½œã€‚vueè°ƒç”¨äº†`queuePostFlushCb`ã€‚\n\n## ä»»åŠ¡è°ƒåº¦\n\nç°åœ¨æ¥å…·ä½“çœ‹ä¸€ä¸‹è¿™äº›**ä»»åŠ¡**è¿›å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­éƒ½åšäº†ä»€ä¹ˆï¼š\n\n### queueJob\n\n```typescript\n// runtime-core/src/schduler.ts\nexport function queueJob(job: SchedulerJob) {\n  // åˆ¤æ–­é˜Ÿåˆ—ä¸­æ˜¯å¦å·²æœ‰è¯¥jobï¼Œæ²¡æœ‰æ‰ä¼šæ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­\n  if (\n    (!queue.length ||\n      !queue.includes(\n        job,\n        isFlushing && job.allowRecurse ? flushIndex + 1 : flushIndex\n      )) &&\n    job !== currentPreFlushParentJob\n  ) {\n    // æ‰¾çš„ä»»åŠ¡åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆé€‚çš„ä½ç½®\n    const pos = findInsertionIndex(job)\n    if (pos > -1) {\n      queue.splice(pos, 0, job)\n    } else {\n      queue.push(job)\n    }\n    // æ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—\n    queueFlush()\n  }\n}\n```\n\nå…ˆè¿›è¡Œé‡å¤åˆ¤æ–­ã€‚**è¿™æ˜¯ç¡®ä¿ä»»åŠ¡é˜Ÿåˆ—ä¸­ä¸ä¼šå‡ºç°å¤šä¸ªç›¸åŒç»„ä»¶çš„effectï¼Œé˜²æ­¢ç»„ä»¶é‡å¤æ¸²æŸ“**ã€‚\n\næœ€ç»ˆè°ƒç”¨`queueFlush`æ¥æ‰§è¡Œæ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—ï¼ˆæ‰§è¡Œå®Œæ‰€æœ‰ä»»åŠ¡ï¼‰\n\n### queuePreFlushCb\n\n```typescript\n// runtime-core/src/schduler.ts\nfunction queueCb(\n  cb: SchedulerCbs,\n  activeQueue: SchedulerCb[] | null,\n  pendingQueue: SchedulerCb[],\n  index: number\n) {\n  if (!isArray(cb)) {\n    if (\n      !activeQueue ||\n      !activeQueue.includes(\n        cb,\n        (cb as SchedulerJob).allowRecurse ? index + 1 : index\n      )\n    ) {\n      pendingQueue.push(cb)\n    }\n  } else {\n    pendingQueue.push(...cb)\n  }\n  \n  // æ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—\n  queueFlush()\n}\n\nexport function queuePreFlushCb(cb: SchedulerCb) {\n  queueCb(cb, activePreFlushCbs, pendingPreFlushCbs, preFlushIndex)\n}\n\nexport function queuePostFlushCb(cb: SchedulerCbs) {\n  queueCb(cb, activePostFlushCbs, pendingPostFlushCbs, postFlushIndex)\n}\n```\n\n`queuePreFlushCb`å’Œ`queuePostFlushCb`éƒ½ä¼šå†å»è°ƒç”¨`queueCb`å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åšä¸¤ä»¶äº‹\n\n1. å°†ä»»åŠ¡æ”¾å…¥å“åº”çš„ä»»åŠ¡é˜Ÿåˆ—ï¼ˆå½“ç„¶ å…ˆåˆ¤æ–­é‡å¤ï¼‰\n2. æ‰§è¡Œ`queueFlush`ï¼Œæ¥æ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—\n\n### queueFlush\n\n```typescript\n// runtime-core/src/schduler.ts\nconst resolvedPromise: Promise<any> = Promise.resolve()\nfunction queueFlush() {\n  if (!isFlushing && !isFlushPending) {\n    isFlushPending = true\n    currentFlushPromise = resolvedPromise.then(flushJobs)\n  }\n}\n\nfunction flushJobs(seen?: CountMap) {\n  // çœç•¥...\n  \n  // 1. æ¸…ç©ºpreFlushCbé˜Ÿåˆ—\n  flushPreFlushCbs(seen)\n  \n\t// çœç•¥...\n  \n  try {\n    // 2. æ¸…ç©ºqueueé˜Ÿåˆ—\n    for (flushIndex = 0; flushIndex < queue.length; flushIndex++) {\n      const job = queue[flushIndex]\n      if (job) {\n        // æ‰§è¡Œjobï¼Œä¹Ÿå°±æ˜¯å‰é¢ä¼ å…¥çš„effect\n        callWithErrorHandling(job, null, ErrorCodes.SCHEDULER)\n      }\n    }\n  } finally {\n\n    // çœç•¥...\n    \n    // 3. æ¸…ç©ºpostFlushCbsé˜Ÿåˆ—\n    flushPostFlushCbs(seen)\n\t\t// çœç•¥...\n  }\n}\n```\n\næ¸…ç©ºé˜Ÿåˆ—ä¸»è¦æµç¨‹ï¼š\n\n1. å¼‚æ­¥æ‰§è¡Œ`flushJob`ï¼Œè¿™é‡Œä½¿ç”¨äº†`resolvedPromise.then(flushJobs)`ã€‚å°†æ¸…ç©ºé˜Ÿåˆ—çš„æ“ä½œå˜æˆäº†å¼‚æ­¥ã€‚\n2. æ¸…ç©ºpreFlushCbé˜Ÿåˆ—\n3. æ¸…ç©ºqueueé˜Ÿåˆ—\n4. æ¸…ç©ºpostFlushCbsé˜Ÿåˆ—\n\nè¿™é‡Œçš„â€œæ¸…ç©ºâ€æ˜¯æ‰§è¡Œé˜Ÿåˆ—ä¸­æ‰€æœ‰ä»»åŠ¡çš„æ„æ€\n\n## nextTickåŸç†ï¼Ÿ\n\nå…ˆçœ‹ä¸€æ®µdemoï¼š\n\n```vue\n<template>\n  <span class=\"my-name\">name: {{name}}</span>\n</template>\n\n<script lang=\"ts\" setup>\nimport { nextTick, onMounted, ref } from 'vue'\n\nconst name = ref(\"zxfan\")\n\nonMounted(() => {\n  name.value += ' yes!'\n  const dom = document.querySelector(\".my-name\")\n  \n  console.log(dom?.innerHTML); // è¾“å‡ºï¼šname: zxfan\n  nextTick(() => {\n    console.log(dom?.innerHTML); // è¾“å‡ºï¼šname: zxfan yes!\n  })\n})\n</script>\n```\n\nç”±äºä¿®æ”¹å“åº”å¼æ•°æ®ï¼Œä¸ä¼šç«‹å³è§¦å‘ç»„ä»¶é‡æ¸²æŸ“ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ª`console.log`è¾“å‡ºçš„å†…å®¹æ˜¯ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å†…å®¹ã€‚è€Œ`nexTick`æ³¨å†Œçš„å›è°ƒä¼šç­‰åˆ°åœ¨æ¸²æŸ“å®Œæ¯•åæ‰§è¡Œã€‚\n\næˆ‘ä»¬çœ‹ä¸€ä¸‹`nextTick`æ˜¯å¦‚ä½•å®ç°çš„\n\n```typescript\n// runtime-core/src/schduler.ts\nexport function nextTick(\n  this: ComponentPublicInstance | void,\n  fn?: () => void\n): Promise<void> {\n  const p = currentFlushPromise || resolvedPromise\n  return fn ? p.then(this ? fn.bind(this) : fn) : p\n}\n```\n\næ³¨æ„åˆ°ï¼Œå®ƒæ˜¯ç­‰promiseæ‰§è¡Œå®Œæ¯•ååœ¨å»æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚é‚£ä¹ˆè¿™ä¸ªpromiseæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n\n- `currentFlushPromise`ï¼šè¿™ä¸ªpromiseæˆ‘ä»¬åˆšåˆšé‡åˆ°è¿‡ï¼Œæ˜¯åœ¨`queueFlush`ä¸­èµ‹å€¼çš„ã€‚è¿™ä¸ªpromiseä¼šåœ¨æœ¬è½®ä»»åŠ¡é˜Ÿåˆ—å…¨éƒ¨æ¸…ç©ºåæ‰ä¼šå˜æˆ`fullfilled`ã€‚è¿™æ˜¯å†å»è°ƒç”¨nextTickçš„å›è°ƒï¼Œå°±èƒ½è·å–åˆ°æœ€æ–°çš„dom\n- `resolvedPromise`ï¼šè¯´æ˜ç°åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£å°±åŒ…è£…ä¸€å±‚promiseå¹¶è¿”å›\n\n\n\nè¦ç†è§£nextTickï¼Œè¿˜éœ€è¦ç»“åˆæµè§ˆå™¨çš„**äº‹ä»¶å¾ªç¯**æ¥åˆ†æï¼Œæˆ‘ä»¬å…ˆæ˜ç¡®å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š\n\n1. æµè§ˆå™¨çš„äº‹ä»¶å¾ªç¯å°†äº‹ä»¶æ”¾åˆ°ä¸¤ä¸ªé˜Ÿåˆ—â€”â€”**å®ä»»åŠ¡é˜Ÿåˆ—**å’Œ**å¾®ä»»åŠ¡é˜Ÿåˆ—\n2. æ¯ä¸€æ¬¡äº‹ä»¶å¾ªç¯ï¼Œä¼šä¼˜å…ˆå…ˆæ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—\n3. promiseå±äºå¾®ä»»åŠ¡\n\nä»¥ä¸‹é¢çš„demoä¸ºä¾‹ï¼Œè§£é‡Šä¸€ä¸‹ä»ä¿®æ”¹å“åº”å¼æ•°æ®åˆ°`nextTick`ä¸­å›è°ƒæ‰§è¡Œçš„è¿‡ç¨‹\n\n```typescript\nname.value += ' yes!'\nnextTick(() => {\n  console.log(dom?.innerHTML); // è¾“å‡ºï¼šname: zxfan yes!\n})\n```\n\n1. å½“æ‰§è¡Œ`name.value += ' yes!'`æ—¶ï¼Œå“åº”å¼æ•°æ®å‘ç”Ÿäº†æ”¹å˜ã€‚\n   - è§¦å‘Proxyçš„setterï¼Œå°†**æ›´æ–°ç»„ä»¶ä»»åŠ¡çš„effect**æ”¾å…¥vueä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼ˆè°ƒç”¨queueJobï¼‰\n   - è°ƒç”¨queueFlushï¼Œè¿™é‡Œè°ƒç”¨äº†`promise.resolve`ï¼Œæ‰€ä»¥å°†**flushJobs**æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—\n   - æ­¤æ—¶å¾®ä»»åŠ¡é˜Ÿåˆ—= [flushJobs]\n2. æ¥ç€æ‰§è¡Œ`nextTick`ã€‚ç­‰å¾…`currentFlushPromise`æ‰§è¡Œå®Œæ¯•\n3. å¼€å§‹æ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚å…ˆæ‰§è¡ŒflushJobsï¼Œæ‰§è¡Œ**æ›´æ–°ç»„ä»¶ä»»åŠ¡çš„effect**ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šæ“ä½œDOMï¼Œä¸€æ—¦æ“ä½œDOMã€‚æµè§ˆå™¨ä¼šè¿›è¡Œçº¿ç¨‹åˆ‡æ¢ã€‚ç”±**JSçº¿ç¨‹**åˆ‡æ¢åˆ°**æ¸²æŸ“çº¿ç¨‹**ï¼Œæµè§ˆå™¨å»æ›´æ–°DOMã€‚å½“DOMæ›´æ–°å®Œæ¯•ï¼Œåœ¨åˆ‡æ¢å›**JSçº¿ç¨‹**ã€‚å›åˆ°JSçº¿ç¨‹åï¼Œ`currentFlushPromise`çŠ¶æ€å˜æˆ`fullfilled`ã€‚å°†nextTickçš„å›è°ƒ`cb`æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚æ­¤æ—¶å¾®ä»»åŠ¡é˜Ÿåˆ—= [cb]\n4. ç»§ç»­æ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ‰§è¡Œcbã€‚æ­¤æ—¶å¦‚æœåœ¨cbä¸­è®¿é—®domï¼Œå°±æ˜¯æ¸²æŸ“å®Œæˆåçš„domå†…å®¹ã€‚\n\n## æ€»ç»“\n\n![vueä»»åŠ¡è°ƒåº¦.png](../../images/Vue/vueä»»åŠ¡è°ƒåº¦.png)\n\n## Vue2ä¸­çš„è¡¨ç°\n\n### ä»»åŠ¡è°ƒåº¦\n\nvu2çš„ä»»åŠ¡è°ƒåº¦åŸç†ä¹Ÿæ˜¯ç±»ä¼¼ã€‚\n\n1. ç»„ä»¶çš„å“åº”å¼æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œä¼šè§¦å‘setteræ–¹æ³•ã€‚\n2. è§¦å‘`dep.notify()`ã€‚\n3. éå†depå¯¹è±¡ä¸Šçš„`watcher`ï¼Œé€ä¸€è°ƒç”¨å…¶`update`æ–¹æ³•ï¼Œï¼ˆWatcherå¯¹è±¡æ˜¯åœ¨æ¸²æŸ“ç»„ä»¶æ—¶åˆ›å»ºçš„ï¼Œç”¨æ¥æ›´æ–°ç»„ä»¶ï¼‰\n4. updateå†è°ƒç”¨`queueWatcher`ï¼Œå°†æ›´æ–°ä»»åŠ¡åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—\n5. è°ƒç”¨`nextTick(flushSchedulerQueue)`ï¼Œç”¨æ¥æ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—ã€‚`nextTick`æ˜¯ä¸ºäº†è®©ç»„ä»¶æ›´æ–°å˜æˆå¼‚æ­¥ã€‚\n\n### nextTick\n\nvue2ä¸­çš„nextTickæ¯”vue3å¤šäº†äº›å†…å®¹ã€‚\n\nnextTickä¹Ÿæ¨¡æ‹Ÿäº†ä¸€ä¸ªå›è°ƒä»»åŠ¡é˜Ÿåˆ—`callbacks`ï¼ˆæ³¨æ„è¿™ä¸æ˜¯è°ƒåº¦çš„ä»»åŠ¡é˜Ÿåˆ—ï¼‰\n\n```typescript\nexport function nextTick (cb?: Function, ctx?: Object) {\n  let _resolve\n  \n  // å°†å›è°ƒåŠ å…¥é˜Ÿåˆ—ä¸­\n  callbacks.push(() => {\n    if (cb) {\n      try {\n        cb.call(ctx)\n      } catch (e) {\n        handleError(e, ctx, 'nextTick')\n      }\n    } else if (_resolve) {\n      _resolve(ctx)\n    }\n  })\n  \n  // å¦‚æœé˜Ÿåˆ—æ²¡æœ‰æ­£åœ¨æ‰§è¡Œï¼ˆflushï¼‰ï¼Œå°±å»æ¸…ç©ºé˜Ÿåˆ—\n  if (!pending) {\n    pending = true\n    timerFunc() // æ¸…ç©ºé˜Ÿåˆ—\n  }\n  // $flow-disable-line\n  if (!cb && typeof Promise !== 'undefined') {\n    return new Promise(resolve => {\n      _resolve = resolve\n    })\n  }\n}\n```\n\nnextTickè°ƒç”¨äº†`timeFunc`æ¥æ¸…ç©ºé˜Ÿåˆ—\n\n```typescript\nfunction flushCallbacks () {\n  // çœç•¥... å°±æ˜¯æ¸…ç©ºcallbakcsä»»åŠ¡é˜Ÿåˆ—\n}\n\nlet timerFunc\n\n\n// 1 æ”¯æŒpromiseï¼Œå°±ç”¨promiseæ¥æ¨¡æ‹Ÿå¼‚æ­¥\nif (typeof Promise !== 'undefined' && isNative(Promise)) {\n  const p = Promise.resolve()\n  timerFunc = () => {\n    p.then(flushCallbacks)\n   \n    if (isIOS) setTimeout(noop)\n  }\n  isUsingMicroTask = true\n} \n// 2. ä¸æ”¯æŒpromise å°±ç”¨MutationObserveræ¥æ¨¡æ‹Ÿå¼‚æ­¥\nelse if (!isIE && typeof MutationObserver !== 'undefined' && (\n  isNative(MutationObserver) ||\n  // PhantomJS and iOS 7.x\n  MutationObserver.toString() === '[object MutationObserverConstructor]'\n)) {\n  // Use MutationObserver where native Promise is not available,\n  // e.g. PhantomJS, iOS7, Android 4.4\n  // (#6466 MutationObserver is unreliable in IE11)\n  let counter = 1\n  const observer = new MutationObserver(flushCallbacks)\n  const textNode = document.createTextNode(String(counter))\n  observer.observe(textNode, {\n    characterData: true\n  })\n  timerFunc = () => {\n    counter = (counter + 1) % 2\n    textNode.data = String(counter)\n  }\n  isUsingMicroTask = true\n} \n\n// 3.ç”¨setImmediateæ¥æ¨¡æ‹Ÿå¼‚æ­¥\nelse if (typeof setImmediate !== 'undefined' && isNative(setImmediate)) {\n\n  timerFunc = () => {\n    setImmediate(flushCallbacks)\n  }\n} else {\n  // Fallback to setTimeout.\n  timerFunc = () => {\n    setTimeout(flushCallbacks, 0)\n  }\n}\n```\n\nä¸ºäº†æ›´å¤šçš„å…¼å®¹æµè§ˆå™¨ï¼ŒtimerFuncæ¨¡æ‹Ÿå¼‚æ­¥åˆ¤æ–­äº†ä¸‰ç§æƒ…å†µ\n\n1. æ”¯æŒPromiseï¼Œå°±ç›´æ¥ç”¨Promiseæ¥æ¨¡æ‹Ÿå¼‚æ­¥ã€‚Promiseå±äºå¾®ä»»åŠ¡\n2. ä¸æ”¯æŒPromiseï¼Œæ”¯æŒMutationObserverã€‚MutationObserverä¹Ÿå±äºå¾®ä»»åŠ¡\n   - åˆ›å»ºä¸€ä¸ªç©ºçš„æ–‡æœ¬èŠ‚ç‚¹ï¼Œç›‘å¬è¿™ä¸ªæ–‡æœ¬èŠ‚ç‚¹çš„å­—ç¬¦å˜åŒ–ã€‚å˜åŒ–äº†å°±è°ƒç”¨`flushCallbacks`æ¥æ¸…ç©ºå›è°ƒä»»åŠ¡é˜Ÿåˆ—\n   - è°ƒç”¨`timerFunc`ï¼Œä¼šä¿®æ”¹æ–‡æœ¬èŠ‚ç‚¹çš„å†…å®¹ï¼Œä»è€Œè§¦å‘`flushCallbacks`å‡½æ•°çš„æ‰§è¡Œ\n3. `MutationObserver`å’Œ`Promise`éƒ½ä¸æ”¯æŒï¼Œå°±ç”¨`setImmediate`æ¥æ¨¡æ‹Ÿå¼‚æ­¥ï¼Œåè€…å±äºå®ä»»åŠ¡\n4. æœ€åæ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨setTimeoutæ¥æ¨¡æ‹Ÿå¼‚æ­¥\n\nå¯è§`vue2`ä¸ºäº†å…¼å®¹æ€§ï¼Œä¸‹è¶³äº†åŠŸå¤«ã€‚è€Œ`vue3`ç›´æ¥å°±ä½¿ç”¨äº†`Promise`\n\n","tags":["Vue","sc-vue"],"categories":["Vue"]},{"title":"æ ˆé—®é¢˜æ¢³ç†","url":"/posts/1f4ac2fb.html","content":"\n## æ™®é€šæ ˆ\n\næ ˆçš„ç‰¹æ€§ï¼š`å…ˆè¿›åå‡º`\n\næ•°ç»„æ¨¡æ‹Ÿï¼š\n\n- è¿›æ ˆï¼š`arr.push()`\n- å‡ºæ ˆï¼š`arr.pop()`\n\n### åŒ¹é…æ¶ˆé™¤\n\næ ˆå¯ä»¥ç”¨æ¥è§£å†³**åŒ¹é…**é—®é¢˜\n\n### [20. æœ‰æ•ˆçš„æ‹¬å·](https://leetcode-cn.com/problems/valid-parentheses/)\n\næ‹¬å·åŒ¹é…ï¼Œ`({[`ä¸`]})`åŒ¹é…\n\nåˆ›å»ºä¸€ä¸ªæ ˆ`stack`ï¼Œå¹¶éå†å­—ç¬¦ä¸²ã€‚å½“é‡åˆ°`({[`æ—¶å…¥æ ˆï¼Œå½“é‡åˆ°`]})`æ—¶ï¼Œå–æ ˆé¡¶å…ƒç´ æ¯”è¾ƒ\n\n- ç›¸åŒ¹é…ï¼Œæ ˆé¡¶å…ƒç´ å‡ºæ ˆï¼Œç»§ç»­å¾ªç¯\n- ä¸åŒ¹é…ï¼Œç›´æ¥è¿”å›`false`\n\næ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(n)\n\n> å¦‚æœæ ˆä¸­çš„å…ƒç´ éƒ½ä¸€æ ·ï¼Œå°±ä¸éœ€è¦ç”¨æ ˆï¼Œç”¨ä¸€ä¸ªè®¡æ•°å™¨countå³å¯\n\n### å¤§é±¼åƒå°é±¼\n\n*é¢˜ç›®ã€‘åœ¨æ°´ä¸­æœ‰è®¸å¤šé±¼ï¼Œå¯ä»¥è®¤ä¸ºè¿™äº›é±¼åœæ”¾åœ¨ x è½´ä¸Šã€‚å†ç»™å®šä¸¤ä¸ªæ•°ç»„ Sizeï¼ŒDirï¼ŒSize[i] è¡¨ç¤ºç¬¬ i æ¡é±¼çš„å¤§å°ï¼ŒDir[i] è¡¨ç¤ºé±¼çš„æ–¹å‘ ï¼ˆ0 è¡¨ç¤ºå‘å·¦æ¸¸ï¼Œ1 è¡¨ç¤ºå‘å³æ¸¸ï¼‰ã€‚è¿™ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«è¡¨ç¤ºé±¼çš„å¤§å°å’Œæ¸¸åŠ¨çš„æ–¹å‘ï¼Œå¹¶ä¸”ä¸¤ä¸ªæ•°ç»„çš„é•¿åº¦ç›¸ç­‰ã€‚é±¼çš„è¡Œä¸ºç¬¦åˆä»¥ä¸‹å‡ ä¸ªæ¡ä»¶:*\n\n*æ‰€æœ‰çš„é±¼éƒ½åŒæ—¶å¼€å§‹æ¸¸åŠ¨ï¼Œæ¯æ¬¡æŒ‰ç…§é±¼çš„æ–¹å‘ï¼Œéƒ½æ¸¸åŠ¨ä¸€ä¸ªå•ä½è·ç¦»ï¼›*\n\n*å½“æ–¹å‘ç›¸å¯¹æ—¶ï¼Œå¤§é±¼ä¼šåƒæ‰å°é±¼ï¼›*\n\n*é±¼çš„å¤§å°éƒ½ä¸ä¸€æ ·ã€‚*\n\n*è¾“å…¥ï¼šSize = [4, 2, 5, 3, 1], Dir = [1, 1, 0, 0, 0]*\n\n*è¾“å‡ºï¼š3*\n\nè¿™é“é¢˜è·Ÿä¸Šä¸€æ¡é¢˜åŸç†ä¸€æ ·éƒ½æ˜¯**åŒ¹é…æ¶ˆé™¤**ï¼Œä¸Šä¸€é“é¢˜æ˜¯æ ¹æ®å…ƒç´ çš„å†…å®¹ï¼ˆæ‹¬å·ï¼‰æ¥åˆ¤æ–­åŒ¹é…æ¶ˆé™¤ã€‚è€Œæœ¬é“é¢˜æ˜¯æ ¹æ®å…ƒç´ çš„**å¤§å°**çš„**â€œæ–¹å‘â€**ä¸¤ä¸ªæ¡ä»¶æ¥åˆ¤æ–­\n\n```typescript\nconst LEFT = 0;\nconst RIGHT = 1;\n\nfunction eatFish(size: number[], dir: number[]) {\n  const stack: number[] = [];\n  for (let i = 0; i < size.length; i++) {\n    // è¿˜æ²¡æœ‰é±¼\n    if (stack.length <= 0) {\n      stack.push(i);\n      continue;\n    }\n\n    \n    let insert = true; \n    \n    // æ ˆé¡¶çš„é±¼æ¯” å½“å‰çš„é±¼å°, å°±ä¸€ç›´å¾ªç¯å¾—åƒ\n    while (stack.length > 0) {\n      let last = stack[stack.length - 1];\n      const canMeet = dir[last] === RIGHT && dir[i] == LEFT;\n\n      if (canMeet && size[last] < size[i]) stack.pop();\n      \n      // å¤§é±¼æŠŠæ ˆä¸­çš„æ‰€æœ‰é±¼éƒ½åƒå®Œäº†ï¼Œéœ€è¦åœ¨æœ€åå°†è¿™æ¡å¤§é±¼æ”¾å…¥æ ˆä¸­\n      else if (canMeet) {\n        insert = false;\n        break;\n      } else {\n        insert = true;\n        break;\n      }\n    }\n    // æ ˆä¸­çš„é±¼éƒ½åƒå®Œäº†\n    if (insert) stack.push(i);\n  }\n  return stack;\n}\n```\n\n## å•è°ƒæ ˆ\n\nå•è°ƒæ ˆåˆ†ä¸ºä¸¤ç§ï¼š\n\n- é€’å¢æ ˆ\n- é€’å‡æ ˆ\n\n### ç›¸é‚»æœ€å°ç´¢å¼•\n\nã€é¢˜ç›®ã€‘ä¸€ä¸ªæ•´æ•°æ•°ç»„ Aï¼Œæ‰¾åˆ°æ¯ä¸ªå…ƒç´ ï¼šå³è¾¹ç¬¬ä¸€ä¸ªæ¯”æˆ‘å°çš„ä¸‹æ ‡ä½ç½®ï¼Œæ²¡æœ‰åˆ™ç”¨ -1 è¡¨ç¤ºã€‚\n\nè¾“å…¥ï¼š[5, 2]\n\nè¾“å‡ºï¼š[1, -1]\n\nè§£é‡Šï¼šå› ä¸ºå…ƒç´  5 çš„å³è¾¹ç¦»æˆ‘æœ€è¿‘ä¸”æ¯”æˆ‘å°çš„ä½ç½®åº”è¯¥æ˜¯ A[1]ï¼Œæœ€åä¸€ä¸ªå…ƒç´  2 å³è¾¹æ²¡æœ‰æ¯” 2 å°çš„å…ƒç´ ï¼Œæ‰€ä»¥åº”è¯¥è¾“å‡º -1ã€‚\n\n```typescript\n/**\n * è§£æï¼š\n *  éå†æ•°ç»„å…ƒç´ ï¼Œæ„é€ é€’å¢æ ˆ\n *  å½“å‰å…ƒç´ æ¯”æ ˆé¡¶å°ï¼Œåˆ™æ ˆé¡¶å…ƒç´ éœ€è¦å‡ºæ ˆï¼Œå¹¶è®°å½•æ ˆé¡¶å…ƒç´ å³ä¾§ç¬¬ä¸€ä¸ªå°çš„ä¸‹æ ‡ä¸ºå½“å‰å…ƒç´ ä¸‹æ ‡\n */\nfunction findRightSmall(arr: number[]) {\n  const result: number[] = arr.map((i) => -1);\n  const stack: number[] = [];\n\n  for (let i = 0; i < arr.length; i++) {\n    const cur = arr[i];\n\n    while (stack.length > 0 && arr[stack[stack.length - 1]] > cur) {\n      result[stack[stack.length - 1]] = i;\n      stack.pop();\n    }\n\n    stack.push(i);\n  }\n\n  return result;\n}\n\n// æ”¹å˜ä¸€ä¸‹é—®é¢˜\n// æ±‚å·¦è¾¹ç¬¬ä¸€ä¸ªæ¯”æˆ‘ä¸‹çš„ä¸‹æ ‡ä¸ºæ­¢ï¼Œæ²¡æœ‰åˆ™ç”¨-1è¡¨ç¤º\n\n/**\n * è§£æ\n *  è¿˜æ˜¯éå†æ•°ç»„å…ƒç´ ï¼Œæ„é€ é€’å¢æ ˆ\n *  å½“å‰å…ƒç´ å°äºç­‰äºæ ˆé¡¶å…ƒç´ æ˜¯éœ€è¦å‡ºæ ˆ\n *  å½“ä¸éœ€è¦æ ˆé¡¶å…ƒç´ å‡ºæ ˆï¼Œè¯´æ˜å½“å‰å…ƒç´ æ¯”æ ˆé¡¶å…ƒç´ å¤§ã€‚å³æ ˆé¡¶å…ƒç´ æ˜¯å½“å‰å…ƒç´ å·¦ä¾§ç¬¬ä¸€ä¸ªå°çš„å…ƒç´ ï¼Œè®°å½•ä¸€ä¸‹\n * \n * è®°å½•ä¹‹å‰è¿˜è¦æ’é™¤æ‰ç›¸ç­‰çš„æƒ…å†µï¼Œå³ä»æ ˆé¡¶å¾€ä¸‹æ‰¾ï¼Œä¸€ç›´æ‰¾åˆ°ä¸€ä¸ªä¸ç›¸åŒçš„å…ƒç´ \n */\nfunction findLeftSmall(arr: number[]) {\n  const result: number[] = arr.map((i) => -1);\n  const stack: number[] = [];\n\n  for (let i = 0; i < arr.length; i++) {\n    const cur = arr[i];\n\n    while (stack.length > 0 && arr[stack[stack.length - 1]] > cur) stack.pop();\n\n    let top = stack.length - 1;\n    while (arr[stack[top]] === cur) top--;\n    if (top >= 0) result[i] = stack[top];\n\n    stack.push(i);\n  }\n\n  return result;\n}\n\n```\n\n### å­—å…¸åºæœ€å°çš„ k ä¸ªæ•°çš„å­åºåˆ—\n\nã€é¢˜ç›®ã€‘ç»™å®šä¸€ä¸ªæ­£æ•´æ•°æ•°ç»„å’Œ kï¼Œè¦æ±‚ä¾æ¬¡å–å‡º k ä¸ªæ•°ï¼Œè¾“å‡ºå…¶ä¸­æ•°ç»„çš„ä¸€ä¸ªå­åºåˆ—ï¼Œéœ€è¦æ»¡è¶³ï¼š1. é•¿åº¦ä¸º kï¼›2.å­—å…¸åºæœ€å°ã€‚\n\nè¾“å…¥ï¼šnums = [3,5,2,6], k = 2\nè¾“å‡ºï¼š[2,6]\n\nè§£é‡Šï¼šåœ¨æ‰€æœ‰å¯èƒ½çš„è§£ï¼š{[3,5], [3,2], [3,6], [5,2], [5,6], [2,6]} ä¸­ï¼Œ[2,6] å­—å…¸åºæœ€å°ã€‚\n\næ‰€è°“å­—å…¸åºå°±æ˜¯ï¼Œç»™å®šä¸¤ä¸ªæ•°ç»„ï¼šx = [x1,x2,x3,x4]ï¼Œy = [y1,y2,y3,y4]ï¼Œå¦‚æœ 0 â‰¤ p < iï¼Œxp == yp ä¸” xi < yiï¼Œé‚£ä¹ˆæˆ‘ä»¬è®¤ä¸º x çš„å­—å…¸åºå°äº yã€‚\n\n```typescript\nfunction findSmallSeq(seg: number[], k: number) {\n  const stack: number[] = [];\n\n  for (let i = 0; i < seg.length; i++) {\n    const cur = seg[i];\n    if (stack.length <= 0) stack.push(cur);\n\n    while (\n      stack.length > 0 &&\n      stack[stack.length - 1] > cur &&\n      stack.length + seg.length - i > k\n    )\n      stack.pop();\n\n    if(stack.length < k) stack.push(cur)\n  }\n\n  return stack;\n}\n\n```\n\n## å•è°ƒæ ˆçš„è¿ç”¨\n\n[84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢](https://leetcode-cn.com/problems/largest-rectangle-in-histogram/)\n\n[42. æ¥é›¨æ°´](https://leetcode-cn.com/problems/trapping-rain-water/)\n\n","tags":["JavaScript","TypeScript","Algorithm"],"categories":["Algorithm"]},{"title":"VNodeç”Ÿå‘½å‘¨æœŸå›¾-vue3æºç ","url":"/posts/f9d1a0d8.html","content":"\n`VNode`æ˜¯vueååˆ†é‡è¦çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä¸‹å›¾æ•´ç†äº†VNodeçš„åˆ›å»ºã€é”€æ¯ã€æ›´æ–°patchç­‰æµç¨‹ã€‚\n\n![VNode](../../images/Vue/VNode.svg)\n\n","tags":["Vue","sc-vue"],"categories":["Vue"]},{"title":"äºŒå‰æ ‘éå†é—®é¢˜æ¢³ç†","url":"/posts/4ed68d4d.html","content":"\n## äºŒå‰æ ‘\n\näºŒå‰æ ‘çš„å®šä¹‰\n\n```typescript\nclass TreeNode {\n  public value: number;\n  public left?: TreeNode;\n  public right?: TreeNode;\n}\n```\n\næœ‰å››ç§éå†æ–¹å¼:\n\n- å‰åºéå†\n- ä¸­åºéå†\n- ååºéå†\n- å±‚æ¬¡éå†\n\n## å‰åºéå†â€”â€”ç»™å­æ ‘ä¼ é€’ä¿¡æ¯\n\n[LeetCode 114.äºŒå‰æ ‘çš„å‰åºéå†](https://leetcode-cn.com/problems/binary-tree-preorder-traversal/)\n\nè§£æ³•ï¼š\n\n- é€’å½’\n- æ ˆ\n- Morris\n\nå¸¸è§çš„è§£æ³•ï¼š**é€’å½’æ³•**\n\n```typescript\nfunction preOrder(node: TreeNode): void {\n  if (!node) return\n\t\n  // è®¿é—®èŠ‚ç‚¹\n  console.log(node.value)\n\t// éå†å·¦å­æ ‘\n  preOrder(node.left)\n\t// éå†å³å­æ ‘\n  preOrder(node.right)\n}\n```\n\n**ä½¿ç”¨æ ˆ**ï¼šæ ˆæ¨¡æ‹Ÿé€’å½’ï¼Œå…ˆä¾æ¬¡å°†èŠ‚ç‚¹ä»¥åŠèŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹æ”¾å…¥æ ˆä¸­ï¼Œå¦‚æœæ²¡æœ‰å·¦å­èŠ‚ç‚¹ï¼Œå°±å»æ ˆé¡¶å…ƒç®—çš„å³å­èŠ‚ç‚¹ä¾æ¬¡å¾ªç¯ã€‚å½“æ ˆä¸ºç©ºè¯´æ˜éå†å®Œäº†ï¼Œæ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(h)ï¼Œhä¸ºæ ‘çš„é«˜åº¦ã€‚\n\n**Morris éå†**å¯ä»¥å®ç°ç©ºé—´å¤æ‚åº¦O(1)ï¼Œæ— éœ€é€’å½’ã€‚\n\n### â€œå½±å­â€äºŒå‰æ ‘\n\næ˜Ÿåº§äºŒå‰æ ‘æ˜¯ä¸€ç§æ€è€ƒæ–¹å¼ï¼Œæ ¹æ®é¢˜æ„ï¼Œå°†æ‰€ç»™äºŒå‰æ ‘æ„é€ æˆå¦ä¸€é¢—äºŒå‰æ ‘\n\n#### [LeetCode 98. éªŒè¯äºŒå‰æœç´¢æ ‘](https://leetcode-cn.com/problems/validate-binary-search-tree/)\n\n[è§£æ]ï¼šå¯ä»¥æ„é€ å½±å­äºŒå‰æ ‘ï¼Œå½±å­äºŒå‰æ ‘çš„èŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªåŒºé—´`[min, max]`ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯åˆ¤æ–­åŸäºŒå‰æ ‘çš„èŠ‚ç‚¹æ˜¯å¦åœ¨å…¶å¯¹åº”çš„å½±å­äºŒå‰æ ‘èŠ‚ç‚¹æ‰€è¡¨ç¤ºçš„åŒºé—´èŒƒå›´ç´¯\n\nå…ˆå‰åºéå†äºŒå‰æ ‘ï¼Œæ ¹èŠ‚ç‚¹åˆ¤æ–­æ˜¯å¦åœ¨`[-Infinity, Infinity]`åŒºé—´ï¼Œå·¦å­æ ‘åˆ¤æ–­æ˜¯å¦åœ¨`[-Infinity, root.val]`ä¹‹é—´ï¼Œå³å­æ ‘åˆ¤æ–­æ˜¯å¦åœ¨`[root.val, Infinity]`ä¹‹é—´\n\nå‰åºéå†å¯ä»¥**é€’å½’**æˆ–**æ ˆ**ï¼Œä¹Ÿå¯ä»¥ç”¨`Morris`\n\nä½¿ç”¨æ ˆçš„è¯ï¼Œå°±éœ€è¦è‡ªå·±æ„é€ å‡ºå½±å­äºŒå‰æ ‘ï¼Œåœ¨é€’å½’çš„è¿‡ç¨‹ä¸­ä¸æ–­ç»™minå’Œmaxèµ‹å€¼ã€‚\n\n```typescript\nclass ShadowNode {\n  node: TreeNode;\n  min: number;\n  max: number;\n\n  constructor(node: TreeNode, min: number, max: number) {\n    this.node = node\n    this.min = min\n    this.max = max\n  }\n}\n```\n\n#### [LeetCode 100. ç›¸åŒçš„æ ‘](https://leetcode-cn.com/problems/same-tree/)\n\n[é¢˜è§£]ï¼šé¢˜ç›®ç»™äº†ä¸¤æ£µæ ‘`p`å’Œ`q`ï¼Œä»–ä»¬ä¿©äº’ä¸ºå½±å­äºŒå‰æ ‘ï¼Œä¸¤æ£µæ ‘åŒæ—¶å‰åºéå†ï¼Œåˆ¤æ–­å¯¹åº”èŠ‚ç‚¹æ˜¯å¦ç›¸åŒ \n\n#### [LeetCode 572. å¦ä¸€ä¸ªæ ‘çš„å­æ ‘](https://leetcode-cn.com/problems/subtree-of-another-tree/)\n\n[é¢˜è§£]ï¼šé¢˜ç›®ç»™äº†ä¸¤æ£µæ ‘`s`å’Œ`t`ï¼Œå‰åºéå†`s`ï¼Œå½“`s.val === t.val`æ˜¯ï¼Œtå¯èƒ½æ˜¯sçš„å­æ ‘ï¼Œè¿™æ—¶å†å»åˆ¤æ–­så’Œtæ˜¯å¦æ˜¯ç›¸åŒçš„æ ‘(ä¸Šä¸€é¢˜)\n\n### åˆ©ç”¨å›æº¯ï¼ˆå›å½’ï¼‰\n\n#### [113. è·¯å¾„æ€»å’Œ II](https://leetcode-cn.com/problems/path-sum-ii/)\n\nè®¡ç®—ç¬¦åˆæ‰€ç»™targetå€¼çš„å…¨éƒ¨è·¯å¾„ã€‚\n\n[é¢˜è§£]ï¼š å‰åºéå†äºŒå‰æ ‘ï¼Œåœ¨éå†çš„è¿‡ç¨‹ä¸­ä½¿ç”¨`path`æ•°ç»„è®°å½•è·¯å¾„ï¼Œ`sum`å˜é‡è®°å½•è·¯å¾„å’Œã€‚å½“éå†åˆ°å¶å­èŠ‚ç‚¹æ—¶ï¼ˆå·¦å³å­æ ‘ä¸ºç©ºï¼‰ã€‚åˆ¤æ–­`sum === target`ï¼Œç›¸ç­‰å°†pathæ”¾å…¥`result(äºŒç»´æ•°ç»„)`ä¸­ã€‚\n\næ²¡æœ‰éå†åˆ°å¶å­èŠ‚ç‚¹ç»§ç»­å›æº¯\n\nåˆ°å¶å­èŠ‚ç‚¹åï¼Œè¦å°†`path.pop`ã€‚å³æŠŠå¶å­ç»“ç‚¹ä»è·¯å¾„æœ€åæ‰”æ‰! \n\n> æ‰©å±•ï¼šæ±‚ä»æ ¹èŠ‚ç‚¹åˆ°æ‰€æœ‰å¶å­èŠ‚ç‚¹çš„è·¯å¾„\n\n## ä¸­åºéå†â€”â€”æœ‰åºæ€§\n\n#### [94. äºŒå‰æ ‘çš„ä¸­åºéå†](https://leetcode-cn.com/problems/binary-tree-inorder-traversal/)\n\nä¸­åºéå†ï¼š\n\n- é€’å½’\n- æ ˆ\n- Morris\n\nä½¿ç”¨æ ˆè§£å†³ä¸­åºéå†ï¼šç®—æ³•å’Œå‰åºéå†å·®ä¸å¤šï¼Œå°±æ˜¯è¯»å–æ•°æ®çš„å®é™…ä¸åŒï¼Œå‰åºæ˜¯åœ¨æ¯ä¸€æ¬¡æ·±å…¥å·¦å­æ ‘å‰è¯»ï¼›è€Œä¸­åºæ˜¯æ¯æ¬¡åˆ‡æ¢å³å­æ ‘æ—¶è¯»\n\n### ä¸­åºæœ‰åºæ€§\n\n#### [98. éªŒè¯äºŒå‰æœç´¢æ ‘](https://leetcode-cn.com/problems/validate-binary-search-tree/)\n\nä½¿ç”¨ä¸­åºéå†è§£å†³è¿™é“é¢˜æ¯”å‰åºéå†è¦ç®€å•ï¼Œå› ä¸ºä¸€ä¸ªç‰¹æ€§ï¼š**ä¸­åºéå†äºŒå‰æœç´¢æ ‘ï¼Œä¸€å®šæœ‰åº**ã€‚åªè¦åœ¨éå†è¿‡ç¨‹ä¸­åˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„å€¼æ˜¯å¦å¤§äºä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œå¦‚æœä¸æ»¡è¶³å¯ä»¥ç›´æ¥åˆ¤æ–­ä¸æ˜¯äºŒå‰æœç´¢æ ‘ã€‚\n\n#### [501. äºŒå‰æœç´¢æ ‘ä¸­çš„ä¼—æ•°](https://leetcode-cn.com/problems/find-mode-in-binary-search-tree/)\n\næ±‚äºŒå‰æœç´¢æ ‘å‡ºç°æ¬¡æ•°æœ€å¤šçš„æ•°ï¼ˆå¯èƒ½ä¸æ­¢ä¸€ä¸ªï¼‰ã€‚é‡‡ç”¨**ä¸­åºéå†**ï¼Œå› ä¸ºä¸€å®šæœ‰åºã€‚æ‰€ä»¥é—®é¢˜å°±è½¬åŒ–æˆï¼š**ç»™å®šæœ‰åºæ•°ç»„ï¼Œæ±‚å‡ºç°æ¬¡æ•°æœ€å¤šçš„æ•°**ã€‚\n\næœ€ç®€å•çš„å°±æ˜¯Mapç»Ÿè®¡æ¯ä¸ªæ•°æ®çš„å‡ºç°æ¬¡æ•°ï¼Œç©ºé—´å¤æ‚åº¦O(n)\n\nç©ºé—´O(1)è§£å†³æ–¹æ³•ï¼šå››ä¸ªå˜é‡:\n\n- maxï¼šæ•°ç»„ï¼Œå­˜æ”¾å‡ºç°æ¬¡æ•°æœ€å¤šçš„å…ƒç´ \n- maxCountï¼šå‡ºç°æ¬¡æ•°æœ€å¤šçš„å…ƒç´ çš„æ¬¡æ•°\n- lastï¼šä¸Šä¸€ä¸ªéå†åˆ°çš„æ•°æ®\n- lastCountï¼šä¸Šä¸€ä¸ªéå†åˆ°çš„æ•°æ®å‡ºç°çš„æ¬¡æ•°\n\nå½“å½“å‰èŠ‚ç‚¹å€¼ä¸ç­‰äºlastï¼Œå°±éœ€è¦åˆ¤æ–­`lastCount`å’Œ`maxCount`çš„å¤§å°ï¼Œæ¥å†³å®šæ˜¯å¦å°†lastCountæ”¾å…¥æ•°ç»„\n\nè¾¹ç•Œæƒ…å†µï¼šå½“éå†ç»“æŸåï¼Œè¿˜è¦å†åˆ¤æ–­ä¸€ä¸‹ã€‚\n\n#### [783. äºŒå‰æœç´¢æ ‘èŠ‚ç‚¹æœ€å°è·ç¦»](https://leetcode-cn.com/problems/minimum-distance-between-bst-nodes/)\n\nè¿˜æ˜¯åˆ©ç”¨**ä¸­åºéå†äºŒå‰æœç´¢æ ‘çš„æœ‰åºæ€§**ã€‚å½“å‰èŠ‚ç‚¹å’Œä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„å€¼ç›¸å‡å–æœ€å°å€¼å³å¯ã€‚\n\n#### [99. æ¢å¤äºŒå‰æœç´¢æ ‘](https://leetcode-cn.com/problems/recover-binary-search-tree/)\n\nè¿˜æœ‰åˆ©ç”¨**ä¸­åºéå†äºŒå‰æœç´¢æ ‘çš„æœ‰åºæ€§**ï¼Œé—®é¢˜å°±è½¬åŒ–ä¸ºï¼šè¿˜åŸå‡åºæ•°ç»„è¢«è°ƒæ¢çš„ä¸¤ä¸ªæ•°ã€‚\n\nä¸‰ä¸ªæŒ‡é’ˆ\n\n- firstï¼šæŒ‡å‘ç¬¬ä¸€ä¸ªè¢«è°ƒæ¢çš„èŠ‚ç‚¹\n- secondï¼šæŒ‡å‘ç¬¬äºŒä¸ªè¢«è°ƒæ¢çš„èŠ‚ç‚¹\n- lastNodeï¼šä¸Šä¸€ä¸ªéå†çš„èŠ‚ç‚¹\n\næ¯æ¬¡éå†ï¼Œåˆ¤æ–­å½“å‰èŠ‚ç‚¹ä¸lastNodeçš„å¤§å°ã€‚åŠ¨æ€è°ƒæ•´firstå’Œsecondçš„æŒ‡å‘ã€‚éå†æœ‰ä¸¤ç§æƒ…å†µ\n\n- åªä¼šé‡åˆ°ä¸€æ¬¡`root.val < lastNode.val`ï¼šè¢«è°ƒæ¢çš„ä¸¤ä¸ªèŠ‚ç‚¹ç›¸é‚»åœ¨ä¸€èµ·ï¼Œè¿™æ—¶`first`å’Œ`second`åˆ†åˆ«æŒ‡å‘`root`å’Œ`lastNode`\n- ä¼šé‡åˆ°ç¬¬äºŒæ¬¡ï¼Œç¬¬äºŒæ¬¡åªéœ€è¦è°ƒæ•´`second`ï¼ŒæŒ‡å‘`root`\n\n### äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰çš„å¢åˆ æŸ¥\n\n#### [450. åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹](https://leetcode-cn.com/problems/delete-node-in-a-bst/)\n\n```typescript\n/**\n * Definition for a binary tree node.\n * class TreeNode {\n *     val: number\n *     left: TreeNode | null\n *     right: TreeNode | null\n *     constructor(val?: number, left?: TreeNode | null, right?: TreeNode | null) {\n *         this.val = (val===undefined ? 0 : val)\n *         this.left = (left===undefined ? null : left)\n *         this.right = (right===undefined ? null : right)\n *     }\n * }\n */\n\nfunction deleteNode(root: TreeNode | null, key: number): TreeNode | null {\n  // case1 ç©ºæ ‘\n  if (root === null) return root\n\n  // case2 è¦åˆ é™¤çš„å…ƒç´ åœ¨å·¦å­æ ‘\n  if (key < root.val) root.left = deleteNode(root.left, key)\n\n  // case3 è¦åˆ é™¤çš„å…ƒç´ åœ¨å³å­æ ‘\n  else if (key > root.val) root.right = deleteNode(root.right, key)\n\n  // case4 å½“å‰èŠ‚ç‚¹å³ä¸º éœ€è¦åˆ é™¤çš„å…ƒç´  ï¼Œåˆåˆ†ä¸ºå››ç§æƒ…å†µï¼š\n  else {\n    // 1.å¶å­èŠ‚ç‚¹\n    if (root.left === null && root.right === null) return null\n    // 2.æœ‰å·¦å­æ ‘\n    else if (root.left !== null) {\n      // æ‰¾å·¦å­æ ‘æœ€å¤§å€¼\n      let node = root.left\n      while (node.right) node = node.right\n      swapNodeVal(root, node)\n      root.left = deleteNode(root.left, node.val)\n    }\n    // 3.æœ‰å³å­æ ‘\n    else if (root.right !== null) { \n      // æ‰¾å³å­æ ‘æœ€å°å€¼\n      let node = root.right\n      while (node.left) node = node.left\n      swapNodeVal(root, node)\n      root.right = deleteNode(root.right, node.val)\n    }\n    // 4.æ—¢æœ‰å·¦å­æ ‘ åˆæœ‰å³å­æ ‘ã€‚è¿™ç§æƒ…å†µåŒ…å«åœ¨æƒ…å†µ2ä¸­\n    // æ‰€ä»¥æœ€ç»ˆç­”æ¡ˆæœ‰ä¸¤ç§\n  }\n  return root\n};\n\nfunction swapNodeVal(a: TreeNode, b: TreeNode) {\n  const val = a.val\n  a.val = b.val\n  b.val = val\n}\n```\n\n#### [701. äºŒå‰æœç´¢æ ‘ä¸­çš„æ’å…¥æ“ä½œ](https://leetcode-cn.com/problems/insert-into-a-binary-search-tree/)\n\næ’å…¥æ“ä½œå’Œåˆ é™¤ç›¸ä¼¼ï¼Œä½†æ˜¯å°±æ²¡æœ‰é‚£ä¹ˆå¤šè¾¹ç•Œæƒ…å†µ\n\n```typescript\nfunction insertIntoBST(root: TreeNode | null, val: number): TreeNode | null {\n  if (root === null) return new TreeNode(val)\n\n  if (root.val < val) root.right = insertIntoBST(root.right, val)\n  else if (root.val > val) root.left = insertIntoBST(root.left, val)\n\n  return root\n};\n```\n\n#### [700. äºŒå‰æœç´¢æ ‘ä¸­çš„æœç´¢](https://leetcode-cn.com/problems/search-in-a-binary-search-tree/)\n\næœç´¢ä¹Ÿç±»ä¼¼\n\n```typescript\nfunction searchBST(root: TreeNode | null, val: number): TreeNode | null {\n  if (root === null) return root\n\n  if (root.val < val) return searchBST(root.right, val)\n  else if (root.val > val) return searchBST(root.left, val)\n  else return root\n};\n```\n\n## ååºéå†â€”â€”ç»™çˆ¶èŠ‚ç‚¹ä¼ é€’ä¿¡æ¯\n\nå¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ—¢æœ‰å·¦å­æ ‘åˆæœ‰å³å­æ ‘ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹ä¼šåœ¨å›æº¯æ—¶è¢«è®¿é—®ï¼ˆå³è¯¥èŠ‚ç‚¹è¢«éå†åˆ°ä¸¤æ¬¡ï¼‰\n\nåç»­éå†ï¼š\n\n- é€’å½’\n- æ ˆ\n- Morris\n\n#### [145. äºŒå‰æ ‘çš„ååºéå†](https://leetcode-cn.com/problems/binary-tree-postorder-traversal/)\n\nä½¿ç”¨**æ ˆ**æ¥é€’å½’éå†äºŒå‰æ ‘ï¼Œæ¯”å‰åºå’Œä¸­åºè¦ç¨å¾®å¤æ‚ä¸€äº›ï¼Œä¸€äº›èŠ‚ç‚¹æ˜¯åœ¨ç¬¬äºŒæ¬¡éå†åˆ°æ—¶æ‰è®¿é—®\n\nä½¿ç”¨ä¸€ä¸ªå˜é‡`pre`å§‹ç»ˆæŒ‡å‘ä¸Šä¸€ä¸ªè®¿é—®çš„èŠ‚ç‚¹\n\néå†åˆ°èŠ‚ç‚¹æ—¶æœ‰ä¸¤ä¸ªåˆ†æ”¯\n\n- å½“å‰èŠ‚ç‚¹æ²¡æœ‰å³èŠ‚ç‚¹æˆ–è€…å³èŠ‚ç‚¹ç­‰äº`pre`æ—¶ï¼Œè®¿é—®è¯¥èŠ‚ç‚¹ï¼Œä¸å†æ·±å…¥æœ‰èŠ‚ç‚¹ï¼ˆå› ä¸ºæ˜¯å›æº¯å›æ¥çš„ï¼‰\n- åä¹‹ï¼Œç»§ç»­è®¿é—®å³èŠ‚ç‚¹\n\n```typescript\nfunction postorderTraversal(root: TreeNode | null): number[] {\n  const stack: TreeNode[] = []\n  const result: number[] = []\n  let pre: TreeNode | null\n  while (true) {\n    while (root) {\n      stack.push(root)\n      root = root.left\n    }\n    if (stack.length <= 0) break\n    root = stack[stack.length - 1] // å–æ ˆé¡¶å…ƒç´ \n    \n    // å³å­æ ‘ä¸ºç©ºï¼Œæˆ–è€…å³å­æ ‘ç­‰äºä¸Šä¸€ä¸ªè¢«è®¿é—®çš„èŠ‚ç‚¹ï¼ˆå›æº¯å›æ¥çš„ï¼‰æ—¶ï¼Œè®¿é—®\n    if (root.right === null || root.right === pre) {\n      result.push(root.val)\n      stack.pop() // å‡ºæ ˆ\n      pre = root\n      root = null // root = null è¯´æ˜ä¸å†éå†è¯¥èŠ‚ç‚¹çš„å­æ ‘\n    } \n    // å¦åˆ™ç»§ç»­ååºéå†\n    else root = root.right\n  }\n\n  return result\n};\n```\n\n#### [å‰‘æŒ‡ Offer 68 - II. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ](https://leetcode-cn.com/problems/er-cha-shu-de-zui-jin-gong-gong-zu-xian-lcof/)\n\n##### ååºéå†\n\nåç»­éå†çš„ç²¾é«“ï¼š**å…ˆæ·±å…¥å·¦å³å­æ ‘æœå–ä¿¡æ¯ï¼Œå›æº¯æ—¶å†åˆ¤æ–­**ï¼ˆå›æº¯æ—¶å°±çŸ¥é“äº†å­èŠ‚ç‚¹çš„ä¿¡æ¯ï¼‰\n\nç°æ·±å…¥å·¦å³å­æ ‘ï¼Œå›æº¯æ—¶ï¼Œåˆ¤æ–­æ¯ä¸ªèŠ‚ç‚¹å·¦å³å­æ ‘ç­‰äºpå’Œqçš„æ¬¡æ•°`l`ä¸`r`\n\n- å¦‚æœ`l`å’Œ`r`å‡ä¸º1ï¼Œè¯´æ˜å½“å‰èŠ‚ç‚¹å°±æ˜¯`p`å’Œ`q`çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ\n\n- å¦‚ä½•`l`å’Œ`r`æœ‰ä¸€ä¸ªä¸º1ä¸”å½“å‰èŠ‚ç‚¹ç­‰äºpæˆ–qï¼Œä¹Ÿè¯´æ˜å½“å‰èŠ‚ç‚¹å°±æ˜¯`p`å’Œ`q`çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ\n\n- å›æº¯æ—¶ï¼Œè¿”å›ä»¥å½“å‰èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„æ ‘ä¸­på’Œqçš„æ•°é‡\n\næ³¨æ„è¿™é“é¢˜çš„å‰ææ¡ä»¶ï¼špã€qå”¯ä¸€ä¸”ä¸ç›¸ç­‰\n\n##### å‰åºéå†\n\nè¿™é“é¢˜è¿˜å¯ä»¥ç”¨**å‰åºéå†**æ¥è§£å†³ï¼Œå‰åºéå†æ—¶éå†åˆ°è¯¥èŠ‚ç‚¹å°±å»è®¿é—®ï¼Œæ­¤æ—¶åªçŸ¥é“å½“å‰èŠ‚ç‚¹å’Œéå†è¿‡çš„èŠ‚ç‚¹ä¿¡æ¯å¹¶ä¸çŸ¥é“å­èŠ‚ç‚¹ä¿¡æ¯ã€‚\n\n- åœ¨éå†åˆ°è¯¥èŠ‚ç‚¹æ˜¯ï¼Œåˆ¤æ–­ä¸€ä¸‹è¯¥èŠ‚ç‚¹æ˜¯ä¸æ˜¯ç­‰äº`p`æˆ–`q`\n  - å¦‚æœæ˜¯ï¼Œå°±ç›´æ¥è¿”å›å­èŠ‚ç‚¹å°±ä¸éœ€è¦åœ¨éå†äº†\n  - å¦‚æœä¸æ˜¯ï¼Œç»§ç»­éå†å·¦å­æ ‘å’Œå³å­æ ‘æ‰¾`p`å’Œ`q`çš„ç‚¹\n- å½“å·¦å³å­æ ‘æ‰¾å®Œäº†\n  - å·¦å³å­æ ‘éƒ½æ‰¾åˆ°äº†`p`å’Œ`q`ï¼Œè¯´æ˜è¯¥èŠ‚ç‚¹å°±æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆ\n  - å¦‚æœåªæ‰¾åˆ°ä¸€ä¸ªï¼Œæˆ–è€…æ²¡æœ‰æ‰¾åˆ°ï¼ˆæ²¡æ‰¾åˆ°çš„è¯è¿”å›nullï¼‰ï¼Œè¿”å›ä¸ç­‰äºnullçš„èŠ‚ç‚¹ï¼ˆç»§ç»­å¾€ä¸‹æ‰¾ï¼‰ï¼Œéƒ½ç­‰äºnullè¯´æ˜ä¸å­˜åœ¨æœ€è¿‘å…¬å…±ç¥–å…ˆ\n\n> æ‰©å±•ï¼šå¤šä¸ªèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆå‘¢ï¼Ÿ\n\n## æ€è€ƒé¢˜\n\n### [105. ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘](https://leetcode-cn.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal/)\n\nå‰åºéå† `preorder = [3,9,20,15,7]`\nä¸­åºéå†`inorder =  [9,3,15,20,7]`\n\nç‰¹æ€§ï¼š\n\n- å‰åºéå†çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸€å®šä¸ºæ ¹èŠ‚ç‚¹ï¼Œåé¢çš„å…ƒç´ åˆ†åˆ«æ˜¯å·¦å­æ ‘å’Œå³å­æ ‘\n- ä¸­åºéå†æŸä¸€ä¸ªå…ƒç´ å¦‚æœä¸ºæ ¹èŠ‚ç‚¹ï¼Œåˆ™å·¦è¾¹çš„éƒ½æ˜¯å…¶å·¦å­æ ‘çš„èŠ‚ç‚¹ï¼Œå³è¾¹éƒ½æ˜¯å…¶å³å­æ ‘çš„èŠ‚ç‚¹\n\næ ¹æ®ç‰¹æ€§å¯ä»¥æ€»ç»“å‡ºä»¥ä¸‹è§£ä½“æ€è·¯\n\n1. å…ˆæ„é€ ä¸€ä¸ªmapï¼Œå­˜æ”¾`inorder`çš„`value->index`ï¼Œè¿™æ˜¯ä¸ºäº†æŸ¥æ‰¾ç´¢å¼•æ—¶æ–¹ä¾¿ï¼ˆç©ºé—´æ¢æ—¶é—´ï¼‰\n2. é€’å½’éå†`preorder`ï¼Œ\n   - å–ç¬¬ä¸€ä¸ªå…ƒç´ å‡ºæ¥ï¼Œå½“ä½œæ ¹èŠ‚ç‚¹\n   - åœ¨åˆ†åˆ«è®¾ç½®æ”¹æ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘\n\n```typescript\nfunction buildTree(preorder: number[], inorder: number[]): TreeNode | null {\n  const map = new Map<number, number>()\n  inorder.map((v, i) => map.set(v, i))\n\n  function build(s: number, e: number) {\n    if (s > e) return null\n\n    const val = preorder.shift()\n    const root = new TreeNode(val)\n    const index = map.get(val) // æŸ¥æ‰¾ç´¢å¼•\n\n    // è®¾ç½®å·¦å³å­æ ‘\n    root.left = build(s, index - 1)\n    root.right = build(index + 1, e)\n    return root\n  }\n\n  return build(0, preorder.length - 1)\n};\n```\n\n","tags":["JavaScript","TypeScript","Algorithm"],"categories":["Algorithm"]},{"title":"é“¾è¡¨é—®é¢˜æ¢³ç†","url":"/posts/4ed68d4d.html","content":"\nè§£å†³é“¾è¡¨é—®é¢˜çš„â€œä¸‰æ¿æ–§â€ï¼š**å‡å¤´ã€æ–°é“¾è¡¨ã€åŒæŒ‡é’ˆ**ã€‚\n\n## å‡å¤´èŠ‚ç‚¹\n\nå‡å¤´é€šå¸¸ä¹Ÿå«ä½œ Dummy Headã€‚å°±æ˜¯åœ¨é“¾è¡¨å‰é¢ï¼ŒåŠ ä¸Šä¸€ä¸ªé¢å¤–çš„ç»“ç‚¹ã€‚æ­¤æ—¶ï¼Œå­˜æ”¾äº† N ä¸ªæ•°æ®çš„å¸¦å‡å¤´çš„é“¾è¡¨ï¼Œç®—ä¸Šå‡å¤´ä¸€å…±æœ‰ N+1 ä¸ªç»“ç‚¹ã€‚æ·»åŠ å‡å¤´åï¼Œå¯ä»¥çœç•¥æ‰å¾ˆå¤šç©ºæŒ‡é’ˆçš„åˆ¤æ–­ï¼Œé“¾è¡¨çš„å„ç§æ“ä½œä¼šå˜å¾—æ›´åŠ ç®€æ´ã€‚\n\n`LeetCode[707] è®¾è®¡é“¾è¡¨`\næŒæ¡å‡ ç§å¸¸è§çš„é“¾è¡¨æ“ä½œ\n\n- get: æŸ¥æ‰¾åˆ¶å®šç´¢å¼•çš„é“¾è¡¨å…ƒç´ \n- addAtHead: å¤´éƒ¨æ’å…¥å…ƒç´ \n- addAtTail: å°¾éƒ¨æ’å…¥å…ƒç´ \n- addAtIndex: æŒ‡å®šç´¢å¼•æ’å…¥\n- deleteAtIndex: æŒ‡å®šç´¢å¼•åˆ é™¤\n\n## æ–°é“¾è¡¨\n\nåšé“¾è¡¨çš„**åè½¬**ã€**äº¤æ¢**ç­‰æ“ä½œæ—¶ï¼Œä¸å»ºè®®ç›´æ¥åœ¨åŸæ¥çš„é“¾è¡¨ä¸Šè¿›è¡Œæ“ä½œã€‚ä¸€ç§å¯å–çš„æ€è·¯æ˜¯ï¼ŒæŠŠè¿™äº›æ“ä½œæƒ³è±¡æˆè¦ç”Ÿæˆæ–°çš„é“¾è¡¨ã€‚\n\n### åè½¬\n\nåˆ—è¡¨åè½¬(`LeetCode 201`)ï¼šå¯ä»¥æ–°å»ºä¸€ä¸ªæœ‰å¤´èŠ‚ç‚¹çš„æ–°é“¾è¡¨ï¼Œéå†æ—§é“¾è¡¨ã€‚å°†æ¯ä¸ªå…ƒç´ é‡‡ç”¨**å¤´éƒ¨æ’å…¥**çš„æ–¹æ³•æ”¾åˆ°æ–°é“¾è¡¨ä¸­\n\n### åˆ é™¤å…ƒç´ \n\næ ¹æ®**ä¸€äº›æ¡ä»¶**åˆ¤æ–­æ¥åˆ é™¤å…ƒç´ \n\n- ç§»é™¤é“¾è¡¨æŒ‡å®šå…ƒç´ (`LeetCode 203`)ï¼šåŒæ ·åˆ›å»ºä¸€ä¸ªæ–°é“¾è¡¨ã€‚éå†æ—§é“¾è¡¨ï¼Œç›¸åŒå…ƒç´ è·³è¿‡ï¼Œä¸åŒå…ƒç´ åŠ å…¥æ–°é“¾è¡¨\n- åˆ é™¤é“¾è¡¨é‡å¤å…ƒç´ ï¼šåˆ¤æ–­å½“å‰éå†çš„å…ƒç´ ä¸æ–°é“¾è¡¨ä¸­æœ€åçš„å…ƒç´ æ˜¯å¦ç›¸ç­‰ã€‚\n- åˆ é™¤é“¾è¡¨æ‰€æœ‰é‡å¤è¿‡çš„å…ƒç´ ï¼š\n\n### åˆå¹¶\n\n- åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨(`LeetCode 21`)\n- åˆå¹¶Kä¸ªå‡åºé“¾è¡¨(`LeetCode 23`)\n\nè¿™ä¸¤é“é¢˜é¡µéƒ½æ˜¯ç”Ÿæˆ dummy æ–°é“¾è¡¨ï¼Œç„¶å**é€‰æ‹©ç»“ç‚¹**å¾€æ–°é“¾è¡¨å°¾éƒ¨è¿½åŠ æ•°æ®\n\n- å‡åºï¼š é€‰æ‹©æœ€å°çš„\n- é™åºï¼šé€‰æ‹©æœ€å¤§çš„\n\n**è€ƒç‚¹**ï¼šåœ¨é€‰æ‹©æœ€å°æˆ–æœ€å¤§æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰æ¥ä¼˜åŒ–\n\n### äº¤æ¢\n\näº¤æ¢é“¾è¡¨ä¸­çš„ç»“ç‚¹(`LeetCode 24`)ï¼šä¸¤ä¸¤åè½¬å³å¥‡å¶ä½ç½®å…ƒç´ äº¤æ¢\n\n- å…ˆæ‹†åˆ†ï¼šæŒ‰ç…§å¥‡å¶æ‹†æˆä¸¤ä¸ªé“¾è¡¨\n- å†åˆå¹¶ï¼šå¥‡æ•°ä½å¯¹åº”åŸæ¥å¶æ•°ä½ï¼Œå¶æ•°ä½å¯¹åº”åŸæ¥å¥‡æ•°ä½\n\nK ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨(`LeetCode 25`)ï¼šæ¯kçš„å…ƒç´ ä¸€ç»„äº¤æ¢(k=2å°±ç­‰ä»·äºä¸Šä¸€é¢˜)\n\n- å‡†å¤‡ä¸¤ä¸ªé“¾è¡¨â€”â€”tempå’Œresult\n- éå†é“¾è¡¨ï¼Œå°†èŠ‚ç‚¹æ’å…¥tempï¼Œæ»¡kä¸ªå°±åè½¬å¹¶æ’å…¥resultä¸­\n- æœ€ç»ˆå°†å‰©ä½™çš„èŠ‚ç‚¹ï¼ˆä¸æ»¡kä¸ªï¼‰æ’å…¥result\n\né€†å‘kä¸ªä¸€ç»„ï¼šä¸Šä¸€é¢˜ç¿»ç€æ¥\n\n- å…ˆå°†é“¾è¡¨åè½¬\n- å†æ²¿ç”¨ä¸Šé¢˜çš„æ–¹æ³•\n\n## åŒæŒ‡é’ˆ\n\né“¾è¡¨çš„åŒæŒ‡é’ˆæœ‰ä¸¤ç§ï¼š\n\n1. é—´éš”æŒ‡é’ˆï¼šå‰é¢çš„æŒ‡é’ˆå…ˆèµ°ä¸€æ­¥ï¼Œç„¶ååé¢çš„æŒ‡é’ˆå†ä¸€èµ·èµ°ï¼›å‰é¢çš„æŒ‡é’ˆå…ˆèµ° k æ­¥ï¼Œåé¢çš„æŒ‡é’ˆå†ä¸€èµ·èµ°ã€‚\n2. å¿«æ…¢æŒ‡é’ˆï¼šä¸¤ä¸ªæŒ‡é’ˆçš„é€Ÿåº¦ä¸€å¿«ä¸€æ…¢å‰è¿›ï¼Œæ¯”å¦‚ä¸€ä¸ªæ¯æ¬¡èµ°ä¸€æ­¥ï¼Œä¸€ä¸ªæ¯æ¬¡èµ°ä¸¤æ­¥ã€‚\n\n`LeetCode[19]` åˆ é™¤é“¾è¡¨å€’æ•°ç¬¬Kä¸ªèŠ‚ç‚¹\n\n- é‡‡ç”¨é—´éš”æŒ‡é’ˆback,front   frontå…ˆèµ°kå¸ƒ\n- backï¼Œfrontå†ä¸€èµ·èµ°ç›´åˆ°frontåˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹\n- è¾¹ç•Œæƒ…å†µï¼šåˆ é™¤çš„æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹\n\nå°†é“¾è¡¨ä»ä¸­é—´æ‹†åˆ†æˆä¸¤åŠ\n\n- é‡‡ç”¨å¿«æ…¢æŒ‡é’ˆback,front\n- frontæ¯æ¬¡èµ°2æ­¥ï¼Œbackæ¯æ¬¡èµ°1æ­¥\n- è¾¹ç•Œ\n  - å¥‡æ•°ä¸ªèŠ‚ç‚¹æ—¶ï¼Œfrontæ­£å¥½æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹\n  - å¶æ•°ä¸ªèŠ‚ç‚¹æ—¶ï¼Œfrontä¸ºç©ºï¼Œåº”è¿”å›backçš„å‰é©±\n\n`LeetCode[143]` é‡æ’é“¾è¡¨\n\n- å…ˆæŠŠé“¾è¡¨å¹³åˆ†\n- æŠŠååŠéƒ¨åˆ†é€†ç½®\n- å†æŠŠé€†ç½®çš„ååŠéƒ¨åˆ†æ’å…¥åˆ°å‰åŠéƒ¨åˆ†çš„å¶æ•°ä½ä¸Š\n\n`LeetCode[141]` ç¯å½¢é“¾è¡¨\n\n- é‡‡ç”¨å¿«æ…¢æŒ‡é’ˆback,front\n- frontæ¯æ¬¡èµ°2æ­¥ï¼Œbackæ¯æ¬¡èµ°1æ­¥\n- å¦‚æœæœ‰ç¯ï¼Œbackå’Œfrontå¿…å®šç›¸é‡\n\næ‰¾å‡ºç¯å½¢é“¾è¡¨æˆç¯çš„èŠ‚ç‚¹\n\n- è®°ä½ä¸€ä¸ªç»“è®ºï¼šå¿«æ…¢æŒ‡é’ˆåˆ†åˆ«ä»å¤´èŠ‚ç‚¹å’Œç›¸é‡èŠ‚ç‚¹å‡ºå‘ï¼Œæœ€ç»ˆä¸€å®šä¼šå†æˆç¯èŠ‚ç‚¹ç›¸é‡\n- å…ˆéƒ½ä»å¤´èŠ‚ç‚¹å‡ºå‘ï¼Œæ‰¾åˆ°ç›¸é‡èŠ‚ç‚¹\n- åˆ†åˆ«ä»å¤´èŠ‚ç‚¹å’Œç›¸é‡èŠ‚ç‚¹å‡ºå‘ï¼Œæœ€åç›¸é‡çš„èŠ‚ç‚¹å³æˆç¯èŠ‚ç‚¹\n\n`LeetCode[148]` é“¾è¡¨æ’åºï¼šç»™å®šä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œå¦‚ä½•ç»™è¿™ä¸ªé“¾è¡¨æ’åºï¼Œè¦æ±‚å¤æ‚åº¦è¾¾åˆ° O(nlogn)ã€‚\n\n- é‡‡ç”¨å½’å¹¶æ’åºçš„æ€æƒ³æ¥è§£\n- é€’æ¨è¿‡ç¨‹ï¼šä¸¤ä¸¤åˆ†è§£â€”â€”ç”¨å¿«æ…¢å°†é“¾è¡¨ä¸æ–­äºŒåˆ†\n- å›å½’è¿‡ç¨‹ï¼šä¸¤ä¸¤åˆå¹¶â€”â€”åˆ©ç”¨æ–°å»ºå¤´å°–ç‚¹æ¥ä¸æ–­åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨\n","tags":["JavaScript","TypeScript","Algorithm"],"categories":["Algorithm"]},{"title":"jsä½è¿ç®—å’Œæƒé™","url":"/posts/8d54c840.html","content":"\n## ä½è¿ç®—\n\n### ä¸ &\n\néƒ½ä¸º1åˆ™ä¸º1ï¼Œå¦åˆ™ä¸º0\n\nAï¼š0011010\nBï¼š0101100\nCï¼š0001000\n\n### æˆ–\t |\n\næœ‰1å³ä¸º1ï¼Œå¦åˆ™ä¸º0\n\nAï¼š0011010\nBï¼š0101100\nCï¼š0111110\n\n### é ^\n\nä¸åŒä¸º1ï¼Œç›¸åŒä¸º0\n\nAï¼š0011010\nBï¼š0101100\nCï¼š0110110\n\n## æƒé™æ§åˆ¶\n\nç°åœ¨æœ‰`è¯»`ã€`å†™`å’Œ`æ‰§è¡Œ`ä¸‰ç§æƒé™\n\n```test\nè¯»\tå†™ æ‰§è¡Œ åè¿›åˆ¶ æƒé™\n0\t 0  1     1\t\tåªæœ‰æ‰§è¡Œ\n0\t 1  0     2\t\tåªæœ‰å†™\n1\t 0\t0\t\t\t4\t\tåªæœ‰è¯»\n```\n\nè¯»å†™æ‰§è¡Œå¯¹åº”çš„å€¼åˆ†åˆ«æ˜¯`1`ã€`2`å’Œ`4`\n\n`011`å³`3`å¯¹åº”çš„æƒé™ä¸º**å†™å’Œæ‰§è¡Œ**ï¼Œå…¶å®ƒä»¥æ­¤ç±»æ¨ã€‚\n\n### æ·»åŠ æƒé™\n\nä½¿ç”¨`|`æ¥æ·»åŠ æƒé™\n\nç”¨æˆ·çš„æƒé™ä¸º1(`001`ï¼Œåªæœ‰æ‰§è¡Œ)ï¼Œç°åœ¨éœ€è¦åŠ ä¸Šè¯»(4, `100`)\n\n```text\n1 | 4:\n0 0 1 => 1\n1 0 0 => 4\n1 0 1 => 5\n```\n\nç»“æœä¸º5(`101`)å¯¹åº”æ‰§è¡Œå’Œè¯»çš„æƒé™\n\n### åˆ é™¤æƒé™\n\nä½¿ç”¨`^`æ¥åˆ é™¤æƒé™\n\nç”¨æˆ·çš„æƒé™ä¸º7(`111`)ï¼Œéœ€è¦åˆ é™¤å†™(2, `010`)çš„æƒé™\n\n```text\n7 ^ 2:\n1 1 1 => 7\n0 1 0 => 2\n1 0 1\t=> 5\n```\n\nç»“æœä¸º5(`101`)ï¼Œå¯¹åº”æ‰§è¡Œå’Œè¯»çš„æƒé™\n\n### åˆ¤æ–­æƒé™\n\nå½“æ‹¿åˆ°ç”¨æˆ·æƒé™æ—¶ï¼Œä½¿ç”¨`&`æ¥åˆ¤æ–­ç”¨æˆ·çš„æƒé™\n\nç”¨æˆ·çš„æƒé™æ˜¯6ï¼ˆ`110`ï¼Œè¯»å’Œå†™ï¼‰\n\n`110` & `001` = `000`ï¼Œ è¡¨ç¤º**æ²¡æœ‰**æ‰§è¡Œæƒé™ \n\n`110` & `010` = `010`ï¼Œ è¡¨ç¤º**æœ‰**å†™çš„æƒé™\n\n`110` & `100` = `100`ï¼Œ è¡¨ç¤º**æœ‰**è¯»çš„æƒé™ \n\nåªæœ‰&åçš„ç»“æœç­‰äºæ‰€éœ€åˆ¤æ–­çš„æƒé™ï¼Œå°±è¡¨ç¤ºæœ‰è¯¥æƒé™\n\n## æƒé™æ•°çš„é™åˆ¶\n\næ¯å¢åŠ ä¸€ä½æƒé™ï¼Œå°±éœ€è¦å¤šä¸€ä½äºŒè¿›åˆ¶ä½ã€‚\n\nJavaScript å°†æ•°å­—å­˜å‚¨ä¸º 64 ä½æµ®ç‚¹æ•°ï¼Œä½†æ‰€æœ‰æŒ‰ä½è¿ç®—éƒ½ä»¥ 32 ä½äºŒè¿›åˆ¶æ•°æ‰§è¡Œã€‚\n\n- åœ¨æ‰§è¡Œä½è¿ç®—ä¹‹å‰ï¼ŒJavaScript å°†æ•°å­—è½¬æ¢ä¸º 32ä½æœ‰ç¬¦å·æ•´æ•°ã€‚\n\n- æ‰§è¡ŒæŒ‰ä½æ“ä½œåï¼Œç»“æœå°†è½¬æ¢å› 64 ä½ JavaScript æ•°ã€‚\n\næ‰€ä»¥ï¼Œjsä¸­æœ€å¤šèƒ½é…ç½®32ç§æƒé™(`1` `1 << 1`....`1 << 31`)ã€‚`1 << 32`ç­‰äº`1`\n\nä½¿ç”¨`BigInt`èƒ½å¤Ÿè¡¨ç¤ºæ›´å¤šçš„æƒé™ã€‚\n\n`1n << 33n => 8589934592n`","tags":["javascript","ä½è¿ç®—"],"categories":["JavaScript"]},{"title":"jsä¸­çš„æ•°å€¼ç±»å‹","url":"/posts/9a6a2aee.html","content":"\n## IEEE 754\n\n`JavaScript`çš„æ•°å€¼ç±»å‹éµå¾ª`IEEE 754`è§„èŒƒã€‚`JavaScript`ä¸­çš„æ•°å­—éƒ½æ˜¯ä»¥æ˜¯64-bitsçš„åŒç²¾åº¦æ•°çš„å½¢å¼å­˜å‚¨çš„ã€‚æ‰€ä»¥èƒ½è¡¨ç¤ºæœ‰2^64ç§æƒ…å†µã€‚\n\n### æµ®ç‚¹æ•°å…¬å¼\n\njsä¸­çš„ä»»ä½•ä¸€ä¸ªäºŒè¿›åˆ¶æµ®ç‚¹æ•°å¯ä»¥ç”±ä»¥ä¸‹å…¬å¼æ¥è¡¨ç¤ºï¼š\n$$\nV = (-1)^{S} * M * 2^{E}\n$$\n\n- Vï¼šè¡¨ç¤ºäºŒè¿›åˆ¶æµ®ç‚¹æ•°\n- Sï¼šç¬¦å·ä½ï¼Œ1ä½ã€‚ä¸º0æ­£æ•°ï¼Œ1ä¸ºè´Ÿæ•°\n- Mï¼šæœ‰æ•ˆæ•°å­—ï¼Œ52ä½ã€‚\n- Eï¼šæŒ‡æ•°ä½ï¼Œ11ä½\n\n`M`æ˜¯ä¸€ä¸ªä»‹äº1å’Œ2ä¹‹é—´çš„æ•°å³(`1.xxxxxxxxxxx`, 11ä¸ª`x`)ã€‚ç¬¬ä¸€ä¸ª`1`æ˜¯é»˜è®¤å¡«ä¸Šçš„æ‰€ä»¥Mæœ‰`2^53 - 1`ä¸­å¯èƒ½ã€‚\n\n`E`çš„å–å€¼æœ‰`2^11`ä¸­å¯èƒ½ï¼Œç”±äº`E`éœ€è¦èƒ½å¤Ÿè¡¨ç¤ºè´Ÿæ•°ï¼Œæ‰€ä»¥è¦å‡å»ä¸€ä¸ªä¸­é—´æ•°(`1023`)\n\nåè¿›åˆ¶7ï¼ŒäºŒè¿›åˆ¶ä¸º111ï¼š\n$$\n7(111) = (-1)^{0} * 1.11 * 2^{2}\n= 1.11 * 100 = 111\n$$\næ³¨æ„ï¼šè¿™é‡Œæ˜¯2è¿›åˆ¶çš„è¿ç®—`2^2 = 100`\n\n`E`ä¸º2ï¼ˆ10ï¼‰ï¼Œè¿™é‡Œå·²ç»å‡å»1023ã€‚`2+1023=1025`ï¼Œå³åä¸€ä½äºŒè¿›åˆ¶å¯¹åº”çš„å€¼ä¸º`1025`\n\n### Eçš„å‡ ç§æƒ…å†µ\n\nåŒæ—¶æŒ‡æ•°Eè¿˜å¯ä»¥**æ ¹æ®è§„å®šåˆ†ä¸ºä¸‰ç§æƒ…å†µè®¨è®º**\n\n1. **Eä¸å…¨ä¸º0æˆ–ä¸å…¨ä¸º1** è¿™ä¸ªé˜¶æ®µå°±æ˜¯æ­£å¸¸çš„æµ®ç‚¹æ•°è¡¨ç¤ºï¼Œé€šè¿‡è®¡ç®—Eç„¶åå‡å»1024å³ä¸ºæŒ‡æ•°\n2. **Eå…¨ä¸º0** æµ®ç‚¹æ•°çš„æŒ‡æ•°Eç­‰äº0-1023 = -1023ï¼Œå½“æŒ‡æ•°ä¸º-1023æ—¶ï¼Œ**æœ‰æ•ˆæ•°å­—Mä¸å†åŠ ä¸Šç¬¬ä¸€ä½çš„1**ï¼Œè€Œæ˜¯è¿˜åŸä¸º0.xxxxxxçš„å°æ•°ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†è¡¨ç¤ºÂ±0ï¼Œä»¥åŠæ¥è¿‘äº0çš„å¾ˆå°çš„æ•°å­—\n3. **Eå…¨ä¸º1** æ­¤æ—¶å¦‚æœæœ‰æ•ˆæ•°å­—Må…¨ä¸º0ï¼Œé‚£ä¹ˆå°±è¡¨ç¤º+âˆæˆ–è€…-âˆï¼Œå–å†³äºç¬¬ä¸€ä½ç¬¦å·ä½ã€‚**ä½†æ˜¯å¦‚æœæœ‰æ•ˆæ•°å­—Mä¸å…¨ä¸º0ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸æ˜¯ä¸€ä¸ªæ•°(NaN)**\n\n## JavaScriptä¸­çš„IEEE 754\n\n### æœ€å¤§å®‰å…¨æ•´æ•°\n\n$$\nNumber.MAX\\_SAFE\\_INTEGER = 2^{53} - 1\n$$\n\næœ‰æ•ˆæ•°å­—åªæœ‰52ä½ï¼Œ`2^53`å’Œ`2^53+1`ä»¥åŠåé¢çš„æ•°åœ¨jsä¸­éƒ½ç›¸ç­‰ã€‚æ‰€ä»¥jsèƒ½å¤Ÿè¡¨ç¤ºçš„æœ€å¤§å®‰å…¨æ•´æ•°æ˜¯`2^53 - 1`ã€‚\n\n### 0.1 + 0.2 !== 0.3 ?\n\nè®¡ç®—æœºè¿›è¡Œæ•°å€¼è¿ç®—æ˜¯ï¼Œæ˜¯å°†åè¿›åˆ¶è½¬æˆäºŒè¿›åˆ¶è¡¥ç å†è¿›è¡Œè®¡ç®—\n\n```text\n0.1D = (-1)^0 * 1.1001..(1001å¾ªç¯13æ¬¡)1010B * 2^-4\n0.2D = (-1)^0 * 1.1001..(1001å¾ªç¯13æ¬¡)1010B * 2^-3\n0.3D = (-1)^0 * 1.0011..(0011å¾ªç¯13æ¬¡)0011B * 2^-2\n```\n\nå½“0.1ï¼Œ0.2è½¬åŒ–ä¸ºäºŒè¿›åˆ¶çš„æ—¶å€™ï¼Œæœ‰æ•ˆæ•°å­—éƒ½æ˜¯52ä½(4 * 12 + 4)ï¼Œå› ä¸ºåœ¨64ä½ç²¾ç¡®åº¦ä¸­ï¼Œåªèƒ½ä¿æŒ52ä½æœ‰æ•ˆæ•°å­—ï¼Œå¦‚æœæ²¡æœ‰52ä½æœ‰æ•ˆæ•°å­—çš„çº¦æŸï¼Œå…¶å®åœ¨ç¬¬53ä½ä¸­ï¼Œ0.1è½¬äºŒè¿›åˆ¶æœ¬æ¥æ˜¯1ï¼Œä½†æ˜¯æœ‰äº†52ä½çº¦æŸä¹‹åï¼Œæ ¹æ®äºŒè¿›åˆ¶çš„å–èˆï¼ˆ**0èˆ1å…¥**ï¼‰ ï¼Œæœ€åäº”ä½æ•°å°±ä»1001 **1(ç¬¬53ä½)** å˜æˆäº† 1010ã€‚\n\næˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è®¡ç®—ä¸€ä¸‹0.1çš„äºŒè¿›åˆ¶åŠ ä¸Š0.2çš„äºŒè¿›åˆ¶ï¼š\n$$\n0.1 + 0.2 = (-1)^{0} * 1.0011...(0011 å¾ªç¯13æ¬¡)0011 * 2^{-2}\n$$\né‚£ä¹ˆç›¸åŠ ç»“æœè½¬æ¢ä¸ºåè¿›åˆ¶å…¶å®ç­‰äº`0.30000000000000004`ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ0.1 + 0.2 != 0.3 çš„åŸå› äº†ã€‚\n\n\n\n","tags":["javascript","Number"],"categories":["JavaScript"]},{"title":"Rustå­¦ä¹ ç¬”è®°-Struct","url":"/posts/a574aaab.html","content":"\næœ¬ç³»åˆ—æ–‡ç« æ˜¯ç¬”è€…å­¦ä¹ `Rust`æ—¶æ‰€åšçš„ç¬”è®°ï¼Œä¾›æ—¥åç¿»é˜…å¤ä¹ ã€‚\n\n## å®šä¹‰Struct\n\nä½¿ç”¨`struct`æ¥å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œç»“æ„ä½“æ˜¯`key-value`é›†åˆã€‚`key`æ˜¯å­—æ®µå, `value`æ˜¯ç±»å‹ã€‚\n\n```rust\nstruct User {\n  username: String,\n  email: String,\n  sign_in_count: u64,\n  active: bool,\n}\n```\n\n> `Strut`çš„å­˜åœ¨ ç±»ä¼¼å…¶ä»–è¯­è¨€çš„`class`\n\n## å®ä¾‹åŒ–Struct\n\nå®ä¾‹åŒ–æ—¶ï¼Œéœ€è¦æä¾›åˆå§‹å‚æ•°ã€‚\n\n```rust\nlet user = User {\n  email: String::from(\"someone@example.com\"),\n  username: String::from(\"someusername123\"),\n  active: true,\n  sign_in_count: 1,\n};\n```\n\né»˜è®¤ï¼Œuseræ˜¯`immutable`ï¼Œå¦‚æœéœ€è¦`mutable`ï¼Œåœ¨å®šä¹‰æ—¶åŠ ä¸Š`mut`\n\n```rust\nlet mut user = User {\n  email: String::from(\"someone@example.com\"),\n  username: String::from(\"someusername123\"),\n  active: true,\n  sign_in_count: 1,\n};\n\nuser.username = String::from(\"zxfan\")\n```\n\nå¦‚æœåŠ ä¸Š`mut`é‚£ä¹ˆï¼Œæ•´ä¸ªå®ä¾‹éƒ½æ˜¯å¯å˜çš„ã€‚`rust`ä¸å…è®¸æŒ‡å®šå­—æ®µæ˜¯å¯å˜çš„ã€‚\n\n### å·¥å‚æ¨¡å¼å®ä¾‹åŒ–\n\né‡‡ç”¨å·¥å‚æ¨¡å¼æ¥å®ä¾‹åŒ–Struct\n\n```rust\nfn build_user(email: String, username: String) -> User {\n  User {\n    email,\n    username,\n    active: true,\n    sign_in_count: 1,\n  }\n}\n```\n\n`email: email`å¯ä»¥çœç•¥ä¸º`email`ã€‚è¿™ä¸€ç‰¹æ€§å’Œ`JavaScript`ä¸€æ ·ã€‚\n\n### ç»“æ„ä½“æ›´æ–°è¯­æ³•\n\n[Struct Update Syntax](https://doc.rust-lang.org/book/ch05-01-defining-structs.html#creating-instances-from-other-instances-with-struct-update-syntax)å…è®¸åˆ›å»ºä½¿ç”¨ä¸€ä¸ªå®ä¾‹æ¥åˆ›å»ºå¦ä¸€ä¸ªå®ä¾‹\n\n```rust\nlet user1 = User {\n  email: String::from(\"someone@example.com\"),\n  username: String::from(\"someusername123\"),\n  active: true,\n  sign_in_count: 1,\n};\n\nlet user2 = User {\n  email: String::from(\"another@example.com\"),\n  username: String::from(\"anotherusername567\"),\n  ..user1\n};\n\n// owner å‘ç”Ÿ move\n// user1 æ— æ³•è®¿é—®\n```\n\né€šè¿‡`..`è¯­æ³•æŒ‡å®š`user2`çš„å‰©ä½™å­—æ®µå–`user1`çš„å€¼ã€‚æ³¨æ„ï¼š`..`ä¼šå‘ç”Ÿ`owner`çš„moveï¼Œuser1å°±æ— æ³•å†è®¿é—®äº†\n\n## Tupple Struct\n\næ²¡æœ‰å­—æ®µåï¼Œä»¥å…ƒç»„çš„æ–¹å¼å®šä¹‰struct\n\n```rust\nstruct Color(i32, i32, i32);\nstruct Point(i32, i32, i32);\n\nlet black = Color(0, 0, 0);\nlet origin = Point(0, 0, 0);\n\nbalck.0 // è®¿é—®\n```\n\né€šè¿‡`.`æ¥è®¿é—®å…¶å…ƒç´ \n\n> é»˜è®¤æƒ…å†µä¸‹ï¼Œ`struct`å­—æ®µå€¼ä¸èƒ½æ˜¯å¼•ç”¨(`References `)ã€‚\n>\n> åœ¨æŒ‡å®šæœ‰`lifetime`çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨ç»“æ„ä½“ä¸­ä½¿ç”¨å¼•ç”¨ã€‚ç”Ÿå‘½å‘¨æœŸèƒ½å¤Ÿç¡®ä¿åªæœ‰structæœ‰æ•ˆï¼Œé‚£ä¹ˆå…¶strutctå†…çš„åº”ç”¨ä¹Ÿæœ‰æ•ˆ\n\n## ä½¿ç”¨æ´¾ç”Ÿç‰¹æ€§æ·»åŠ ä½¿ç”¨åŠŸèƒ½\n\nå½“ä½¿ç”¨`println!`ç›´æ¥è¾“å‡ºä¸€ä¸ªç»“æ„ä½“ï¼Œä¼šæŠ¥é”™ï¼\n\n```rust\nstruct Rectangle {\n    width: u32,\n    height: u32,\n}\n\nfn main() {\n    let rect1 = Rectangle {\n        width: 30,\n        height: 50,\n    };\n\n    println!(\"rect1 is {}\", rect1);\n}\n\n/*\n  --> src/main.rs:12:29\n   |\n12 |     println!(\"rect1 is {}\", rect1);\n   |                             ^^^^^ `Rectangle` cannot be formatted with the default formatter\n   |\n   = help: the trait `std::fmt::Display` is not implemented for `Rectangle`\n   = note: in format strings you may be able to use `{:?}` (or {:#?} for pretty-print) instead\n   = note: required by `std::fmt::Display::fmt`\n   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n*/\n```\n\n**`Rectangle` cannot be formatted with the default formatter**ã€‚åˆ©ç”¨æ´¾ç”Ÿç‰¹æ€§å¯ä»¥è§£å†³structè¾“å‡ºçš„é—®é¢˜ã€‚\n\n`#[derive(Debug)]`ï¼šå°†`Debug`ç‰¹æ€§æ´¾ç”Ÿåˆ°è‡ªå®šä¹‰ç±»å‹ï¼ˆç»“æ„ä½“ï¼‰ä¸­\n\n```rust\n// #å£°æ˜æ³¨è§£\n#[derive(Debug)]\nstruct Rectangle {\n    width: u32,\n    height: u32,\n}\n\nfn main() {\n    let rect1 = Rectangle {\n        width: 30,\n        height: 50,\n    };\n\t\t\n  \t// åœ¨è¾“å‡ºæ—¶ï¼ŒåŠ ä¸Š{:?}\n    println!(\"rect1 is {:?}\", rect1);\n}\n```\n\nä¸¤ç§è¾“å‡ºï¼š\n\n- `{:?}`: è¾“å‡º`rect1 is Rectangle { width: 30, height: 50 }`\n\n- `{:#?}`: æ ¼å¼åŒ–è¾“å‡º\n\n  ```tex\n  rect1 is Rectangle {\n      width: 30,\n      height: 50,\n  }\n  ```\n\n## ç»“æ„ä½“æ–¹æ³•\n\n`struct`ç±»ä¼¼å…¶å®ƒè¯­è¨€çš„`class`ã€‚ç±»æœ‰æˆå‘˜æ–¹æ³•ã€‚`stuct`ä¹Ÿæœ‰ç±»å‹æ¦‚å¿µã€‚ä½¿ç”¨`impl`ï¼ˆimplementï¼‰å…³é”®å­—æ¥ç»™`struct`æ·»åŠ æˆå‘˜æ–¹æ³•\n\n```rust\n#[derive(Debug)]\nstruct Rectangle {\n    width: u32,\n    height: u32,\n}\n\nimpl Rectangle {\n    fn area(&self) -> u32 {\n        self.width * self.height\n    }\n}\n\nfn main() {\n    let rect1 = Rectangle {\n        width: 30,\n        height: 50,\n    };\n\n    println!(\n        \"The area of the rectangle is {} square pixels.\",\n        rect1.area()\n    );\n}\n\n```\n\nç»“æ„ä½“æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…å®šä¸º`self`ï¼Œå®ƒæ˜¯`struct`å®ä¾‹ã€‚åŠ ä¸Š`&`æ˜¯å› ä¸ºåªéœ€è¦å¼•ç”¨ã€‚\n\nä½¿ç”¨æ—¶ç›´æ¥ç”¨`.`è°ƒç”¨ï¼Œæ— éœ€è€ƒè™‘åƒ`C/C++`é‚£æ ·æœ‰`.`å’Œ`->`ä¸¤ç§è°ƒç”¨æ–¹å¼ã€‚å› ä¸º`Rust`èƒ½å¤Ÿè‡ªåŠ¨å¼•ç”¨å’Œè§£å¼•ç”¨ã€‚\n\n> ä¸€ä¸ªimplèƒ½å¤Ÿå£°æ˜å¤šä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªstructä¹Ÿèƒ½æœ‰å¤šä¸ªimpl\n\n## å…³è”å‡½æ•°\n\n`impl`èƒ½å¤Ÿå£°æ˜ä¸ä»¥`self`ä½œä¸ºå‚æ•°çš„å‡½æ•°ï¼Œè¢«ç§°ä¸º`å…³è”å‡½æ•°`ã€‚å¯ä»¥ç†è§£æˆå…¶ä»–è¯­è¨€çš„**é™æ€æ–¹æ³•**\n\n```rust\nimpl Rectangle {\n    fn square(size: u32) -> Rectangle {\n        Rectangle { width: size, height: size }\n    }\n}\n\n// è°ƒç”¨\nlet sq = Rectangle::square(3)\n```\n\nä½¿ç”¨`::`æ¥è°ƒç”¨å…³è”å‡½æ•°ã€‚\n\n","tags":["Rust","è¯­è¨€å­¦ä¹ "],"categories":["Rust"]},{"title":"web-vitalsæºç è§£è¯»","url":"/posts/473044e6.html","content":"\n## web-vitalsç®€ä»‹\n\n[web-vitals](https://www.npmjs.com/package/web-vitals#overview)æ˜¯`google`å¼€æºçš„ä¸€ä¸ªæµ‹é‡webæ€§èƒ½æŒ‡æ ‡çš„å·¥å…·ã€‚ä½“ç§¯æ‰**1KB**ï¼Œå®ƒå¯ä»¥ç”¨æ¥æµ‹é‡`CLS`ã€`FID`ã€`LCP`ã€`FCP`ã€`TTFB`ã€‚\n\nå¯é€šè¿‡npmæ¥å®‰è£…`npm install web-vitals`\n\nä½¿ç”¨ä¹Ÿååˆ†ç®€å•\n\n```typescript\nimport {getLCP, getFID, getCLS} from 'web-vitals';\n\ngetCLS(console.log);\ngetFID(console.log);\ngetLCP(console.log);\n```\n\n## æºç ç»“æ„\n\n`web-vitals`æ•´ä¸ªé¡¹ç›®ä¸æ˜¯å¾ˆå¤æ‚ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹\n\n```text\nâ”œâ”€.git\nâ”œâ”€docs\nâ”œâ”€src # æºç \nâ”œâ”€test # æµ‹è¯•ä»£ç \nâ”œâ”€.eslintrc \nâ”œâ”€.gitignore\nâ”œâ”€base.d.ts\nâ”œâ”€base.js\nâ”œâ”€CHANGELOG.md\nâ”œâ”€LICENSE # å¼€æºåè®®\nâ”œâ”€package-lock.json\nâ”œâ”€package.json\nâ”œâ”€README.md\nâ”œâ”€rollup.config.js # rollupæ„å»ºé…ç½®\nâ”œâ”€tsconfig.json # tsé…ç½®\nâ”œâ”€wdio.conf.js # e2eæµ‹è¯•é…ç½®\n```\n\n## ä»£ç è§„èŒƒ\n\n### Eslint\n\n`web-vitals`é€šè¿‡é…ç½®eslintæ¥çº¦å®šä»£ç è§„èŒƒã€‚é€šå¸¸ï¼Œ`eslint`é…ç½®æ–‡ä»¶ä½äºæ ¹ç›®å½•ä¸‹ã€‚è¿™æ ·å¯¹äºæ•´ä¸ªé¡¹ç›®éƒ½é€šç”¨ä¸€å¥—`eslint`é…ç½®ã€‚è¿™å¾€å¾€æ˜¯ä¸æ»¡è¶³éœ€æ±‚çš„ã€‚å¯èƒ½srcç›®å½•éœ€è¦ä¸€å¥—eslinté…ç½®ï¼Œè€Œtestç›®å½•æœ‰éœ€è¦å¦ä¸€å¥—eslinté…ç½®ã€‚`web-vitals`æ˜¯é€šè¿‡`eslintrc`ä¸‹çš„**overrides**å­—æ®µé…ç½®çš„\n\n```json\n{\n  \"parser\": \"babel-eslint\",\n  \"env\": {\n    \"browser\": true,\n    \"es6\": true,\n    \"node\": true,\n    \"mocha\": true\n  },\n  \"parserOptions\": {\n    \"sourceType\": \"module\"\n  },\n  \"overrides\": [\n    {\n      \"files\": \"wdio.conf.js\",\n      \"extends\": [\n        \"eslint:recommended\", \"google\"\n      ],\n      \"rules\": {\n        \"max-len\": \"off\"\n      }\n    },\n    {\n      \"files\": [\"test/e2e/*.js\"],\n      \"globals\": {\n        \"$\": false,\n        \"browser\": false\n      },\n      \"extends\": [\n        \"eslint:recommended\", \"google\"\n      ],\n      \"rules\": {\n        \"no-invalid-this\": \"off\",\n        \"max-len\": [2, {\n          \"ignorePattern\": \"^\\\\s*import|= require\\\\(|^\\\\s*it\\\\(|^\\\\s*describe\\\\(\",\n          \"ignoreUrls\": true\n        }],\n      }\n    },\n    {\n      \"files\": \"src/**/*.ts\",\n      \"parser\": \"@typescript-eslint/parser\",\n      \"extends\": [\n        \"plugin:@typescript-eslint/recommended\"\n      ],\n      \"rules\": {\n        \"@typescript-eslint/no-non-null-assertion\": \"off\",\n        \"@typescript-eslint/no-use-before-define\": \"off\",\n        \"@typescript-eslint/explicit-function-return-type\": \"off\",\n        \"@typescript-eslint/explicit-module-boundary-types\": \"off\",\n        \"@typescript-eslint/ban-ts-comment\": \"off\",\n        \"@typescript-eslint/camelcase\": \"off\",\n        \"node/no-missing-import\": \"off\",\n        \"node/no-unsupported-features/es-syntax\": \"off\",\n        \"node/no-missing-require\": \"off\",\n        \"node/shebang\": \"off\",\n        \"no-dupe-class-members\": \"off\"\n      },\n      \"parserOptions\": {\n        \"ecmaVersion\": 2018,\n        \"sourceType\": \"module\"\n      }\n    }\n  ]\n}\n```\n\n`overrides`å­—æ®µå¯¹åº”çš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€æ¡æ–°çš„eslintè§„åˆ™ï¼Œå¹¶è¦†ç›–å…¨å±€é…ç½®\n\n### husky\n\n[`husky`](https://typicode.github.io/husky/)æ˜¯ä¸€ä¸ª`git`é’©å­å·¥å…·ï¼Œ`package.json`æ–‡ä»¶ä¸‹æœ‰ä¸ª`husky`å­—æ®µ\n\n```json\n{\n    \"scripts\": {\n        \"lint\": \"eslint \\\"*.js\\\" \\\"src/**/*.ts\\\" \\\"test/**/*.js\\\"\",\n        \"lint:fix\": \"eslint --fix \\\"*.js\\\" \\\"src/**/*.ts\\\" \\\"test/**/*.js\\\"\",\n    },\n    \"husky\": {\n        \"hooks\": {\n            \"pre-commit\": \"npm run lint\"\n        }\n    },\n}\n```\n\nå®ƒçš„ä½œç”¨æ˜¯ï¼Œåœ¨æ¯æ¬¡`git commit`æ—¶ï¼Œè§¦å‘é’©å­å¹¶æ‰§è¡Œ`npm run lint`ï¼Œä¹Ÿå°±æ˜¯è¿›è¡ŒEslintæ£€æŸ¥ã€‚å¦‚æœæ²¡æœ‰é€šè¿‡eslintï¼Œå°±ä¼šcommitå¤±è´¥ã€‚\n\n### @rollup/plugin-eslint\n\n`web-vitals`çš„`rollup`å¹¶æ²¡æœ‰é…ç½®[@rollup/plugin-eslint](https://github.com/rollup/plugins/tree/master/packages/eslint)ã€‚å¦‚æœåŠ ä¸Šè¿™ä¸ªæ’ä»¶ï¼Œä¼šåœ¨æ„å»ºæ—¶è¿›è¡Œeslintæ£€æŸ¥ï¼Œå¦‚æœæ²¡æœ‰é€šè¿‡eslintï¼Œå°±ä¼šæ„å»ºå¤±è´¥å¹¶ç»™å‡ºç›¸åº”çš„ä¿®å¤æç¤ºã€‚\n\n## æ„å»ºé…ç½®\n\n`web-vitals`æ˜¯é€šè¿‡`rollup`è¿›è¡Œæ„å»ºæ‰“åŒ…çš„ã€‚å…¶é…ç½®ä¹Ÿååˆ†ç®€å•\n\n```javascript\n// rollup.config.js\nimport replace from '@rollup/plugin-replace';\nimport {terser} from 'rollup-plugin-terser';\nimport babel from 'rollup-plugin-babel';\n\nconst configurePlugins = ({module, polyfill = false}) => {\n  return [\n    babel({\n      presets: [['@babel/preset-env', {\n        targets: {\n          browsers: ['ie 11'],\n        },\n      }]],\n    }),\n    terser({\n      module,\n      mangle: true,\n      compress: true,\n    }),\n    replace({\n      'self.__WEB_VITALS_POLYFILL__': polyfill,\n    })\n  ]\n}\n\nconst configs = [\n  {\n    input: 'dist/modules/index.js',\n    output: {\n      format: 'esm',\n      file: './dist/web-vitals.js',\n    },\n    plugins: configurePlugins({module: true, polyfill: false}),\n  },\n  {\n    input: 'dist/modules/index.js',\n    output: {\n      format: 'umd',\n      file: `./dist/web-vitals.umd.js`,\n      name: 'webVitals',\n    },\n    plugins: configurePlugins({module: false, polyfill: false}),\n  },\n  {\n    input: 'dist/modules/index.js',\n    output: {\n      format: 'esm',\n      file: './dist/web-vitals.base.js',\n    },\n    plugins: configurePlugins({module: true, polyfill: true}),\n  },\n  {\n    input: 'dist/modules/index.js',\n    output: {\n      format: 'umd',\n      file: `./dist/web-vitals.base.umd.js`,\n      name: 'webVitals',\n      extend: true,\n    },\n    plugins: configurePlugins({module: false, polyfill: true}),\n  },\n  {\n    input: 'dist/modules/polyfill.js',\n    output: {\n      format: 'iife',\n      file: './dist/polyfill.js',\n      name: 'webVitals',\n      strict: false,\n    },\n    plugins: configurePlugins({module: false}),\n  },\n];\n\nexport default configs;\n\n```\n\n### ä¸åŒçš„äº§å‡ºæ–‡ä»¶\n\nå¯¼å‡ºçš„`config`æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚æ¯ä¸ªæ•°ç»„å…ƒç´ æ˜¯ä¸€ä»½rollupé…ç½®\n\n| äº§å‡ºæ–‡ä»¶å             | module | polyfill |\n| ---------------------- | ------ | -------- |\n| web-vitals.js          | esm    | ä¸å«     |\n| web-vitals.umd.js      | umd    | ä¸å«     |\n| web-vitals.base.js     | esm    | å«       |\n| web-vitals.base.umd.js | umd    | å«       |\n| polyfill.js            | iife   | -        |\n\n- `esm`ï¼šå³ ES Moduleï¼Œåœ¨ä»£ç ä¸­ç›´æ¥`import`ä½¿ç”¨\n\n- `iife`ï¼šç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œå°±æ˜¯`(function() {})(window)`è¿™ç§å½¢å¼\n\n- `umd`ï¼šæœ¬è´¨ä¸Šä¹Ÿæ˜¯iifeï¼Œä½†æ˜¯å®ƒå°†å¾…æ‰§è¡Œçš„å‡½æ•°ä½œä¸ºiifeçš„å‚æ•°ä¼ å…¥\n\n  ```javascript\n  var a = 2;\n  (function IIFE( def ) {\n    def( window );\n  })(function def( global ) {\n    var a = 3;\n    console.log( a ); // 3 \n    console.log( global.a ); // 2\n  });\n  ```\n\n`iife`å’Œ`umd`éƒ½æ˜¯ç›´æ¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨äº†\n\n###  tree-shaking\n\nrolupä½¿ç”¨äº†`@rollup/plugin-replace`ï¼Œç”¨äºæ›¿æ¢ä¸€äº›å¸¸é‡\n\n```javascript\nreplace({\n    'self.__WEB_VITALS_POLYFILL__': polyfill,\n})\n```\n\nè¿™ä¼šå°†ä»£ç ä¸­æ‰€æœ‰å‡ºç°çš„`self.__WEB_VITALS_POLYFILL__`çš„åœ°æ–¹æ›¿æ¢æˆ`polyfill`å˜é‡çš„å¯¹åº”çš„å€¼ï¼ˆ`true`æˆ–`false`ï¼‰ã€‚åœ¨ä»£ç ä¸­å‡ºç°å¤§é‡çš„`self.__WEB_VITALS_POLYFILL__`\n\n```typescript\n// src/lib/getFirstHidden.ts \n\n// function getFirstHidden\nif (self.__WEB_VITALS_POLYFILL__) {\n    firstHiddenTime = self.webVitals.firstHiddenTime;\n    if (firstHiddenTime === Infinity) {\n        trackChanges();\n    }\n} else {\n    firstHiddenTime = initHiddenTime();\n    trackChanges();\n}\n```\n\nå¦‚æœ`self.__WEB_VITALS_POLYFILL__`æ˜¯trueï¼Œrollupåœ¨æ„å»ºæ—¶ï¼Œå°±ä¼šå§elseçš„é€»è¾‘åˆ æ‰ã€‚åä¹‹ï¼Œä¼šæŠŠifçš„é€»è¾‘ç»™åˆ æ‰ã€‚è¿™æ ·å°±å®ç°äº†Tree Shakingâ€”â€”åˆ é™¤å¤šä½™ä»£ç ã€‚\n\n### TypeScript\n\n`web-vitals`çš„æºç æ˜¯ä½¿ç”¨TSç¼–å†™çš„ï¼Œæœ€ç»ˆéœ€è¦ç”Ÿæˆjsæ–‡ä»¶ã€‚\n\n`web-vitals`çš„æ„å»ºè¿‡ç¨‹ï¼š\n\n- å…ˆé€šè¿‡tscç”Ÿæˆ**jsæ–‡ä»¶**å’Œ**ç±»å‹å£°æ˜æ–‡ä»¶**ã€‚\n- å†é€šè¿‡**rollup**è¿›è¡Œå¯¹**jsæ–‡ä»¶**æ‰“åŒ…æ„å»º\n\nç±»å‹å£°æ˜éœ€è¦å†`package.json`ä¸­`typings`å­—æ®µæŒ‡å®šå£°æ˜æ–‡ä»¶çš„ä½ç½®\n\n```json\n{\n    \"main\": \"dist/web-vitals.umd.js\",\n    \"module\": \"dist/web-vitals.js\",\n    \"typings\": \"dist/modules/index.d.ts\",\n    \"files\": [\n        \"base.js\",\n        \"base.d.ts\",\n        \"dist\",\n        \"src\"\n    ],\n}\n```\n\n- `main`:  å®šä¹‰äº† npm åŒ…çš„å…¥å£æ–‡ä»¶ï¼Œbrowser ç¯å¢ƒå’Œ node ç¯å¢ƒå‡å¯ä½¿ç”¨\n- `module`:  å®šä¹‰ npm åŒ…çš„ ESM è§„èŒƒçš„å…¥å£æ–‡ä»¶ï¼Œbrowser ç¯å¢ƒå’Œ node ç¯å¢ƒå‡å¯ä½¿ç”¨\n- å¥½æœ‰ä¸ª`browser` : å®šä¹‰ npm åŒ…åœ¨ browser ç¯å¢ƒä¸‹çš„å…¥å£æ–‡ä»¶\n\n- `files`ï¼šå½“`npm publish`æ˜¯ï¼ŒæŒ‡å®šéœ€è¦ä¸Šä¼ çš„æ–‡ä»¶ã€‚\n\n## å¼€æºåè®®\n\n`web-vitals`é‡‡ç”¨`Apache-2.0`å¼€æºåè®®ã€‚è¯¥åè®®å…è®¸å¼€å‘è€…ä¿®æ”¹ä»£ç ï¼Œå¹¶ä¸”å•†ä¸šå‘å¸ƒã€‚ä½†æ˜¯å¯¹äºæ”¹åŠ¨éƒ¨åˆ†å¿…é¡»æä¾›ä¸€ä»½å£°æ˜ã€‚\n\n## æµ‹è¯•\n\n`web-vitals`çš„æµ‹è¯•éœ€è¦çœŸå®çš„æµè§ˆå™¨ç¯å¢ƒï¼Œå³éœ€è¦**ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆe2e testï¼‰**ã€‚é¡¹ç›®é€šè¿‡[wdioï¼ˆwebDriver.IOï¼‰]([Getting Started | WebdriverIO](https://webdriver.io/docs/gettingstarted))æ¥å®ç°çš„ã€‚\n\n```json\n{\n    \"scripts\": {\n        \"test\": \"npm-run-all build -p -r test:*\",\n        \"test:e2e\": \"wdio wdio.conf.js\",\n        \"test:server\": \"node test/server.js\",\n    }\n}\n```\n\n### æµ‹è¯•æµç¨‹\n\nå½“æ‰§è¡Œ`npm run test`æ—¶\n\n- å…ˆæ„å»ºæ‰“åŒ…é¡¹ç›®\n- å¯åŠ¨ä¸€ä¸ªHTTPæœåŠ¡ï¼Œç”¨äºå¤„ç†æµè§ˆå™¨çš„èµ„æºè¯·æ±‚\n- å¯åŠ¨wdioæµ‹è¯•\n\nå½“æ‰§è¡Œtest/e2eç›®å½•ä¸‹çš„æµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œä¾‹å¦‚`getLCP-test.js`\n\n```javascript\nit('reports the correct value on hidden (reportAllChanges === false)', async function() {\n    // æµè§ˆå™¨ä¸æ”¯æŒå°±è·³è¿‡è¿™æ¡ç”¨ä¾‹\n    if (!browserSupportsLCP) this.skip();\n\t\n    // æ‰“å¼€ /test/lcpè¿™ä¸ªç½‘é¡µï¼Œè¿™æ˜¯æµ‹è¯•ç½‘é¡µ\n    await browser.url('/test/lcp');\n\n    // ç­‰å¾…æ‰€æœ‰å›¾ç‰‡åŠ è½½å®Œæˆ\n    await imagesPainted();\n\n    // è·³è½¬åˆ°ç©ºç™½é¡µï¼Œè§¦å‘ä¸Šä¸€ä¸ªé¡µé¢çš„ hideçŠ¶æ€\n    await browser.url('about:blank');\n\t\n    // æ£€æµ‹æ˜¯beacon.logä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå‚æ•°ä¸ºæ•°æ®æ¡æ•°\n    await beaconCountIs(1);\n    \n    // å¯¹ beaconæ•°æ®è¿›è¡Œæ–­è¨€\n    assertStandardReportsAreCorrect(await getBeacons());\n});\n```\n\nå½“è¾“å…¥`browser.url('/test/lcp')`å…¶å®è®¿é—®çš„åœ°å€æ˜¯`http://localhost:9090/test/lcp`(åœ¨wdio.config.jsä¸­é…ç½®çš„)ã€‚è¿™æ¡è¯·æ±‚ä¼šå‘é€ç»™æœ¬åœ°çš„HTTPæœåŠ¡ä¸Šã€‚\n\n```javascript\n// src/test/server.js\n\napp.get('/test/:view', function(req, res) {\n  const data = {\n    ...req.query,\n    modulePath: `/dist/web-vitals${\n        req.query.polyfill ? `.base` : ``}.js`,\n    webVitalsPolyfill: fs.readFileSync('./dist/polyfill.js', 'utf-8'),\n  }\n  res.send(nunjucks.render(`${req.params.view}.njk`, data));\n});\n```\n\n`nunjucks`æ˜¯ä¸€ä¸ªæ¨¡æ¿å¼•æ“ã€‚dataæ•°æ®ä¼šæ’å…¥åˆ°æ¨¡æ¿å¼•æ“å†…ã€‚å½“è®¿é—®`/test/lcp`æ—¶ï¼Œä¼šå°†è§£æ`lcp.njk`å¹¶å°†htmlè¿”å›ç»™æµè§ˆå™¨ã€‚\n\n```html\n<!-- src/test/view/lcp.njk -->\n{% extends 'layout.njk' %}\n\n{% block content %}\n  <h1>LCP Test</h1>\n  <p>\n    {% if not imgDelay %}\n      {% set imgDelay = 500 %}\n    {% endif %}\n    <img {% if imgHidden %}hidden{% endif %} src=\"/test/img/square.png?delay={{ imgDelay }}\">\n  </p>\n  <p>Text below the image</p>\n\n  <p><a id=\"navigate-away\" href=\"https://example.com\">Navigate away</a></p>\n\n  <!-- Include a tall element to ensure scrolling is possible. -->\n  <div style=\"height: 100vh\"></div>\n\n  <footer>Text below the full-height element.</footer>\n\n  <script type=\"module\">\n    import {getLCP} from '{{ modulePath }}';\n\n    getLCP((lcp) => {\n      // Log for easier manual testing.\n      console.log(lcp);\n\n      // Elements can't be serialized, so we convert first.\n      lcp = {\n        ...lcp,\n        entries: lcp.entries.map((e) => ({\n          element: e.element.nodeName.toLowerCase(),\n          size: e.size,\n          startTime: e.startTime,\n        })),\n      };\n\n      // å‘é€ç»Ÿè®¡æ•°æ®\n      navigator.sendBeacon(`/collect`, JSON.stringify(lcp));\n    }, self.__reportAllChanges);\n  </script>\n{% endblock %}\n```\n\nhtmlä¸­çš„æœ€åä¸€æ­¥è°ƒç”¨äº†` navigator.sendBeacon(\"/collect\", JSON.stringify(lcp));`ï¼Œ`/collect`è¿™ä¸ªè¯·æ±‚ä¹Ÿæ˜¯å‘åˆ°æœ¬åœ°çš„HTTPæœåŠ¡ã€‚æœåŠ¡ç«¯ä¼šå°†æ•°æ®å†™å…¥åˆ°`src/test/beacons.log`ä¸­ã€‚\n\n### sendBeacon\n\n`navigator.sendBeacon`æ˜¯ä¸“é—¨ç”¨æ¥å‘é€å¼‚æ­¥ç»Ÿè®¡æ•°æ®çš„APIã€‚\n\næœ‰ä¸€ç§éœ€æ±‚ï¼šå½“é¡µé¢è·³è½¬æˆ–å…³é—­æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†å½“å‰é¡µé¢çš„ä¸€äº›ç»Ÿè®¡æ•°æ®å‘é€åˆ°æœåŠ¡ç«¯ã€‚å¾€å¾€è¿™äº›æ•°æ®ä¸èƒ½æå‰å‘é€ã€‚å¦‚æœä½¿ç”¨å¼‚æ­¥`XMLHttpRequest`çš„è¯ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šå¿½ç•¥è¿™ä¸ªè¯·æ±‚ã€‚å¦‚æœä½¿ç”¨åŒæ­¥`XMLHttpRequest`çš„è¯ï¼Œä¼šå½±å“ä¸‹ä¸ªé¡µé¢çš„åŠ è½½é€Ÿåº¦ã€‚\n\nä½¿ç”¨`navigator.sendBeacon`ï¼Œä¼šå‘é€ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šè¢«æµè§ˆå™¨å¿½ç•¥ã€‚\n\n```javascript\ndocument.addEventListener('visibilitychange', function logData() {\n  if (document.visibilityState === 'hidden') {\n    navigator.sendBeacon('/log', analyticsData);\n  }\n});\n```\n\n> åˆ¤æ–­é¡µé¢å…³é—­ä¸å¦ï¼Œå»ºè®®ä½¿ç”¨`visibilitychange`äº‹ä»¶\n>\n> safariéœ€è¦ä½¿ç”¨`pagehide`äº‹ä»¶\n\n## ä»£ç å®ç°\n\n### PerformanceObserver\n\næ€§èƒ½è§‚å¯Ÿè€…(PerformanceObserver)ç”¨äºè·å–æ€§èƒ½æ•°æ®ã€‚\n\n`new PerformanceObserver(callback);` æ¥å—ä¸€ä¸ªcallbackä½œä¸ºå‚æ•°\n\n`observer`æ–¹æ³•ç”¨äºæ³¨å†Œæ€§èƒ½æ¡ç›®ç±»å‹ï¼ŒtypeæŒ‡æ‰€è¦è§‚æµ‹çš„æ€§èƒ½æ¡ç›®ç±»å‹ï¼Œå–å€¼æƒ…å†µé€šè¿‡`PerformanceObserver.supportedEntryTypes`å±æ€§æŸ¥çœ‹ã€‚\n\n`[\"element\", \"event\", \"first-input\", \"largest-contentful-paint\", \"layout-shift\", \"longtask\", \"mark\", \"measure\", \"navigation\", \"paint\", \"resource\"]`\n\nå…¶ä¸­:\n\n- `largest-contentful-paint`ï¼šLCP\n- `layout-shift`ï¼šCLS\n- `first-input`ï¼šFID\n\n```javascript\n// è·å–lcpæ—¶é—´\nconst callback = (entryList) => {\n  for (const entry of entryList.getEntries()) {\n    console.log('LCP candidate:', entry.startTime, entry);\n  }\n}\n\nconst observer = new PerformanceObserver(callback)\n\nobserver.observe({type: 'largest-contentful-paint', buffered: true});\n```\n\n### LCPã€FIDã€CLS\n\n`web-vitals`ä¸­çš„`LCP`ã€`FID`å’Œ`CLS`éƒ½æ˜¯é€šè¿‡`PerformanceObserver`æ¥å®ç°çš„ã€‚\n\nä»¥LCPä¸ºä¾‹ï¼š\n\n`getLCP`å‡½æ•°ä½äº`src/getLCP.ts`æ–‡ä»¶ä¸­ã€‚\n\n```typescript\nexport const getLCP = (onReport: ReportHandler, reportAllChanges?: boolean) => {\n  \n  // 1 è·å– ç¬¬ä¸€æ¬¡é¡µé¢å¤„äºhiddençŠ¶æ€çš„æ—¶é—´\n  const firstHidden = getFirstHidden();\n  let metric = initMetric('LCP');\n  let report: ReturnType<typeof bindReporter>;\n\t\n                         \n  // 2. PerformanceObserver\n  const entryHandler = (entry: PerformanceEntry) => {\n    const value = entry.startTime;\n\n    // è¿‡æ»¤æ‰åˆ‡æ¢pagehideåçš„ æ€§èƒ½æ•°æ®\n    if (value < firstHidden.timeStamp) {\n      metric.value = value;\n      metric.entries.push(entry);\n    }\n\n    report();\n  };\n\n  const po = observe('largest-contentful-paint', entryHandler);\n\n  if (po) {\n    report = bindReporter(onReport, metric, reportAllChanges);\n\n    const stopListening = () => {\n      if (!finalMetrics.has(metric)) {\n        po.takeRecords().map(entryHandler as PerformanceEntryHandler);\n        po.disconnect();\n        finalMetrics.add(metric);\n        report();\n      }\n    }\n\n    // å½“ç”¨æˆ·ç‚¹å‡»é¡µé¢æ—¶ï¼Œç«‹å³è§¦å‘ report\n    ['keydown', 'click'].forEach((type) => {\n      addEventListener(type, stopListening, {once: true, capture: true});\n    });\n\n    onHidden(stopListening, true);\n\t\t\n    // å½“pageshowæ—¶ï¼ŒæŠ¥å‘Šmetric\n    onBFCacheRestore((event) => {\n      metric = initMetric('LCP');\n      report = bindReporter(onReport, metric, reportAllChanges);\n      requestAnimationFrame(() => {\n        requestAnimationFrame(() => {\n          metric.value = performance.now() - event.timeStamp;\n          finalMetrics.add(metric);\n          report();\n        });\n      });\n    });\n  }\n};\n```\n\n### TTFB\n\nTTFBæ—¶é—´ç›´æ¥å–`performance.responseStart`","tags":["sc-web-vitals"],"categories":["web-vitals"]},{"title":"å‰ç«¯æ€§èƒ½æŒ‡æ ‡","url":"/posts/d43bedc2.html","content":"\n## æ€§èƒ½æŒ‡æ ‡\n\n`google`çš„**Core Web Vitals**ä¸»è¦ç”±ä¸‰ä¸ªæ€§èƒ½æŒ‡æ ‡ç»„æˆ\n\n- `LCP(Largest Contentful Paint)`ï¼šæœ€å¤§å†…å®¹ç»˜åˆ¶\n\n- `FID(First Input Delay)`ï¼šé¦–æ¬¡è¾“å…¥å»¶è¿Ÿ\n\n- `CLS(Cumlative Layout Shift)`ï¼šç´¯ç§¯å¸ƒå±€åç§»\n\né™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å¸¸è§æ€§èƒ½æŒ‡æ ‡ï¼š\n\n- `FCP(First Contentful Paint)`ï¼šé¦–æ¬¡å†…å®¹ç»˜åˆ¶\n\n- `TTFB(Time to First Byte)`ï¼šé¦–å­—èŠ‚æ—¶é—´\n\n## Web Vitals\n\n`Web Vitals`æ˜¯`google`å‘èµ·çš„å€¡è®®ï¼Œä¸ºwebæ€§èƒ½æä¾›ç»Ÿä¸€çš„è¡¡é‡æ ‡å‡†ã€‚å®ƒæœ‰ä¸‰éƒ¨åˆ†ç»„æˆâ€”â€”`LCP`ã€`FID`å’Œ`CLS`ã€‚\n\n![web vitals](../../images/Performance/web-vitals.png)\n\n- **Largest Contentful Paint (LCP)**: ç”¨äºè¡¡é‡åŠ è½½æ€§èƒ½ã€‚è€ƒè™‘åˆ°ç”¨æˆ·ä½“éªŒï¼ŒLCPåº”è¯¥åœ¨**2.5s**å†…\n- **First Input Delay (FID)**: ç”¨æ¥è¡¡é‡ç½‘ç«™çš„äº¤äº’æ€§ã€‚è€ƒè™‘åˆ°ç”¨æˆ·ä½“éªŒï¼ŒFIDåº”è¯¥å°äº**100ms**\n- **Cumulative Layout Shift (CLS)**: ç”¨æ¥è¡¡é‡ç½‘ç«™çš„è§†è§‰ç¨³å®šæ€§ã€‚è€ƒè™‘åˆ°ç”¨æˆ·ä½“éªŒï¼ŒCLSåº”è¯¥å°äº**0.1**\n\nè¡¡é‡ä¸€ä¸ªç½‘ç«™çš„æ€§èƒ½ï¼šå¦‚æœä¸€ä¸ªç½‘ç«™æœ‰**75%**çš„é¡µé¢èƒ½è¾¾åˆ°`GOOD`æ ‡å‡†ï¼Œé‚£ä¹ˆè¯¥ç½‘ç«™å°±æ»¡è¶³`GOOD`çº§åˆ«çš„æ€§èƒ½ã€‚\n\nè¿™ä¸‰ä¸ªæ€§èƒ½æ•°æ®éƒ½å¯ä»¥é€šè¿‡\n\n- `Google`å¼€æºçš„[web-vitals](https://www.npmjs.com/package/web-vitals)\n- `lighthouse`\n\næ¥æµ‹é‡ã€‚\n\n## [Largest Contentful Paint(LCP)](https://web.dev/lcp/)\n\næœ€å¤§å†…å®¹ç»˜åˆ¶æ—¶é—´æ˜¯æŒ‡ç½‘é¡µæœ€å¤§å›¾åƒ/æ–‡æœ¬å—çš„ç»˜åˆ¶æ—¶é—´ã€‚å½“ä¸€ä¸ªé¡µé¢çš„**æœ€å¤§ä¸°å¯Œå†…å®¹å…ƒç´ **ç»˜åˆ¶å®Œæˆäº†ï¼Œå°±å‡ ä¹å¯ä»¥è®¤ä¸ºæ˜¯è¯¥é¡µé¢æ¸²æŸ“å®Œæˆã€‚LCPè®¤ä¸ºçš„**æœ€å¤§ä¸°å¯Œå†…å®¹å…ƒç´ **æœ‰ï¼š\n\n- `img`å…ƒç´ \n- `svg`é‡Œçš„`image`å…ƒç´ \n- `video`å…ƒç´ \n- `css`ä¸­`url()`åŠ è½½çš„å›¾ç‰‡\n- åŒ…å«æ–‡æœ¬å…ƒç´ çš„å—çº§å…ƒç´ \n\n### åˆ†é˜¶æ®µåŠ è½½\n\né¡µé¢çš„åŠ è½½æ˜¯åˆ†é˜¶æ®µçš„ï¼Œé¡µé¢ä¸Šçš„æœ€å¤§å…ƒç´ å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚\n\nå½“é¡µé¢é¦–å¸§ç»˜åˆ¶å®Œæ¯•åï¼Œæµè§ˆå™¨ä¼šå®ä¾‹ä¸€ä¸ªåŒ–[`PerformanceEntry`](https://developer.mozilla.org/en-US/docs/Web/API/PerformanceEntry)å¯¹è±¡ï¼Œå¹¶ä¸”å°†å…¶`entryType`å±æ€§è®¾ç½®ä¸º`largest-contentful-paint`ã€‚ç”¨äºæ ‡è¯†é¦–å¸§å…ƒç´ çš„ç»˜åˆ¶\n\nå½“é¡µé¢å‡ºç°æ–°çš„æœ€å¤§å…ƒç´ æ—¶ï¼Œåˆä¼šå†åˆ›å»ºä¸€ä¸ª`PerformancenEntry`å¯¹è±¡ã€‚å¦‚ä½•æœ‰ä»»ä½•å…ƒç´ å¤§äºå¤§äºä¸Šä¸€ä¸ªæœ€å¤§å…ƒç´ ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ª`PerformanceEntry`å¯¹è±¡\n\n![lcp vs fcp](../../images/Performance/lcpvsfcp.png)\n\nFCPæ˜¯å€¼é¦–æ¬¡å†…å®¹ç»˜åˆ¶æ—¶é—´ï¼ŒæŒ‡çš„æ˜¯é¡µé¢å‡ºç°ç¬¬ä¸€ä¸ªç»˜åˆ¶å®Œæˆå…ƒç´ çš„æ—¶é—´ã€‚æ‰€ä»¥FCPæ¯”LCPè¦å¿«ã€‚\n\n### å½±å“LCPçš„å› ç´ \n\n- æœåŠ¡ç«¯å“åº”æ…¢\n- csså’Œjsé˜»å¡æ¸²æŸ“\n- èµ„æºåŠ è½½æ—¶é—´\n- å®¢æˆ·ç«¯æ¸²æŸ“\n\n## [First Input Delay](https://web.dev/fid/)\n\né¦–æ¬¡è¾“å…¥å»¶è¿Ÿï¼ˆFIDï¼‰åº¦é‡æ ‡å‡†æœ‰åŠ©äºè¡¡é‡ç”¨æˆ·å¯¹ç½‘ç«™çš„äº¤äº’æ€§å’Œå“åº”æ€§çš„ç¬¬ä¸€å°è±¡ã€‚\n\nFIDè¡¡é‡çš„æ˜¯ä»ç”¨æˆ·é¦–æ¬¡ä¸é¡µé¢è¿›è¡Œäº¤äº’ï¼ˆå³å½“ä»–ä»¬å•å‡»é“¾æ¥ï¼Œç‚¹å‡»æŒ‰é’®æˆ–ä½¿ç”¨è‡ªå®šä¹‰çš„JavaScriptäº‹ä»¶ï¼‰åˆ°æµè§ˆå™¨å®é™…ä¸Šèƒ½å¤Ÿå¼€å§‹å¤„ç†äº‹ä»¶å¤„ç†ç¨‹åºçš„æ—¶é—´\n\n> FIDä»…åœ¨äº‹ä»¶å¤„ç†ä¸­æµ‹é‡â€œå»¶è¿Ÿâ€ã€‚å®ƒä¸ä¼šæµ‹é‡äº‹ä»¶å¤„ç†æ—¶é—´æœ¬èº«ã€‚\n\n![fid](../../images/Performance/fid.svg)\n\nå½“ç”¨æˆ·**ç¬¬ä¸€æ¬¡ä¸é¡µé¢äº¤äº’**ï¼ˆä¾‹å¦‚ç‚¹å‡»é¡µé¢ï¼‰ã€‚ä½†æ˜¯è¿™æ—¶**JSçº¿ç¨‹**æ­£åœ¨æ‰§è¡Œï¼Œå®ƒä¼šé˜»å¡æ¸²æŸ“çº¿ç¨‹çš„æ‰§è¡Œï¼Œæ‰€ä»¥æ­¤æ—¶ï¼Œé¡µé¢æ˜¯æ²¡æœ‰ç»™ç”¨æˆ·åé¦ˆçš„ã€‚è¿™æ®µæ—¶é—´å°±æ˜¯**FID**\n\nè¦å†å¼ºè°ƒ**é¦–æ¬¡**ï¼ŒFIDåªè¡¡é‡ç¬¬ä¸€æ¬¡çš„äº¤äº’ã€‚ç¬¬ä¸€ä¸ªè¾“å…¥å»¶è¿Ÿå°†æ˜¯ç”¨æˆ·å¯¹æ‚¨ç½‘ç«™çš„å“åº”åº¦çš„ç¬¬ä¸€å°è±¡ï¼Œè€Œç¬¬ä¸€å°è±¡å¯¹äºå¡‘é€ æˆ‘ä»¬å¯¹ç½‘ç«™è´¨é‡å’Œå¯é æ€§çš„æ•´ä½“å°è±¡è‡³å…³é‡è¦ã€‚\n\nå†æ¬¡å¼ºè°ƒFIDåªæµ‹é‡**è¾“å…¥å»¶è¿Ÿ**ï¼Œè®°å½•é¦–æ¬¡äº¤äº’åˆ°äº‹ä»¶å¼€å§‹çš„äº‹ä»¶ï¼Œå¹¶ä¸è®°å½•äº‹ä»¶æ‰§è¡Œçš„äº‹ä»¶ã€‚\n\n## [Cumlative Layout Shift](https://web.dev/cls/)\n\nç´¯ç§¯å¸ƒå±€åç§»ä¼šæµ‹é‡åœ¨é¡µé¢æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å‘ç”Ÿçš„æ¯ä¸ª*æ„å¤–çš„å¸ƒå±€ç§»ä½*çš„æ‰€æœ‰ä¸ªåˆ«*å¸ƒåç§»åˆ†æ•°*çš„æ€»å’Œ\n\n**å¸ƒå±€åç§»**æ˜¯æŒ‡é¡µé¢ä¸Šçš„è¯¾ä»¶å…ƒç´ ä¸‹ä¸€é˜µåç§»åˆ°å…¶å®ƒä½ç½®ã€‚\n\n### å¸ƒå±€åç§»åˆ†æ•°\n\n`Layout Shift Score`è®¡ç®—ï¼Œæ˜¯é€šè¿‡è§†çª—å£ä¸­ä¸¤ä¸ªæ¸²æŸ“å¸§ä¹‹é—´å…ƒç´ çš„è¿åŠ¨ï¼Œå–è¯¥è¿åŠ¨ä¸­ä¸¤ä¸ªåº¦é‡çš„ä¹˜ç§¯ï¼š**å†²å‡»åˆ†æ•°ï¼ˆImpact Fractionï¼‰**å’Œ**è·ç¦»åˆ†æ•°ï¼ˆDistance Fractionï¼‰**\n\n$layout shift score = impact fraction * distance fraction$\n\n### Impact Fraction\n\n![impact fraction](../../images/Performance/impact_fraction.png)\n\nåœ¨ä¸Šå›¾ä¸­ï¼Œæœ‰ä¸€ä¸ªå…ƒç´ åœ¨ä¸€å¸§ä¸­å æ®äº†è§†å£çš„ä¸€åŠã€‚ç„¶åï¼Œåœ¨ä¸‹ä¸€å¸§ä¸­ï¼Œå…ƒç´ ä¸‹ç§»è§†å£é«˜åº¦çš„25ï¼…ã€‚çº¢è‰²çš„è™šçº¿çŸ©å½¢è¡¨ç¤ºä¸¤ä¸ªå¸§ä¸­å…ƒç´ çš„å¯è§åŒºåŸŸçš„å¹¶é›†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶ä¸ºæ€»è§†å£çš„75ï¼…ï¼Œå› æ­¤å…¶*å½±å“åˆ†æ•°*ä¸º`0.75`ã€‚\n\n### Distance Fraction\n\n![distance_fraction.png](../../images/Performance/distance_fraction.png)\n\nåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæœ€å¤§è§†å£å°ºå¯¸æ˜¯é«˜åº¦ï¼Œä¸ç¨³å®šå…ƒç´ å·²ç§»åŠ¨äº†è§†å£é«˜åº¦çš„25ï¼…ï¼Œè¿™ä½¿å¾—*è·ç¦»åˆ†æ•°*ä¸º0.25ã€‚\n\nå› æ­¤ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ*ç¢°æ’åˆ†æ•°*ä¸º`0.75`ï¼Œ*è·ç¦»åˆ†æ•°*ä¸º`0.25`ï¼Œå› æ­¤*å¸ƒå±€åç§»åˆ†æ•°*ä¸º`0.75 * 0.25 = 0.1875`ã€‚\n\n### [å¦‚ä½•æ”¹å–„CLS ](https://web.dev/cls/#how-to-improve-cls)\n\nå¯¹äºå¤§å¤šæ•°ç½‘ç«™ï¼Œå¯ä»¥éµå¾ªä¸€äº›æŒ‡å¯¼åŸåˆ™æ¥é¿å…æ‰€æœ‰æ„å¤–çš„å¸ƒå±€å˜åŒ–ï¼š\n\n- **åŠ¡å¿…ç¡®ä¿å›¾ç‰‡å’Œè§†é¢‘å…ƒç´ æœ‰æ­£ç¡®çš„å°ºå¯¸**ï¼Œé€šè¿‡`padding-top`å®ç°**å®½é«˜ç­‰æ¯”ä¾‹**ï¼Œå®¹å™¨å†…å®¹ä½¿ç”¨**ç»å¯¹å®šä½**\n- **é™¤éå“åº”ç”¨æˆ·äº¤äº’ï¼Œå¦åˆ™åˆ‡å‹¿åœ¨ç°æœ‰å†…å®¹ä¸Šæ–¹æ’å…¥å†…å®¹ã€‚**è¿™æ ·å¯ä»¥ç¡®ä¿å¯ä»¥é¢„æœŸå‘ç”Ÿä»»ä½•ç‰ˆå¼ç§»ä½ã€‚\n- **ä¸å°†åŠ¨ç”»ï¼ˆanimationï¼‰è§¦å‘å¸ƒå±€æ›´æ”¹çš„å±æ€§åŠ¨ç”»ç›¸æ¯”ï¼Œè½¬æ¢ï¼ˆtransformï¼‰åŠ¨ç”»æ›´å¯å–ã€‚**å¯¹è¿‡æ¸¡è¿›è¡ŒåŠ¨ç”»å¤„ç†ï¼Œä»¥æä¾›çŠ¶æ€ä¸çŠ¶æ€ä¹‹é—´çš„ä¸Šä¸‹æ–‡å’Œè¿ç»­æ€§ã€‚\n\n## First Contentful Paint\n\n**é¦–æ¬¡å†…å®¹ç»˜åˆ¶**è¡¡é‡é¡µé¢å¼€å§‹åŠ è½½åˆ°é¡µé¢é¦–ä¸ªå…ƒç´ æ¸²æŸ“å®Œæˆçš„äº‹ä»¶ã€‚é€šå¸¸å¯ä»¥ç”¨æ¥ä»£è¡¨ç½‘é¡µçš„ç™½å±æ—¶é—´ã€‚é€šå¸¸`LCP`æ—¶é—´æ˜¯å¤§äºæˆ–ç­‰äº`FCP`æ—¶é—´\n\n## Time To First Bytes\n\n**é¦–å­—èŠ‚æ—¶é—´**æ˜¯æŒ‡å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰æ¥æ”¶åˆ°æœåŠ¡ç«¯å‘æ¥çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ‰€ç»å†çš„æ—¶é—´ã€‚åŒ…æ‹¬**DNSè§£æ**ã€**TCPä¸‰æ¬¡æ¡æ‰‹**ã€**TLSåå•†**ä»¥åŠ**æœåŠ¡ç«¯å¤„ç†è¯·æ±‚**\n\n## å…¶å®ƒæ€§èƒ½æ•°æ®\n\né€šè¿‡`performance`å¯¹è±¡ï¼Œèƒ½è·å–åˆ°è¯¦ç»†çš„ç½‘é¡µæ€§èƒ½æ•°æ®\n\n`performance.timing`å¯¹è±¡ç»“æ„ï¼š\n\n```typescript\ninterface PerformanceTiming {\n    readonly connectEnd: number;\n    readonly connectStart: number;\n    readonly domComplete: number;\n    readonly domContentLoadedEventEnd: number;\n    readonly domContentLoadedEventStart: number;\n    readonly domInteractive: number;\n    readonly domLoading: number;\n    readonly domainLookupEnd: number;\n    readonly domainLookupStart: number;\n    readonly fetchStart: number;\n    readonly loadEventEnd: number;\n    readonly loadEventStart: number;\n    readonly navigationStart: number;\n    readonly redirectEnd: number;\n    readonly redirectStart: number;\n    readonly requestStart: number;\n    readonly responseEnd: number;\n    readonly responseStart: number;\n    readonly secureConnectionStart: number;\n    readonly unloadEventEnd: number;\n    readonly unloadEventStart: number;\n    toJSON(): any;\n}\n```\n\n\ntimingå¯¹è±¡æä¾›äº†å„ç§ä¸æµè§ˆå™¨å¤„ç†ç›¸å…³çš„æ—¶é—´æ•°æ®ã€‚å…·ä½“å¦‚ä¸‹è¡¨\n\n| åç§°                       | ä½œç”¨ï¼ˆè¿™é‡Œæ‰€æœ‰æ—¶é—´æˆ³éƒ½ä»£è¡¨UNIXæ¯«ç§’æ—¶é—´æˆ³ï¼‰                   |\n| -------------------------- | ------------------------------------------------------------ |\n| connectEnd                 | æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥å»ºç«‹æ—¶çš„æ—¶é—´æˆ³ï¼Œè¿æ¥å»ºç«‹æŒ‡çš„æ˜¯æ‰€æœ‰æ¡æ‰‹å’Œè®¤è¯è¿‡ç¨‹å…¨éƒ¨ç»“æŸ |\n| connectStart               | HTTPè¯·æ±‚å¼€å§‹å‘æœåŠ¡å™¨å‘é€æ—¶çš„æ—¶é—´æˆ³ï¼Œå¦‚æœæ˜¯æŒä¹…è¿æ¥ï¼Œåˆ™ç­‰åŒäºfetchStartã€‚ |\n| domComplete                | å½“å‰ç½‘é¡µDOMç»“æ„ç”Ÿæˆæ—¶ï¼Œä¹Ÿå°±æ˜¯Document.readyStateå±æ€§å˜ä¸ºâ€œcompleteâ€,å¹¶ä¸”ç›¸åº”çš„readystatechangeäº‹ä»¶è§¦å‘æ—¶çš„æ—¶é—´æˆ³ã€‚ |\n| domContentLoadedEventEnd   | å½“å‰ç½‘é¡µDOMContentLoadedäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¹Ÿå°±æ˜¯DOMç»“æ„è§£æå®Œæ¯•ã€æ‰€æœ‰è„šæœ¬è¿è¡Œå®Œæˆæ—¶çš„æ—¶é—´æˆ³ã€‚ |\n| domContentLoadedEventStart | å½“å‰ç½‘é¡µDOMContentLoadedäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¹Ÿå°±æ˜¯DOMç»“æ„è§£æå®Œæ¯•ã€æ‰€æœ‰è„šæœ¬å¼€å§‹è¿è¡Œæ—¶çš„æ—¶é—´æˆ³ã€‚ |\n| domInteractive             | å½“å‰ç½‘é¡µDOMç»“æ„ç»“æŸè§£æã€å¼€å§‹åŠ è½½å†…åµŒèµ„æºæ—¶ï¼Œä¹Ÿå°±æ˜¯Document.readyStateå±æ€§å˜ä¸ºâ€œinteractiveâ€ã€å¹¶ä¸”ç›¸åº”çš„readystatechangeäº‹ä»¶è§¦å‘æ—¶çš„æ—¶é—´æˆ³ã€‚ |\n| domLoading                 | å½“å‰ç½‘é¡µDOMç»“æ„å¼€å§‹è§£ææ—¶,ä¹Ÿå°±æ˜¯Document.readyStateå±æ€§å˜ä¸ºâ€œloadingâ€ã€å¹¶ä¸”ç›¸åº”çš„readystatechangeäº‹ä»¶è§¦å‘æ—¶çš„æ—¶é—´æˆ³ã€‚ |\n| domainLookupEnd            | åŸŸåæŸ¥è¯¢ç»“æŸæ—¶çš„æ—¶é—´æˆ³ã€‚å¦‚æœä½¿ç”¨æŒä¹…è¿æ¥ï¼Œæˆ–è€…ä»æœ¬åœ°ç¼“å­˜è·å–ä¿¡æ¯çš„ï¼Œç­‰åŒäºfetchStart |\n| domainLookupStart          | åŸŸåæŸ¥è¯¢å¼€å§‹æ—¶çš„æ—¶é—´æˆ³ã€‚å¦‚æœä½¿ç”¨æŒä¹…è¿æ¥ï¼Œæˆ–è€…ä»æœ¬åœ°ç¼“å­˜è·å–ä¿¡æ¯çš„ï¼Œç­‰åŒäºfetchStart |\n| fetchStart                 | æµè§ˆå™¨å‡†å¤‡é€šè¿‡HTTPè¯·æ±‚å»è·å–é¡µé¢çš„æ—¶é—´æˆ³ã€‚åœ¨æ£€æŸ¥åº”ç”¨ç¼“å­˜ä¹‹å‰å‘ç”Ÿã€‚ |\n| loadEventEnd               | å½“å‰ç½‘é¡µloadäº‹ä»¶çš„å›è°ƒå‡½æ•°ç»“æŸæ—¶çš„æ—¶é—´æˆ³ã€‚å¦‚æœè¯¥äº‹ä»¶è¿˜æ²¡æœ‰å‘ç”Ÿï¼Œè¿”å›0ã€‚ |\n| loadEventStart             | å½“å‰ç½‘é¡µloadäº‹ä»¶çš„å›è°ƒå‡½æ•°å¼€å§‹æ—¶çš„æ—¶é—´æˆ³ã€‚å¦‚æœè¯¥äº‹ä»¶è¿˜æ²¡æœ‰å‘ç”Ÿï¼Œè¿”å›0ã€‚ |\n| navigationStart            | å½“å‰æµè§ˆå™¨çª—å£çš„å‰ä¸€ä¸ªç½‘é¡µå…³é—­ï¼Œå‘ç”Ÿunloadäº‹ä»¶æ—¶çš„æ—¶é—´æˆ³ã€‚å¦‚æœæ²¡æœ‰å‰ä¸€ä¸ªç½‘é¡µï¼Œå°±ç­‰äºfetchStart |\n| redirectEnd                | æœ€åä¸€æ¬¡é‡å®šå‘å®Œæˆï¼Œä¹Ÿå°±æ˜¯Httpå“åº”çš„æœ€åä¸€ä¸ªå­—èŠ‚è¿”å›æ—¶çš„æ—¶é—´æˆ³ã€‚å¦‚æœæ²¡æœ‰é‡å®šå‘ï¼Œæˆ–è€…ä¸Šæ¬¡é‡å®šå‘ä¸æ˜¯åŒæºçš„ã€‚åˆ™ä¸º0 |\n| redirectStart              | ç¬¬ä¸€æ¬¡é‡å®šå‘å¼€å§‹æ—¶çš„æ—¶é—´æˆ³ï¼Œå¦‚æœæ²¡æœ‰é‡å®šå‘ï¼Œæˆ–è€…ä¸Šæ¬¡é‡å®šå‘ä¸æ˜¯åŒæºçš„ã€‚åˆ™ä¸º0 |\n| requestStart               | æµè§ˆå™¨å‘æœåŠ¡å™¨å‘å‡ºHTTPè¯·æ±‚æ—¶ï¼ˆæˆ–å¼€å§‹è¯»å–æœ¬åœ°ç¼“å­˜æ—¶ï¼‰çš„æ—¶é—´æˆ³ã€‚ |\n| responseEnd                | æµè§ˆå™¨ä»æœåŠ¡å™¨æ”¶åˆ°ï¼ˆæˆ–ä»æœ¬åœ°ç¼“å­˜è¯»å–ï¼‰æœ€åä¸€ä¸ªå­—èŠ‚æ—¶ï¼ˆå¦‚æœåœ¨æ­¤ä¹‹å‰HTTPè¿æ¥å·²ç»å…³é—­ï¼Œåˆ™è¿”å›å…³é—­æ—¶ï¼‰çš„æ—¶é—´æˆ³ |\n| responseStart              | æµè§ˆå™¨ä»æœåŠ¡å™¨æ”¶åˆ°ï¼ˆæˆ–ä»æœ¬åœ°ç¼“å­˜è¯»å–ï¼‰ç¬¬ä¸€ä¸ªå­—èŠ‚æ—¶çš„æ—¶é—´æˆ³ã€‚ |\n| secureConnectionStart      | æµè§ˆå™¨ä¸æœåŠ¡å™¨å¼€å§‹å®‰å…¨é“¾æ¥çš„æ¡æ‰‹æ—¶çš„æ—¶é—´æˆ³ã€‚å¦‚æœå½“å‰ç½‘é¡µä¸è¦æ±‚å®‰å…¨è¿æ¥ï¼Œåˆ™è¿”å›0ã€‚ |\n| unloadEventEnd             | å¦‚æœå‰ä¸€ä¸ªç½‘é¡µä¸å½“å‰ç½‘é¡µå±äºåŒä¸€ä¸ªåŸŸä¸‹ï¼Œåˆ™è¡¨ç¤ºå‰ä¸€ä¸ªç½‘é¡µçš„unloadå›è°ƒç»“æŸæ—¶çš„æ—¶é—´æˆ³ã€‚å¦‚æœæ²¡æœ‰å‰ä¸€ä¸ªç½‘é¡µï¼Œæˆ–è€…ä¹‹å‰çš„ç½‘é¡µè·³è½¬ä¸æ˜¯å±äºåŒä¸€ä¸ªåŸŸå†…ï¼Œåˆ™è¿”å›å€¼ä¸º0ã€‚ |\n| unloadEventStart           | å¦‚æœå‰ä¸€ä¸ªç½‘é¡µä¸å½“å‰ç½‘é¡µå±äºåŒä¸€ä¸ªåŸŸä¸‹ï¼Œåˆ™è¡¨ç¤ºå‰ä¸€ä¸ªç½‘é¡µçš„unloadäº‹ä»¶å‘ç”Ÿæ—¶çš„æ—¶é—´æˆ³ã€‚å¦‚æœæ²¡æœ‰å‰ä¸€ä¸ªç½‘é¡µï¼Œæˆ–è€…ä¹‹å‰çš„ç½‘é¡µè·³è½¬ä¸æ˜¯å±äºåŒä¸€ä¸ªåŸŸå†…ï¼Œåˆ™è¿”å›å€¼ä¸º0ã€‚ |\n\n**å¸¸ç”¨æŒ‡æ ‡è®¡ç®—å…¬å¼å¦‚ä¸‹**\n\n1. DNSè§£æè€—æ—¶: domainLookupEnd - domainLookupStart\n2. TCPè¿æ¥è€—æ—¶: connectEnd - connectStart\n3. SSLå®‰å…¨è¿æ¥è€—æ—¶: connectEnd - secureConnectionStart\n4. ç½‘ç»œè¯·æ±‚è€—æ—¶(TTFB): responseStart - requestStart\n5. æ•°æ®ä¼ è¾“è€—æ—¶: responseEnd - responseStart\n6. DOMè§£æè€—æ—¶: domInteractive - responseEnd\n7. èµ„æºåŠ è½½è€—æ—¶: loadEventStart - domContentLoadedEventEnd\n8. é¦–åŒ…æ—¶é—´: responseStart - domainLookupStart\n9. é¦–æ¬¡æ¸²æŸ“æ—¶é—´ / ç™½å±æ—¶é—´: responseEnd - fetchStart\n10. é¦–æ¬¡å¯äº¤äº’æ—¶é—´: domInteractive - fetchStart\n11. DOM Readyæ—¶é—´: domContentLoadEventEnd - fetchStart\n12. é¡µé¢å®Œå…¨åŠ è½½æ—¶é—´: loadEventStart - fetchStart\n\n","tags":["ç½‘ç»œ","Nodejs"],"categories":["Performance"]},{"title":"ä¾èµ–æ³¨å…¥-vu3æºç ","url":"/posts/dafb6b4a.html","content":"\n## å¦‚ä½•ä½¿ç”¨\n\nåœ¨`setup`ä¸­ä½¿ç”¨ï¼š\n\n```typescript\n// ç”Ÿäº§ç»„ä»¶\nimport { defineComponent, provide, inject, ref } from \"vue\";\n\ndefineComponent({\n  setup() {\n    const name = ref(\"name\");\n    provide(\"name\", name);\n  },\n});\n\n// æ¶ˆè´¹ç»„ä»¶\ndefineComponent({\n  setup() {\n    const name = inject(\"name\"); // ä¼šä¿ç•™å“åº”å¼\n    return { name };\n  },\n});\n\n```\n\nå…¨å±€`provide`\n\n```typescript\nimport { createApp } from \"vue\";\n\nconst app = createApp()\n\napp.provide(name, 'ZXFAN')\n```\n\n## å¤„ç†è¿‡ç¨‹\n\nåœ¨**çˆ¶ç»„ä»¶**çš„`setup`ä¸­ä½¿ç”¨`provide`å‡½æ•°ï¼Œä¼šåœ¨æ”¾åœ¨ç»„ä»¶å®ä¾‹ä¸Šçš„`provides`å¯¹è±¡ä¸Šã€‚**æ³¨æ„ï¼šæ¯ä¸ªç»„ä»¶å®ä¾‹ä¸Šçš„`provides`å¯¹è±¡çš„åŸå‹å¯¹è±¡éƒ½æ˜¯å…¶çˆ¶ç»„ä»¶çš„`provides`å¯¹è±¡**ï¼Œæ ¹ç»„ä»¶çš„åŸå‹å¯¹è±¡ä¸ºnullã€‚è¿™æ ·åœ¨æŸ¥æ‰¾æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨åœ¨åŸå‹é“¾ä¸Šå¯»æ‰¾ã€‚\n\nåœ¨**å­ç»„ä»¶**çš„`setup`ä¸­ä½¿ç”¨`inject`å‡½æ•°ï¼Œä¼šåœ¨ç»„ä»¶å®ä¾‹ä¸Šæ‰¾ï¼Œå®ä¾‹ä¸Šæ²¡æœ‰å°±å»**åŸå‹é“¾**ï¼ˆçˆ¶ç»„ä»¶çš„`provides`å¯¹è±¡ï¼‰å»æ‰¾ã€‚\n\nå…¨å±€`provide`å³`app.provide(xx, xx)`çš„å½¢å¼ï¼Œä¼šå°†æ³¨å…¥çš„å†…å®¹å­˜æ”¾åœ¨ä¸Šä¸‹æ–‡å¯¹è±¡çš„`providers`ä¸Š\n\n## `provides`åŸå‹é“¾çš„å½¢æˆ\n\nå…·æœ‰åµŒå¥—çš„ç»„ä»¶çš„provideså¯¹è±¡æ„æˆäº†åŸå‹é“¾ï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿åšæŸ¥æ‰¾æ“ä½œ\n\nåŸå‹é“¾çš„æœ€é¡¶æ˜¯nullï¼Œè¿™æ˜¯åœ¨åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡æ—¶åˆå§‹åŒ–çš„ã€‚\n\n```typescript\n// runtime-core/src/apiCreateApp.ts\n\nexport function createAppContext(): AppContext {\n  return {\n    app: null as any,\n    config: {\n      isNativeTag: NO,\n      performance: false,\n      globalProperties: {},\n      optionMergeStrategies: {},\n      isCustomElement: NO,\n      errorHandler: undefined,\n      warnHandler: undefined\n    },\n    mixins: [],\n    components: {},\n    directives: {},\n    provides: Object.create(null)\n  }\n}\n```\n\n`Object.create(null)`ä¼šåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå¹¶ä¸”å°†è¿™ä¸ªç©ºå¯¹è±¡çš„åŸå‹å¯¹è±¡è®¾ç½®ä¸ºå‚æ•°`null`ã€‚\n\nç„¶åæ˜¯ç»„ä»¶å®ä¾‹åˆ›å»ºæ—¶ï¼Œä¼šè‡ªåŠ¨åˆå§‹åŒ–`provides`å¯¹è±¡ã€‚\n\n```typescript\nexport function createComponentInstance(\n  vnode: VNode,\n  parent: ComponentInternalInstance | null,\n  suspense: SuspenseBoundary | null\n) {\n  // ...\n\n  const instance: ComponentInternalInstance = {\n    // ...\n    provides: parent ? parent.provides : Object.create(appContext.provides),\n    // ...\n  }\n  //...\n\n  return instance\n}\n```\n\næ˜¾ç¤ºåˆ¤æ–­**æ˜¯å¦å­˜åœ¨çˆ¶ç»„ä»¶**ï¼Œè‹¥å­˜åœ¨ç›´æ¥å–çˆ¶ç»„ä»¶çš„**provideså¯¹è±¡**\nè‹¥æ²¡æœ‰çˆ¶ç»„ä»¶ï¼Œåˆ™è¯´æ˜æ˜¯**æ ¹ç»„ä»¶**ï¼Œåˆ™å–**ä¸Šä¸‹æ–‡å¯¹è±¡**çš„**provideså¯¹è±¡**\n\n## provideå‡½æ•°\n\n```typescript\n// runtime-core/src/apiInject.ts\n\nexport function provide<T>(key: InjectionKey<T> | string | number, value: T) {\n  if (!currentInstance) {\n    if (__DEV__) {\n      warn(`provide() can only be used inside setup().`)\n    }\n  } else {\n    let provides = currentInstance.provides\n    // é»˜è®¤ï¼Œå®ä¾‹ä¼šç»§æ‰¿å…¶çˆ¶ç»„ä»¶çš„åŸå‹å¯¹è±¡\n    // å½“ç»„ä»¶æœ¬èº«éœ€è¦provideï¼Œå®ƒä¼šåˆ›å»ºè‡ªå·±çš„provideså¯¹è±¡ï¼Œå¹¶å°†çˆ¶ç»„ä»¶çš„provideså¯¹è±¡è®¾ä¸ºå…¶åŸå‹å¯¹è±¡\n    // è¿™æ ·åœ¨ä½¿ç”¨injectå‡½æ•°æ³¨å…¥æ—¶ï¼Œå°±èƒ½åˆ©ç”¨åŸå‹é“¾è‡ªåŠ¨å‘çˆ¶ç»„ä»¶æŸ¥æ‰¾ã€‚\n    const parentProvides =\n      currentInstance.parent && currentInstance.parent.provides\n    if (parentProvides === provides) {\n      provides = currentInstance.provides = Object.create(parentProvides)\n    }\n    // TS doesn't allow symbol as index type\n    provides[key as string] = value\n  }\n}\n```\n\nå½“`parentProvides === provides`ä¸º`true`æ—¶ï¼Œè¯´æ˜è¿™æ˜¯å½“å‰ç»„ä»¶ç¬¬ä¸€æ¬¡è°ƒç”¨`provide`å‡½æ•°ã€‚å› ä¸ºå¦‚æœä¸€ä¸ªç»„ä»¶ä¸éœ€è¦provideï¼Œé‚£ä¹ˆå®ä¾‹çš„`provides`å°±æŒ‡å‘å…¶çˆ¶ç»„ä»¶çš„`provides`å¯¹è±¡ã€‚è¿™æ ·å°±ç¼©çŸ­äº†åŸå‹é“¾çš„é•¿åº¦ã€‚\n\n## injectå‡½æ•°\n\n```typescript\nexport function inject(\n  key: InjectionKey<any> | string,\n  defaultValue?: unknown,\n  treatDefaultAsFactory = false\n) {\n  // fallback to `currentRenderingInstance` so that this can be called in\n  // a functional component\n  const instance = currentInstance || currentRenderingInstance\n  if (instance) {\n    // #2400\n    // to support `app.use` plugins,\n    // fallback to appContext's `provides` if the intance is at root\n    const provides =\n      instance.parent == null\n        ? instance.vnode.appContext && instance.vnode.appContext.provides\n        : instance.parent.provides\n\n    if (provides && (key as string | symbol) in provides) {\n      // TS doesn't allow symbol as index type\n      return provides[key as string]\n    } else if (arguments.length > 1) {\n      return treatDefaultAsFactory && isFunction(defaultValue)\n        ? defaultValue()\n        : defaultValue\n    } else if (__DEV__) {\n      warn(`injection \"${String(key)}\" not found.`)\n    }\n  } else if (__DEV__) {\n    warn(`inject() can only be used inside setup() or functional components.`)\n  }\n}\n```\n\ninjectå°±æ˜¯å»`provides`å¯¹è±¡æ‰¾å¯¹åº”`key`çš„è¿‡ç¨‹ã€‚\næ³¨æ„ï¼šè¿™é‡Œåˆ¤æ–­`instance.parent == null`æ˜¯æ¥åˆ¤æ–­å½“å‰ç»„ä»¶æ˜¯ä¸æ˜¯æ ¹ç»„ä»¶ã€‚","tags":["Vue","sc-vue"],"categories":["Vue"]},{"title":"VueæŒ‡ä»¤-vue3æºç ","url":"/posts/c445157e.html","content":"\n## å¦‚ä½•ä½¿ç”¨\n\nåœ¨æ ¹å®ä¾‹ä¸Š**æ³¨å†Œå…¨å±€æŒ‡ä»¤**\n\n```typescript\nimport { createApp } from \"vue\"\nimport App from 'app.vue'\n\nconst app = createApp(App)\n\napp.derectives(\"focus\", {\n  // ...\n})\n```\n\né€šè¿‡é€‰é¡¹æ¥**æ³¨å†Œå±€éƒ¨æŒ‡ä»¤**\n\n```typescript\nimport { defineComponent } from \"vue\"\n\ndefineComponent({\n  // ...\n  directives: {\n    focus: {\n      // ...\n    }\n  }\n  //...\n})\n```\n\nåœ¨templateä¸­ä½¿ç”¨ï¼š\n\n```vue\n<template>\n\t<input v-focus />\n</template>\n```\n\nåœ¨renderå‡½æ•°ä¸­ä½¿ç”¨\n\n```typescript\nimport { defineComponent, h, withDirectives, vShow } from \"vue\"\n\ndefineComponent({\n  // ...\n  data: {\n    value: true\n  },\n  render() {\n   \treturn withDirectives(h(\"input\"), [vShow, this.value])\n  }\n  //...\n})\n```\n\n`withDirectives`çš„å‡½æ•°ç­¾åï¼š\n\n- ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯VNode\n- ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡ä»¤ï¼ˆå¯ä»¥æ˜¯è‡ªå®šä¹‰æŒ‡ä»¤ï¼‰\n\n```typescript\nfunction withDirectives<T extends VNode<RendererNode, RendererElement, {\n    [key: string]: any;\n}>>(vnode: T, directives: DirectiveArguments): T\n```\n\n## æŒ‡ä»¤ç”Ÿå‘½å‘¨æœŸ\n\næŒ‡ä»¤æœ‰ä¸¤ç§ç±»å‹â€”â€”å¯¹è±¡å’Œå‡½æ•°\n\n```typescript\nexport type Directive<T = any, V = any> =\n  | ObjectDirective<T, V>\n  | FunctionDirective<T, V>\n\n\nexport interface ObjectDirective<T = any, V = any> {\n  created?: DirectiveHook<T, null, V>\n  beforeMount?: DirectiveHook<T, null, V>\n  mounted?: DirectiveHook<T, null, V>\n  beforeUpdate?: DirectiveHook<T, VNode<any, T>, V>\n  updated?: DirectiveHook<T, VNode<any, T>, V>\n  beforeUnmount?: DirectiveHook<T, null, V>\n  unmounted?: DirectiveHook<T, null, V>\n  getSSRProps?: SSRDirectiveHook\n}\n\nexport type FunctionDirective<T = any, V = any> = DirectiveHook<T, any, V>\n```\n\nå¯¹è±¡å°±æ˜¯å£°æ˜æŒ‡ä»¤çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸ\n\nå‡½æ•°ï¼Œåªä¼šç”Ÿå‘½`mounted`å’Œ`update`\n\n> ä¸€ä¸ªæŒ‡ä»¤å®šä¹‰å¯¹è±¡å¯ä»¥æä¾›å¦‚ä¸‹å‡ ä¸ªé’©å­å‡½æ•° (å‡ä¸ºå¯é€‰)ï¼š\n>\n> - `created`ï¼šåœ¨ç»‘å®šå…ƒç´ çš„ attribute æˆ–äº‹ä»¶ç›‘å¬å™¨è¢«åº”ç”¨ä¹‹å‰è°ƒç”¨ã€‚åœ¨æŒ‡ä»¤éœ€è¦é™„åŠ é¡»è¦åœ¨æ™®é€šçš„ `v-on` äº‹ä»¶ç›‘å¬å™¨å‰è°ƒç”¨çš„äº‹ä»¶ç›‘å¬å™¨æ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚\n> - `beforeMount`ï¼šå½“æŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ å¹¶ä¸”åœ¨æŒ‚è½½çˆ¶ç»„ä»¶ä¹‹å‰è°ƒç”¨ã€‚\n> - `mounted`ï¼šåœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶è¢«æŒ‚è½½åè°ƒç”¨ã€‚\n> - `beforeUpdate`ï¼šåœ¨æ›´æ–°åŒ…å«ç»„ä»¶çš„ VNode ä¹‹å‰è°ƒç”¨ã€‚\n>\n> - `updated`ï¼šåœ¨åŒ…å«ç»„ä»¶çš„ VNode **åŠå…¶å­ç»„ä»¶çš„ VNode** æ›´æ–°åè°ƒç”¨ã€‚\n> - `beforeUnmount`ï¼šåœ¨å¸è½½ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶ä¹‹å‰è°ƒç”¨\n> - `unmounted`ï¼šå½“æŒ‡ä»¤ä¸å…ƒç´ è§£é™¤ç»‘å®šä¸”çˆ¶ç»„ä»¶å·²å¸è½½æ—¶ï¼Œåªè°ƒç”¨ä¸€æ¬¡ã€‚\n\n## å¤„ç†è¿‡ç¨‹\n\nå…¨å±€æ³¨å†ŒæŒ‡ä»¤ï¼Œä¼šåœ¨**ä¸Šä¸‹æ–‡å¯¹è±¡**ä¸Šçš„**directivesï¼ˆArrayç±»å‹ï¼‰**ä¸­æ·»åŠ æŒ‡ä»¤\n\nå±€éƒ¨æŒ‡ä»¤æ³¨å†Œï¼Œä¼šå°†æŒ‡ä»¤å­˜æ”¾åœ¨**ç»„ä»¶å®ä¾‹**\n\nåœ¨`template`ä¸­ä½¿ç”¨æŒ‡ä»¤ï¼Œæ„å»ºå·¥å…·å°†å…¶è½¬æ¢æˆ`renderå‡½æ•°`ã€‚\n\nè¿è¡Œæ—¶ï¼Œå…ˆå»appä¸Šä¸‹æ–‡æˆ–è€…ç»„ä»¶å®ä¾‹ä¸Šå¯»æ‰¾æŒ‡ä»¤ã€‚ç„¶åå°†æŒ‡ä»¤ç»‘å®šåˆ°`VNode`ã€‚æ¯ä¸ª`VNode`éƒ½ä¼šæœ‰ä¸€ä¸ª`dirs`æ•°ç»„ï¼Œç”¨æ¥å­˜æ”¾ç»‘å®šåˆ°è¯¥`VNode`çš„å…¨éƒ¨æŒ‡ä»¤ã€‚\n\næœ€ååœ¨å„ä¸ªé˜¶æ®µæ‰§è¡ŒæŒ‡ä»¤ç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°\n\n## æ³¨å†Œæµç¨‹\n\n### å…¨å±€æ³¨å†Œ\n\n```typescript\nimport { createApp } from \"vue\"\nimport App from 'app.vue'\n\nconst app = createApp(App)\n\napp.derectives(\"focus\", {\n  // ...\n})\n```\n\næŒ‡ä»¤å…¨å±€æ³¨å†Œæ˜¯é€šè¿‡`createApp`å‡½æ•°è¿”å›çš„appå¯¹è±¡ä¸Šçš„**directivesæ–¹æ³•**æ¥æ³¨å†Œçš„\n\nè§‚å¯Ÿä¸€ä¸‹**createAppå‡½æ•°**\n\n```typescript\n// runtime-core/src/apiCreateApp.ts\n\nexport function createAppAPI<HostElement>(\n  render: RootRenderFunction,\n  hydrate?: RootHydrateFunction\n): CreateAppFunction<HostElement> {\n  return function createApp(rootComponent, rootProps = null) {\n\n    const context = createAppContext()\n    const installedPlugins = new Set()\n\n    let isMounted = false\n\n    const app: App = (context.app = {\n      // çœç•¥å…¶å®ƒä»£ç ...\n      directive(name: string, directive?: Directive) {\n        if (__DEV__) {\n          validateDirectiveName(name)\n        }\n\n        if (!directive) {\n          return context.directives[name] as any\n        }\n        if (__DEV__ && context.directives[name]) {\n          warn(`Directive \"${name}\" has already been registered in target app.`)\n        }\n        context.directives[name] = directive\n        return app\n      }\n      // çœç•¥å…¶å®ƒä»£ç ...\n    })\n\n    return app\n  }\n}\n```\n\ndirectiveå‡½æ•°åšäº†ä¸‰ä»¶äº‹\n\n- é€šè¿‡`validateDirectiveName`å‡½æ•°å—ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯å†…ç½®æŒ‡ä»¤(`v-if`ã€`v-show`ç­‰)ã€‚å¦‚æœæ˜¯ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸‹ä¼šæŠ¥ä¸€ä¸ªè­¦å‘Š\n- å¦‚æœåªä¼ äº†`name`ï¼Œè®¤ä¸ºæ˜¯å–æŒ‡ä»¤æ“ä½œå¹¶è¿”å›å¯¹åº”nameçš„æŒ‡ä»¤ã€‚å¦‚æœä¼ äº†`directive`åˆ™è®¤ä¸ºæ˜¯æ³¨å†ŒæŒ‡ä»¤æ“ä½œ\n- æ³¨å†ŒæŒ‡ä»¤ï¼šåœ¨`context.directives`å¯¹è±¡ä¸Šä¿å­˜æŒ‡ä»¤\n\n> `context`æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ã€‚é€šè¿‡`createAppContext`å‡½æ•°åˆ›å»ºçš„\n\n### å±€éƒ¨æ³¨å†Œ\n\né€‰æ‹©å±€éƒ¨æ³¨å†Œçš„æ–¹å¼ï¼ŒæŒ‡ä»¤å†™åœ¨`directivesé€‰é¡¹`ä¸­ã€‚å•æ–‡ä»¶ç»„ä»¶ä¼šé€šè¿‡æ„å»ºå·¥å…·ç”Ÿæˆ**ç»„ä»¶å®ä¾‹**ï¼Œä¹Ÿç­‰ä»·äº**defineComponent**ã€‚åœ¨ç”Ÿæˆ`VNode`æ—¶ï¼Œå°†ç»„ä»¶å®ä¾‹ç»‘å®šåˆ°`VNode`çš„`type`å±æ€§ä¸Šã€‚\n\nå±€éƒ¨æ³¨å†Œçš„æŒ‡ä»¤å­˜æ”¾åœ¨ç»„ä»¶å®ä¾‹ä¸Šã€‚åç»­ä¼šé€šè¿‡`VNode.type.directives`æ¥è®¿é—®æŒ‡ä»¤\n\n## ç»‘å®šä¸æ‰§è¡Œ\n\nåœ¨templateæ¨¡ç‰ˆä¸Šä½¿ç”¨æŒ‡ä»¤ï¼Œå¦‚ï¼š\n\n```vue\n<template>\n\t<input v-focus />\n</template>\n```\n\næ„å»ºå·¥å…·ç¼–è¯‘ç”Ÿæˆ**renderå‡½æ•°**ï¼š\n\n```javascript\nimport { resolveDirective as _resolveDirective, createVNode as _createVNode, withDirectives as _withDirectives, openBlock as _openBlock, createBlock as _createBlock } from \"vue\"\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _directive_focus = _resolveDirective(\"focus\")\n\n  return _withDirectives((_openBlock(), _createBlock(\"input\", null, null, 512 /* NEED_PATCH */)), [\n    [_directive_focus]\n  ])\n}\n\n```\n\nå¯ä»¥çœ‹å‡ºï¼Œrenderå†…è°ƒç”¨äº†ä¸¤ä¸ªæ–¹æ³•ï¼š\n\n- `_resolveDirective`ï¼šæ¥å—æŒ‡ä»¤åç§°ä½œä¸ºå‚æ•°ã€‚è¯¥å‡½æ•°çš„ä½œç”¨æ˜¯å»appä¸Šä¸‹æ–‡æˆ–è€…ç»„ä»¶å®ä¾‹ä¸Šå¯»æ‰¾æŒ‡ä»¤\n- `_withDirectives`ï¼šå°†æŒ‡ä»¤ç»‘å®šåˆ°VNodeä¸Šã€‚\n\n### è§£ææŒ‡ä»¤\n\nè§£ææŒ‡ä»¤æ‰¾åˆ°éœ€è¦ä½¿ç”¨çš„æŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯`resolveDirective`çš„è¿‡ç¨‹ã€‚åˆ†ææºç ï¼Œå‘ç°`resolveDirective`è°ƒç”¨`resolveAsset`ã€‚\n\n```typescript\n// runtime-core/helpers/resolveAssets.ts\n\nconst COMPONENTS = 'components'\nconst DIRECTIVES = 'directives'\n\nexport function resolveDirective(name: string): Directive | undefined {\n  return resolveAsset(DIRECTIVES, name)\n}\n\nfunction resolveAsset(\n  type: typeof COMPONENTS | typeof DIRECTIVES,\n  name: string,\n  warnMissing = true\n) {\n  const instance = currentRenderingInstance || currentInstance\n  if (instance) {\n    const Component = instance.type\n\n    // çœç•¥ ç»„ä»¶å¤„ç†...\n\n    const res =\n      // å±€éƒ¨æ³¨å†Œ\n      // check instance[type] first for components with mixin or extends.\n      resolve(instance[type] || (Component as ComponentOptions)[type], name) ||\n      // å…¨å±€æ³¨å†Œ\n      resolve(instance.appContext[type], name)\n    \n    return res\n  }\n}\n\nfunction resolve(registry: Record<string, any> | undefined, name: string) {\n  return (\n    registry &&\n    (registry[name] ||\n      registry[camelize(name)] ||\n      registry[capitalize(camelize(name))])\n  )\n}\n```\n\n`instance`æ˜¯ç»„ä»¶å®ä¾‹ï¼Œ`instance.type`ç­‰äº`VNode.type`å³ç»„ä»¶å®ä¾‹ï¼ˆä¹Ÿå°±æ˜¯æ³¨å†Œå±€éƒ¨æŒ‡ä»¤çš„åœ°æ–¹ï¼‰ã€‚`instance.appContext`æ˜¯å…¨å±€ä¸Šä¸‹æ–‡ï¼ˆä¹Ÿå°±æ˜¯æ³¨å†Œå…¨å±€æŒ‡ä»¤çš„åœ°æ–¹ï¼‰\n\nè§£æç»„ä»¶çš„è¿‡ç¨‹ï¼š\n\n- å…ˆå¯»æ‰¾å±€éƒ¨æ³¨å†Œçš„æŒ‡ä»¤ï¼Œåœ¨ç»„ä»¶å®ä¾‹`instance`ä¸Šå¯»æ‰¾ï¼Œæ‰¾ä¸åˆ°å»ç»„ä»¶å®ä¾‹ï¼ˆ`instance.type`ï¼‰å»æ‰¾ã€‚\n- å¦‚æœæ‰¾ä¸åˆ°å±€éƒ¨æ³¨å†ŒæŒ‡ä»¤ï¼Œå°±å¯»æ‰¾å…¨å±€æ³¨å†ŒæŒ‡ä»¤ã€‚ç›´æ¥åœ¨ä¸Šä¸‹æ–‡å¯¹è±¡`intance.appContext`ä¸Šæ‰¾\n\n> å¯ä»¥å‘ç°ï¼Œå±€éƒ¨æ³¨å†Œçš„æŒ‡ä»¤ä¼šè¦†ç›–å…¨å±€æ³¨å†ŒæŒ‡ä»¤ã€‚\n\n### ç»‘å®šæŒ‡ä»¤\n\nç»‘å®šæŒ‡ä»¤åˆ°VNodeæ˜¯é€šè¿‡`withDirectives`å‡½æ•°å®ç°çš„\n\n```typescript\n// runtime-cor/src/directives.ts\n\nexport type DirectiveArguments = Array<\n  | [Directive]\n  | [Directive, any]\n  | [Directive, any, string]\n  | [Directive, any, string, DirectiveModifiers]\n>\n\n/**\n * Adds directives to a VNode.\n */\nexport function withDirectives<T extends VNode>(\n  vnode: T,\n  directives: DirectiveArguments\n): T {\n  const internalInstance = currentRenderingInstance\n  if (internalInstance === null) {\n    __DEV__ && warn(`withDirectives can only be used inside render functions.`)\n    return vnode\n  }\n  const instance = internalInstance.proxy\n  const bindings: DirectiveBinding[] = vnode.dirs || (vnode.dirs = [])\n  for (let i = 0; i < directives.length; i++) {\n    let [dir, value, arg, modifiers = EMPTY_OBJ] = directives[i]\n    if (isFunction(dir)) {\n      dir = {\n        mounted: dir,\n        updated: dir\n      } as ObjectDirective\n    }\n    bindings.push({\n      dir,\n      instance,\n      value,\n      oldValue: void 0,\n      arg,\n      modifiers\n    })\n  }\n  return vnode\n}\n```\n\n`withDirectives`å‡½æ•°éå†äº†`directives`æ•°ç»„ï¼Œå¹¶å°†å…¶å…ƒç´ ç»‘å®šåˆ°`VNode.dirs`ä¸Šã€‚\n\n**ç‰¹åˆ«æ³¨æ„**ï¼šå¦‚æœæŒ‡ä»¤æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåªä¼šç»™`mounted`å’Œ`updated`èµ‹å€¼ï¼Œå¹¶ä¸”æ‰§è¡Œé€»è¾‘æ˜¯ä¸€æ ·çš„ã€‚\n\næŒ‡ä»¤å¯¹è±¡çš„ç»“æ„ï¼š\n\n- `instance`ï¼šä½¿ç”¨æŒ‡ä»¤çš„ç»„ä»¶å®ä¾‹ã€‚\n- `value`ï¼šä¼ é€’ç»™æŒ‡ä»¤çš„å€¼ã€‚ä¾‹å¦‚ï¼Œåœ¨ `v-my-directive=\"1 + 1\"` ä¸­ï¼Œè¯¥å€¼ä¸º `2`ã€‚\n- `oldValue`ï¼šå…ˆå‰çš„å€¼ï¼Œä»…åœ¨ `beforeUpdate` å’Œ `updated` ä¸­å¯ç”¨ã€‚å€¼æ˜¯å¦å·²æ›´æ”¹éƒ½å¯ç”¨ã€‚\n- `arg`ï¼šå‚æ•°ä¼ é€’ç»™æŒ‡ä»¤ (å¦‚æœæœ‰)ã€‚ä¾‹å¦‚åœ¨ `v-my-directive:foo` ä¸­ï¼Œarg ä¸º `\"foo\"`ã€‚\n- `modifiers`ï¼šåŒ…å«ä¿®é¥°ç¬¦ (å¦‚æœæœ‰) çš„å¯¹è±¡ã€‚ä¾‹å¦‚åœ¨ `v-my-directive.foo.bar` ä¸­ï¼Œä¿®é¥°ç¬¦å¯¹è±¡ä¸º `{foo: trueï¼Œbar: true}`ã€‚\n- `dir`ï¼šä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨æ³¨å†ŒæŒ‡ä»¤æ—¶ä½œä¸ºå‚æ•°ä¼ é€’ã€‚ä¾‹å¦‚ï¼Œåœ¨ä»¥ä¸‹æŒ‡ä»¤ä¸­\n\n### æ‰§è¡ŒæŒ‡ä»¤\n\næŒ‡ä»¤ç»‘å®šåˆ°`VNode`åï¼Œå°±ä¼šåœ¨ç›¸åº”çš„æ—¶å€™è°ƒç”¨æŒ‡ä»¤\n\nè§‚å¯ŸæŒ‡ä»¤çš„ç±»å‹ç­¾åï¼Œæœ‰ä¸¤ç§â€”â€”å¯¹è±¡æŒ‡ä»¤ï¼Œå’Œå‡½æ•°æŒ‡ä»¤ã€‚å…¶ä¸­å¯¹è±¡æŒ‡ä»¤å£°æ˜äº†å¾ˆå¤š`hook(é’©å­å‡½æ•°)`ï¼Œè¿™äº›æ˜¯æŒ‡ä»¤çš„ç”Ÿå‘½å‘¨æœŸã€‚\n\næ¯”å¦‚ï¼Œåœ¨`mountElement`å‡½æ•°ä¸­å°±æœ‰å¾ˆå¤šè§¦å‘æŒ‡ä»¤çš„ä»£ç ï¼Œä¾‹å¦‚ï¼š\n\n```typescript\n// runtime-core/src/render.ts\n\n// function mountElement\n\nif (dirs) {\n  invokeDirectiveHook(vnode, null, parentComponent, 'created')\n}\n```\n\n`invokeDirectiveHook`æ˜¯ç”¨æ¥è§¦å‘æŒ‡ä»¤ï¼Œå®ƒå’Œ`withDirectives`éƒ½ä½äº`runtime-core/src/directives.ts`æ–‡ä»¶ä¸­ã€‚\n\n```typescript\nexport function invokeDirectiveHook(\n  vnode: VNode,\n  prevVNode: VNode | null,\n  instance: ComponentInternalInstance | null,\n  name: keyof ObjectDirective\n) {\n  const bindings = vnode.dirs!\n  const oldBindings = prevVNode && prevVNode.dirs!\n  for (let i = 0; i < bindings.length; i++) {\n    const binding = bindings[i]\n    if (oldBindings) {\n      binding.oldValue = oldBindings[i].value\n    }\n    const hook = binding.dir[name] as DirectiveHook | undefined\n    if (hook) {\n      callWithAsyncErrorHandling(hook, instance, ErrorCodes.DIRECTIVE_HOOK, [\n        vnode.el,\n        binding,\n        vnode,\n        prevVNode\n      ])\n    }\n  }\n}\n```\n\næ¯ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­çš„æ‰§è¡Œéƒ½ä¼šä¼ å…¥4ä¸ªå‚æ•°\n\n- `el`ï¼š vnodeå¯¹åº”çš„elementå…ƒç´ \n- `binding`ï¼šå½“å‰vnodeç»‘å®šçš„æ‰€æœ‰æŒ‡ä»¤å¯¹è±¡\n- `vnode`ï¼šè™šæ‹ŸèŠ‚ç‚¹\n- `prevVNode`ï¼šä¸Šä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œä»…åœ¨ `beforeUpdate` å’Œ `updated` é’©å­ä¸­å¯ç”¨\n\n## v-modelæŒ‡ä»¤\n\nvueå†…ç½®äº†ä¼—å¤šæŒ‡ä»¤ï¼Œå…¶ä¸­`v-model`ç”¨æ¥å®ç°**åŒå‘ç»‘å®š**ã€‚\n\n### v-modelä¸æ˜¯å•æŒ‡ä¸€ä¸ªæŒ‡ä»¤\n\nå½“åœ¨templateä¸­ä½¿ç”¨v-model:\n\n```vue\n<input v-model=\"username\"/>\n<input type=\"radio\" v-model=\"gender\"/>\n<input type=\"checkbox\" v-model=\"gender\"/>\n\n<!-- è‡ªå®šä¹‰ç»„ä»¶ -->\n<my-component v-model=\"isShow\"/>\n```\n\nè¢«æ„å»ºå·¥å…·ç¼–è¯‘åçš„æ¸²æŸ“å‡½æ•°\n\n```javascript\nimport { vModelText as _vModelText, createVNode as _createVNode, withDirectives as _withDirectives, vModelRadio as _vModelRadio, vModelCheckbox as _vModelCheckbox, resolveComponent as _resolveComponent, Fragment as _Fragment, openBlock as _openBlock, createBlock as _createBlock } from \"vue\"\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_my_component = _resolveComponent(\"my-component\")\n\n  return (_openBlock(), _createBlock(_Fragment, null, [\n    _withDirectives(_createVNode(\"input\", {\n      \"onUpdate:modelValue\": $event => (_ctx.username = $event)\n    }, null, 8 /* PROPS */, [\"onUpdate:modelValue\"]), [\n      [_vModelText, _ctx.username]\n    ]),\n    _withDirectives(_createVNode(\"input\", {\n      type: \"radio\",\n      \"onUpdate:modelValue\": $event => (_ctx.gender = $event)\n    }, null, 8 /* PROPS */, [\"onUpdate:modelValue\"]), [\n      [_vModelRadio, _ctx.gender]\n    ]),\n    _withDirectives(_createVNode(\"input\", {\n      type: \"checkbox\",\n      \"onUpdate:modelValue\": $event => (_ctx.gender = $event)\n    }, null, 8 /* PROPS */, [\"onUpdate:modelValue\"]), [\n      [_vModelCheckbox, _ctx.gender]\n    ]),\n    _createVNode(_component_my_component, {\n      modelValue: _ctx.isShow,\n      \"onUpdate:modelValue\": $event => (_ctx.isShow = $event)\n    }, null, 8 /* PROPS */, [\"modelValue\", \"onUpdate:modelValue\"])\n  ], 64 /* STABLE_FRAGMENT */))\n}\n\n// Check the console for the AST\n```\n\nå¯ä»¥è§‚å¯Ÿåˆ°ï¼Œæ¸²æŸ“å‡½æ•°ä½¿ç”¨`withDirectives`åˆ†åˆ«ç»™ä¸‰ä¸ª`input`å…ƒç´ ç»‘å®šäº†ä¸‰ä¸ªæŒ‡ä»¤`vModelText`ã€`vModelRadio`ã€`vModelCheckbox`ã€‚ç„¶è€Œå¹¶æœªç»™**ç»„ä»¶**ç»‘å®šæŒ‡ä»¤ã€‚\n\n### ä¸åŒå…ƒç´ çš„v-modelè¡Œä¸ºä¸ä¸€æ ·\n\né’ˆå¯¹ä¸åŒå…ƒç´ ï¼Œå®ç°åŒå‘ç»‘å®šçš„æ–¹å¼ä¸åŒã€‚é»˜è®¤æƒ…å†µä¸‹:\n\n- é’ˆå¯¹ç»„ä»¶ï¼Œä¼ é€’`modelValue`ï¼Œå¹¶ç›‘å¬`update:modelValue`äº‹ä»¶\n- é’ˆå¯¹æ–‡æœ¬è¾“å…¥æ¡†ï¼Œ`vModelText`ä¼šå°†å€¼ç»‘å®šåˆ°`value`å±æ€§ï¼Œå¹¶ç›‘å¬`input`æˆ–`chang`(æœ‰lazyä¿®é¥°ç¬¦)äº‹ä»¶\n- é’ˆå¯¹å•é€‰æŒ‰é’®å’Œå¤é€‰æ¡†ï¼Œ`vModelRadio`å’Œ`vModelCheckobx`éƒ½ä¼šå°†å€¼ç»‘å®šåˆ°`checked`å±æ€§ï¼Œå¹¶ç›‘å¬å…¶`change`äº‹ä»¶\n- é’ˆå¯¹ä¸‹æ‹‰æ¡†ï¼Œ`vModelSelect`ä¼šéå†æ‰€æœ‰`option`å¹¶å¯¹æ¯”optionçš„valueå±æ€§ä¸v-modelçš„å€¼æ˜¯å¦ä¸€è‡´ï¼Œè‹¥ä¸€è‡´ç»™è¯¥`option`æ·»åŠ `selected=true`ã€‚å¹¶ç›‘å¬`change`äº‹ä»¶å“åº”æ›´æ”¹ã€‚\n\nè¿™äº›`v-model`æŒ‡ä»¤çš„æºç ä½äº`runtime-dom/src/directives/vModel.ts`ï¼Œçœ‹ä¸€ä¸‹`vModelText`çš„æºç \n\n```typescript\n// v-modelå’Œå…¶å®ƒæŒ‡ä»¤ä¸€æ ·ä¼šç»‘å®šåˆ°VNodeä¸Š\n// å¦‚æœä¸ä½¿ç”¨v-modelï¼Œè¿™éƒ¨åˆ†ä»£ç ä¼šè¢«tree-shaking\nexport const vModelText: ModelDirective<\n  HTMLInputElement | HTMLTextAreaElement\n> = {\n  created(el, { modifiers: { lazy, trim, number } }, vnode) {\n    el._assign = getModelAssigner(vnode)\n    const castToNumber = number || el.type === 'number'\n    addEventListener(el, lazy ? 'change' : 'input', e => {\n      if ((e.target as any).composing) return\n      let domValue: string | number = el.value\n      if (trim) {\n        domValue = domValue.trim()\n      } else if (castToNumber) {\n        domValue = toNumber(domValue)\n      }\n      el._assign(domValue)\n    })\n    if (trim) {\n      addEventListener(el, 'change', () => {\n        el.value = el.value.trim()\n      })\n    }\n    if (!lazy) {\n      addEventListener(el, 'compositionstart', onCompositionStart)\n      addEventListener(el, 'compositionend', onCompositionEnd)\n      // Safari < 10.2 & UIWebView doesn't fire compositionend when\n      // switching focus before confirming composition choice\n      // this also fixes the issue where some browsers e.g. iOS Chrome\n      // fires \"change\" instead of \"input\" on autocomplete.\n      addEventListener(el, 'change', onCompositionEnd)\n    }\n  },\n  // set value on mounted so it's after min/max for type=\"range\"\n  mounted(el, { value }) {\n    el.value = value == null ? '' : value\n  },\n  beforeUpdate(el, { value, modifiers: { trim, number } }, vnode) {\n    el._assign = getModelAssigner(vnode)\n    // avoid clearing unresolved text. #2302\n    if ((el as any).composing) return\n    if (document.activeElement === el) {\n      if (trim && el.value.trim() === value) {\n        return\n      }\n      if ((number || el.type === 'number') && toNumber(el.value) === value) {\n        return\n      }\n    }\n    const newValue = value == null ? '' : value\n    if (el.value !== newValue) {\n      el.value = newValue\n    }\n  }\n}\n```\n\n`vModelTest`å£°æ˜äº†ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°â€”â€”`created`ã€`mounted`å’Œ`beforeUpdate`\n\n- `created`\n  - æ ¹æ®`lazy`æ¥åˆ¤æ–­ç»‘å®š`input`å’Œ`change`äº‹ä»¶ã€‚åœ¨è¯¥äº‹ä»¶ä¸‹è§¦å‘`VNode`ä¸Šçš„`onUpdate:modelValue`äº‹ä»¶æ¥æ›´æ–°æ•°æ®\n  - å¦‚æœç»‘å®š`trim`ä¿®é¥°ç¬¦ï¼Œæ¯æ¬¡`input`åä¿®æ”¹`value`å±æ€§\n  - å¦‚æœæ²¡æœ‰`lazy`ä¿®é¥°ç¬¦ï¼Œä¼šåšç»„åˆé”®è¾“å…¥ä¼˜åŒ–ï¼Œè¿™å¯¹ä¸­æ–‡è¾“å…¥å¾ˆæœ‰æ•ˆã€‚åœ¨`compositionend`ä¸Šè§¦å‘`input`å…ƒç´ çš„`input`äº‹ä»¶\n- `mounted`ï¼šå°†`v-model`çš„å€¼ç»‘å®šåˆ°`input`çš„`value`å±æ€§ä¸Š\n- `beforeUpdate`ï¼šä¸»è¦æ˜¯å¯¹æ ‡ç­¾çš„ä¸€äº›å±æ€§è¿›è¡Œæ›´æ–°\n\n","tags":["Vue","sc-vue"],"categories":["Vue"]},{"title":"æ‰‹æ’•Promise","url":"/posts/d884e9d5.html","content":"\n## Promiseå¿«é€Ÿå›é¡¾\n\n`Promise`æ˜¯ä¸€ä¸ªç”¨æ¥å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„å¼ºå¤§çš„APIã€‚\n\n### ä¸‰ç§çŠ¶æ€\n\n`Promise`æœ‰**ä¸‰ç§çŠ¶æ€**:\n\n- `pending`: ç­‰å¾…çŠ¶æ€\n- `fulfilled`: å®ŒæˆçŠ¶æ€ï¼ˆç»ˆæ€ï¼‰\n- `rejected`: æ‹’ç»çŠ¶æ€ï¼ˆç»ˆæ€ï¼‰\n\n> `promise`çš„çŠ¶æ€åªä¼šæ”¹å˜ä¸€æ¬¡ï¼Œä»`pending`->`fullfilled`æˆ–è€…ä»`pending`->`rejected`ã€‚çŠ¶æ€æ˜¯ä¸å¯é€†çš„ã€‚\n\n### PromiseåŸå‹æ–¹æ³•\n\nä¸€ä¸ª`Promise`å¯¹è±¡çš„åŸå‹æœ‰**ä¸‰ä¸ªæ–¹æ³•**ï¼Œå®ƒä»¬éƒ½æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°\n\n- `Promise.prototype.then(onFulfilled, onRejected)`ï¼šå½“`pending`->`fullfilled`æ—¶è§¦å‘`then`çš„`onFulfilled`\n- `Promise.prototype.catch(onRejected)`ï¼šå½“`pending`->`rejected`æ—¶å‡ºå‘`catch`\n- `Promise.prototype.finally(onFinally)`ï¼šå½“çŠ¶æ€ä¸ºç»ˆæ€æ—¶ï¼Œæœ€åä¸€å®šä¼šè§¦å‘`finally`\n\n> `then`å’Œ`catch`çš„å›è°ƒå‡½æ•°ä¸€å®šä¼šè¿”å›ä¸€ä¸ªPromise\n>\n> - å½“ç›´æ¥reutrn a; ç›¸å½“äº return Promise.resolve(a)\n>\n> - å½“ç›´æ¥throw err; ç›¸å½“äº return Promise.reject(err)\n>\n> - å½“ç›´æ¥return pormiseï¼›é‚£ä¹ˆå°±è¿”å›è¿™ä¸ªpromiseå¯¹è±¡\n\n### Promiseçš„æ–¹æ³•\n\n- [`Promise.all(iterable)`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/all)\n\n  - allæ¥å—ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆä¾‹å¦‚æ•°ç»„ï¼‰ã€‚æ¯ä¸ªè¿­ä»£å…ƒç´ å¯ä»¥æ˜¯Promiseä¹Ÿå¯ä»¥ä¸æ˜¯Promise\n  - å¦‚æœè¿­ä»£å…ƒç´ æ˜¯Promiseä¼šè¢«ä¾æ¬¡æ‰§è¡Œã€‚\n  - å¦‚æœæ‰€æœ‰PromiseæˆåŠŸæ‰§è¡Œï¼Œåˆ™çŠ¶æ€ä¿®æ”¹æˆ`fulfilled`ï¼Œå¹¶å°†å¯è¿­ä»£å¯¹è±¡çš„æ‰€æœ‰promiseè¿”å›å€¼çš„æ•°ç»„ä½œä¸ºæˆåŠŸå›è°ƒçš„è¿”å›å€¼ï¼Œé¡ºåºè·Ÿiterableçš„é¡ºåºä¿æŒä¸€è‡´ã€‚\n  - å¦‚æœè¿™ä¸ªæ–°çš„promiseå¯¹è±¡è§¦å‘äº†å¤±è´¥çŠ¶æ€ï¼ˆrejectedï¼‰ï¼Œå®ƒä¼šæŠŠiterableé‡Œç¬¬ä¸€ä¸ªè§¦å‘å¤±è´¥çš„promiseå¯¹è±¡çš„é”™è¯¯ä¿¡æ¯ä½œä¸ºå®ƒçš„å¤±è´¥é”™è¯¯ä¿¡æ¯\n\n  > æ— è®ºæœ€ç»ˆçŠ¶æ€æ˜¯`fulfilled`è¿˜æ˜¯`rejected`ï¼Œ`iterable`ä¸­æ‰€æœ‰Promiseéƒ½ä¼šè¢«æ‰§è¡Œã€‚å› ä¸ºPromiseè¢«å®šä¹‰æ—¶å°±ä¼šæ‰§è¡Œã€‚\n\n- [`Promise.allSettled(iterable)`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled)\n\n  ä¸`Promise.all`ååˆ†ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºï¼š\n\n  - å½“å‘ç”Ÿ`rejected`æ—¶ï¼Œ`promise.all`ç›´æ¥æŠŠç¬¬ä¸€ä¸ªå¤±è´¥çš„promiseå¯¹è±¡çš„é”™è¯¯ä¿¡æ¯è¿”å›è€Œ`promise.allSettled`ä¼šç­‰æ‰€æœ‰promiseå…¨éƒ¨æ‰§è¡Œååœ¨è¿”å›\n  - ç»“æœæ•°ç»„ä¸æ˜¯promiseæ‰§è¡Œç»“æœçš„é›†åˆï¼Œè€Œæ˜¯çŠ¶æ€é›†åˆ [fulfilled, rejected, fulfilled]\n\n- [`Promise.any(iterable)`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/any)\n\n  æ¥æ”¶ä¸€ä¸ªPromiseå¯¹è±¡çš„é›†åˆï¼Œå½“å…¶ä¸­çš„ä¸€ä¸ª promise æˆåŠŸï¼Œå°±è¿”å›é‚£ä¸ªæˆåŠŸçš„promiseçš„å€¼ã€‚\n\n- [`Promise.race(iterable)`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/race)\n\n  å½“iterableå‚æ•°é‡Œçš„ä»»æ„ä¸€ä¸ªå­promiseè¢«æˆåŠŸæˆ–å¤±è´¥åï¼Œä»¥è¿™ä¸ªpromiseè¿”å›\n\n- [`Promise.reject(reason)`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/reject)\n\n  è¿”å›ä¸€ä¸ªçŠ¶æ€ä¸ºå¤±è´¥çš„Promiseå¯¹è±¡ï¼Œå¹¶å°†ç»™å®šçš„å¤±è´¥ä¿¡æ¯ä¼ é€’ç»™å¯¹åº”çš„å¤„ç†æ–¹æ³•\n\n- [`Promise.resolve(value)`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/resolve)\n\n  è¿”å›ä¸€ä¸ªçŠ¶æ€ç”±ç»™å®švalueå†³å®šçš„Promiseå¯¹è±¡ã€‚\n\n  - å¦‚æœè¯¥å€¼æ˜¯thenable(å³ï¼Œå¸¦æœ‰thenæ–¹æ³•çš„å¯¹è±¡)ï¼Œè¿”å›çš„Promiseå¯¹è±¡çš„æœ€ç»ˆçŠ¶æ€ç”±thenæ–¹æ³•æ‰§è¡Œå†³å®šï¼›\n  - å¦åˆ™çš„è¯(è¯¥valueä¸ºç©ºï¼ŒåŸºæœ¬ç±»å‹æˆ–è€…ä¸å¸¦thenæ–¹æ³•çš„å¯¹è±¡),è¿”å›çš„Promiseå¯¹è±¡çŠ¶æ€ä¸ºfulfilledï¼Œå¹¶ä¸”å°†è¯¥valueä¼ é€’ç»™å¯¹åº”çš„thenæ–¹æ³•ã€‚\n\n  > é€šå¸¸è€Œè¨€ï¼Œå¦‚æœä¸çŸ¥é“ä¸€ä¸ªå€¼æ˜¯å¦æ˜¯Promiseå¯¹è±¡ï¼Œä½¿ç”¨Promise.resolve(value) æ¥è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡,è¿™æ ·å°±èƒ½å°†è¯¥valueä»¥Promiseå¯¹è±¡å½¢å¼ä½¿ç”¨ã€‚\n\n## æ‰‹å†™Promise\n\næˆ‘ä»¬è¦å†™ä¸€ä¸ªç¬¦åˆ[`Promise/A+`](https://promisesaplus.com/)è§„èŒƒçš„Promise\n\n### åŸºç¡€ç»“æ„\n\nå…ˆçœ‹ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨çš„Demo\n\n```typescript\nnew FakePromise<any>((resolve, reject) => {\n  setTimeout(() => {\n    console.log(\"è¿›å…¥setTimeout\")\n    resolve()\n  }, 1000)\n  console.log(\"FakePromise\")\n}).then((res) => {\n  console.log(res)\n  throw \"å‘ç”Ÿé”™è¯¯äº†\"\n}).catch(err => {\n  console.log(err)\n})\n```\n\næ ¹æ®apiï¼Œå…ˆå†™å‡ºåŸºç¡€ç»“æ„\n\n```typescript\ninterface IPromiseCallback {\n  (resolve: Function, reject: Function): void;\n}\n\n// Promiseçš„ä¸‰ç§çŠ¶æ€\nconst PENDING = \"pending\";\nconst FULFILLED = \"fulfilled\";\nconst REJECTED = \"rejected\";\n\nclass FakePromise<T> {\n  private state: string; // ä¿å­˜promiseçŠ¶æ€\n  private value!: T;\t// resolveçš„å€¼\n  private reason: any; // rejectçš„å€¼\n\n  constructor(executor: IPromiseCallback) {\n    this.state = PENDING;\n\n    const resolve = (value: T) => {\n      \n    };\n    const reject = (reason?: any) => {\n      \n    };\n\n    try {\n      executor(resolve, reject);\n    } catch (err) {\n      reject(err);\n    }\n  }\n\n  then(onFulfilled: Function, onRejected: Function) {}\n  catch(onRejected: Function) {}\n}\n```\n\nå½“æ‰§è¡Œ`new FakePromise`æ—¶ï¼Œç«‹å³ä¿®æ”¹çŠ¶æ€ï¼ˆPendingï¼‰ã€‚**ç„¶åæ‰§è¡Œå›è°ƒ**ï¼ˆå¯ä»¥çœ‹å‡ºPromiseä¸€æ—¦è¢«åˆ›å»ºå°±ä¼šç«‹å³æ‰§è¡Œï¼‰ï¼Œå¹¶ä¼ å…¥ä¸¤ä¸ªå‚æ•°`resolve`å’Œ`reject`\n\n`FakePromise`çš„å›è°ƒä¸­ä¼šè°ƒç”¨`resolve`æˆ–è€…`reject`å‡½æ•°ï¼Œæ¥ä¸‹æ¥å®Œå–„`resolve`å’Œ`reject`\n\n```typescript\n// ...\n\nconst resolve = (value: T) => {\n\tsetTimeout(() => {\n    if (this.state !== PENDING) return;\n    this.value = value;\n    this.state = FULFILLED\n  })\n};\nconst reject = (reason?: any) => {\n  setTimeout(() => {\n    if (this.state !== PENDING) return;\n    this.reason = reason;\n    this.state = REJECTED\n  })\n};\n\n// ...\n```\n\næ­¤å¤„ç›®å‰åšäº†ä¸‰ä¸ªå·¥ä½œï¼š\n\n- `resolve`å’Œ`reject`åº”è¯¥éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥è¿™é‡Œç”¨`setTimout`æ¥æ¨¡æ‹Ÿã€‚\n- ä¿å­˜valueå’Œreasonçš„å€¼\n- æ›´æ”¹promiseçš„çŠ¶æ€\n\n### then\n\nç”±äº`resolve`çš„æ‰§è¡Œæ˜¯å¼‚æ­¥çš„ï¼Œæ­¤æ—¶åº”è¯¥å…ˆè°ƒç”¨åŒæ­¥çš„`then`\n\n```typescript\nclass FakePromise<T> {\n  //...\n  \n  private onFulfilledFns: Function[] = [];\n  private onRejectedFns: Function[] = [];\n  \n  // ...\n  \n  then(onFulfilled?: (res: T) => any, onRejected?: Function) {\n    onFulfilled = typeof onFulfilled === \"function\" ? onFulfilled : (x) => x;\n    onRejected =\n      typeof onRejected === \"function\"\n        ? onRejected\n        : (x: any) => {\n            throw x;\n          };\n    const promise = new FakePromise((resolve, reject) => {\n      switch (this.state) {\n        case FULFILLED:\n          setTimeout(() => {\n            try {\n              resolve(onFulfilled!(this.value))\n            } catch (err) {\n              reject(err);\n            }\n          });\n          break;\n        case REJECTED:\n          setTimeout(() => {\n            try {\n              resolve(onRejected(this.reason));\n            } catch (err) {\n              reject(err);\n            }\n          });\n          break;\n        case PENDING:\n          // store and wait\n          this.onFulfilledFns.push(() => {\n            try {\n              resolve(onFulfilled(this.value));\n            } catch (err) {\n              reject(err);\n            }\n          });\n          this.onRejectedFns.push(() => {\n            try {\n              resolve(onRejected(this.reason));\n            } catch (err) {\n              reject(err);\n            }\n          });\n          break;\n      }\n    });\n    return promise;\n  }\n  // ...\n}\n```\n\n`then`å‡½æ•°ï¼š\n\n- ç¬¬ä¸€æ­¥ï¼Œå¯¹ä¸¤ä¸ªå‚æ•°è¿›è¡Œå¤„ç†ï¼Œå¦‚æœä¸æ˜¯å‡½æ•°å°±èµ‹ä¸€ä¸ªé»˜è®¤å€¼ï¼ˆå‡½æ•°ï¼‰\n- ç„¶åå®šä¹‰äº†ä¸€ä¸ª`FakePromise`å¹¶æœ€ç»ˆå°†å…¶è¿”å›ï¼Œå› ä¸ºthenå°±æ˜¯åº”è¯¥è¿”å›ä¸€ä¸ª`Promise`ï¼Œè¿™æ ·æ‰èƒ½æŒ‚è½½å¤šä¸ªthenä»è€Œé“¾å¼è°ƒç”¨\n- åˆ†åˆ«å¯¹æ¯ä¸ªçŠ¶æ€è¿›è¡Œå¤„ç†ï¼Œæ— è®ºä»€ä¹ˆçŠ¶æ€éƒ½æ˜¯å¼‚æ­¥çš„\n  - `fulfilled`ï¼šç›´æ¥è°ƒç”¨`onFulfilled`ï¼Œä¼ å…¥valueå¹¶æ•è·èµ·å¼‚å¸¸\n  - `rejected`ï¼šç›´æ¥è°ƒç”¨`onRejected`ï¼Œä¼ å…¥reasonå¹¶æ•è·èµ·å¼‚å¸¸\n  - `pending`ï¼šè¯´æ˜å½“æ‰§è¡Œ`then`æ—¶ï¼Œï¼ˆå¼‚æ­¥ï¼‰promiseè¿˜åœ¨æ‰§è¡Œã€‚é‚£æˆ‘ä»¬å°±éœ€è¦æŠŠå›è°ƒå­˜ä¸‹æ¥ï¼Œå­˜åˆ°`onFulfilledFns`å’Œ`onRejectedFns`ä¸­ï¼Œæ³¨æ„å®ƒä»¬å¿…é¡»æ˜¯æ•°ç»„ï¼Œå› ä¸€ä¸ªä¸º`FakePromise`å¯ä»¥æœ‰å¤šä¸ª`then`ã€‚ç­‰åˆ°ï¼ˆå¼‚æ­¥ï¼‰promiseæ‰§è¡Œå®Œæ¯•ï¼ˆ`resolve`æˆ–è€…`rejected`ï¼‰æ—¶å†å»è°ƒç”¨ã€‚\n\n`pending`çŠ¶æ€çš„å›è°ƒå·²ç»ä¿å­˜ä¸‹æ¥äº†ã€‚æˆ‘ä»¬éœ€è¦å†`resolve`å’Œ`reject`ä¸­å»å¤„ç†\n\n```typescript\n// ...\n\nconst resolve = (value: T) => {\n\tsetTimeout(() => {\n    if (this.state !== PENDING) return;\n    this.value = value;\n    this.state = FULFILLED\n    this.onFulfilledFns.forEach((fn) => fn()); // æ·»åŠ è¿™ä¸€è¡Œ\n  })\n};\nconst reject = (reason?: any) => {\n  setTimeout(() => {\n    if (this.state !== PENDING) return;\n    this.reason = reason;\n    this.state = REJECTED\n    this.onRejectedFns.forEach((fn) => fn()); // æ·»åŠ è¿™ä¸€è¡Œ\n  })\n};\n\n// ...\n```\n\nå°±æ˜¯éå†æ•°ç»„ï¼Œæ‰§è¡Œæ¯ä¸€ä¸ªå‡½æ•°ã€‚\n\n`then`çš„ä¸¤ä¸ªå›è°ƒå‚æ•°â€”â€”`onFulfilled`å’Œ`onRejected`ã€‚çš„è¿”å›å€¼æœ‰å¾ˆå¤šæƒ…å†µã€‚æˆ‘ä»¬ç›®å‰æ²¡æœ‰å¯¹è¿™äº›æƒ…å†µåˆ¤æ–­è€Œæ˜¯ç›´æ¥`resolve(x)`æˆ–è€…`reject(x)`ï¼ˆè§ä¸Šæ–¹ä»£ç ï¼‰\n\n`Promise/A+`è§„èŒƒè§„å®š:\n\n- æƒ…å†µ 1ï¼š x ç­‰äº promiseï¼ˆå½“å‰çš„promiseå¯¹è±¡ï¼‰\n\n  æŠ›å‡ºä¸€ä¸ª TypeError é”™è¯¯ï¼Œæ‹’ç» promiseã€‚\n\n- æƒ…å†µ 2ï¼šx ä¸º Promise çš„å®ä¾‹\n\n  å¦‚æœ x å¤„äºç­‰å¾…çŠ¶æ€ï¼Œé‚£ä¹ˆ promise ç»§ç»­ç­‰å¾…è‡³ x æ‰§è¡Œæˆ–æ‹’ç»ï¼Œå¦åˆ™æ ¹æ® x çš„çŠ¶æ€æ‰§è¡Œ/æ‹’ç» promiseã€‚\n\n- æƒ…å†µ 3ï¼šx ä¸ºå¯¹è±¡æˆ–å‡½æ•°\n\n  è¯¥æƒ…å†µçš„æ ¸å¿ƒæ˜¯å–å‡º x.then å¹¶è°ƒç”¨ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™å°† this æŒ‡å‘ xã€‚å°† then å›è°ƒå‡½æ•°ä¸­å¾—åˆ°ç»“æœ y ä¼ å…¥æ–°çš„ Promise è§£å†³è¿‡ç¨‹ä¸­ï¼Œå½¢æˆä¸€ä¸ªé€’å½’è°ƒç”¨ã€‚å…¶ä¸­ï¼Œå¦‚æœæ‰§è¡ŒæŠ¥é”™ï¼Œåˆ™ä»¥å¯¹åº”çš„é”™è¯¯ä¸ºåŸå› æ‹’ç» promiseã€‚\n\n  è¿™ä¸€æ­¥æ˜¯å¤„ç†æ‹¥æœ‰ then() å‡½æ•°çš„å¯¹è±¡æˆ–å‡½æ•°ï¼Œè¿™ç±»å¯¹è±¡æˆ–å‡½æ•°æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œ**thenable**â€ã€‚æ³¨æ„ï¼Œå®ƒåªæ˜¯æ‹¥æœ‰ then() å‡½æ•°ï¼Œå¹¶ä¸æ˜¯ Promise å®ä¾‹ã€‚\n\n- æƒ…å†µ 4ï¼šå¦‚æœ x ä¸ä¸ºå¯¹è±¡æˆ–å‡½æ•°\n\n  ä»¥ x ä½œä¸ºå€¼ï¼Œæ‰§è¡Œ promiseã€‚\n\næ¥ä¸‹æ¥æ ¹æ®`Promise/A+`è§„èŒƒæ¥å®ç°`resolvePromise`å‡½æ•°\n\n```typescript\nclass FakePromise<T> {\n  // ...\n  \n  private resolvePromise(\n    promise: FakePromise<any>,\n    x: any,\n    resolve: Function,\n    reject: Function\n  ) {\n      // æƒ…å†µ1: xç­‰äºå½“å‰promiseå¯¹è±¡ï¼Œç›´æ¥æŠ›å‡ºTypeError\n      if (promise === x) {\n        return reject(new TypeError(\"x can not be equal to promise\"));\n      } \n      \n      // æƒ…å†µ2ï¼šxæ˜¯ FakePromiseçš„å®ä¾‹\n      // å–å†³äºxçš„çŠ¶æ€\n      else if (x instanceof FakePromise) {\n        if (x.state === FULFILLED) {\n          resolve(x.value);\n        } else if (x.state === REJECTED) {\n          reject(x.reason);\n        } else {\n          // PENDING\n          x.then((y) => {\n            this.resolvePromise(promise, y, resolve, reject);\n          }, reject);\n        }\n      } \n      \n      // æƒ…å†µ3: xæ˜¯å¯¹è±¡æˆ–è€…å‡½æ•°\n      else if (\n        x !== null &&\n        (typeof x === \"object\" || typeof x === \"function\")\n      ) {\n        // excuteè®°å½•æ˜¯å¦æ‰§è¡Œè¿‡ï¼Œé˜²æ­¢é‡å¤æ‰§è¡Œ\n        let executed: boolean = false;\n        try {\n          // å–å‡º å¯¹è±¡æˆ–å‡½æ•°ï¼ˆä¹Ÿæ˜¯å¯¹è±¡ï¼‰çš„thenå±æ€§\n          const then = x.then;\n          \n          // thenæ˜¯å‡½æ•°ï¼Œæ‰§è¡Œ\n          if (typeof then === \"function\") {\n            // ç„¶åæ‰§è¡Œ\n            then.call(\n              x,\n              (y: any) => {\n                if (executed) return;\n                executed = true;\n                this.resolvePromise(promise, y, resolve, reject);\n              },\n              (e: any) => {\n                if (executed) return;\n                executed = true;\n                reject(e);\n              }\n            );\n          }\n          \n          // thenä¸æ˜¯å‡½æ•°ï¼Œç›´æ¥resolve\n          else {\n            resolve(x);\n          }\n        } catch (e) {\n          if (executed) return;\n          executed = true;\n          reject(e);\n        }\n      } \n      \n      \n      // æƒ…å†µ4: å…¶ä»–æƒ…å†µï¼Œç›´æ¥resolve\n      else {\n        resolve(x);\n      }\n  }\n  \n  // ...\n}\n```\n\nç„¶åä¿®æ”¹`then`å‡½æ•°\n\n```typescript\nclass FakePromise<T> {\n  //...\n  \n  private onFulfilledFns: Function[] = [];\n  private onRejectedFns: Function[] = [];\n  \n  // ...\n  \n  then(onFulfilled?: (res: T) => any, onRejected?: Function) {\n    onFulfilled = typeof onFulfilled === \"function\" ? onFulfilled : (x) => x;\n    onRejected =\n      typeof onRejected === \"function\"\n        ? onRejected\n        : (x: any) => {\n            throw x;\n          };\n    const promise = new FakePromise((resolve, reject) => {\n      switch (this.state) {\n        case FULFILLED:\n          setTimeout(() => {\n            try {\n              this.resolvePromise(\n                promise,\n                onFulfilled!(this.value),\n                resolve,\n                reject\n              );\n            } catch (err) {\n              reject(err);\n            }\n          });\n          break;\n        case REJECTED:\n          setTimeout(() => {\n            try {\n              this.resolvePromise(\n                promise,\n                onRejected!(this.reason),\n                resolve,\n                reject\n              );\n            } catch (err) {\n              reject(err);\n            }\n          });\n          break;\n        case PENDING:\n          // store and wait\n          this.onFulfilledFns.push(() => {\n            try {\n              this.resolvePromise(\n                promise,\n                onFulfilled!(this.value),\n                resolve,\n                reject\n              );\n            } catch (err) {\n              reject(err);\n            }\n          });\n          this.onRejectedFns.push(() => {\n            try {\n              this.resolvePromise(\n                promise,\n                onRejected!(this.reason),\n                resolve,\n                reject\n              );\n            } catch (err) {\n              reject(err);\n            }\n          });\n          break;\n      }\n    });\n    return promise;\n  }\n}\n```\n\næŠŠä¹‹å‰æ‰€æœ‰`resolve`å’Œ`reject`çš„åœ°æ–¹æ”¹æˆè°ƒç”¨`resolvePromise`å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—å››ä¸ªå‚æ•°ï¼šå½“å‰thenè¿”å›çš„promiseå¯¹è±¡ï¼Œ`onFulfilled`æˆ–`onRejected`çš„æ‰§è¡Œç»“æœï¼Œresolveè¿˜æœ‰rejectå‡½æ•°\n\n### catch\n\n`catch`å’Œ`then`çš„ç¬¬äºŒä¸ªå‚æ•°ä¸€æ ·ï¼Œç”¨äºæ•è·å¼‚å¸¸ã€‚\n\nå½“thenç¬¬äºŒä¸ªå‚æ•°æ²¡ä¼ ï¼Œå®ƒä¼šè¢«é»˜è®¤èµ‹å€¼ä¸€ä¸ªå¼‚å¸¸å¤„ç†å‡½æ•°`(x: any) => { throw x }`ï¼Œè¿™é‡Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚\n\n```typescript\nnew FakePromise((resolve, reject) => {\n  // p0\n  setTimeout((() => {\n    reject('hi')\n  }, 1000))\n}).then(() => {\n  // p1\n  console.log('p1')\n  return 'p1 done'\n}).then(() => {\n  // p2\n  console.log('p2')\n  return 'p2 done'\n}).catch(err => {\n  console.log(err)\n})\n```\n\nåœ¨`p0`ä¸­rejectã€‚ç”±äº`p0`çš„`then`æ²¡æœ‰ä¼ `onRejected`ã€‚æ‰€ä»¥å½“æ‰§è¡Œthenå‡½æ•°æ—¶ï¼Œä¼šé»˜è®¤èµ‹ä¸€ä¸ªæŠ›å‡ºå¼‚å¸¸çš„å‡½æ•°ã€‚è¿™ä¸ªå¼‚å¸¸è¢«`p1`çš„`try catch`æ•è·åˆ°äº†ï¼Œè¿›è€Œ`p1`ä¹Ÿ`reject`äº†ã€‚è¿›è€Œæ‰§è¡Œ`p1`çš„**onRejected**ï¼Œä¸è¿‡ä¹Ÿæ²¡ä¼ ï¼Œç»§ç»­æŠ›å¼‚å¸¸å†rejectã€‚ç»§ç»­æ‰§è¡Œp2çš„**onRejected**ã€‚`p2`æ²¡æœ‰è°ƒç”¨thenå‡½æ•°äº†ä½†æ˜¯è°ƒç”¨äº†**catch**å‡½æ•°ã€‚æ‰€ä»¥æ­¤æ—¶catchå‡½æ•°åªè¦å°†å…¶å›è°ƒç»‘å®šåˆ°`then`å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ˆonRejectedï¼‰ä¸Šå°±å¯ä»¥è¢«æ‰§è¡Œäº†ã€‚\n\n```typescript\nclass FakePromise<T> {\n  // ...\n  \n  catch(onRejected: Function) {\n    return this.then(undefined, onRejected);\n  }\n  \n  // ...\n}\n```\n\nè°ƒç”¨`catch`ä¼šç»™å½“å‰Promiseå¯¹è±¡æ·»åŠ ä¸€ä¸ª`then`å‡½æ•°å¹¶ä¸”ä¼ é€’äº†`onRejected`ã€‚\n\n> å½“**promise**é“¾ä¸­æœ‰ä¸€ä¸ªç¯èŠ‚rejectäº†ã€‚ä»–å°±ä¼šä¸€ç›´å‘ä¸‹å¯»æ‰¾**onRejected**ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚\n>\n> å¦‚æœcatchæ‰§è¡Œä¹‹åè¿”å›ä¸€ä¸ª**fulfilled**çš„**promise**ï¼Œ**catch**ä¹‹åçš„**then**ç»§ç»­æ‰§è¡Œ\n>\n> å¦‚æœ**catch**æ‰§è¡Œä¹‹åè¿”å›ä¸€ä¸ª**rejected**çš„**promise**ï¼Œç»§ç»­å¾€åå¯»æ‰¾**onRejected**\n\n### finally\n\næ— è®ºpromiseæœ€ç»ˆçŠ¶æ€æ˜¯`fulfilled`è¿˜æ˜¯`rejected`ã€‚`finally`éƒ½ä¼šæ‰§è¡Œã€‚é‚£æˆ‘ä»¬åœ¨`Promise`é“¾çš„æœ€åå»æ‰§è¡Œfinallyå³å¯\n\n```typescript\nclass FakePromise<T> {\n  // ...\n  \n  finally(onFinally: Function) {\n    this.then(\n      (value: T) => {\n        onFinally();\n        return value;\n      },\n      (reason: any) => {\n        onFinally();\n        throw reason;\n      }\n    );\n  }\n  \n  // ...\n}\n```\n\n### Promise.resolve\n\n`resolve`ç”¨æ¥è®²ä¸€ä¸ªæ™®é€šçš„å˜é‡åŒ…è£…æˆ`fulfilled`çš„`promise`å¯¹è±¡ï¼Œå¤„ç†è¿‡ç¨‹éœ€è¦ç¬¦åˆ`Promise/A+`è§„èŒƒï¼Œä¹Ÿå°±æ˜¯é‚£å››ç§æƒ…å†µã€‚\n\n```typescript\nclass FakePromise<T> {\n  // ...\n  \n  static resolve(value: any) {\n    const promise = new FakePromise((resolve, reject) => {\n      setTimeout(() => {\n        this.prototype.resolvePromise(promise, value, resolve, reject);\n      });\n    });\n    return promise;\n  }\n  \n  // ...\n}\n```\n\n### Promise.reject\n\n`reject`ç”¨æ¥å°†ä¸€ä¸ªæ™®é€šçš„å˜é‡åŒ…è£…æˆ`rejected`çš„`promise`å¯¹è±¡ï¼Œå¤„ç†è¿‡ç¨‹éœ€è¦ç¬¦åˆ`Promise/A+`è§„èŒƒï¼Œä¹Ÿå°±æ˜¯é‚£å››ç§æƒ…å†µã€‚\n\n```typescript\nclass FakePromise<T> {\n  // ...\n  \n  static reject(value: any) {\n    const promise = new FakePromise((resolve, reject) => {\n      reject(value);\n    });\n    return promise;\n  }\n  \n  // ...\n}\n```\n\n### Promise.all\n\nç›´æ¥ä¸Šä»£ç \n\n```typescript\nclass FakePromise<T> {\n  // ...\n  \n  static all(it: Array<any>) {\n    const result: Array<any> = [];\n    let count = 0;\n    return new FakePromise<Array<any>>((resolve, reject) => {\n      it.forEach((cb, index) => {\n        FakePromise.resolve(cb).then((res) => {\n          count++;\n          result[index] = res;\n          if (count === it.length) resolve(result);\n        }, reject);\n      });\n    });\n  }\n  \n  // ...\n}\n```\n\nå‚æ•°`it`åº”è¯¥æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œä¸ºäº†ç®€åŒ–å°±ç”¨æ•°ç»„æ¥æ¨¡æ‹Ÿã€‚å¾ªç¯ä¸­ä½¿ç”¨`FakePromise.resolve`æ¥å°†`cb`åŒ…è£…æˆ`Promise`å¯¹è±¡ã€‚å½“å‘ç”Ÿé”™è¯¯ç›´æ¥è°ƒç”¨rejectï¼Œã€‚å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œå½“countç­‰äºitçš„é•¿åº¦ï¼ˆå³itæ‰€æœ‰å…ƒç´ å¤„ç†å®Œæ¯•ï¼‰æ—¶ï¼Œå°†ç»“æœ`result`ç»™`resolve`å‡ºå»ã€‚\n\n### Promise.race\n\n`race`å°±æ›´ç®€å•äº†ï¼Œå½“ç¬¬ä¸€ä¸ª`promise`æ‰§è¡Œåå°±ç›´æ¥`resolve`\n\n```typescript\nclass FakePromise<T> {\n  // ...\n  \n  static race(it: Array<any>) {\n    return new FakePromise<any>((resolve, reject) => {\n      it.forEach((cb) => {\n        FakePromise.resolve(cb).then(res => {\n          resolve(res)\n        }, reject);\n      });\n    });\n  }\n  \n  // ...\n}\n```\n\n> ååˆ†é‡è¦ï¼šæ— è®º`all`è¿˜æ˜¯`race`ã€‚ä¼ å…¥çš„æ‰€æœ‰`promise`éƒ½ä¼šæ‰§è¡Œã€‚åªæ˜¯æœ‰äº›`promise`å¯èƒ½ä¸ä¼šæ·»åŠ `then`æˆ–è€…`catch`æ¥å¤„ç†\n\n[æºç ](https://github.com/zxffan/playground/blob/main/fake_promise/index.ts)\n\n## asyncå’Œawait\n\n### è°çš„è¯­æ³•ç³–ï¼Ÿ\n\n`async`å’Œ`await`æ˜¯ ES2017 æ ‡å‡†æ¨å‡ºçš„ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œçš„å…³é”®å­—ã€‚å®ƒæ˜¯`Generator`å‡½æ•°ï¼ˆç”Ÿæˆå™¨å‡½æ•°ï¼‰çš„è¯­æ³•ç³–\n\n`Generator`å‡½æ•°æ˜¯ ES6 æå‡ºçš„é™¤ Promise ä¹‹å¤–çš„å¦ä¸€ç§å¼‚æ­¥è§£å†³æ–¹æ¡ˆã€‚\n\n```typescript\nfunction* gen() {\n  console.log(\"first\");\n  yield 1;\n  console.log(\"second\");\n  yield 2;\n  console.log(\"third\");\n}\n\nconst iterator = gen() // è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡\n\niterator.next() // è¿”å› { value: 1, done: false }\niterator.next() // è¿”å› { value: 2, done: false }\niterator.next() // è¿”å› { value: undefined, done: true }\n```\n\n### asyncå’ŒawaitåŸç†\n\n`async/await` åšçš„äº‹æƒ…å°±æ˜¯å°†` Generatorå‡½æ•°`è½¬æ¢æˆ` Promise`\n\n```typescript\nfunction generatorToPromise(generator: GeneratorFunction) {\n  return function () {\n    const iterator = generator.apply(this, Array.of(arguments));\n    return new Promise((resolve, reject) => {\n      function step(action: keyof typeof iterator, arg?: any): any {\n        try {\n          const { value, done } = iterator[action](arg);\n          if (done) {\n            resolve(value);\n          } else {\n            return Promise.resolve(value).then(\n              (val) => step(\"next\", value),\n              (err) => step(\"throw\", err)\n            );\n          }\n        } catch (err) {\n          return reject(err);\n        }\n      }\n\n      return step(\"next\");\n    });\n  };\n}\n```\n\n","tags":["JavaScript","Promise"],"categories":["JavaScript"]},{"title":"Emitåˆ†æ-vue3æºç ","url":"/posts/9c1e6144.html","content":"\n## å¦‚ä½•ä½¿ç”¨\n\n`template`ä¸­ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶\n\n```vue\n<template>\n\t<child-component @show-info=\"showInfo\" @delete.once=\"deleteItem\"/>\n</template>\n```\n\nåœ¨`child-component`å­ç»„ä»¶ä¸­ä½¿ç”¨emit\n\n`this.emit(\"show-info\")`\n\n## å¤„ç†è¿‡ç¨‹\n\nvueä¼šå°†æ‰€æœ‰`v-on`æŒ‡ä»¤ç»‘å®šçš„äº‹ä»¶å…¨éƒ¨å­˜æ”¾åˆ°**ç»„ä»¶å®ä¾‹**çš„**props**ä¸­ï¼Œå¹¶å¯¹å…¶æ”¹å, `show-info`ä¼šå˜æˆ`onShowInfo`ã€‚è¿™éƒ¨åˆ†å·¥ä½œç”±æ„å»ºå·¥å…·å®Œæˆã€‚\n\nå¦‚æœæ²¡æœ‰ä½¿ç”¨`template`ï¼Œè€Œä½¿ç”¨æ¸²æŸ“å‡½æ•°ï¼Œéœ€è¦æ‰‹åŠ¨å†™æˆ`onShowInfo`çš„å½¢å¼\n\nå½“åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨emitæ—¶ï¼Œä¹Ÿæ˜¯ä¼šå…ˆä¿®æ”¹åç§°å†å»propsä¸­å¯»æ‰¾ç›¸åº”äº‹ä»¶å¹¶æ‰§è¡Œã€‚\n\n## Emitå‡½æ•°\n\nemitå‡½æ•°ç”¨æ¥è§¦å‘äº‹ä»¶ï¼Œå…¶æºç ä½äº`rumtime-core/src/componentEmits.ts`ä¸‹\n\n```typescript\n// ...\n\nexport function emit(\n  instance: ComponentInternalInstance,\n  event: string,\n  ...rawArgs: any[]\n) {\n  const props = instance.vnode.props || EMPTY_OBJ\n\n  let args = rawArgs\n\n  // ----------------------\n  // æ­¤å¤„æ˜¯å¤„ç† update:xxx äº‹ä»¶çš„(v-model)\n  const isModelListener = event.startsWith('update:')\n  const modelArg = isModelListener && event.slice(7)\n  if (modelArg && modelArg in props) {\n    const modifiersKey = `${\n      modelArg === 'modelValue' ? 'model' : modelArg\n    }Modifiers`\n    const { number, trim } = props[modifiersKey] || EMPTY_OBJ\n    if (trim) {\n      args = rawArgs.map(a => a.trim())\n    } else if (number) {\n      args = rawArgs.map(toNumber)\n    }\n  }\n  // ----------------------\n\n  // å¦‚æœ eventæ˜¯  custom-event\n  let handlerName = toHandlerKey(camelize(event))\n  // handlerName å˜æˆ onCustomEvent\n  let handler = props[handlerName]\n\n  // å¦‚æœv-model update:xxxçš„äº‹ä»¶ï¼Œå¤„ç†åˆ™ä¸åŒ\n  if (!handler && isModelListener) {\n    // å¦‚æœ eventæ˜¯ update:modelValue\n    handlerName = toHandlerKey(hyphenate(event))\n    // handlerName å˜æˆ update:model-value\n    handler = props[handlerName]\n  }\n\n  if (handler) {\n    // æ‰§è¡Œ å‡½æ•°\n    callWithAsyncErrorHandling(\n      handler,\n      instance,\n      ErrorCodes.COMPONENT_EVENT_HANDLER,\n      args\n    )\n  }\n\t\n  // å¯»æ‰¾æœ‰æ²¡æœ‰ onceä¿®é¥°ç¬¦çš„äº‹ä»¶ï¼Œ\n  // å¦‚æœæœ‰åˆ¤æ–­æ˜¯å¦æ‰§è¡Œè¿‡ï¼Œç”¨emmitedè®°å½•\n  // å¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›ï¼Œæ²¡æœ‰è®°å½•emitedå¹¶æ‰§è¡Œ\n  const onceHandler = props[handlerName + `Once`]\n  if (onceHandler) {\n    if (!instance.emitted) {\n      ;(instance.emitted = {} as Record<string, boolean>)[handlerName] = true\n    } else if (instance.emitted[handlerName]) {\n      return\n    }\n    callWithAsyncErrorHandling(\n      onceHandler,\n      instance,\n      ErrorCodes.COMPONENT_EVENT_HANDLER,\n      args\n    )\n  }\n}\n\n//...\n```\n\næºç ä¸­æœ‰3ç§å¤„ç†ï¼šv-modelçš„update:xxxã€è‡ªå®šä¹‰äº‹ä»¶ã€onceäº‹ä»¶\n\n- v-modelçš„**update:xxx**ï¼š\n- è‡ªå®šä¹‰äº‹ä»¶ï¼šå…ˆä¿®æ”¹eventï¼Œå†å»propsé‡Œå¯»æ‰¾å¯¹åº”äº‹ä»¶ï¼Œè°ƒç”¨\n- onceï¼šåœ¨`instance.emited`ä¸­è®°å½•è°ƒç”¨æ¬¡æ•°ï¼Œå¹¶åœ¨äº‹ä»¶åç§°ååŠ ä¸Š**Once**\n\n`emit`å‡½æ•°ä¼šåœ¨ç»„ä»¶å®ä¾‹åˆ›å»ºæ˜¯è¢«æŒ‚è½½åœ¨ç»„ä»¶å®ä¾‹ä¸Š\n\n```typescript\n// runtime-core/src/components\n\nexport function createComponentInstance(\n  vnode: VNode,\n  parent: ComponentInternalInstance | null,\n  suspense: SuspenseBoundary | null\n) {\n  // ...\n  instance.emit = emit.bind(null, instance)\n  // ...\n}\n```\n\n## v-onäº‹ä»¶å¤„ç†\n\né€šè¿‡[vue-template-explore](https://vue-next-template-explorer.netlify.app/)æ¥è§‚å¯Ÿä¸€ä¸‹å¦‚ä½•å¤„ç†è‡ªå®šä¹‰äº‹ä»¶\n\n`<child-component @show-info=\"showInfo\" @delete.once=\"deleteItem\">Hello</child-component>`\n\n```javascript\nimport { createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock } from \"vue\"\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_child_component = _resolveComponent(\"child-component\")\n\n  return (_openBlock(), _createBlock(_component_child_component, {\n    onShowInfo: _ctx.showInfo,\n    onDeleteOnce: _ctx.deleteItem\n  }, {\n    default: _withCtx(() => [\n      _createTextVNode(\"Hello\")\n    ]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"onShowInfo\", \"onDeleteOnce\"]))\n}\n\n// Check the console for the AST\n```\n\n`createBlock`å‡½æ•°ä½äº`runtime-core/src/vnode.ts`ä¸­ã€‚ç”¨æ¥åˆ›å»ºåŒºå—æ ¹èŠ‚ç‚¹ã€‚å®ƒçš„ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯propsã€‚å¯ä»¥è§‚å¯Ÿåˆ°`show-info`å˜æˆäº†`onShowInfo`ï¼Œ`delete`å˜æˆäº†`onDeleteOnce`ã€‚\n\nä¸‹é¢æ˜¯`createBlock`çš„å‡½æ•°ç­¾åã€‚\n\n```typescript\nfunction createBlock(\n\ttype: VNodeTypes | ClassComponent, \n  props?: Record<string, any> | null | undefined,\n  children?: any,\n  patchFlag?: number | undefined, \n  dynamicProps?: string[] | undefined\n): VNode\n```\n\n## ä¸vue2çš„åŒºåˆ«\n\nvue2çš„emitæ˜¯æŒ‚è½½åœ¨`vue.prototype`ä¸Šçš„æ–¹æ³•\n\nvue3çš„emitæ˜¯æŒ‚è½½åœ¨å®ä¾‹ä¸Šçš„æ–¹æ³•","tags":["Vue","sc-vue"],"categories":["Vue"]},{"title":"Nodejsæ­å»ºvueæœåŠ¡ç«¯æ¸²æŸ“","url":"/posts/af3ae610.html","content":"\n## ä½•ä¸ºæœåŠ¡ç«¯æ¸²æŸ“\n\nä¸**æœåŠ¡ç«¯æ¸²æŸ“**ç›¸å¯¹åº”çš„æ˜¯**å®¢æˆ·ç«¯æ¸²æŸ“**ã€‚åŒºåˆ«ä»–ä»¬çš„æ–¹æ³•å°±æ˜¯åˆ¤æ–­ç½‘é¡µï¼ˆå…·æœ‰å®Œæ•´HTMLç»“æ„ï¼‰æ˜¯ç”±æœåŠ¡ç«¯ç”Ÿæˆçš„è¿˜æ˜¯ç”±å®¢æˆ·ç«¯ç”Ÿæˆã€‚ä»¥vueä¸ºä¾‹ï¼š\n\n- å®¢æˆ·ç«¯æ¸²æŸ“ï¼šç”¨æˆ·è¾“å…¥ç½‘å€ï¼ŒæœåŠ¡ç«¯è¿”å›ä¸€ä¸ªhtmlæ–‡ä»¶ï¼ˆæ²¡æœ‰å®Œæ•´çš„HTMLç»“æ„ï¼Œé€šå¸¸åªæœ‰`<div id=\"app\"></div>`ï¼‰ã€‚æµè§ˆå™¨è§£æHTMLï¼Œé‡åˆ°è®¸å¤šscriptå¤–é“¾ï¼Œè¿›è€Œè¯·æ±‚è¿™äº›è„šæœ¬ã€‚ç„¶åå†æ‰§è¡Œè¿™äº›è„šæœ¬ï¼Œæœ€ç»ˆåœ¨ç”Ÿæˆç›¸åº”domèŠ‚ç‚¹ã€‚\n- æœåŠ¡ç«¯æ¸²æŸ“ï¼šç”¨æˆ·è¾“å…¥ç½‘å€ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åã€‚åœ¨æœåŠ¡ç«¯æ‰§è¡Œç›¸å…³è„šæœ¬ï¼Œç”Ÿæˆç›¸åº”çš„domèŠ‚ç‚¹ã€‚æœ€åå°†æ¸²æŸ“åçš„å…·æœ‰å®Œæ•´HTMLç»“æ„çš„htmlæ–‡ä»¶ç›´æ¥å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚è¿™æ—¶ï¼Œæµè§ˆå™¨å°±å¯ä»¥å±•ç¤ºé¡µé¢äº†ï¼Œä¹‹åå†è§£æHTMLæ–‡ä»¶ï¼Œè¯·æ±‚å¤–é“¾è„šæœ¬ã€‚æ¯”è¾ƒé‡è¦çš„æ˜¯å®¢æˆ·ç«¯éœ€è¦æ¿€æ´»æœåŠ¡ç«¯ç”Ÿæˆçš„é‚£äº›èŠ‚ç‚¹ã€‚\n\nç”±æ­¤ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“ç›¸å¯¹äºå®¢æˆ·ç«¯æœ‰ä»¥ä¸‹å¥½å¤„ï¼š\n\n1. æ¯”å®¢æˆ·ç«¯æ›´å¿«çš„é¦–å±é€Ÿåº¦ï¼Œå¿«äº†è¯·æ±‚ä¸‹è½½è„šæœ¬å’Œæ‰§è¡Œè„šæœ¬çš„æ—¶é—´\n2. æ›´å¥½çš„SEOï¼ŒæœåŠ¡å™¨è¿”å›çš„æ˜¯ä¸€ä¸ªå®Œæ•´çš„HTMLé¡µé¢ã€‚\n\n## æŠ€æœ¯é€‰å‹\n\n**æœåŠ¡ç«¯æ¸²æŸ“**å¿…é¡»æœ‰ä¸€ä¸ªæœåŠ¡ç«¯æ¥æ‹…ä»»æ¸²æŸ“ç½‘é¡µçš„èŒè´£ã€‚nodejsæ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚\n\n- ä¸­é—´ä»¶ç³»ç»Ÿï¼šKoa\n- Vueç›¸å…³ï¼švueã€vuexã€vue-routerã€vue-server-renderer\n- æ„å»ºï¼šwebpakç›¸å…³\n- å¼€å‘è¯­è¨€ï¼šTypeScript\n\n## å®ç°è“å›¾\n\n![ssrè“å›¾](../../images/nodejs/vue_ssr_blueprint.jpg)\n\né¦–å…ˆé¡¹ç›®æ˜¯ç”±webpackæ‰“åŒ…æ„å»ºçš„ï¼Œé¡¹ç›®æœ‰ä¸¤ä¸ªå…¥å£æ–‡ä»¶`server entry`å’Œ`client entry`ã€‚ä¸€ä¸ªç”¨äºæœåŠ¡ç«¯ä¸€ä¸ªç”¨äºå®¢æˆ·ç«¯ã€‚æŠŠæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„å…¬å…±é€»è¾‘ï¼ˆä¾‹å¦‚åˆ›å»ºvueã€vuexã€vue-routerå®ä¾‹ï¼‰æŠ½ç¦»å‡ºæ¥æ”¾å…¥`app.js`ã€‚\n\nwebpackæ„å»ºåä¼šç”Ÿæˆä¸¤ä»½`bundle`â€”â€”`server bundle`å’Œ`client bundle(manifest)`ã€‚è¿™ä¸¤ä¸ªæ–‡ä»¶ä¼šä¼ é€’ç»™`vue-server-renderer`ç”¨æ¥åˆ›å»º`render`ï¼ˆæ¸²æŸ“å™¨ï¼‰ï¼Œä»è€Œåœ¨æœåŠ¡ç«¯æ¸²æŸ“å‡ºhtmlã€‚\n\n[æºç åœ°å€](https://github.com/zxffan/vue2-ssr)\n\n## vue-server-renderer\n\nè¿™æ˜¯vueå®˜æ–¹æä¾›çš„ä¸€ä¸ªæœåŠ¡ç«¯æ¸²æŸ“å·¥å…·ã€‚vueçš„ssrå®ç°æ˜¯åŸºäºå®ƒçš„ã€‚\n\né…ç½®webpackç”Ÿæˆæ‰€éœ€è¦çš„bundleå’Œmanifest\n\n```typescript\nimport VueSSRServerPlugin from \"vue-server-renderer/server-plugin\";\nimport VueSSRClientPlugin from \"vue-server-renderer/client-plugin\";\n// client\nexport default {\n  // ...çœç•¥\n  plugins: [new VueSSRClientPlugin()],\n  // ...çœç•¥\n}\n\n// server\nexport default {\n  // ...çœç•¥\n  plugins: [new VueSSRServerPlugin()],\n  // ...çœç•¥\n}\n```\n\n`vue-server-renderer`æä¾›ä¸¤ä¸ª**plugin**â€”â€”`server plugin`å’Œ`client plugin`ã€‚å‰è€…ä¼šåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ç”Ÿæˆ**bundle**æ–‡ä»¶ï¼Œåè€…ä¼šç”Ÿæˆ**manifest**æ–‡ä»¶\n\nä½¿ç”¨ä¾‹å­ï¼š\n\n```typescript\nimport { createBundleRenderer } from \"vue-server-renderer\";\n// è¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯webpackæ‰“åŒ…åè‡ªåŠ¨ç”Ÿæˆçš„\nconst bundle = require(\"../dist/vue-ssr-server-bundle.json\");\nconst clientManifest = require(\"../dist/vue-ssr-client-manifest.json\");\n\n// ä¼ å…¥clientManifestå’Œbundle\nconst renderer = createBundleRenderer(\n  bundle,\n  {\n    clientManifest,\n    template: readFileSync(ab(\"./src/index.html\"))?.toString(),\n    runInNewContext: false,\n    basedir: ab(\"./dist\"),\n  }\n);\n\n// ä½¿ç”¨\n// async function\nconst html = await renderer.renderToString(context)\n// html å³ æ¸²æŸ“åçš„htmlç»“æ„\n```\n\nä¸€æ—¦bundleå’Œmanifesté…ç½®å®Œæ¯•ï¼Œ`vue-server-render`ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åšå¾ˆå¤šå·¥ä½œï¼Œä¾‹å¦‚å®¢æˆ·ç«¯æ¿€æ´»ã€‚\n\nè¿˜æœ‰éœ€è¦åœ¨htmlæ¨¡ç‰ˆæ–‡ä»¶ä¸­çš„bodyæ ‡ç­¾å“ªåŠ ä¸Š**<!--vue-ssr-outlet-->**ï¼Œè¿™æ ·`vue-server-renderer`å°±ä¼šå°†ç”Ÿæˆçš„vueå®ä¾‹æŒ‚è½½åœ¨å¯¹åº”ä½ç½®ã€‚\n\n## é›†æˆvue-router\n\nä»ä¸¤ä¸ªè§’åº¦æ¥è¯´ï¼š\n\nä¸€æ˜¯æœåŠ¡ç«¯ï¼Œå½“ä¸€ä¸ªè·¯ç”±è¯·æ±‚å‘é€åˆ°æœåŠ¡ç«¯ï¼Œè¿™æ˜¯è·¯ç”±åŒ¹é…å‘ç”Ÿåœ¨æœåŠ¡ç«¯\n\n```typescript\n// server entry\nimport { createApp } from \"./app\";\n\ninterface IServerContext {\n  url: string;\n  state: any,\n  meta: any\n}\n\nexport default function (ctx: IServerContext) {\n  const { app, router, store } = createApp(); // æ­¤å¤„åˆ›å»ºvueå®ä¾‹\n  return new Promise<typeof app>((resolve, reject) => {\n    router.push(ctx.url); // åŒ¹é…è·¯ç”±\n\t\t\n    // åœ¨onReadyåšä¸€äº›å¤„ç†æ“ä½œ\n    router.onReady(() => {\n      // è·å¾—æ‰€æœ‰ä»¥å·²ç»åŒ¹é…çš„ç»„ä»¶\n      const matchedComponents = router.getMatchedComponents();\n      if (matchedComponents.length <= 0) {\n        return reject({ code: 404 });\n      }// æ²¡æœ‰è¯´æ˜ æ²¡æœ‰åŒ¹é…æ­¤è·¯ç”±çš„ç»„ä»¶ï¼Œè¿”å›404\n\t\t\t\n      // æˆ‘ä»¬çº¦å®šå­˜åœ¨ asyncDataé€‰é¡¹\n      // å®ƒè¿”å›Promiseï¼Œå¹¶ä¸”åœ¨æœåŠ¡ç«¯æ‰§è¡Œ\n      // å½“ asyncDataæ‰§è¡Œå®Œæ¯•åæ‰ä¼šç”Ÿæˆhtmlè¿”å›ç»™å®¢æˆ·ç«¯\n      Promise.all(\n        matchedComponents.map((com: any) => {\n          if (com.asyncData !== undefined) {\n            return com.asyncData({ store, router: router.currentRoute });\n          }\n        })\n      ).then(() => {\n        resolve(app);\n      });\n    }, reject);\n  });\n}\n```\n\näºŒæ˜¯å®¢æˆ·ç«¯ï¼Œå½“åœ¨å®¢æˆ·ç«¯ä½¿ç”¨routerè·³è½¬æ—¶ï¼Œä¹Ÿéœ€è¦å»å…ˆæ‰§è¡ŒasyncDataï¼Œå¾…å…¶æ‰§è¡Œå®Œæ¯•ååœ¨è¿”å›é¡µé¢ã€‚\n\n```typescript\n// client entry\n// ...\n\n// å¤„ç†è·¯ç”± updateçš„æƒ…å†µ\nVue.mixin({\n  beforeRouteUpdate(to, from, next) {\n    Promise.all(\n      to.matched.map((c) => {\n        const options = c.components.$options;\n        const asyncData = (options as any).asyncData;\n        if (asyncData) {\n          return asyncData({\n            store: store,\n            route: to,\n          });\n        }\n      })\n    ).finally(next);\n  },\n});\n\nrouter.onReady(() => {\n  router.beforeResolve((to, from, next) => {\n    const matched = router.getMatchedComponents(to);\n    const prevMatched = router.getMatchedComponents(from);\n\t\t\n    // å¯¹æ¯” ä¸¤æ¡è·¯ç”±ä¸‹çš„ç»„ä»¶æœ‰å¦æœ‰ä¸åŒï¼Œè‹¥éƒ½ç›¸åŒå°±å°±ç›´æ¥è·³è½¬\n    let diffed = false;\n    const activated = matched.filter((c, i) => {\n      return diffed || (diffed = prevMatched[i] !== c);\n    });\n\n    if (activated.length <= 0) next();\n\n    // è¿™é‡Œå¯ä»¥æ˜¾ç¤ºåŠ è½½å™¨\n    const render = createLoading();\n\n    render\n      .mount()\n      .then(() =>\n        Promise.all(\n          activated.map((c: any) => {\n            if (c.asyncData) return c.asyncData({ store, router: to });\n          })\n        )\n      )\n      .then((res) => {\n        // TODO å°†ç»“æœ åˆå¹¶åˆ°dataé€‰é¡¹\n      })\n      .finally(() => {\n        // è¿™é‡Œå¯ä»¥å…³é—­åŠ è½½å™¨\n        render.hide();\n        next();\n      });\n  });\n  app.$mount(\"#app\");\n});\n```\n\nä¸Šé¢è¿™ç§è·¯ç”±ç­–ç•¥ï¼Œæ˜¯å¿…é¡»å…ˆasyncDataæ‰§è¡Œå®Œæ¯•ï¼Œå†å±•ç¤ºç”»é¢ï¼Œè¿™é€šå¸¸ä¼šæœ‰ä¸€ä¸ªå…¨å±çš„loadingé¡µã€‚\n\nè¿˜æœ‰ä¸€ç§ç­–ç•¥æ˜¯ï¼Œç›´æ¥æ˜¾ç¤ºé¡µé¢ï¼Œå½“aysncDataæ‰§è¡Œå®Œæ¯•å†å°†å…¶å¡«å……ç»„ä»¶ï¼Œè¿™æ ·å¯¹äºæ¯ä¸€ä¸ªç»„ä»¶éƒ½åº”è¯¥æœ‰ä¸€ä¸ªloadingçŠ¶æ€ã€‚\n\n## é›†æˆvuex\n\næœåŠ¡ç«¯æ”¶åˆ°è·¯ç”±è¯·æ±‚ï¼Œå…ˆåŒ¹é…è·¯ç”±ï¼Œæ‰§è¡ŒasyncDataï¼Œå…¶å¯èƒ½ä¼šä¿®æ”¹storeçš„å€¼ã€‚å¾…æ‰€æœ‰è·¯ç”±ç»„ä»¶çš„asyncDataæ‰§è¡Œå®Œæ¯•åã€‚ä¼šåœ¨è¿”å›ç»™å®¢æˆ·ç«¯çš„htmlä¸­æ’å…¥ä¸€æ®µ**script**\n\n```html\n<script>\nwindow.__INITIAL_STATE__ = {\n  // stateçš„å€¼\n}\n</script>\n```\n\nå®¢æˆ·ç«¯éœ€è¦å°†**\\_\\_INITIAL_STATE\\_\\_**çš„å€¼æ’å…¥storeå®ä¾‹ä¸­ã€‚\n\n```typescript\n// client entry\nconst initalState = (window as any).__INITIAL_STATE__;\nif (initalState) {\n  store.replaceState(initalState);\n}\n```\n\nåœ¨æœåŠ¡ç«¯ä¸­éœ€è¦åŠ ä¸Šä¸€æ®µ\n\n```typescript\nexport default function (ctx: IServerContext) {\n  const { app, router, store } = createApp();\n  return new Promise<typeof app>((resolve, reject) => {\n    router.push(ctx.url);\n    ctx.meta = app.$meta()\n\n    router.onReady(() => {\n      const matchedComponents = router.getMatchedComponents();\n      if (matchedComponents.length <= 0) {\n        return reject({ code: 404 });\n      }\n\n      Promise.all(\n        matchedComponents.map((com: any) => {\n          if (com.asyncData !== undefined) {\n            return com.asyncData({ store, router: router.currentRoute });\n          }\n        })\n      ).then(() => {\n        // åœ¨ä¸Šä¸‹æ–‡åŠ ä¸Š state\n        ctx.state = store.state\n        resolve(app);\n      });\n    }, reject);\n  });\n}\n```\n\nåœ¨æœåŠ¡ç«¯å…¥å£æ–‡ä»¶ä¸­å¯¼å‡ºçš„è¿™ä¸ªfunctionï¼Œä¼šåœ¨ä½¿ç”¨`render.renderToString(context)`æ˜¯è‡ªåŠ¨è°ƒç”¨ï¼Œå…¶ctxå¯¹äºä¼ å…¥çš„contextå‚æ•°ã€‚è¿™ä¸ªcontextä¹Ÿä¼šè¢«`vue-server-render`ä½¿ç”¨åˆ°ã€‚\n\n## å¼€å‘ç¯å¢ƒçš„æ„å»º\n\nç”Ÿäº§ç¯å¢ƒç›´æ¥æ‰“åŒ…å¯ç”¨æœåŠ¡å³å¯ã€‚\n\nåœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œéœ€è¦å®ç°çƒ­æ›´æ–°ã€‚å½“ç”¨æˆ·ä»£ç å‘ç”Ÿä¿®æ”¹æ—¶ï¼Œé‡æ–°æ‰“åŒ…ï¼Œå¹¶é€šè¿‡socketé€šçŸ¥æµè§ˆå™¨æ›´æ–°ç›¸åº”å†…å®¹ã€‚\n\nå®¢æˆ·ç«¯çš„çƒ­æ›´æ–°ï¼šç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯koaï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨`koa-webpack`æ’ä»¶ï¼Œå®ƒé›†æˆäº†ä¸¤ä¸ªæ’ä»¶ï¼š\n`webpack-dev-middleware`ï¼šæ‰“åŒ…é¡¹ç›®åˆ°å†…å­˜ä¸­ï¼Œå¹¶å…è®¸å®¢æˆ·ç«¯è®¿é—®åˆ°\n`webpack-hot-client`ï¼šå®ç°çƒ­æ›´æ–°\n\n```typescript\n// è·å–webpacké…ç½®\nconst clientConfig = createClientConfig();\n// ç”Ÿæˆcompiler\nconst clientCompiler = webpack(clientConfig);\nkoaWebpack({\n  compiler: clientCompiler,\n  devMiddleware: {\n    publicPath: clientConfig.output?.publicPath,\n  },\n}).then((middleware) => app.use(middleware)); // æ³¨å†Œä¸­é—´ä»¶\n```\n\næœåŠ¡ç«¯çš„çƒ­æ›´æ–°ï¼Œç›´æ¥ç”¨webpack watchæ¨¡å¼æ¥æ‰“åŒ…ã€‚ä½†æ˜¯æ³¨æ„éœ€è¦ä¿®æ”¹æ–‡ä»¶è¾“å‡ºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæˆ‘ä»¬éœ€è¦å°†æ‰“åŒ…åçš„æ–‡ä»¶æ”¾åœ¨å†…å­˜ä¸­è€Œä¸æ˜¯ç£ç›˜ä¸Šã€‚\n\n```typescript\n// * å¤„ç†æœåŠ¡ç«¯ æ›´æ–°è·å–bundle\nconst serverConfig = createServerConf();\nconst serverCompiler = webpack(serverConfig);\n\n// ä½¿ç”¨ memory-fs æ¥ä¿®æ”¹ webpacké»˜è®¤çš„æ–‡ä»¶ç³»ç»Ÿ\nconst mfs = new MemoryFs();\nserverCompiler.outputFileSystem = mfs;\n\n// watchæ¨¡å¼ æ‰“åŒ…\nserverCompiler.watch({}, (err, stats) => {\n  if (err) throw err;\n  const result = stats.toJson();\n  if (result.errors.length) return;\n\n  // TODO æ‰“åŒ…æˆåŠŸ\n});\n```\n\n## cssæ”¯æŒ\n\ncssçš„æ”¯æŒåªéœ€è¦æœ‰æ­£ç¡®çš„webpack loaderé…ç½®å³å¯ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨`vue-style-loader`æ¥ä»£æ›¿`style-loader`ã€‚å‰è€…æ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“ã€‚\n\nè¿˜æœ‰ä¸€ä¸ªå‘æ˜¯ï¼Œ`css-loader`çš„é»˜è®¤é…ç½®ä¸`vue-style-loader`å†²çªï¼Œéœ€è¦å…³é—­`esModule`\n\n```typescript\nexport default {\n  // çœç•¥\n  module: {\n    rules: [\n      {\n        test: /\\.css$/,\n        use: [\n          isDev ? \"vue-style-loader\" : extractLoader,\n          {\n            loader: \"css-loader\",\n            options: {\n              esModule: false, // å…³é—­ esModule\n            },\n          },\n        ],\n      },\n    ],\n  },\n  // çœç•¥\n};\n```\n\nè¿˜å¯ä»¥åŠ ä¸Š`postcss-loader`ã€`sass-loader`ç­‰\n\n## HEADæ”¯æŒ\n\nä¸ºäº†æ›´å¥½å¾—æ”¯æŒ`SEO`ã€‚æä¾›äº†è‡ªå®šä¹‰headçš„èƒ½åŠ›ã€‚æˆ‘ä»¬é€šè¿‡[vue-meta](https://vue-meta.nuxtjs.org/guide/ssr.html)æ¥å®ç°ã€‚\n\nå…ˆæ³¨å†Œæ’ä»¶\n\n```typescript\nimport Vue from 'vue'\nimport VueMeta from 'vue-meta'\n\nVue.use(VueMeta)\n```\n\nåœ¨æœåŠ¡ç«¯å…¥å£æ–‡ä»¶\n\n```typescript\nexport default function (ctx: IServerContext) {\n  const { app, router, store } = createApp();\n  return new Promise<typeof app>((resolve, reject) => {\n    router.push(ctx.url);\n    // åŠ ä¸Šè¿™å¥\n    ctx.meta = app.$meta()\n\n    // çœç•¥...\n}\n```\n\næœ€åä¿®æ”¹htmlæ¨¡ç‰ˆæ–‡ä»¶\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  {{{ meta.inject().title ? meta.inject().title.text() : '' }}}\n  {{{ meta.inject().meta ? meta.inject().meta.text() : '' }}}\n</head>\n\n<body>\n  <!--vue-ssr-outlet-->\n</body>\n\n</html>\n```\n\nä½¿ç”¨ï¼šåœ¨metaInfoé€‰é¡¹ä¸­é…ç½®\n\n```typescript\nexport default {\n  metaInfo: {\n    title: \"Homeé¡µé¢\",\n    meta: [{ charset: \"utf-8\" }, { name: \"description\", content: \"foo\" }],\n  },\n}\n```\n\n## å®¢æˆ·ç«¯æ¿€æ´»\n\nå®¢æˆ·ç«¯æ¿€æ´»çš„å·¥ä½œå·²ç»ç”±`vue-server-renderer`å®Œæˆäº†ã€‚æˆ‘ä»¬åˆ†æä¸€ä¸‹å®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚\n\nåœ¨æœåŠ¡ç«¯ï¼Œç”±`vue-server-renderer`ç”Ÿæˆhtmlã€‚ä¼šåœ¨ç›¸åº”çš„htmlä¸Šæ‰“ä¸Šæ ‡è®°ï¼Œä¾‹å¦‚`<div id=\"app\" data-server-rendered=\"true\">`ã€‚å®¢æˆ·ç«¯è¯†åˆ«åˆ°`data-server-rendered`å±æ€§ï¼Œå°±ä¼šçŸ¥é“è¿™éƒ¨åˆ†htmlæ˜¯ç”±æœåŠ¡ç«¯å¦‚æ¸²æŸ“è€Œæ¥çš„ï¼Œéšåå®¢æˆ·ç«¯å°±ä¼šæ¿€æ´»è¿™äº›é™æ€çš„HTML\n\n## ç¼“å­˜\n\næ¯æ¬¡è¯·æ±‚ï¼ŒæœåŠ¡ç«¯éƒ½éœ€è¦åˆ›å»ºç»„ä»¶å®ä¾‹ï¼Œè¿™ä¼šæœ‰ä¸€å®šçš„æ€§èƒ½æŸè€—ã€‚å¯¹äº**éç”¨æˆ·ç‰¹å®šçš„é¡µé¢**ï¼ˆå¯¹ä¸åŒçš„ç”¨æˆ·å±•ç¤ºç›¸åŒå†…å®¹çš„é¡µé¢ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œç¼“å­˜\n\n### ç¼“å­˜é¡µé¢\n\nä»¥é¡µé¢ä¸ºå•ä½ï¼Œç¼“å­˜htmlæ–‡æœ¬\n\n```typescript\nimport LRU from \"lru-cache\";\n\nconst pageCache = new LRU({\n  max: 100,\n  maxAge: 1000, // é‡è¦æç¤ºï¼šæ¡ç›®åœ¨ 1 ç§’åè¿‡æœŸã€‚\n});\n\nasync function renderPage(ctx: Context) {\n  console.log(\"è·¯ç”±åŒ¹é…:\", ctx.url);\n  try {\n    // åˆ¤æ–­ æ˜¯å¦å‘½ä¸­ç¼“å­˜\n    const cacheable = isCacheable(ctx.url);\n    if (cacheable && pageCache.get(ctx.url)) {\n      ctx.status = 200;\n      ctx.body = pageCache.get(ctx.url);\n      return;\n    }\n    const context: any = {\n      url: ctx.url,\n    };\n    const html = await renderer.renderToString(context);\n\n    ctx.res.setHeader(\"Content-Type\", \"text/html\");\n    ctx.status = 200;\n    ctx.body = html;\n\t\t\n    // è®¾ç½®ç¼“å­˜\n    if (cacheable) {\n      pageCache.set(ctx.url, html);\n    }\n  } catch (err) {\n    // çœç•¥\n  }\n}\n\nfunction isCacheable(url: string) {\n  return [\"/about\", \"/profiles\"].indexOf(url) >= 0;\n}\n```\n\n### ç¼“å­˜ç»„ä»¶\n\nä¸€ç»„ä»¶ä¸ºå•ä½æ¥ç¼“å­˜ã€‚`vue-server-renderer` å†…ç½®æ”¯æŒç»„ä»¶çº§åˆ«ç¼“å­˜ã€‚åªéœ€è¦åœ¨åˆ›å»º`renderer`æ—¶ä¼ é€’`cache`å‚æ•°ã€‚\n\n```typescript\nimport LRU from \"lru-cache\";\n\nconst renderer = createRenderer({\n  cache: LRU({\n    max: 10000,\n    maxAge: 1000\n  })\n})\n```\n\nåœ¨ç»„ä»¶å†…ï¼Œè®¾ç½®`serverCacheKey`é€‰é¡¹æ¥å¯ç”¨ç¼“å­˜ã€‚\n\n```typescript\nexport default {\n  name: 'item', // å¿…å¡«é€‰é¡¹\n  props: ['item'],\n  serverCacheKey: props => props.item.id,\n  render (h) {\n    return h('div', this.item.id)\n  }\n}\n```\n\næ³¨æ„ï¼š\n\n- `serverCacheKey`çš„è¿”å›å€¼è¡¨ç¤ºç¼“å­˜ï¼Œå½“å‰å‘ç”Ÿå˜åŒ–ç¼“å­˜å¤±æ•ˆã€‚è‹¥è¿”å›å¸¸é‡è¡¨ç¤ºç»„ä»¶å°†è¢«æ°¸ä¹…ç¼“å­˜\n- `name`å”¯ä¸€\n\né€šå¸¸æ¥è¯´ï¼Œç»„ä»¶ç¼“å­˜æ¯”è¾ƒé€‚ç”¨äºä¸€ç§åœºæ™¯ã€‚`v-for`æ¸²æŸ“å¤§ç»„ä»¶åˆ—è¡¨ã€‚é€šå¸¸æ•°æ®éƒ½ä¼šæœ‰ä¸ªidå’Œæœ€åæ›´æ–°æ—¶é—´ã€‚é€šè¿‡è¿™ä¸¤ä¸ªå±æ€§å¯ä»¥å†³å®šç¼“å­˜æ˜¯å¦æœ‰æ•ˆ\n\n```typescript\nexport default {\n  serverCacheKey: props => props.item.id + '::' + props.item.last_updated\n}\n```\n\n","tags":["vue2","ssr","Nodejs"],"categories":["Nodejs","Server"]},{"title":"Nodejsæ­å»ºæœåŠ¡ç«¯","url":"/posts/9e0c0ca5.html","content":"\n## æœåŠ¡ç«¯\n\næœåŠ¡ç«¯é¡¾åæ€ä¹‰å°±æ˜¯æä¾›æœåŠ¡çš„ä¸€æ–¹ã€‚\n\nå…ˆå›é¡¾ä¸€ä¸‹å››å±‚æ¨¡å‹ï¼š`åº”ç”¨å±‚ï¼ˆæœ€é¡¶å±‚ï¼‰`-> `ä¼ è¾“å±‚` -> `ç½‘ç»œå±‚` -> `æ•°æ®é“¾è·¯å±‚ï¼ˆæœ€åº•å±‚ï¼‰`\n\nå…¶ä¸­ä¼ è¾“å±‚ä½¿ç”¨çš„æ˜¯`TCP/UDP`åè®®\nåº”ç”¨å±‚ä½¿ç”¨çš„åè®®æœ‰`http`ã€`ftp`ç­‰\n\nä»»ä½•ä¸€ç§ç½‘ç»œæœåŠ¡éƒ½å¿…é¡»éµä»ä¸€ç§åè®®ã€‚\n\n`nodejs`å†…ç½®äº†è‹¥å¹²æ¨¡å—ï¼Œå®ç°äº†å¸¸è§çš„ç½‘ç»œåè®®ï¼Œå¹¶å‘ç”¨æˆ·æä¾›äº†ä¾¿åˆ©çš„æ¥å£ã€‚\n\n> å››å±‚æ¨¡å‹åªæ˜¯ç†è®ºæ¨¡å‹\n\n## Netæ¨¡å—\n\n[`net`](https://nodejs.org/dist/latest-v14.x/docs/api/net.html)æ¨¡å—åœ¨[è®¤è¯†RPC](/posts/91c0fa71.html#æ­å»ºå¤šè·¯å¤ç”¨çš„RPCé€šé“)ä¸­æåˆ°è¿‡ï¼Œå½“æ—¶æ˜¯ç”¨æ¥æ­å»ºRPCé€šé“ã€‚\n\nå®ƒå¯ä»¥å»ºç«‹åŸºäºæµçš„TCPæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ã€‚\nç®€å•çš„è¯´ï¼Œå°±æ˜¯å»ºç«‹ä¸¤ç«¯â€”â€”æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼Œä¸¤è€…ä¹‹é—´é€šè¿‡TCPè¿æ¥ã€‚æ•°æ®ä»¥æµçš„æ–¹å¼ä¼ è¾“ï¼ˆ`Buffer`ï¼‰\n\n```typescript\n// server.ts\nimport { createServer } from \"net\";\n\nconst server = createServer((socket) => {\n  //\n  socket.on(\"data\", (buffer) => {\n    console.log(\"server: receive data from server: \", buffer.toString());\n  });\n\n  socket.write(\"hello client!\");\n});\n\nserver.listen(8081);\n\n// ---------------------------------------------\n\n// client.ts\nimport { createConnection } from \"net\";\n\nconst socket = createConnection({\n  host: \"localhost\",\n  port: 8081,\n});\n\nsocket.on(\"data\", (buffer) => {\n  console.log(\"client: receive data from server: \", buffer.toString());\n\n  socket.write(\"hello server!\")\n});\n\nsocket.on(\"close\", () => {\n  console.log(\"client: close connection\");\n});\n```\n\næœåŠ¡ç«¯é€šè¿‡`createServer`åˆ›å»ºä¸€ä¸ªTCPæœåŠ¡ï¼Œå…¶å›è°ƒå‡½æ•°æ¥å—`socket`ä½œä¸ºå‚æ•°ã€‚\nå®¢æˆ·ç«¯é€šè¿‡`createConnection`æ¥è¿æ¥æœåŠ¡ç«¯ï¼Œå…¶è¿”å›`socket`\n\n`sokect`æ˜¯æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ç”¨æ¥é€šä¿¡çš„å·¥å…·\n\n```typescript\n// é€šè¿‡onæ¥ç›‘å¬dataäº‹ä»¶\n// æœ‰æ¶ˆæ¯å‘é€è¿‡æ¥ å°±ä¼šè§¦å‘è¯¥äº‹ä»¶\n// å‚æ•°ä¸ºbufferï¼Œä½¿ç”¨toString toJSONç­‰æ–¹æ³•æ¥è·å–åŸå§‹å€¼ï¼Œå‚è€ƒnodejs bufferæ¨¡å—\nsocket.on(\"data\", buffer => {\n  // TODO\n  // buffer.toString()\n  // buffer.toJSON()\n})\n\n// socket.write(data[, encoding][, callback])\n// writeæ–¹æ³•ç”¨æ¥å‘é€æ•°æ®\nsocket.write(\"hello\")\n```\n\n`buffer`çš„ç¼–è§£ç å¯ä»¥ä½¿ç”¨[`Protocol Buffers`](https://github.com/protocolbuffers/protobuf)\n\n## HTTPæ¨¡å—\n\n[`http`æ¨¡å—](https://nodejs.org/dist/latest-v14.x/docs/api/http.html)å®ç°äº†`HTTPåè®®`ã€‚`HTTPåè®®`æ˜¯åŸºäº`TCPåè®®`çš„ï¼Œæ‰€ä»¥`nodejs`çš„`http`æ¨¡å—æ˜¯åŸºäº`net`æ¨¡å—çš„ã€‚\n\nä¼ ç»Ÿçš„webç½‘ç«™ä¸»è¦ä½¿ç”¨çš„å°±æ˜¯httpåè®®\n\n```typescript\nimport { createServer } from \"http\";\nimport { readFileSync } from \"fs\";\n\nconst buffer = readFileSync(\"./index.html\");\n\nconst server = createServer((req, res) => {\n  res.end(buffer);\n});\n\nserver.listen(\"8080\");\n```\n\nåœ¨æµè§ˆå™¨è¾“å…¥`localhost:8080`å°±å¯ä»¥è®¿é—®`index.html`ã€‚ä¸€ä¸ªæç®€çš„httpæœåŠ¡å°±æ­å»ºæˆäº†ã€‚\n\n`http`æ¨¡å—ä¹Ÿæä¾›äº†å®¢æˆ·ç«¯æ–¹æ³•â€”â€”`request`\n\n```typescript\nimport { request } from 'http'\n\nconst postData = querystring.stringify({\n  'msg': 'Hello World!'\n});\n\nconst options = {\n  hostname: 'www.google.com',\n  port: 80,\n  path: '/upload',\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/x-www-form-urlencoded',\n    'Content-Length': Buffer.byteLength(postData)\n  }\n};\n\nconst req = http.request(options, (res) => {\n  console.log(`STATUS: ${res.statusCode}`);\n  console.log(`HEADERS: ${JSON.stringify(res.headers)}`);\n  res.setEncoding('utf8');\n  res.on('data', (chunk) => {\n    console.log(`BODY: ${chunk}`);\n  });\n  res.on('end', () => {\n    console.log('No more data in response.');\n  });\n});\n\nreq.on('error', (e) => {\n  console.error(`problem with request: ${e.message}`);\n});\n\n// Write data to request body\nreq.write(postData);\nreq.end();\n```\n\n## HTTPSæ¨¡å—\n\nåœ¨`HTTP`å’Œ`TCP`ä¹‹é—´æœ‰åŠ äº†ä¸€å±‚`TLS/SSL`ï¼Œä»¥è§£å†³æ˜æ–‡ä¼ è¾“çš„å®‰å…¨é—®é¢˜\n\n`HTTPS`åœ¨`HTTP`åŸºç¡€ä¸Šæ·»åŠ äº†`TLS/SSL`åŠ å¯†åŠŸèƒ½ã€‚åœ¨`nodejs`ä¸­`TLS/SSL`ä¹Ÿæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ã€‚`HTTPS`æ¨¡å—åŸºäº`HTTP`æ¨¡å—å’Œ`TLS/SSL`æ¨¡å—ã€‚\n\nå¯¹äºå¼€å‘è€…ï¼Œä½¿ç”¨`HTTPS`å°±æ˜¯å¤šäº†ä¸€æ­¥â€”â€”**é…ç½®ç§é’¥å’Œè¯ä¹¦**ã€‚\n\n### ç”Ÿæˆç§é’¥å’Œè¯ä¹¦\n\né¦–é€‰ç¡®è®¤æ­£ç¡®å®‰è£…`openssl`ã€‚å°†é€šè¿‡å‘½ä»¤è¡Œæ¥ç”Ÿæˆç§é’¥å’Œè¯ä¹¦\n\nç¬¬ä¸€æ­¥ï¼Œç”Ÿæˆç§é’¥key , `ryans-key.pem`\n\n```bash\nopenssl genrsa -out ryans-key.pem 2048\n```\n\nç¬¬äºŒæ­¥ï¼Œæ ¹æ®ç§é’¥ï¼Œç”Ÿæˆè¯ä¹¦æ³¨å†Œè¯·æ±‚ï¼ˆCertificate Signing Requestï¼Œ CSRï¼‰, `ryans-csr.pem`ï¼Œä¼šæé—®ä¸€å †é—®é¢˜ï¼ˆå¯†ç è®°ä½ï¼‰\n\n```bash\nopenssl req -new -sha256 -key ryans-key.pem -out ryans-csr.pem\n```\n\nç¬¬ä¸‰æ­¥ï¼ŒæŠŠCSRå‘ç»™CAæœºæ„ç­¾åï¼Œæˆ‘ä»¬è¿™ä¸€æ­¥é‡‡ç”¨è‡ªç­¾åçš„æ–¹å¼ï¼Œè·å¾—è¯ä¹¦`ryans-cert.pem`\n\n```bash\nopenssl x509 -req -in ryans-csr.pem -signkey ryans-key.pem -out ryans-cert.pem\n```\n\nè‡³æ­¤ï¼Œæˆ‘ä»¬è·å¾—äº†ç§é’¥å’Œ`cerè¯ä¹¦`ã€‚\n\næˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥è·å–`pfxè¯ä¹¦`,`ryans.pfx`\n\n```bash\nopenssl pkcs12 -export -in ryans-cert.pem -inkey ryans-key.pem -out ryans.pfx\n```\n\n### httpsæ¨¡å—ä½¿ç”¨\n\n```typescript\nimport { createServer } from \"https\";\nimport { fstat, readFileSync } from \"fs\";\n\nconst options = {\n  key: readFileSync(\"./certs/ryans-key.pem\"),\n  cert: readFileSync(\"./certs/ryans-cert.pem\"),\n};\n\nconst html = readFileSync('../index.html')\n\nconst server = createServer(options, (req, res) => {\n  res.end(html)\n});\n\nserver.listen(443) // httpsé»˜è®¤æ˜¯443ç«¯å£\n```\n\nä½¿ç”¨Chromeæ¥æµ‹è¯•ï¼Œé¦–å…ˆéœ€è¦å…è®¸`localhost`ä½¿ç”¨æ— æ•ˆè¯ä¹¦ï¼ˆæ²¡æœ‰ç»è¿‡CAç­¾åï¼‰ã€‚`chrome://flags/#allow-insecure-localhost`ï¼Œè®¾ä¸º`Enabled`å³å¯\n\nåœ¨æµè§ˆå™¨ä¸­è¾“å…¥`https://localhost:443`ã€‚å°±å¯ä»¥çœ‹åˆ°é¡µé¢äº†\n\nè¿˜å¯ä»¥ä½¿ç”¨pfxè¯ä¹¦ï¼Œpfxè¯ä¹¦ç›¸å¯¹äºcerè¯ä¹¦ï¼š\n\n- cerè¯ä¹¦åªåŒ…å«å…¬é’¥\n- pfxè¯ä¹¦åŒ…å«å…¬é’¥å’Œç§é’¥\n\n```typescript\nimport { createServer } from \"https\";\nimport { fstat, readFileSync } from \"fs\";\n\nconst options = {\n  pfx: readFileSync('./certs/ryans.pfx'),\n  passphrase: '' // pfxè¯ä¹¦çš„å¯†ç \n};\n\nconst html = readFileSync('../index.html')\n\nconst server = createServer(options, (req, res) => {\n  res.end(html)\n});\n\nserver.listen(443)\n```\n\n`https`æ¨¡å—ä¹Ÿæœ‰`https.request`æ–¹æ³•ç”¨æ¥å‘èµ·httpsè¯·æ±‚\n\n## HTTP/2\n\n### HTTP/2 ç‰¹ç‚¹\n\n`http`é€šå¸¸æŒ‡`http/1.1`ã€‚`http/2`ç›¸è¾ƒäº`http/1.1`åšäº†å¾ˆå¤šæå‡:\n\n- **`TLS/SSL`åŠ å¯†**ï¼šå’Œhttpsä¸€æ ·ã€‚æ‰€ä»¥ä¹Ÿéœ€è¦é…ç½®è¯ä¹¦å’Œç§é’¥\n- **äºŒè¿›åˆ¶ä¼ è¾“**ï¼š`http/1.1`ä¼ è¾“çš„æ˜¯æ–‡æœ¬ï¼Œ`http/2`ä¼ è¾“çš„æ˜¯äºŒè¿›åˆ¶æµ\n- **å¤šè·¯å¤ç”¨**ï¼š`http/2`æœ‰ä¸¤ä¸ªæ¦‚å¿µâ€”â€”**å¸§**å’Œ**æµ**ã€‚`http/2`å°†æ•°æ®æŠ¥æ–‡åˆ†æˆä¸€ä¸ªä¸ªäºŒè¿›åˆ¶**å¸§ï¼ˆFrameï¼‰**ï¼Œåœ¨ä¸€ä¸ªTCPè¿æ¥ä¸­ï¼Œä¸åŒçš„å¸§ç»„åˆåœ¨ä¸€èµ·å‘é€ï¼ˆ**äºŒè¿›åˆ¶åˆ†å¸§**ï¼‰å½¢æˆ**æµï¼ˆStreamï¼‰**ã€‚åœ¨æ¥æ”¶æ–¹æ ¹æ®å¸§é¦–éƒ¨ä¿¡æ¯åœ¨ç»„åˆèµ·æ¥ã€‚`HTTP/1.1`åªèƒ½ä¸€ä¸ªä¸ªè¯·æ±‚æŠ¥æ–‡æ’é˜Ÿå‘é€ã€‚\n- **headerå‹ç¼©**ï¼šhttpè¯·æ±‚æœ‰è¿™ç¹å¤šå†—é•¿çš„é¦–éƒ¨ï¼Œ`http/2`ä¼šå¯¹é¦–éƒ¨è¿›è¡Œå‹ç¼©\n- **æœåŠ¡ç«¯æ¨é€**ï¼šèƒ½å¤Ÿä¸»åŠ¨ç»™å®¢æˆ·ç«¯æ¨é€èµ„æº\n  - `http/1.1`åŠ è½½ç½‘é¡µçš„é¡ºåºï¼šè¯·æ±‚htmlï¼Œè§£æhtmlï¼Œå†è¯·æ±‚jsã€cssç­‰æ–‡ä»¶\n  - `http/2`ï¼šå½“æœåŠ¡ç«¯æ”¶åˆ°htmlè¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯å°±ä¸»åŠ¨å§htmlã€cssã€jsä»¥åŠå›¾ç‰‡ç­‰èµ„æºå‘é€ç»™å®¢æˆ·ç«¯\n\n> å‰4ä¸ªéƒ½æ˜¯`http/2`è‡ªåŠ¨å®ç°çš„ã€‚æœåŠ¡ç«¯æ¨é€éœ€è¦å¼€å‘è€…æ‰‹åŠ¨é…ç½®ã€‚\n\n### Nodejså®ç°\n\n`nodejs`å†…ç½®äº†`http2`æ¨¡å—ï¼Œå®ç°äº†`http/2`åè®®ã€‚\n\n```typescript\nimport { createSecureServer } from \"http2\";\nimport { readFileSync } from \"fs\";\n\nconst options = {\n  pfx: readFileSync(\"./certs/ryans.pfx\"),\n  passphrase: \"\",\n};\n\nconst html = readFileSync(\"../index.html\");\n\nconst server = createSecureServer(options);\n\nserver.on(\"stream\", (stream, headers) => {\n  stream.respond({\n    \"content-type\": \"text/html; charset=utf-8\",\n    \":status\": 200,\n  });\n  stream.end(html);\n});\n\nserver.listen(443);\n```\n\n`http2`æ¨¡å—æœ‰ä¸¤ä¸ªåˆ›å»ºæœåŠ¡çš„æ–¹æ³•â€”â€”`createServer`å’Œ`createSecureServer`ã€‚å‰è€…æ˜¯ä¸å¸¦TLS/SSLåŠ å¯†çš„ï¼Œåè€…å¸¦åŠ å¯†ã€‚ç›®å‰ä¸»æµæµè§ˆå™¨åªæ”¯æŒå¸¦`TLS/SSL`åŠ å¯†çš„`HTTP/2`\n\nç›‘å¬`http2Server`çš„`stream`äº‹ä»¶ï¼Œå½“è¯·æ±‚å‘æ¥å°±æ¥è§¦å‘è¯¥äº‹ä»¶ï¼ˆhttp2æ•°æ®æ˜¯ä»¥äºŒè¿›åˆ¶æµçš„å½¢å¼ä¼ è¾“ï¼‰\n\n`http2Stream`æ˜¯ä¸€ä¸ªåŒå·¥æµã€‚æ—¢å¯ä»¥å‘é€æ•°æ®ä¹Ÿå¯ä»¥æ¥å—æ•°æ®ã€‚`ServerHttp2Stream`æ˜¯å…¶å®ç°ï¼Œå…¶ï¼š\n\n- `http2stream.pushStream(headers[, options], callback)`ï¼šå®ç°æœåŠ¡ç«¯ä¸»åŠ¨æ¨é€\n- `http2stream.respond([headers[, options]])`ï¼šå‘é€å›åº”ï¼Œå¯ä»¥åœ¨è¿™è®¾ç½®å“åº”å¤´\n- `stream`æ˜¯ä¸€ä¸ªæµï¼Œä½¿ç”¨`stream.write()`å‘å…¶å†™å…¥å†…å®¹æˆ–`stream.end(content)`ç»“æŸè¿™ä¸ªæµ\n\n### æœåŠ¡ç«¯æ¨é€(Server Push)\n\nè¿™æ˜¯http/2çš„ä¸€å¤§ç‰¹ç‚¹ã€‚nodejsä¸­å®ç°é€šè¿‡`pushStream`æ–¹æ³•å³å¯å®ç°\n\n```typescript\nimport { createSecureServer } from \"http2\";\nimport { readFileSync } from \"fs\";\n\nconst options = {\n  pfx: readFileSync(\"./certs/ryans.pfx\"),\n  passphrase: \"\",\n};\n\nconst html = readFileSync(\"../index.html\");\nconst png = readFileSync(\"../hello.jpg\");\n\nconst server = createSecureServer(options);\n\nserver.on(\"stream\", (stream, headers) => {\n  stream.respond({\n    \"content-type\": \"text/html; charset=utf-8\",\n    \":status\": 200,\n  });\n  stream.pushStream({ \":path\": \"/hello.jpg\" }, (err, pushStream, headers) => {\n    if (err) throw err;\n    pushStream.respond({ \":status\": 200 });\n    pushStream.end(png);\n  });\n  stream.end(html);\n});\n\nserver.listen(443);\n\n```\n\nä¸Šä¾‹åœ¨ç”¨æˆ·è¯·æ±‚`https://localhost`æ—¶ï¼Œå°†index.htmlå’Œ`https://localhost/hello.jpg`ä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯ã€‚\n\n### å®¢æˆ·ç«¯\n\n`http2`æ¨¡å—ä¹Ÿæä¾›äº†å®¢æˆ·ç«¯å®ç°ã€‚\n\n```typescript\nimport { connect } from \"http2\";\nimport { readFileSync } from \"fs\";\n\nconst client = connect(\"https://www.zxffan.com:443\", {\n  ca: readFileSync(\"./certs/ryans-cert.pem\"),\n});\n\nconst req = client.request({ \":path\": \"/\" });\n\nreq.on(\"response\", (headers, flags) => {\n  for (const name in headers) {\n    console.log(`${name}: ${headers[name]}`);\n  }\n});\n\nreq.setEncoding(\"utf8\");\nlet data = \"\";\nreq.on(\"data\", (chunk) => {\n  data += chunk;\n});\nreq.on(\"end\", () => {\n  console.log(`\\n${data}`);\n  client.close();\n});\nreq.end();\n```\n\nå®¢æˆ·ç«¯éœ€è¦é…ç½®caè¯ä¹¦\n\n## Express\n\n`Express`æ˜¯`ndoejs`çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå®ƒå¯¹ç½‘ç»œæ¨¡å—åšäº†å¢å¼ºã€‚æ¥ä¸ªä¾‹å­ï¼š\n\n```typescript\nimport express from \"express\";\nimport { createServer } from 'http'\n\nconst app = express();\nconst server = createServer(app)\n\napp.get(\"/\", (req, res) => {\n  // TODO\n  res.send('hello express!')\n});\n\napp.use((req, res, next) => {\n  console.log('Time: %d', Date.now())\n  next()\n})\n\nserver.listen(3000);\n```\n\nå°†appä¼ ç»™`createServer`ã€‚è¿™æ ·`express`å°±æ‹¦æˆªäº†æ‰€æœ‰è¯·æ±‚ï¼Œåœ¨æ”¶åˆ°è¯·æ±‚åˆ°å“åº”ä¹‹é—´å°±å¯ä»¥æ·»åŠ å¾ˆå¤š**ä¸­é—´ä»¶**ã€‚\n\n- ä¸­é—´ä»¶ç³»ç»Ÿï¼Œ`app.use`æ¥æ³¨å†Œä¸€ä¸ªä¸­é—´ä»¶ï¼Œæ‰€æœ‰è¯·æ±‚å›æŒ‰ç…§ä¸­é—´ä»¶æ³¨å†Œé¡ºåºä¾æ¬¡è°ƒç”¨ã€‚\n\n- è·¯ç”±ç³»ç»Ÿï¼Œ`express`æ–°å¢äº†è·¯ç”±ï¼Œ`app.get`ã€`app.post`ã€‚è·¯ç”±æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸­é—´ä»¶\n\n### ä¸­é—´ä»¶â€”â€”æ´‹è‘±æ¨¡å‹\n\n```typescript\nimport express from \"express\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst server = createServer(app);\n\napp.use(\n  function m1(req, res, next)  {\n    console.log('m1 start');\n    next()\n    console.log('m1 end')\n  },\n  function m2(req, res, next)  {\n    console.log('m2 start');\n    next()\n    console.log('m2 end')\n  },\n  function m3(req, res, next)  {\n    console.log('m3 start');\n    next()\n    console.log('m3 end')\n  },\n);\n\napp.get(\"/\", (req, res) => {\n  // TODO\n  res.send(\"hello express!\");\n});\n\nserver.listen(3000);\n```\n\nä¸Šä¾‹æ³¨å†Œäº†3ä¸ªä¸­é—´ä»¶â€”â€”`m1`,`m2`å’Œ`m3`\n\nè¾“å‡ºé¡ºåºï¼š\n\n```text\nm1 start\nm2 start\nm3 start\nm3 end\nm2 end\nm1 end\n```\n\nä¸­é—´ä»¶å°±åƒä¸€ä¸ªæ´‹è‘±ï¼Œ`m1`æ˜¯å¤–è¡¨çš®ï¼Œ`m2`æ˜¯ä¸­é—´è¡¨çš®ï¼Œ`m2`æ˜¯å†…è¡¨çš®ã€‚ä»æ´‹è‘±çš„ä¸€å±‚ç©¿é€åˆ°å¦ä¸€ä¸ªï¼Œç»è¿‡é¡ºåºå¿…ç„¶æ˜¯ï¼š`m1->m2->m3->m3->m2->m1`ã€‚ã€\n\n![æ´‹è‘±æ¨¡å‹](../../images/nodejs/ä¸­é—´ä»¶æ´‹è‘±æ¨¡å‹.png)\n\nä½†æ˜¯`express`çš„æ´‹è‘±æ¨¡å‹åˆä¸ªé—®é¢˜â€”â€”å¼‚æ­¥æ”¯æŒä¸å¥½ã€‚å¦‚æœm2ä¸­è¿›è¡Œä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼ˆRPCï¼ŒæŸ¥æ•°æ®åº“ç­‰ï¼‰ï¼Œå…¶å®ƒä¸­é—´ä»¶ä¸ä¼šç­‰å¾…æ“ä½œç»“æœã€‚`Koa`çš„å‡ºç°å¼¥è¡¥äº†è¿™ä¸ªç¼ºç‚¹ã€‚\n\n### httpså’Œhttp2\n\nhttps\n\n```typescript\nimport express from \"express\";\nimport { createServer } from \"https\";\nimport { readFileSync } from \"fs\";\n\nconst options = {\n  pfx: readFileSync(\"./certs/ryans.pfx\"),\n  passphrase: \"\",\n};\n\nconst app = express();\nconst server = createServer(options, app);\n\nconst html = readFileSync(\"../index.html\", \"utf-8\");\n\napp.get(\"/\", (req, res) => {\n  // TODO\n  res.send(html);\n});\n\nserver.listen(3000);\n```\n\nä½¿ç”¨æ–¹æ³•å’Œ`http`æ¨¡å—ç±»ä¼¼ã€‚\n\nè‡³äº`http2`æ¨¡å—ï¼Œ`express`ç›®å‰è¿˜æ— æ³•ä¸å…¶å…¼å®¹ã€‚å‚è§å®˜æ–¹[issue](https://github.com/expressjs/express/issues/2761#issuecomment-142610897)\nå¦‚æœæƒ³åœ¨`http2`æ¨¡å—ä¸­ä½¿ç”¨`express`çš„è·¯ç”±ï¼Œå¯ä»¥ä½¿ç”¨[`router`](https://github.com/pillarjs/router)ï¼Œå®ƒæ˜¯ä»expressç‹¬ç«‹å‡ºæ¥çš„å¹¶ä¸”å…¼å®¹`http2`ï¼Œå‚è€ƒ[issue](https://github.com/expressjs/express/issues/2761#issuecomment-142612001)\næœç´¢èµ„æ–™ï¼Œå‘ç°å¯ä»¥ä½¿ç”¨`spdy`è¿™ä¸ªåº“æ¥ç»“åˆexpresså®ç°`http2`\n\n## Koa\n\n`Koa`æ˜¯`express`åŸç­äººé©¬æ‰“é€ çš„ã€‚`koa`å°±æ˜¯ä¸€ä¸ª**ä¸­é—´ä»¶ç³»ç»Ÿ**ã€‚ä»–çš„ä¸­é—´ä»¶æ”¯æŒä¸¤ç§å‡½æ•°â€”â€”æ™®é€šå‡½æ•°å’Œ**å¼‚æ­¥å‡½æ•°**\n\n```typescript\nimport Koa from \"koa\";\nimport { createServer } from \"http\";\n\nconst app = new Koa();\nconst server = createServer(app.callback());\n\napp.use(async (ctx, next) => {\n  await next();\n  ctx.body = 'hello koa!'\n});\n\nserver.listen(3000);\n```\n\næˆ‘è¿™é‡Œçš„å†™æ³•éƒ½æ˜¯é€šè¿‡åŸç”Ÿ`http`æ¨¡å—ï¼Œè¿™æ˜¯ä¸ºäº†ä½“ç°`koa`ã€`express`åªä¸è¿‡æ˜¯ä¸€å¥—ä¸­é—´ä»¶å±‚ã€‚åº•å±‚çš„ç½‘ç»œæœåŠ¡è¿˜æ˜¯nodejsæä¾›çš„ã€‚\n\nä¹Ÿå¯ä»¥ç®€å†™\n\n```typescript\nimport Koa from \"koa\";\n\nconst app = new Koa();\n\napp.use(async (ctx, next) => {\n  await next();\n  ctx.body = 'hello koa!'\n});\n\napp.listen(3000);\n```\n\nkoaä¸­é—´ä»¶æ”¯æŒnodejsçš„`async`å’Œ`await`è¯­æ³•ï¼Œä»è€Œä¼˜é›…çš„å®ç°å¼‚æ­¥ã€‚\n\n### https\n\nä½¿ç”¨httpsï¼Œä¹Ÿå°±æ˜¯æ›´æ¢åº•å±‚ç½‘ç»œåè®®ã€‚\n\n```typescript\nimport Koa from \"koa\";\nimport { createServer } from \"https\";\nimport { readFileSync } from \"fs\";\n\nconst options = {\n  pfx: readFileSync(\"./certs/ryans.pfx\"),\n  passphrase: \"\",\n};\n\nconst app = new Koa();\nconst server = createServer(options, app.callback());\n\nconst html = readFileSync(\"../index.html\", \"utf-8\");\n\napp.use(async (ctx, next) => {\n  await next();\n  ctx.body = html;\n});\n\nserver.listen(3000);\n```\n\n### http/2\n\n`Koa`æ˜¯å…¼å®¹`http2`æ¨¡å—çš„ï¼š\n\n```typescript\nimport Koa from \"koa\";\nimport { createSecureServer } from \"http2\";\nimport { readFileSync } from \"fs\";\n\nconst options = {\n  pfx: readFileSync(\"./certs/ryans.pfx\"),\n  passphrase: \"\",\n};\n\nconst html = readFileSync(\"../index.html\", \"utf-8\");\n\nconst app = new Koa();\nconst server = createSecureServer(options, app.callback());\n\napp.use(async (ctx, next) => {\n  await next();\n  ctx.\n  ctx.body = html;\n});\n\nserver.listen(443);\n```\n\nkoaå¦‚ä½•ä½¿ç”¨æœåŠ¡ç«¯æ¨é€ï¼Œç›®å‰è¿˜æ²¡æœ‰æŸ¥åˆ°ğŸ˜‚ã€‚\n\næŸ¥äº†ä¸‹å®˜æ–¹issueï¼Œå¼€å‘è€…åªæåˆ°å…¼å®¹HTTP/2ã€‚æ²¡æ`server push`ï¼Œä¸è¿‡æœ‰äººå»ºè®®é€šè¿‡`ctx.stream`çš„å½¢å¼è·å¾—æµï¼Œè¿›è€Œä½¿ç”¨`stream.pushStream()`\n\n## HTTP/3\n\n`HTTP/1.x`ã€`HTTPS`ä»¥åŠ`HTTP/2.0`éƒ½ç¦»ä¸å¼€åº•å±‚çš„`TCP`åè®®ã€‚\n\n`HTTP/2.0`é‡‡ç”¨å¤šè·¯å¤ç”¨ï¼Œå¤šä¸ªæ•°æ®åŒ…ä½¿ç”¨ä¸€ä¸ª`TCP`è¿æ¥ã€‚`TCP`æ˜¯å¯é è¿æ¥ï¼Œä½†å‘ç”Ÿä¸¢åŒ…æ—¶ï¼Œä¼šè¿›è¡Œé‡ä¼ ã€‚æ‰€ä»¥ç½‘ç»œçŠ¶æ€å·®çš„æƒ…å†µä¸‹ï¼ŒæŸäº›æ•°æ®åŒ…é¢‘ç¹é‡ä¼ ï¼Œä»è€Œå¯¼è‡´æ‹¥å¡ï¼Œåé¢çš„HTTPåŒ…éƒ½ç©¿ä¸å‡ºå»ã€‚è¿™å«åš**å¤´éƒ¨é˜»å¡ï¼ˆHead of line Blockingï¼‰**\n\n`HTTP/3.0`å°±å¼€å§‹è€ƒè™‘æ”¾å¼ƒ`TCP`è½¬å‘`UDP`åè®®ã€‚èµ·åˆ`Google`æå‡ºæ¥ä¸ª`QUIC`åè®®ï¼Œåæ¥`IETF`æ ‡å‡†åŒ–äº†`QUIC`åè®®å½¢æˆ`HTTP/3`ã€‚å…¶åº•å±‚é‡‡ç”¨`UDP`ï¼ŒåŸºäº`UDP`å®ç°åšäº†ä¼—å¤šå¢å¼ºï¼š\n\n- 0RTTï¼š`TPC`å»ºç«‹è¿æ¥æ¯æ¬¡éƒ½éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå°±å­˜åœ¨æ•°æ®åŒ…çš„ä¸‰æ¬¡å¾€è¿”å³**3RTT**ã€‚è€Œ`QUIC`é¦–æ¬¡å»ºç«‹è¿æ¥åªéœ€è¦`1RTT`ã€‚å…¶åçš„è¿æ¥å¯ä»¥ç›´æ¥å¤ç”¨ï¼Œåªéœ€è¦**0RTT**\n- è¿æ¥è¿ç§»ï¼šå½“`æºIP`ã€`æºç«¯å£`ã€`ç›®çš„IP`ã€`ç›®çš„ç«¯å£`å…¶ä¸­ä¸€ä¸ªå‘ç”Ÿå˜åŒ–å°±éœ€è¦é‡æ–°å»ºç«‹TCPè¿æ¥ã€‚åªè¦**Connection ID**æ²¡æœ‰å˜åŒ–ã€‚`HTTP/3`å¯ä»¥ç»§ç»­å¤ç”¨è¿æ¥\n- å¤´éƒ¨é˜»å¡ï¼šç”±äºä½¿ç”¨`UDP`ï¼Œå‘ç”Ÿä¸¢åŒ…æ—¶ï¼Œä¹Ÿä¸ä¼šç«‹å³é‡ä¼ ï¼Œé˜»å¡è¿æ¥ã€‚\n- æ‹¥å¡æ§åˆ¶\n- å‰å‘çº é”™\n- æ›´å¤šç‰¹æ€§ è¯·å‚è€ƒ[æ–‡ç« ](https://zhuanlan.zhihu.com/p/143464334)\n\nnodejsç›®å‰æœªæ”¯æŒ`HTTP/3`ã€‚\n\nchromeåªæ”¯æŒ `Google QUIC`ã€‚å¯¹`IETF QUIC`çš„æ”¯æŒå¤„äº`WIP`çŠ¶æ€\n\n","tags":["Nodejs","æœåŠ¡"],"categories":["Nodejs","Server"]},{"title":"Nginx","url":"/posts/d0156050.html","content":"\n> nginx [engine x] is an HTTP and reverse proxy server, a mail proxy server, and a generic TCP/UDP proxy server\n>\n> nginxæ˜¯ä¸€ä¸ªHTTPæœåŠ¡å™¨ã€åå‘ä»£ç†æœåŠ¡å™¨ã€é‚®ä»¶ä»£ç†æœåŠ¡å™¨ã€é€šç”¨TCP/UDPä»£ç†æœåŠ¡å™¨\n\næ€»è€Œè¨€ä¹‹ï¼Œ`nginx`èƒ½å¤Ÿåœ¨ä½ çš„æœºå™¨ä¸Šè·‘èµ·HTTPæœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæœåŠ¡ä¸Šéƒ¨ç½²ä¼ ç»Ÿçš„Webç³»ç»Ÿã€‚\n\n## Nginxé…ç½®\n\nå®‰è£…ä»€ä¹ˆçš„å°±ä¸æäº†ã€‚nginxçš„é…ç½®æ¡†æ¶å¦‚ä¸‹\n\n```nginx\n\n#user  nobody;\nworker_processes  1; #é…ç½®å·¥ä½œè¿›ç¨‹æ•°ç›®\n\n#é…ç½®å…¨å±€é”™è¯¯æ—¥å¿—åŠç±»å‹ [debug|info|notice|warn|error|crit(è‡´å‘½é”™è¯¯)] é»˜è®¤error\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n\n#é…ç½®è¿›ç¨‹pidæ–‡ä»¶\n#pid        logs/nginx.pid;\n\n\n#é…ç½®å·¥ä½œæ¨¡å¼å’Œè¿æ¥æ•°\nevents {\n  #é…ç½®æ¯ä¸ªworkerçš„æœ€å¤§è¿æ¥æ•°\n  #nginxæœ€å¤§è¿æ¥æ•° = worker_process * worder_connections\n  worker_connections  1024;\n}\n\n#é…ç½®http\nhttp {\n  #include ç”¨æ¥å¼•å…¥å…¶ä»–æ–‡ä»¶çš„é…ç½®\n  #å½“æ”¶åˆ°é™æ€èµ„æºè¯·æ±‚æ—¶ï¼Œä¼šæ ¹æ®èµ„æºçš„åç¼€åå»mime.typesé‡Œæ‰¾å¯¹åº”çš„mimeç±»å‹ï¼Œå†æ ¹æ®mimeæ¥è®¾ç½®å“åº”å¤´ä¸­çš„Content-Type\n  include       mime.types;\n  default_type  application/octet-stream; #è®¾ç½®é»˜è®¤å“åº”ç±»å‹\n\n  #è®¾ç½®æ—¥å¿—æ ¼å¼\n  #log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n  #                  '$status $body_bytes_sent \"$http_referer\" '\n  #                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n  #access_log  logs/access.log  main;\n\n  #sendfile æŒ‡ä»¤æŒ‡å®š nginx æ˜¯å¦è°ƒç”¨ sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œ\n  #å¯¹äºæ™®é€šåº”ç”¨ï¼Œå¿…é¡»è®¾ä¸º on,\n  #å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸º offï¼Œ\n  #ä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„uptime.\n  sendfile        on;\n  #tcp_nopush     on; #ç´¯è®¡ä¸€å®šé‡çš„æ•°æ®åŒ…ä¸€èµ·å‘é€\n  #tcp_nodelay\t\ton; #é»˜è®¤å»¶å0.2såå‘é€æ•´åˆæ•°æ®åŒ…ï¼ˆé¿å…é¢‘ç¹å‘é€å°æ•°æ®åŒ…ï¼‰ã€‚onåˆ™å…³é—­è¿™ä¸ªç‰¹æ€§\n\n  #è¿æ¥è¶…æ—¶æ—¶é—´\n  #keepalive_timeout  0;\n  keepalive_timeout  65;\n\n  #å¼€å¯gzipå‹ç¼©\n  gzip  on;\n\n  server {\n    listen       8080; #é…ç½®ç›‘å¬ç«¯å£\n    server_name  localhost; #é…ç½®æœåŠ¡å\n\n    #ç¼–ç \n    #charset koi8-r;\n\n    #è®¾ç½®æ—¥å¿—å­˜æ”¾è·¯å¾„ï¼Œæ ¼å¼ä¸º mainï¼ˆåœ¨httpä¸­å®šä¹‰çš„ï¼‰\n    access_log  logs/host.access.log  main;\n\n    #é»˜è®¤çš„åŒ¹é…è§„åˆ™\n    location / {\n      root   html;\n      index  index.html index.htm;\n    }\n\n    #error_page  404              /404.html;\n\n    # redirect server error pages to the static page /50x.html\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n      root   html;\n    }\n\n    # ä»£ç†æ‰€æœ‰urlä¸­å«æœ‰apiçš„è¯·æ±‚ï¼Œå¹¶è½¬å‘åˆ° http://127.0.0.1\n    location /api/ {\n      proxy_pass   http://127.0.0.1:8080;\n    }\n\n    # æ‹’æ¥æ‰€æœ‰htæ–‡ä»¶è¯·æ±‚\n    location ~ /\\.ht {\n      deny  all;\n    }\n  }\n\n  include servers/*;\n}\n\n```\n\n## è™šæ‹Ÿä¸»æœº\n\n**è™šæ‹Ÿä¸»æœºæŠ€æœ¯**å¯ä»¥å°†ä¸€å°ç‰©ç†æœåŠ¡å™¨åˆ’åˆ†æˆå¤šä¸ª**è™šæ‹Ÿä¸»æœº**ã€‚å¯ä»¥åœ¨æ¯ä¸ªè™šæ‹Ÿä¸»æœºéƒ¨ç½²ç½‘ç«™ã€‚\n\n### åŸºäºç«¯å£\n\n`server`ä¸‹çš„`listen`å­—æ®µå¯ä»¥è®¾ç½®æ‰€éœ€ç›‘å¬çš„ç«¯å£\n\n```nginx\nserver {\n  listen 8080;\n  root /project1/\n  \n  location / {\n    index index.html\n  }\n}\n```\n\n`localhost:8080`å³å¯è®¿é—®åˆ°è™šæ‹Ÿä¸»æœºï¼ˆserverï¼‰ä¸Šéƒ¨ç½²çš„ç½‘ç«™\n\n### åŸºäºè™šæ‹Ÿä¸»æœºå\n\n`server_name`ï¼šé…ç½®è™šæ‹Ÿä¸»æœºçš„åç§°ã€‚å¯ä»¥é…ç½®æˆè®¿é—®çš„åŸŸå\n\n```nginx\n# A\nserver {\n  listen  80;\n  server_name www.test1.com;\n  # ...\n}\n\n# B\nserver {\n  listen  80;\n  server_name www.test2.com;\n  # ...\n}\n```\n\nè™šæ‹Ÿä¸»æœºAå’ŒBç›‘å¬åŒä¸€ä¸ªç«¯å£ï¼Œä½†æ˜¯é€šè¿‡é…ç½®ä¸åŒçš„`server_name`æ¥åŒºåˆ†\n\n- `http://www.test1.com/index.html`å°†è®¿é—®åˆ°è™šæ‹Ÿä¸»æœºA\n- `http://www.test2.com/index.html`å°†è®¿é—®åˆ°è™šæ‹Ÿä¸»æœºB\n\n## locationåŒ¹é…è§„åˆ™\n\n`location [=|~|~*|^~] /uri/ { â€¦ }`\n\n- `=` å¼€å¤´è¡¨ç¤ºç²¾ç¡®åŒ¹é…\n\n- `^~` å¼€å¤´è¡¨ç¤ºuriä»¥æŸä¸ªå¸¸è§„å­—ç¬¦ä¸²å¼€å¤´ï¼Œç†è§£ä¸ºåŒ¹é… urlè·¯å¾„å³å¯ã€‚nginxä¸å¯¹urlåšç¼–ç ï¼Œå› æ­¤è¯·æ±‚ä¸º/static/20%/aaï¼Œå¯ä»¥è¢«è§„åˆ™^~ /static/ /aaåŒ¹é…åˆ°ï¼ˆæ³¨æ„æ˜¯ç©ºæ ¼ï¼‰ã€‚\n\n- `~` å¼€å¤´è¡¨ç¤ºåŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…\n\n- `~*` å¼€å¤´è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…\n\n- `!~`å’Œ`!~*`åˆ†åˆ«ä¸ºåŒºåˆ†å¤§å°å†™ä¸åŒ¹é…åŠä¸åŒºåˆ†å¤§å°å†™ä¸åŒ¹é… çš„æ­£åˆ™\n\n- `/` é€šç”¨åŒ¹é…ï¼Œä»»ä½•è¯·æ±‚éƒ½ä¼šåŒ¹é…åˆ°ã€‚\n\n## rootå’Œalias\n\n`rooot`å’Œ`alias`éƒ½æ˜¯ç”¨æ¥æŒ‡å®šæ–‡ä»¶è·¯å¾„çš„\n\n```nginx\nlocation ^~ /public/ {\n\troot /www/root/html;\n}\n```\n\nå½“è®¿é—®`/public/index.html`æ—¶ä¼šåœ¨`/www/root/html/public/index.html`è·¯å¾„ä¸‹å¯»æ‰¾æ–‡ä»¶\n\n```nginx\nlocation ^~ /public/ {\n\talias /www/root/html/;\n}\n```\n\nå½“è®¿é—®`/public/index.html`æ—¶ä¼šåœ¨`/www/root/html/index.html`è·¯å¾„ä¸‹å¯»æ‰¾æ–‡ä»¶\n\næ‰€ä»¥ï¼ŒåŒºåˆ«å°±æ˜¯åœ¨æŸ¥æ‰¾æ–‡ä»¶æ—¶ï¼Œrootä¼šåŠ ä¸Šlocationé…ç½®è·¯å¾„ï¼Œè€Œaliasä¸ä¼š\n\n## åˆå§‹é¡µ\n\n```nginx\nserver {\n  listen 80;\n  server_name www.test.com;\n  \n  location / {\n    root /website/project1;\n    index index.html welcome.html\n  }\n}\n```\n\nå½“è®¿é—®`www.test.com`æ—¶ï¼Œä¼šåœ¨`/website/project1/`ç›®å½•ä¸‹å¯»æ‰¾`index.html`æ–‡ä»¶ï¼Œæœ‰åˆ™è¿”å›å¦åˆ™ç»§ç»­å¯»æ‰¾`welcome.html`\n\n## é”™è¯¯é¡µ\n\nå¯¹äºä¸€äº›é”™è¯¯é¡µé¢ï¼ˆ404ï¼Œ500ç­‰ï¼‰ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹é…ç½®æ¥è®¿é—®\n\n```nginx\nerror_page 404 =200 /404.html;\nlocation = /404.html {\n    root /website;\n}\n\nerror_page 500 502 503 =200 /50x.html;\nlocation = /50x.html {\n    root /website;\n} \n```\n\nå½“è¯·æ±‚å‘ç”Ÿ404æ—¶ï¼ˆè®¿é—®åˆ°ä¸å­˜åœ¨çš„é¡µé¢ï¼‰ï¼Œä¼šè·³è½¬åˆ°`/404.html`ã€‚ä¸ºäº†é˜²æ­¢æ‰¾ä¸åˆ°ï¼ŒåŠ äº†ä¸ª`location`æŒ‡å®šæ–‡ä»¶æ‰€åœ¨ä½ç½®ï¼ˆ`/website/404.html`ï¼‰ã€‚\n\nå¯¹äºå•é¡µé¢åº”ç”¨ï¼Œé€šå¸¸åªæœ‰ä¸€ä¸ª`index.html`ã€‚åœ¨é…ç½®404ç­‰é”™è¯¯æ—¶ï¼Œéœ€è¦è¿”å›`index.html`\n\n```nginx\nerror_page 404 =200 /404.html;\nlocation = /404.html {\n  root /website;\n  try_files $uri $uri/ /index.html;\n}\n```\n\nè§£é‡Šï¼šå‘ç”Ÿ404æ—¶ï¼Œé‡å®šå‘åˆ°`/404.html`ã€‚åŒ¹é…åˆ°`/404.html`çš„`location`ã€‚ç„¶åé‡åˆ°`try_files`æŒ‡ä»¤\n\n**`try_files $uri $uri/ /index.html;`**\n\nè®¿é—®`/public/somepage.html`æ—¶ï¼Œä¼šå‰å»æ‰¾`$uri`(å°±æ˜¯`/public/somepage.html`)ï¼Œæ‰¾ä¸åˆ°å¯»æ‰¾`$uri/`ã€‚æ‰¾ä¸åˆ°æœ€åè¿”å›`/index.html`\n\n## ä»£ç†\n\nåå‘ä»£ç†å’Œæ­£å‘ä»£ç†éƒ½éœ€è¦é€šè¿‡`proxy_pass`æŒ‡ä»¤æ¥å®ç°ã€‚\n\néœ€è¦ä»£ç†çš„åœºæ™¯ä¸€èˆ¬æœ‰ä¸‰ç§è§’è‰²ï¼š\n\n- å®¢æˆ·ç«¯ï¼šä¸€èˆ¬æŒ‡æµè§ˆå™¨\n- ä»£ç†æœåŠ¡å™¨ï¼šæŒ‡nginx\n- æœåŠ¡ç«¯ï¼šçœŸæ­£éœ€è¦è®¿é—®çš„æœåŠ¡å™¨\n\n```nginx\nserver {\n  listen 80;\n  root /websites/demo;\n  \n  location / {\n    try_files $uri $uri/ /index.html;\n    index index.html;\n  }\n  \n  location ^~ /api {\n    proxy_pass http://localhost:8081/ #æœ«å°¾åŠ / è½¬å‘å°±ä¸ä¼šåŒ…å«/api(locationçš„è·¯å¾„é…ç½®)\n  }\n}\n```\n\nå®¢æˆ·ç«¯è®¿é—®`/api/get-user-info`ã€‚è¯·æ±‚åˆ°è¾¾ä»£ç†æœåŠ¡å™¨ï¼ŒåŒ¹é…åˆ°`/api`è½¬å‘ç»™`http://localhost:8081/get-user-info`ã€‚\n\nåå‘ä»£ç†å’Œæ­£å‘ä»£ç†æœ¬è´¨ä¸Šéƒ½æ˜¯è¯·æ±‚å’Œå“åº”çš„è½¬å‘ã€‚æ ¹æ®ä»£ç†çš„ç›®çš„æ¥åˆ’åˆ†å®ƒä»¬ã€‚\n\nä»£ç†ä¸€èˆ¬éƒ½æ˜¯æŒ‡**æ­£å‘ä»£ç†**ï¼Œç›®çš„æ˜¯**å¸®åŠ©å†…ç½‘çš„å®¢æˆ·ç«¯è®¿é—®å¤–ç½‘**ã€‚æ¯”å¦‚é€šè¿‡ç§‘å­¦ä¸Šç½‘è®¿é—®googleï¼Œå®ƒåœ¨å›½å¤–å‡è®¾ä¸€å°æ²¡æœ‰è¢«ç¦çš„ä»£ç†æœåŠ¡å™¨ã€‚å›½å†…è®¿é—®è¿™å°ä»£ç†æœåŠ¡å™¨ï¼Œä»£ç†æœåŠ¡å™¨å†å»è®¿é—®googleã€‚\n\n**åå‘ä»£ç†**æ­£å¥½ç›¸åã€‚å®ƒæ˜¯**å¸®åŠ©å¤–ç½‘çš„å®¢æˆ·ç«¯è®¿é—®å†…ç½‘**ã€‚æ¯”å¦‚è®¿é—®baiduã€‚å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰è®¿é—®ç™¾åº¦ï¼Œä¼šè®¿é—®åˆ°baiduçš„ä»£ç†æœåŠ¡å™¨ï¼Œé€šè¿‡ä»£ç†æœåŠ¡å™¨æ¥è®¿é—®baiduçš„å†…ç½‘æœåŠ¡å™¨ã€‚\n\nnginxçš„åå‘ä»£ç†å¸¸å¸¸è¢«æåˆ°ã€‚å› ä¸ºå®ƒçš„æ€§èƒ½çœŸçš„å¾ˆå¥½ã€‚æœ€é‡è¦çš„æ˜¯åå‘ä»£ç†å¯ä»¥æ¥åš**è´Ÿè½½å‡è¡¡**ã€‚\n\n## è´Ÿè½½å‡è¡¡\n\nè¿˜ä»¥è®¿é—®ç™¾åº¦ä¸ºä¾‹ï¼Œå½“ä»£ç†æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶ï¼Œä»£ç†æœåŠ¡å™¨æ ¹æ®è´Ÿè½½å‡è¡¡è§„åˆ™ï¼ˆç®—æ³•ï¼‰æ¥é€‰æ‹©ç™¾åº¦çš„å†…ç½‘æœåŠ¡å™¨ï¼ˆç™¾åº¦çš„æœåŠ¡å™¨è‚¯å®šä¸æ­¢ä¸€å°ï¼‰æ¥è½¬å‘è¯·æ±‚ã€‚\n\n### é…ç½®\n\n```nginx\nhttp {\n  upstream backend {\n    server 127.0.0.1:3000 weight=3; # weightæƒé‡ è¶Šå¤§è®¿é—®çš„æœºç‡è¶Šé«˜\n    server 127.0.0.1:5000 weight=1; \n  }\n  \n  server {\n    listen 80;\n    root /websites/demo\n    location / {\n      proxy_pass http://backend;\n    }\n  }\n}\n```\n\næ‰€æœ‰è¯·æ±‚éƒ½ä¼šä»£ç†è½¬å‘åˆ°`upstream`ä¸­é…ç½®çš„æœåŠ¡å™¨ã€‚æŒ‰ç…§æƒé‡åˆ†é…\n\n### ç­–ç•¥\n\n#### 1.è½®è¯¢ï¼ˆé»˜è®¤ï¼‰\n\n```nginx\nupstream backserver { \n  server 127.0.0.1:3000; \n  server 127.0.0.1:5000; \n} \n```\n\næ¯ä¸ªè¯·æ±‚éƒ½ä¼šæŒ‰ç…§æ—¶é—´å¾ªåºä¾æ¬¡åˆ†é…åˆ°æ‰€é…ç½®çš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœæœåŠ¡å™¨å®•æœºåˆ™è‡ªåŠ¨å‰”é™¤\n\n#### 2.æƒé‡\n\n```nginx\nupstream backend {\n  server 127.0.0.1:3000 weight=3; # weightæƒé‡ è¶Šå¤§è®¿é—®çš„æœºç‡è¶Šé«˜\n  server 127.0.0.1:5000 weight=1; \n}\n```\n\næŒ‡å®šè½®è¯¢æœºç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚\n\n#### 3.IPå“ˆå¸Œ\n\næœåŠ¡ç«¯å¯èƒ½éœ€è¦è®¿é—®sessionï¼Œå¦‚æœæ¯ä¸€æ¬¡å¤„ç†è¯·æ±‚çš„æœåŠ¡ç«¯ä¸åŒï¼Œæ˜¯æ— æ³•è·å–æ­£ç¡®çš„sessionçš„ã€‚IPå“ˆå¸Œæ˜¯æŒ‡æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œä»è€Œè§£å†³sessionçš„é—®é¢˜ã€‚\n\n```nginx\nupstream backserver { \n  ip_hash;\n  server 127.0.0.1:3000; \n  server 127.0.0.1:5000; \n} \n```\n\n#### 4.fair\n\næŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚ \n\n```nginx\nupstream backserver {\n  server 127.0.0.1:3000; \n  server 127.0.0.1:5000;\n  fair;\n} \n```\n\n#### 5.URLå“ˆå¸Œ\n\næ ¹æ®è¯·æ±‚URLçš„hashæ¥åˆ†é…ï¼Œç›¸åŒhashåˆ†é…è‡³åŒä¸€å°æœåŠ¡å™¨\n\n```nginx\nupstream backserver {\n  server 127.0.0.1:3000; \n  server 127.0.0.1:5000;\n  hash $request_uri;\n  hash_method crc32;\n}\n```\n\n### å…¶å®ƒé…ç½®\n\n```nginx\nupstream backserver {\n  server 127.0.0.1:3000 down; # downè¡¨ç¤ºæœåŠ¡å®•æœºï¼Œä¸å‚ä¸åˆ†é… \n  server 127.0.0.1:5000;\n  server 127.0.0.1:6000;\n  server 127.0.0.1:7000 backup; # backupè¡¨ç¤ºè¿™æ˜¯å¤‡ç”¨æœåŠ¡ï¼Œåªæœ‰å½“å…¶å®ƒæœåŠ¡å…¨éƒ¨downï¼Œæ‰ä¼šå¯ç”¨å¤‡ç”¨æœåŠ¡\n}\n```\n\n\n\n## è®¾ç½®å¤´ä¿¡æ¯\n\nè®¾ç½®å“åº”å¤´æœ‰ä¸¤ä¸ªæŒ‡ä»¤â€”â€”`add_header`å’Œ`proxy_set_header`ã€‚\n\n- `add_header key value [always]`ï¼š**è®¾ç½®å“åº”å¤´ç»™æµè§ˆå™¨**ï¼Œå¯¹20xå’Œ30xçš„å“åº”ç æœ‰æ•ˆï¼ŒåŠ ä¸Š`always`å¼ºåˆ¶ç”Ÿæ•ˆ\n- `proxy_set_header key value`ï¼š**è®¾ç½®è¯·æ±‚å¤´ç»™ä¸Šæ¸¸æœåŠ¡å™¨**\n\n```nginx\n# nginx è®¾ç½®corsè·¨åŸŸ\nadd_header 'Access-Control-Allow-Origin' '*';\nadd_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE';\nadd_header 'Access-Control-Allow-Headers' 'Content-Type';\nlocation ^~ /api {\n  if ($request_method = 'OPTIONS') {\n    return 200;\n  }\n  proxy_set_header Host $http_host;\n  proxy_pass http://127.0.0.1:8081/;\n}\n```\n\n## å˜é‡å‚æ•°\n\nnginxå†…ç½®äº†å¾ˆå¤šå˜é‡ï¼Œä½¿ç”¨å½¢å¼`$å˜é‡å`\n\n```nginx\n$args                    #è¯·æ±‚ä¸­çš„å‚æ•°å€¼\n$query_string            #åŒ $args\n$arg_NAME                #GETè¯·æ±‚ä¸­NAMEçš„å€¼\n$is_args                 #å¦‚æœè¯·æ±‚ä¸­æœ‰å‚æ•°ï¼Œå€¼ä¸º\"?\"ï¼Œå¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸²\n$uri                     #è¯·æ±‚ä¸­çš„å½“å‰URI(ä¸å¸¦è¯·æ±‚å‚æ•°ï¼Œå‚æ•°ä½äº$args)ï¼Œå¯ä»¥ä¸åŒäºæµè§ˆå™¨ä¼ é€’çš„$request_uriçš„å€¼ï¼Œå®ƒå¯ä»¥é€šè¿‡å†…éƒ¨é‡å®šå‘ï¼Œæˆ–è€…ä½¿ç”¨indexæŒ‡ä»¤è¿›è¡Œä¿®æ”¹ï¼Œ$uriä¸åŒ…å«ä¸»æœºåï¼Œå¦‚\"/foo/bar.html\"ã€‚\n$document_uri            #åŒ $uri\n$document_root           #å½“å‰è¯·æ±‚çš„æ–‡æ¡£æ ¹ç›®å½•æˆ–åˆ«å\n$host                    #ä¼˜å…ˆçº§ï¼šHTTPè¯·æ±‚è¡Œçš„ä¸»æœºå>\"HOST\"è¯·æ±‚å¤´å­—æ®µ>ç¬¦åˆè¯·æ±‚çš„æœåŠ¡å™¨å.è¯·æ±‚ä¸­çš„ä¸»æœºå¤´å­—æ®µï¼Œå¦‚æœè¯·æ±‚ä¸­çš„ä¸»æœºå¤´ä¸å¯ç”¨ï¼Œåˆ™ä¸ºæœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„æœåŠ¡å™¨åç§°\n$hostname                #ä¸»æœºå\n$https                   #å¦‚æœå¼€å¯äº†SSLå®‰å…¨æ¨¡å¼ï¼Œå€¼ä¸º\"on\"ï¼Œå¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ã€‚\n$binary_remote_addr      #å®¢æˆ·ç«¯åœ°å€çš„äºŒè¿›åˆ¶å½¢å¼ï¼Œå›ºå®šé•¿åº¦ä¸º4ä¸ªå­—èŠ‚\n$body_bytes_sent         #ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„å­—èŠ‚æ•°ï¼Œå“åº”å¤´ä¸è®¡ç®—åœ¨å†…ï¼›è¿™ä¸ªå˜é‡å’ŒApacheçš„mod_log_configæ¨¡å—ä¸­çš„\"%B\"å‚æ•°ä¿æŒå…¼å®¹\n$bytes_sent              #ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„å­—èŠ‚æ•°\n$connection              #TCPè¿æ¥çš„åºåˆ—å·\n$connection_requests     #TCPè¿æ¥å½“å‰çš„è¯·æ±‚æ•°é‡\n$content_length          #\"Content-Length\" è¯·æ±‚å¤´å­—æ®µ\n$content_type            #\"Content-Type\" è¯·æ±‚å¤´å­—æ®µ\n$cookie_name             #cookieåç§°\n$limit_rate              #ç”¨äºè®¾ç½®å“åº”çš„é€Ÿåº¦é™åˆ¶\n$msec                    #å½“å‰çš„Unixæ—¶é—´æˆ³\n$nginx_version           #nginxç‰ˆæœ¬\n$pid                     #å·¥ä½œè¿›ç¨‹çš„PID\n$pipe                    #å¦‚æœè¯·æ±‚æ¥è‡ªç®¡é“é€šä¿¡ï¼Œå€¼ä¸º\"p\"ï¼Œå¦åˆ™ä¸º\".\"\n$proxy_protocol_addr     #è·å–ä»£ç†è®¿é—®æœåŠ¡å™¨çš„å®¢æˆ·ç«¯åœ°å€ï¼Œå¦‚æœæ˜¯ç›´æ¥è®¿é—®ï¼Œè¯¥å€¼ä¸ºç©ºå­—ç¬¦ä¸²\n$realpath_root           #å½“å‰è¯·æ±‚çš„æ–‡æ¡£æ ¹ç›®å½•æˆ–åˆ«åçš„çœŸå®è·¯å¾„ï¼Œä¼šå°†æ‰€æœ‰ç¬¦å·è¿æ¥è½¬æ¢ä¸ºçœŸå®è·¯å¾„\n$remote_addr             #å®¢æˆ·ç«¯åœ°å€\n$remote_port             #å®¢æˆ·ç«¯ç«¯å£\n$remote_user             #ç”¨äºHTTPåŸºç¡€è®¤è¯æœåŠ¡çš„ç”¨æˆ·å\n$request                 #ä»£è¡¨å®¢æˆ·ç«¯çš„è¯·æ±‚åœ°å€\n$request_body            #å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸»ä½“ï¼šæ­¤å˜é‡å¯åœ¨locationä¸­ä½¿ç”¨ï¼Œå°†è¯·æ±‚ä¸»ä½“é€šè¿‡proxy_passï¼Œfastcgi_passï¼Œuwsgi_passå’Œscgi_passä¼ é€’ç»™ä¸‹ä¸€çº§çš„ä»£ç†æœåŠ¡å™¨\n$request_body_file       #å°†å®¢æˆ·ç«¯è¯·æ±‚ä¸»ä½“ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚æ–‡ä»¶å¤„ç†ç»“æŸåï¼Œæ­¤æ–‡ä»¶éœ€åˆ é™¤ã€‚å¦‚æœéœ€è¦ä¹‹ä¸€å¼€å¯æ­¤åŠŸèƒ½ï¼Œéœ€è¦è®¾ç½®client_body_in_file_onlyã€‚å¦‚æœå°†æ¬¡æ–‡ä»¶ä¼  é€’ç»™åç«¯çš„ä»£ç†æœåŠ¡å™¨ï¼Œéœ€è¦ç¦ç”¨request bodyï¼Œå³è®¾ç½®proxy_pass_request_body offï¼Œfastcgi_pass_request_body offï¼Œuwsgi_pass_request_body offï¼Œor scgi_pass_request_body off\n$request_completion      #å¦‚æœè¯·æ±‚æˆåŠŸï¼Œå€¼ä¸º\"OK\"ï¼Œå¦‚æœè¯·æ±‚æœªå®Œæˆæˆ–è€…è¯·æ±‚ä¸æ˜¯ä¸€ä¸ªèŒƒå›´è¯·æ±‚çš„æœ€åä¸€éƒ¨åˆ†ï¼Œåˆ™ä¸ºç©º\n$request_filename        #å½“å‰è¿æ¥è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”±rootæˆ–aliasæŒ‡ä»¤ä¸URIè¯·æ±‚ç”Ÿæˆ\n$request_length          #è¯·æ±‚çš„é•¿åº¦ (åŒ…æ‹¬è¯·æ±‚çš„åœ°å€ï¼Œhttpè¯·æ±‚å¤´å’Œè¯·æ±‚ä¸»ä½“)\n$request_method          #HTTPè¯·æ±‚æ–¹æ³•ï¼Œé€šå¸¸ä¸º\"GET\"æˆ–\"POST\"\n$request_time            #å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ä½¿ç”¨çš„æ—¶é—´,å•ä½ä¸ºç§’ï¼Œç²¾åº¦æ¯«ç§’ï¼› ä»è¯»å…¥å®¢æˆ·ç«¯çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹ï¼Œç›´åˆ°æŠŠæœ€åä¸€ä¸ªå­—ç¬¦å‘é€ç»™å®¢æˆ·ç«¯åè¿›è¡Œæ—¥å¿—å†™å…¥ä¸ºæ­¢ã€‚\n$request_uri             #è¿™ä¸ªå˜é‡ç­‰äºåŒ…å«ä¸€äº›å®¢æˆ·ç«¯è¯·æ±‚å‚æ•°çš„åŸå§‹URIï¼Œå®ƒæ— æ³•ä¿®æ”¹ï¼Œè¯·æŸ¥çœ‹$uriæ›´æ”¹æˆ–é‡å†™URIï¼Œä¸åŒ…å«ä¸»æœºåï¼Œä¾‹å¦‚ï¼š\"/cnphp/test.php?arg=freemouse\"\n$scheme                  #è¯·æ±‚ä½¿ç”¨çš„Webåè®®ï¼Œ\"http\" æˆ– \"https\"\n$server_addr             #æœåŠ¡å™¨ç«¯åœ°å€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸ºäº†é¿å…è®¿é—®linuxç³»ç»Ÿå†…æ ¸ï¼Œåº”å°†ipåœ°å€æå‰è®¾ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­\n$server_name             #æœåŠ¡å™¨å\n$server_port             #æœåŠ¡å™¨ç«¯å£\n$server_protocol         #æœåŠ¡å™¨çš„HTTPç‰ˆæœ¬ï¼Œé€šå¸¸ä¸º \"HTTP/1.0\" æˆ– \"HTTP/1.1\"\n$status                  #HTTPå“åº”ä»£ç \n$time_iso8601            #æœåŠ¡å™¨æ—¶é—´çš„ISO 8610æ ¼å¼\n$time_local              #æœåŠ¡å™¨æ—¶é—´ï¼ˆLOG Format æ ¼å¼ï¼‰\n$cookie_NAME             #å®¢æˆ·ç«¯è¯·æ±‚Headerå¤´ä¸­çš„cookieå˜é‡ï¼Œå‰ç¼€\"$cookie_\"åŠ ä¸Šcookieåç§°çš„å˜é‡ï¼Œè¯¥å˜é‡çš„å€¼å³ä¸ºcookieåç§°çš„å€¼\n$http_NAME               #åŒ¹é…ä»»æ„è¯·æ±‚å¤´å­—æ®µï¼›å˜é‡åä¸­çš„ååŠéƒ¨åˆ†NAMEå¯ä»¥æ›¿æ¢æˆä»»æ„è¯·æ±‚å¤´å­—æ®µï¼Œå¦‚åœ¨é…ç½®æ–‡ä»¶ä¸­éœ€è¦è·å–httpè¯·æ±‚å¤´ï¼š\"Accept-Language\"ï¼Œ$http_accept_languageå³å¯\n$http_cookieã€€ã€€ã€€ã€€ã€€ã€€ã€€ #è¯·æ±‚çš„æ‰€æœ‰cookie\n$http_host               #è¯·æ±‚åœ°å€ï¼Œå³æµè§ˆå™¨ä¸­ä½ è¾“å…¥çš„åœ°å€ï¼ˆIPæˆ–åŸŸåï¼‰\n$http_referer            #urlè·³è½¬æ¥æº,ç”¨æ¥è®°å½•ä»é‚£ä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„\n$http_user_agent         #ç”¨æˆ·ç»ˆç«¯æµè§ˆå™¨ç­‰ä¿¡æ¯\n$http_x_forwarded_for    #å®¢æˆ·ç«¯çš„IPå’Œä»£ç†æœåŠ¡å™¨çš„IPï¼Œä»¥é€—å·éš”å¼€ï¼›å¯ä¼ªé€ \n$http_x_forwarded_proto  #è¯·æ±‚çš„åè®®\n$sent_http_NAME          #å¯ä»¥è®¾ç½®ä»»æ„httpå“åº”å¤´å­—æ®µï¼›å˜é‡åä¸­çš„ååŠéƒ¨åˆ†NAMEå¯ä»¥æ›¿æ¢æˆä»»æ„å“åº”å¤´å­—æ®µï¼Œå¦‚éœ€è¦è®¾ç½®å“åº”å¤´Content-lengthï¼Œ$sent_http_content_lengthå³å¯\n$sent_http_cache_control\n$sent_http_connection\n$sent_http_content_type\n$sent_http_keep_alive\n$sent_http_last_modified\n$sent_http_location\n```\n\n## https\n\nåœ¨nginxä¸­ä½¿ç”¨httpsï¼Œé…ç½®ä¸€ä¸‹è¯ä¹¦å°±å¯ä»¥\n\n```nginx\n# HTTPS server\n#\nserver {\n  listen       443 ssl;\n  server_name  localhost;\n\n  ssl_certificate      cert.pem; # å…¬é’¥ï¼Œä¼šè¢«å‘é€ç»™æ¯ä¸€ä¸ªè®¿é—®çš„å®¢æˆ·ç«¯\n  ssl_certificate_key  cert.key; # ç§é’¥ï¼Œç”¨æ¥è§£å¯†å®¢æˆ·ç«¯å‘é€çš„æ•°æ®\n\n  ssl_session_cache    shared:SSL:1m; # è®¾ç½®ssl/tlsä¼šè¯ç¼“å­˜çš„ç±»å‹å’Œå¤§å°\n  ssl_session_timeout  5m; # sslå‚æ•°çš„è¿‡æœŸæ—¶é—´\n\n  ssl_ciphers  HIGH:!aNULL:!MD5; # é€‰æ‹©åŠ å¯†å¥—ä»¶\n  ssl_prefer_server_ciphers  on; # onä»£è¡¨ è®¾ç½®åå•†åŠ å¯†ç®—æ³•æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨æœåŠ¡ç«¯çš„åŠ å¯†å¥—ä»¶ï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯çš„åŠ å¯†å¥—ä»¶\n\n  location / {\n    root   html;\n    index  index.html index.htm;\n  }\n}\n```\n\n## HTTP/2\n\nåœ¨httpsçš„ä¾‹å­ä¸Šï¼Œåšä¸€å¤„æ”¹åŠ¨ï¼šåœ¨listenååŠ ä¸Šhttp2å³å¯\n\n```nginx\nlisten       443 ssl http2;\n```\n\n## Nginxæ—¥å¿—åˆ‡å‰²\n\nå¦‚æœæŠŠæ‰€æœ‰æ—¥å¿—éƒ½æ‰“åœ¨ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå½“æ–‡ä»¶å¾ˆå¤§æ—¶ï¼Œè¯»å†™å°±ä¼šå˜æ…¢ä»è€Œå½±å“nginxæ€§èƒ½\n\nå¯ä»¥é€šè¿‡shellè„šæœ¬æŒ‰å¤§å°æ¥åˆ‡å‰²æ—¥å¿—æ–‡ä»¶ã€‚\n\nåœ¨nginxä¸­ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§æ—¶é—´æ¥åˆ‡å‰²æ–‡ä»¶\n\n```nginx\nif ($time_iso8601 ~ \"^(\\d{4})-(\\d{2})-(\\d{2})\") {\n  set $year $1;\n  set $month $2;\n  set $day $3;\n}\naccess_log /var/log/nginx/$year-$month-$dayaccess.log json;\n```\n\nä¸Šä¾‹æ˜¯æŠŠåŒä¸€å¤©çš„æ—¥å¿—æ”¾åœ¨ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ã€‚","tags":["Server","Nginx","Web"],"categories":["Server","Nginx"]},{"title":"JavaScriptæ²™ç®±","url":"/posts/72bec40a.html","content":"\n> **æ²™ç›’**ï¼ˆè‹±è¯­ï¼šsandboxï¼Œåˆè¯‘ä¸º**æ²™ç®±**ï¼‰æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œä¸ºè¿è¡Œä¸­çš„ç¨‹åºæä¾›çš„éš”ç¦»ç¯å¢ƒã€‚é€šå¸¸æ˜¯ä½œä¸ºä¸€äº›æ¥æºä¸å¯ä¿¡ã€å…·ç ´ååŠ›æˆ–æ— æ³•åˆ¤å®šç¨‹åºæ„å›¾çš„ç¨‹åºæä¾›å®éªŒä¹‹ç”¨ **by wikipedia**\n\nç®€å•çš„è¯´ï¼Œæ²™ç®±å°±æ˜¯ä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒã€‚æ²™ç®±é‡Œå¤–äº’ä¸å½±å“ã€‚\n\n## Nodeçš„æ²™ç®±ç¯å¢ƒ\n\n`nodejs`å†…ç½®äº†ä¸€ä¸ª`vm`æ¨¡å—ï¼Œä»–å¯ä»¥è®©æˆ‘ä»¬ç›´æ¥åœ¨ V8 è™šæ‹Ÿæœºä¸Šä¸‹æ–‡ä¸­ç¼–è¯‘å’Œè¿è¡Œä»£ç ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š\n\n```javascript\nconst vm = require(\"vm\");\n\n// åˆ›å»ºéœ€è¦è¿è¡Œçš„è„šæœ¬\nconst script = new vm.Script(\"a + b\");\n\n// åˆ›å»ºä¸Šä¸‹æ–‡ context\nconst context = vm.createContext({a: 1, b: 2});\n\n// åœ¨ä¸Šä¸‹æ–‡contextä¸‹è¿è¡Œè„šæœ¬\nconst result = script.runInContext(context)\n\nconsole.log(result) // è¾“å‡ºï¼š3\n\n\n// æˆ–è€…ç›´æ¥\nvm.runInContext(\"a + b\", context) // è¾“å‡ºï¼š3\n```\n\nåœ¨nodejsä¸­åˆ›å»ºä¸€ä¸ªæ²™ç®±è¿˜æ˜¯æŒºå®¹æ˜“çš„ã€‚\n\nä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ`vm`æ¨¡å—å¹¶éç»å¯¹å®‰å…¨ï¼Œç”±å®ƒåˆ›å»ºçš„çš„æ²™ç®±å†…éƒ¨é€šè¿‡ä¸€äº›æ‰‹æ®µè¿˜æ˜¯å¯ä»¥è®¿é—®åˆ°å¤–éƒ¨ç¯å¢ƒçš„ã€‚æ‰€ä»¥`nodejs`å®˜æ–¹æ–‡æ¡£æ˜ç¡®æ ‡æ³¨ï¼š **`vm` æ¨¡å—ä¸æ˜¯å®‰å…¨çš„æœºåˆ¶ã€‚ ä¸è¦ä½¿ç”¨å®ƒæ¥è¿è¡Œä¸å—ä¿¡ä»»çš„ä»£ç **ã€‚\n\nä¹Ÿæœ‰ä¸€äº›ç¤¾åŒºæ¨¡å—ï¼š\næ¯”å¦‚`vm2`ï¼Œå®ƒå†…éƒ¨ä½¿ç”¨`vm`æ¨¡å—ï¼Œå¹¶ä¸”ä½¿ç”¨Proxyæ¥é˜»æ­¢æ²™ç®±è„šæœ¬é€ƒé€¸ã€‚\n\n[`Safeify`](https://www.npmjs.com/package/safeify)æ˜¯ä¸€ä¸ªåŸºäº`vm2`çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå®ƒåˆ›å»ºäº†ä¸ªè¿›ç¨‹æ± ï¼ŒæŠŠä»£ç æ”¾å…¥è¿›ç¨‹æ± ä¸­æ‰§è¡Œã€‚è¿›ç¨‹é—´é€šè¿‡IPCé€šè®¯ã€‚\n\n## æµè§ˆå™¨çš„æ²™ç®±ç¯å¢ƒ\n\næµè§ˆå™¨ç¯å¢ƒæ²¡æœ‰`vm`è¿™ä¸ªAPIï¼Œå®ç°å°†æœ‰æ‰€ä¸åŒã€‚\n\n### eval\n\nè¿™æ˜¯ä¸€ä¸ªä»¤äººè¯Ÿç—…çš„apiï¼Œ`eval(\"window\")`æ˜¯èƒ½å¤Ÿè®¿é—®åˆ°`window`å¯¹è±¡çš„ï¼Œæ‰€ä»¥å®ƒå¹¶ä¸èƒ½éš”ç¦»ã€‚\n\n### new Function()\n\n```javascript\nfn = new Function(...args, 'functionBody');\n```\n\n`new Function`ä¾ç„¶èƒ½å¤Ÿè®¿é—®åˆ°å…¨å±€ä½œç”¨åŸŸã€‚\n\n### with\n\nè¿™ä¸ªå†·é—¨çš„APIï¼Œå¯èƒ½å¤§å¤šæ•°JSå¼€å‘è€…éƒ½æ²¡å¬è¯´è¿‡\n\n```javascript\nfunction createRuntimeSandbox(src) {\n  src = 'with (context) {' + src + '}'\n  return new Function('context', src)\n}\n\nconst func = createRuntimeSandbox(\"console.log(window)\")\nfunc({window: 123}) // è¾“å‡º 123\n```\n\n`with`å…³é”®å­—ä¼šä½¿ç”¨`in`è¿ç®—ç¬¦æ¥åˆ¤æ–­æ˜¯å¦åœ¨`context`ä¸­ã€‚å¦‚æœcontextå­˜åœ¨å°±å»contextå–ã€‚åä¹‹å»å…¨å±€ä½œç”¨åŸŸä¸­å–ã€‚\n\n### Proxy\n\nåœ¨withçš„ä¾‹å­ä¸Šåšäº›æ”¹åŠ¨\n\n```javascript\nfunction createRuntimeSandbox(src) {\n  src = 'with (context) {' + src + '}'\n  const func = new Function('context', src)\n  return context => {\n    const fakeContext = {}\n    const proxy = new Proxy(fakeContext, {\n      has() { return true }, // ç¡®ä¿ xx in fakeContext æ°¸è¿œä¸ºtrueï¼Œä¸å»å…¨å±€ä½œç”¨åŸŸæ‰¾\n      get(target, param) {\n        return target[param] || context[param]\n      }\n    })\n    return func(proxy)\n  }\n}\n\nconst func = createRuntimeSandbox(\"console.log(name);name='hello';console.log(name)\")\n\nconst context = { name: \"zxffan\", console }\nfunc(context) // è¾“å‡ºï¼šzxffan hello\nconsole.log(context.name) // è¾“å‡ºï¼šzxffan\n```\n\nä¸Šä¾‹ä½¿ç”¨äº†`proxy`ï¼Œå°†ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰åšäº†ä»£ç†ã€‚åœ¨æ²™ç®±é‡Œä¿®æ”¹contextçš„nameå±æ€§ä¸ä¼šå½±å“åˆ°æ²™ç®±å¤–ã€‚\n\nè¿˜æœ‰ä¸ªé—®é¢˜ï¼Œ`proxy`åªä»£ç†äº†`context`ï¼Œå¦‚æœcontexté‡ŒåˆåŒ…å«å¯¹è±¡ï¼Œé‚£ä¹ˆåœ¨æ²™ç®±é‡Œæ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚å†™ä¸€ä¸ªé€šç”¨çš„ä»£ç†æ–¹æ³•æ¥è§£å†³\n\n```javascript\nfunction createProxySandbox(context, handler = {}) {\n  const fakeContext = {};\n  return new Proxy(fakeContext, Object.assign({\n    get(target, param) {\n      return Reflect.get(target, param) || Reflect.get(context, param)\n    }\n  }, handler))\n}\n\nfunction createRuntimeSandbox(src) {\n  src = 'with (context) {' + src + '}'\n  const func = new Function('context', src)\n  return context => {\n    const proxy = createProxySandbox(context, { has() { return true } })\n    return func(proxy)\n  }\n}\n\n\nconst func = createRuntimeSandbox(\"window.aa='zxffan';console.log(window.aa)\")\n\nconst fakeWindow = createProxySandbox(window)\nfakeWindow.window = fakeWindow\n\nfunc(fakeWindow) // è¾“å‡ºï¼šzxffan\nconsole.log(window.aa) // è¾“å‡ºï¼šundefined\n```\n\nè¿™æ ·ä½¿ç”¨ï¼Œå¯ä»¥è‡ªå®šä¹‰éœ€è¦æš´éœ²ç»™æ²™ç®±çš„å…¨å±€å¯¹è±¡ã€‚\n\n`createProxySandbox`ç›¸å½“äºä»£ç†æä¾›çš„å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªä»£ç†åçš„å¯¹è±¡ã€‚å¯¹ä»£ç†åçš„å¯¹è±¡çš„ä¿®æ”¹ä¸å½±å“åŸå¯¹è±¡ï¼Œè¿™æœ¬èº«å°±æ˜¯ä¸€ä¸ª**æ•°æ®æ²™ç®±**ã€‚\n\n`createRuntimeSandbox`æä¾›äº†ä¸€ä¸ªæŒ‡å®šä¸Šä¸‹æ–‡çš„JSæ‰§è¡Œç¯å¢ƒã€‚è¯¥ç¯å¢ƒç¡®ä¿ä¸ä¼šç›´æ¥è®¿é—®å’Œä¿®æ”¹æ²™ç®±å¤–çš„ä½œç”¨åŸŸçš„æ•°æ®ï¼Œè¿™ç›¸å½“äºä¸€ä¸ª**è¿è¡Œæ—¶æ²™ç®±**ã€‚\n\n## æ€»ç»“\n\næ²™ç®±çš„ä½œç”¨æ˜¯éš”ç¦»ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¿è¯ä¸ä¼šé€ æˆJSæ±¡æŸ“ã€‚\n\nåº”ç”¨åœºæ™¯ï¼š\n\n- åœ¨å¾®å‰ç«¯åœºæ™¯ä¸‹ï¼Œå¯ä»¥åˆ©ç”¨æ²™ç®±æ¥ä¿è¯å„ä¸ªå¾®åº”ç”¨ä¹‹é—´ä»¥åŠå¾®åº”ç”¨å’Œä¸»åº”ç”¨ä¹‹é—´ä¸ä¼šé€ æˆJSæ±¡æŸ“ã€‚\n- é€šå¸¸ä¹Ÿå¯ä»¥å°†ä¸å—ä¿¡ï¼ˆå­˜åœ¨å®‰å…¨éšæ‚£ï¼‰çš„ä»£ç æ”¾åœ¨æ²™ç®±ä¸­è¿è¡Œï¼Œä»¥é˜»æ­¢å…¶ç ´åä¸»ç¨‹åºã€‚\n\næ¨èä½¿ç”¨`with`ã€`new Function`ä»¥åŠ`Proxy`æ„æˆçš„æ²™ç®±å®ç°\n\n","tags":["javascript"],"categories":["JavaScript"]},{"title":"äº‘è®¡ç®—çš„å‘å±•","url":"/posts/8aa364dc.html","content":"\næœ€è¿‘å¯¹`serverless`æèµ·äº†å…´è¶£ï¼Œäºæ˜¯æç¬”å†™å‡ ç¯‡å­¦ä¹ ç¬”è®°ã€‚\n\n## æ—¶ä»£å†ç¨‹\n\næ€»çš„æ¥è¯´äº‘è®¡ç®—çš„å‘å±•ç»è¿‡äº†**ç‰©ç†æœºæ—¶ä»£**ã€**è™šæ‹Ÿæœºæ—¶ä»£**ã€**å®¹å™¨æ—¶ä»£**ä»¥åŠå½“ä¸‹çš„**Serverless**ã€‚\n\n### ç‰©ç†æœºæ—¶ä»£\n\nå‘å¸ƒä¸€ä¸ªç½‘ç«™ï¼Œéœ€è¦è´­ä¹°ä¸€å°ç‰©ç†æœºæœåŠ¡å™¨ã€‚ç„¶åæ‰‹åŠ¨å®‰è£…æ“ä½œç³»ç»Ÿå’Œè®¸å¤šçš„è½¯ä»¶ç¯å¢ƒã€‚é‚£æ—¶æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ—¶ï¼ŒæœåŠ¡è¿ç§»æ˜¯ä¸€ä»¶å¾ˆç—›è‹¦çš„äº‹ã€‚è€Œä¸”è´­ä¹°ç‰©ç†æœºçš„æˆæœ¬ä¹Ÿå¾ˆé«˜ã€‚\n\n### è™šæ‹Ÿæœºæ—¶ä»£\n\n2001å¹´åè™šæ‹ŸåŒ–æŠ€æœ¯æ—¥æ¸æˆç†Ÿã€‚**è™šæ‹ŸåŒ–æŠ€æœ¯**å¯ä»¥å°†ä¸€å°**ç‰©ç†æœº**åˆ†å‰²æˆå¤šå°**è™šæ‹Ÿæœº**ä¾›å¤šåç”¨æˆ·ä½¿ç”¨ï¼Œå……åˆ†åˆ©ç”¨ç¡¬ä»¶èµ„æºã€‚æ¯”å¦‚é˜¿é‡Œäº‘çš„ECSï¼Œæˆ‘ä¸Šå­¦çš„æ—¶å€™å°±ä¹°äº†ä¸€å°è™šæ‹Ÿæœºã€‚ç›¸å¯¹äºç›´æ¥è´­ä¹°ä¸€å°ç‰©ç†æœºï¼Œè™šæ‹Ÿæœºå¯ä»¥å¤§å¤§é™ä½æˆæœ¬ã€‚\n\n### å®¹å™¨æ—¶ä»£\n\nå®¹å™¨æŠ€æœ¯ã€‚ç›®å‰æ¯”è¾ƒæµè¡Œçš„å¦‚`Docker`ã€‚åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…å®¹å™¨ï¼Œå°†è½¯ä»¶æœåŠ¡éƒ¨ç½²åœ¨å®¹å™¨ä¸­ã€‚è¿™æ ·ï¼Œåœ¨åšè¿ç§»çš„æ—¶å€™å¯ä»¥å°†å®¹å™¨å†…çš„è½¯ä»¶ç¯å¢ƒæ‰“åŒ…æˆé•œåƒã€‚å†æ‹·è´åˆ°å¦ä¸€å°æœåŠ¡å™¨ä¸Šéƒ¨ç½²ã€‚å¤§å¤§é™ä½äº†è¿ç§»æˆæœ¬\n\næœ‰äº†å®¹å™¨ï¼Œåœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„å°±ä¸å†æ˜¯åº”ç”¨è€Œæ˜¯ä¸€ä¸ªä¸ªå®¹å™¨ã€‚å½“å®¹å™¨å¤šäº†å°±æ¯”è¾ƒéš¾ä»¥ç®¡ç†ã€‚`Kubernetes(K8S)`æ˜¯Googleçš„ç”¨æ¥è¿›è¡Œå®¹å™¨ç¼–æ’çš„å¼€æºå·¥å…·ã€‚æœ‰äº†K8Så°±å¯ä»¥å®ç°ç½‘ç«™çš„è‡ªåŠ¨å¼¹æ€§ä¼¸ç¼©ã€‚ä½†æ˜¯è¿™ä¸€åˆ‡çš„é…ç½®éƒ½éœ€è¦ä¸“ä¸šçš„è¿ç»´çŸ¥è¯†ã€‚\n\n### Serverless\n\n`Serverless`æ˜¯æŒ‡æ„å»ºå’Œè¿è¡Œä¸éœ€è¦æœåŠ¡å™¨ç®¡ç†çš„ä¸€ç§æ¨¡å¼ã€‚ç›®å‰Serverlesså®ç°æ–¹å¼ä¸»è¦æ˜¯åŸºäº`FaaS`å’Œ`BaaS`\n\n- FaaS(å‡½æ•°å³æœåŠ¡)ï¼šå°†åº”ç”¨åˆ‡å‰²æˆä¸€ä¸ªä¸ªç‹¬ç«‹çš„å‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°æœ‰è‡ªå·±ç‹¬ç«‹çš„ä¸šåŠ¡ï¼Œè¿™äº›å‡½æ•°å†ç»„æˆå¤æ‚çš„åº”ç”¨ã€‚\n- Baas(åç«¯å³æœåŠ¡)ï¼šå°†æ•°æ®åº“ã€æ–‡ä»¶å­˜å‚¨ç­‰åç«¯èƒ½åŠ›å°è£…æˆæœåŠ¡ï¼Œå¹¶ä»¥æ¥å£çš„å½¢å¼æä¾›ã€‚åœ¨FaaSä¸­å¯ä»¥è°ƒç”¨å„ç§åç«¯æœåŠ¡ã€‚\n\nä¸€ä¸ªServerlessçš„ç½‘ç«™æ¶æ„å¤§è‡´å¦‚ä¸‹ï¼š\n\n![serverlessæ¶æ„](../../images/serverless/serverlessç½‘ç«™æ¶æ„.png)\n\n## XaaS\n\næ¢³ç†ä¸€äº›ä¸€äº›åè¯ï¼šIaaSã€PaaSã€SaaSã€FaaSä¸BaaS\n\n- IaaSï¼ˆåŸºç¡€è®¾æ–½å³æœåŠ¡ï¼‰ï¼šè™šæ‹ŸåŒ–æŠ€æœ¯æˆç†Ÿåï¼Œå‡ºç°ä¼—å¤šäº‘å‚å•†å’Œäº§å“ã€‚ä¾‹å¦‚AWS çš„ EC2ã€é˜¿é‡Œäº‘ ECSã€‚è¿™äº›éƒ½å±äºIaaSã€‚\n- PaaSï¼ˆå¹³å°å³æœåŠ¡ï¼‰ï¼šéšç€ä¸šåŠ¡å½¢æ€å‘å±•ï¼Œäº‘å‚å•†å‘ç°å¯ä»¥æŠ½è±¡å‡ºä¸€äº›é€šç”¨çš„å¹³å°ï¼Œæ¯”å¦‚ä¸­é—´ä»¶ã€æ•°æ®åº“ç­‰ï¼Œäºæ˜¯å°±æŠŠè¿™äº›åŠŸèƒ½åšæˆæœåŠ¡ï¼Œä¹Ÿæ”¾åœ¨äº‘ä¸Šå»å–ï¼Œè¿™äº›å±äºPaaSã€‚\n- SaaSï¼ˆè½¯ä»¶å³æœåŠ¡ï¼‰ï¼šSaaSå¾ˆå¸¸è§ã€‚æ¯”å¦‚é‚®ç®±æœåŠ¡ï¼Œè½¯ä»¶ç¯å¢ƒéƒ¨ç½²åœ¨å¼€å‘è€…æœåŠ¡å™¨ä¸­ã€‚ç”¨æˆ·åªéœ€è¦ä¸€ä¸ªè´¦æˆ·ï¼Œæ‰“å¼€æµè§ˆå™¨å³å¯ä½¿ç”¨ã€‚\n- FaaSä¸BaaSä¸Šæ–‡è®¨è®ºè¿‡ã€‚\n\n## Serverless\n\n### ä»€ä¹ˆæ˜¯Serverless\n\n**å¹¿ä¹‰çš„ Serverless** æ˜¯æŒ‡ï¼š**æ„å»ºå’Œè¿è¡Œè½¯ä»¶æ—¶ä¸éœ€è¦å…³å¿ƒæœåŠ¡å™¨çš„ä¸€ç§æ¶æ„æ€æƒ³**\n\n**ç‹­ä¹‰çš„ Serverless** æ˜¯ **FaaS å’Œ BaaS çš„ç»„åˆ**ï¼Œè¿™æ˜¯å½“å‰ä¸»æµçš„å®ç°\n\nServerlessçš„ä¸»è¦ç‰¹ç‚¹\n\n- æœåŠ¡æ— å…³ï¼šå¼€å‘è€…æ— éœ€å…³å¿ƒæœåŠ¡å™¨èµ„æºï¼ˆé…ç½®ï¼Œç£ç›˜å¤§å°ç­‰ï¼‰ï¼Œåªéœ€è¦æä¾›ä¸€ä»½ä»£ç ã€‚\n- å¼¹æ€§ä¼¸ç¼©ï¼šèµ„æºçš„åˆ†é…å®Œå…¨ç”±äº‘æœåŠ¡æ¥è®¡ç®—ï¼Œä¼šæ ¹æ®è¯·æ±‚é‡è‡ªåŠ¨è°ƒæ•´èµ„æºå ç”¨\n- æŒ‰é‡è®¡è´¹ï¼šåœ¨ Serverless æ¶æ„ä¸­ï¼Œè®¡è´¹æ–¹å¼æŒ‰å®é™…ä½¿ç”¨é‡è®¡è´¹ï¼ˆæ¯”å¦‚å‡½æ•°è°ƒç”¨æ¬¡æ•°ã€è¿è¡Œæ—¶é•¿ï¼‰ã€‚\n\n###  PaaSã€Kubernetes ã€äº‘åŸç”Ÿç­‰æŠ€æœ¯æ˜¯ä¸æ˜¯ Serverlessï¼Ÿ\n\næŒ‰ç…§`Serverless`çš„ç‰¹ç‚¹æ¥çœ‹ï¼Œå®ƒä»¬éƒ½ä¸æ˜¯\n`PaaS`æ˜¯æŒ‰ç…§æœåŠ¡æ”¶è´¹å¹¶éæŒ‰é‡æ”¶è´¹\n`K8S`æ˜¯ä¸€ç§å®¹å™¨ç¼–æ’æŠ€æœ¯ï¼Œå®ƒå¯ä»¥å®ç°å¼¹æ€§ä¼¸ç¼©ã€‚ä½†æ˜¯å…·ä½“çš„ç¼–æ’è§„åˆ™éœ€è¦ä¸“ä¸šè¿ç»´æ¥è®¾ç½®ï¼Œä¸ç¬¦åˆæœåŠ¡æ— å…³\näº‘åŸç”Ÿæ˜¯æŒ‡åŸç”Ÿä¸ºäº‘è®¾è®¡çš„ä¸€ç§æ¶æ„æ¨¡å¼ã€‚`Serverless`æ˜¯äº‘åŸç”Ÿçš„ä¸€ç§å®ç°ï¼Œ`K8S`æ˜¯å¦ä¸€ç§å®ç°\n\n## Serverlessçš„ç¼ºç‚¹\n\n1. ä¾èµ–ç¬¬ä¸‰æ–¹ï¼šä½¿ç”¨`Serverless`å°±å¿…é¡»ä½¿ç”¨äº‘å‚å•†æä¾›çš„`Serverless`çš„äº§å“ã€‚è¿™æ ·å°±ä¸äº‘å‚å•†ç»‘å®šã€‚ä¸€æ—¦é€‰å®šä¸€ä¸ªäº‘å‚å•†ï¼Œåœ¨æƒ³åšè¿ç§»å°±ååˆ†å¤æ‚ã€‚è¿™æ˜¯å› ä¸ºå½“å‰å›½å†…`Serverless`å®ç°æ²¡æœ‰ä¸€ä¸ªå…¬å…±çš„æ ‡å‡†ã€‚\n2. åº•å±‚ç¡¬ä»¶å¤šæ ·æ€§ï¼šåŒä¸€ä¸ªäº‘å‡½æ•°å¯èƒ½è¿è¡Œåœ¨ä¸åŒç¡¬ä»¶èµ„æºä¸‹ã€‚å¦‚æœä½ çš„æœåŠ¡ä¾èµ–äºå…·ä½“çš„ç¡¬ä»¶èµ„æºï¼ˆæ¯”å¦‚åªæœ‰æŸä¸ªCPU/GPUèƒ½å¤Ÿä½¿ç”¨ï¼‰ï¼Œè¿™å°±è¦äº‘å‚å•†æä¾›ç›¸åº”æœåŠ¡ã€‚\n3. æ€§èƒ½ç“¶é¢ˆï¼š`Serverless`çš„äº‘å‡½æ•°ä¸æ˜¯ä¸€ç›´è¿è¡Œçš„ï¼Œåªæœ‰éœ€è¦çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œã€‚æ¯æ¬¡æ‰§è¡Œå‰ä¼šåˆå§‹åŒ–å‡½æ•°æ‰§è¡Œç¯å¢ƒï¼Œè¿™éœ€è¦ä¸€å®šæ—¶é—´ã€‚è€Œè¿™ä¸ªæ—¶é—´éœ€è¦äº‘å‚å•†è‡ªå·±å»ä¼˜åŒ–ã€‚\n4. é€šä¿¡æ•ˆç‡ä½ï¼š`Serverful`ä¸­å‡½æ•°æ‰å‡½æ•°éƒ½æ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œçš„ã€‚è€Œ`Serverless`ä¸­å‡½æ•°éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¹‹é—´è°ƒç”¨ï¼ˆHTTPï¼ŒRPCï¼‰è‚¯å®šæ•ˆç‡æ²¡æœ‰å†…å­˜é«˜\n5. å¼€å‘è°ƒè¯•å¤æ‚ï¼šç›®å‰`Serverless`è¿˜å¤„äºå‘å±•é˜¶æ®µï¼Œå„å‚å•†çš„æ ‡å‡†ä¸ä¸€ï¼Œå¼€å‘å’Œè°ƒè¯•å·¥å…·ä¸å®Œå–„ã€‚\n\n","tags":["Serverless","äº‘è®¡ç®—"],"categories":["Serverles"]},{"title":"jså®ç°é€‰ä¸­ä¸å¤åˆ¶ç²˜è´´","url":"/posts/82fa4d6c.html","content":"\n## é€‰ä¸­\n\n### ä¸¤ä¸ªå¯¹è±¡\n\n1. [selection]( https://developer.mozilla.org/zh-CN/docs/Web/API/Selection )\n2. [range]( https://developer.mozilla.org/zh-CN/docs/Web/API/Range )\n\n> Selectionå¯¹è±¡æ‰€å¯¹åº”çš„æ˜¯ç”¨æˆ·æ‰€é€‰æ‹©çš„ [`ranges`](https://developer.mozilla.org/zh-CN/docs/Web/API/Range) ï¼ˆåŒºåŸŸï¼‰ï¼Œä¿—ç§°æ‹–è“ by MDN\n\nFirefoxä¸­å¯ä»¥é€šè¿‡æŒ‰ä½ctrlåŒæ—¶é€‰ä¸­ä¸åŒåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸéƒ½å¯¹åº”ä¸€ä¸ªrangeå¯¹è±¡ï¼ˆchromeç¦ç”¨äº†è¯¥åŠŸèƒ½ï¼Œå³åªèƒ½é€‰ä¸­ä¸€ä¸ªåŒºåŸŸï¼‰ã€‚selectionä»£è¡¨æ–‡æœ¬é€‰åŒºï¼ˆç½‘é¡µä¸­å¯é€‰æ‹©çš„åŒºåŸŸï¼‰ï¼Œæ‰€ä»¥selectionåŒ…å«è‹¥å¹²ä¸ªrangeã€‚å¯ä»¥é€šè¿‡`selection.getRangeAt(index)`æ¥è·å–é€‰åŒº(range)ã€‚indexæ˜¯è¦è·å–çš„rangeçš„ç´¢å¼•ï¼ˆchromeä¸­åªèƒ½æ˜¯0ï¼‰ã€‚\n\n### åº”ç”¨ï¼šè·å–é€‰ä¸­æ–‡æœ¬\n\n```javascript\nconst selection = window.getSelection()\nselection.toString()\n```\n\n### åº”ç”¨ï¼šå–æ¶ˆé€‰ä¸­\n\n```javascript\nconst selection = window.getSelection()\nselection.removeAllRanges()\n```\n\n### åº”ç”¨ï¼šå…¨é€‰æŸä¸ªèŠ‚ç‚¹çš„å†…å®¹\n\n```javascript\nconst range = document.createRange() // åˆ›å»ºrangeå¯¹è±¡\nconst node = document.getElementById('dom') // è·å–è¦å…¨é€‰çš„domèŠ‚ç‚¹\nrange.selectNodeContents(node)\n\nconst selection = window.getSelection()\nselection.removeAllRanges() // æ¸…ç©ºå…¶å®ƒé€‰ä¸­å†…å®¹\nselection.addRange(range) // æ·»åŠ é€‰ä¸­åŒºåŸŸ\n```\n\n### åº”ç”¨ï¼šæˆªå–ä½ç½®é€‰ä¸­\n\n```javascript\nconst range = document.createRange()\nconst node = document.getElementById('dom') // è·å–è¦æˆªå–çš„domèŠ‚ç‚¹\n\n/* \n * * å¦‚æœèµ·å§‹èŠ‚ç‚¹ç±»å‹æ˜¯ Textï¼Œ Comment, or CDATASectionä¹‹ä¸€, é‚£ä¹ˆ startOffsetæŒ‡çš„æ˜¯ä»èµ·å§‹èŠ‚ç‚¹ç®—èµ·å­—ç¬¦çš„åç§»é‡ã€‚ \n * * å¯¹äºå…¶ä»– Node ç±»å‹èŠ‚ç‚¹ï¼Œ startOffset æ˜¯æŒ‡ä»èµ·å§‹ç»“ç‚¹å¼€å§‹ç®—èµ·å­èŠ‚ç‚¹çš„åç§»é‡ã€‚\n */\nconst [startOffset, endOffset] = [1, 7]\nrange.setStart(node, startOffset)\nrange.setEnd(node, endOffset)\n\nconst selection = window.getSelection()\nselection.removeAllRanges() // æ¸…ç©ºå…¶å®ƒé€‰ä¸­å†…å®¹\nselection.addRange(range) // æ·»åŠ é€‰ä¸­åŒºåŸŸ\n```\n\n## å¤åˆ¶ä¸ç²˜è´´\n\nå¤åˆ¶ä¸ç²˜è´´çš„å®ç°éœ€è¦ä½¿ç”¨[Clipboard](https://developer.mozilla.org/zh-CN/docs/Web/API/Clipboard)ï¼Œå®ƒé¦–å…ˆä¼šé€šçŸ¥ç”¨æˆ·æ˜¯å¦èµ‹äºˆè¯»å†™å‰ªè´´æ¿æƒé™ã€‚\n\nç³»ç»Ÿå‰ªè´´æ¿æš´éœ²åœ¨å…¨å±€å±æ€§`navigator.clipboard`ä¹‹ä¸‹\n\nå®ƒæœ‰å››ä¸ªAPIï¼Œä»–ä»¬éƒ½æ˜¯è¿”å›Promise\n\n- read() ä»å‰ªè´´æ¿è¯»å–æ•°æ®ï¼ˆæ¯”å¦‚å›¾ç‰‡ï¼‰ã€‚\n- readText() ä»å‰ªè´´æ¿è¯»å–æ–‡æœ¬\n- write() å†™æ•°æ®\n- writeText() å†™æ–‡æœ¬\n\n> æ³¨æ„ï¼š\n> `document.execCommand`å·²ç»è¢«åºŸå¼ƒäº†ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚\n> `clipboard`åœ¨**éHTTPSç¯å¢ƒ**ä¸‹ä¸å¯ç”¨\n","tags":["javascript"],"categories":["JavaScript"]},{"title":"å‡½æ•°å¼ç¼–ç¨‹","url":"/posts/1690d21b.html","content":"\n## å‡½æ•°å¼ç¼–ç¨‹è¦ç´ \n\n- å£°æ˜å¼\n- çº¯å‡½æ•°\n- ä¸å¯å˜æ€§\n\n### å£°æ˜å¼\n\n**å£°æ˜å¼**æ˜¯å°†ç¨‹åºçš„æè¿°ä¸æ±‚å€¼åˆ†ç¦»å¼€æ¥çš„ã€‚å®ƒå…³æ³¨äºå¦‚ä½•ç”¨å„ç§è¡¨è¾¾å¼æ¥æè¿°ç¨‹åºé€»è¾‘ã€‚ä¸å…¶ç›¸å¯¹çš„æ˜¯**å‘½ä»¤å¼**ã€‚\n\n```javascript\n// demoï¼šæ±‚æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ï¼ˆæ•°å€¼ç±»å‹ï¼‰çš„å¹³æ–¹\nconst arr = [1, 2, 3, 4, 5]\n\n// å‘½ä»¤å¼\nfor (let i = 0; i < arr.length; i++) {\n  arr[i] = Math.pow(arr[i], 2);\n}\n\n// å£°æ˜å¼\nconst square = num => Math.pow(num, 2)\narr.map(square)\n\n```\n\n### çº¯å‡½æ•°\n\nçº¯å‡½æ•°è¦æ±‚ï¼š\n\n- å¯¹äºåŒä¸€ç»„è¾“å…¥å¿…ç„¶æœ‰ç›¸åŒçš„è¾“å‡ºã€‚\n- ä¸ä¾èµ–äºå¤–éƒ¨ç¯å¢ƒä¹Ÿä¸æ”¹å˜å¤–éƒ¨ç¯å¢ƒã€‚\n\n```javascript\n\n// å…·æœ‰å‰¯ä½œç”¨çš„å‡½æ•°\nlet count1 = 0;\nfunction increment1() {\n  return ++count1 // å¼•ç”¨äº†å…¨å±€å˜é‡\n}\n\n// çº¯å‡½æ•°\nfunction increment2(count) {\n  return count + 1\n}\n\n```\n\nå®é™…ä¸Šï¼Œçº¯å‡½æ•°æ˜¯å¾ˆéš¾å¾—çš„ã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯å°½å¯èƒ½åœ°æŠŠå…·æœ‰å‰¯ä½œç”¨åœ°éƒ¨åˆ†æŠ½ç¦»å‡ºæ¥ï¼Œè®©é€»è¾‘ç»“æ„æ›´åŠ æ¸…æ™°ã€‚\n\n### ä¸å¯å˜æ•°æ®\n\nå¤„ç†æ•°æ®æ—¶ä¸è¦ä¿®æ”¹åŸæ•°æ®ï¼Œå°½å¯èƒ½å¾—åŸºäºåŸæ•°æ®æ¥æ„é€ æ–°æ•°æ®ã€‚\n\n```javascript\n\n// demo: æ•°ç»„æ’åº\n\nconst arr = [4, 6, 2, 3, 8, 5];\n\n// mutable\nfunction sort1() {\n  return arr.sort()\n}\n\n// immutable\nfunction sort1() {\n  return [].concat(arr).sort()\n}\n\n```\n\n> å‡½æ•°å¼ç¼–ç¨‹é¼“åŠ±å°†å¤æ‚çš„ä»»åŠ¡åˆ†æˆæˆä¸€ä¸ªä¸ªçº¯å‡½æ•°ã€‚å†å°†è¿™äº›å‡½æ•°è¿›è¡Œç»„åˆã€‚è¿™æ ·ä½¿å¾—ä»»åŠ¡æµæ›´åŠ æ¸…æ™°ï¼Œæ›´æ˜“äºç»´æŠ¤\n\n## æŸ¯é‡Œ(curry)åŒ–\n\næŸ¯é‡ŒåŒ–å¯ä»¥ç¼©å‡å‡½æ•°å‚æ•°ã€‚\n\nä¸€ä¸ªå‘èŠ‚ç‚¹æ’å…¥å‚æ•°çš„demo\n\n```javascript\nfunction insertText(dom, text) {\n  document.querySelector(dom).innerText = text\n}\n\ninsertText(\"container\", \"hello world\")\n```\n\nç»è¿‡æŸ¯é‡ŒåŒ–åå°±å˜æˆäº†\n\n```javascript\nfunction insertText(dom) {\n  return function (text) {\n    document.querySelector(dom).innerText = text\n  }\n}\n\nconst insertToContainer = insertText(\"container\")\ninsertToContainer(\"hello world\")\n```\n\n## ç»„åˆ\n\nç»„åˆæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚å°†ä¸€ä¸ªå¤æ‚çš„é€»è¾‘æ‹†åˆ†æˆä¸€ä¸ªä¸ªå‡½æ•°åï¼Œéœ€è¦å°†è¿™äº›å‡½æ•°ç»„åˆèµ·æ¥æ‰§è¡Œã€‚\n\n### é“¾å¼ç»„åˆ\n\nåœ¨ç»„åˆçº¯å‡½æ•°æ—¶ï¼Œé€šè¿‡é“¾å¼çš„æ–¹å¼æ¯”è¾ƒå®¹æ˜“è¢«ç†è§£ï¼Œä¾‹å¦‚:\n\n```javascript\narr.filter(/** .. **/)\n   .map(/** .. **/)\n   .reduce(/** .. **/)\n   //...\n```\n\nçœŸçš„æ‰“ç®—ä½¿ç”¨é“¾å¼ç»„åˆæ³•çš„è¯ï¼Œæ¨è`lodash.js`è¿™ä¸ªå·¥å…·åº“ã€‚\n\n```javascript\nvar users = [\n  { 'user': 'barney',  'age': 36 },\n  { 'user': 'fred',    'age': 40 },\n  { 'user': 'pebbles', 'age': 1 }\n];\n \nvar youngest = _\n  .chain(users)\n  .sortBy('age')\n  .map(function(o) {\n    return o.user + ' is ' + o.age;\n  })\n  .head()\n  .value();\n// => 'pebbles is 1'\n```\n\n### ç®¡é“ç»„åˆ\n\næ–¹æ³•é“¾çš„ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯ï¼šå®ƒä¸æ–¹æ³•æ‰€å±çš„å¯¹è±¡ç´§ç´§åœ°è€¦åˆåœ¨ä¸€èµ·ï¼Œé™åˆ¶é“¾ä¸­å¯ä»¥ä½¿ç”¨çš„æ–¹æ³•æ•°é‡ï¼Œä¹Ÿå°±é™åˆ¶äº†ä»£ç çš„è¡¨ç°åŠ›ã€‚\n\n```javascript\n\nfunction first() {}\n\nfunction getName() {}\n\nfunction reverse() {}\n\nfunction sort() {}\n\nconst task = pipe(first, getName, reverse, sort) // pipe ç”¨æ¥ç»„åˆå‡½æ•°\n\ntask(params)\n\n```\n\n`pipe`å°†å‡½æ•°ç»„åˆèµ·æ¥ã€‚`task`æ‰§è¡Œåï¼Œå°†`params`ä¼ é€’ç»™`first`ã€‚`first`å‡½æ•°æ‰§è¡Œå®Œæˆåå†å°†ç»“æœä¼ é€’ç»™`getName`ã€‚ç”±æ­¤ç±»æ¨ï¼Œå°†æ‰€æœ‰å‡½æ•°ç»„åˆèµ·æ¥ï¼Œå½¢å¦‚ä¸€æ¡ç®¡é“ã€‚\n\nä¸Šä¾‹ä¸­ï¼Œ`pipe`çš„å‚æ•°éƒ½æ˜¯å‡½æ•°å£°æ˜ï¼Œå¦‚æœæŸä¸ªå‡½æ•°éœ€è¦æå‰ä¼ å…¥ä¸€äº›å‚æ•°å¯ä»¥ä½¿ç”¨**æŸ¯é‡ŒåŒ–**\n\nè¿™é‡Œæ¨èä¸€ä¸‹`Ramda.js`è¿™ä¸ªå·¥å…·åº“ã€‚å®ƒä¸`lodash`ç›¸ä¼¼ä½†å´åˆä¸ç›¸åŒï¼Œå®ƒå†…ç½®`pipe`æ–¹æ³•ä»¥åŠå…¶å®ƒç»„åˆæ–¹æ³•ã€‚\n\n## ç®¡é“ç»„åˆå¤„ç†ç¨‹åºæµ\n\nä¸Šé¢çš„ä¾‹å­ï¼Œéƒ½æ²¡æœ‰æ¶‰åŠåˆ° é€»è¾‘åˆ†æ”¯ã€‚åœ¨å‘½ä»¤å¼ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°±ä¼šå†™`if/else`ï¼Œè€Œå‡½æ•°å¼ç¼–ç¨‹æ˜¯ä¸å»ºè®®ç›´æ¥ä½¿ç”¨`if/else`çš„ã€‚\n\nåœ¨`Ramda.js`ä¸­`pipe`æ˜¯ç”¨æ¥ç»„åˆå‡½æ•°çš„ï¼Œå«åš**ç»„åˆå™¨**ã€‚é™¤äº†`pipe`è¿˜æœ‰å…¶å®ƒç»„åˆå™¨\n\n### R.compose\n\n`compose`ä¸`pipe`åŠŸèƒ½ä¸€æ ·ï¼Œåªæ˜¯ç»„åˆçš„æ–¹å‘ç›¸åã€‚\n`R.compose(f1, f2, f3)`, ä»–ä¼šå…ˆæ‰§è¡Œf3ï¼Œç„¶åæ‰§è¡Œf2ï¼Œæœ€åf1\n\n### R.tap\n\n`compose`å’Œ`pipe`ç»„åˆå‡½æ•°æ—¶ï¼Œå­˜åœ¨å‚æ•°ä¼ é€’ã€‚æ¯ä¸ªå‡½æ•°çš„è¿”å›å€¼éƒ½ç»™ä¼ ç»™ç®¡é“ä¸­çš„ä¸‹ä¸€ä¸ªå‡½æ•°ã€‚\nå¦‚æœä¸­é—´æœ‰ä¸€ä¸ªå‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼ˆæ¯”å¦‚ æ—¥å¿—åŸ‹ç‚¹ï¼‰å°±æ— æ³•æ„æˆç®¡é“ã€‚\n\n`tap`èƒ½å¤Ÿå°†ä¸€ä¸ªæ— è¿”å›å€¼çš„å‡½æ•°æ’å…¥ç®¡é“ä¸­ï¼Œå› ä¸ºtapä¼šå°†å‚æ•°åŸæ ·è¿”å›ã€‚\n\n```javascript\nconst debug = R.tap(debugLog);\nconst cleanInput = R.compose(normalize, debug, trim);\nconst isValidSsn = R.compose(debug, checkLengthSsn, debug, cleanInput);\n```\n\n### alternation\n\n```javascript\nconst alt = function (...fns) {\n  return function (val) {\n    let result\n    for (let fn of fns) {\n      result = fn(val);\n      if (result) break;\n    }\n    return result\n  }\n}\n```\n\n`alt(fn1, fn2, fn3, ...)`ï¼Œå¦‚æœfn1çš„è¿”å›å€¼ä¸æ˜¯`false`ã€`null`å’Œ`undefined`åˆ™è¿”å›fn1çš„è¿”å›å€¼ã€‚å¦åˆ™æ‰§è¡Œfn2çš„ï¼Œå†åˆ¤æ–­å…¶è¿”å›å€¼ã€‚\næ‰€ä»¥`alt`èƒ½å¤Ÿæä¾›ç®€å•çš„é€»è¾‘æ¡ä»¶åˆ¤æ–­\n\n### sequence\n\nå®ç°å¦‚ä¸‹\n\n```javascript\nconst seq = function(...funcs) {\n  const funcs = Array.prototype.slice.call(arguments);\n  return function (val) {\n    funcs.forEach(function (fn) {\n      fn(val);\n    });    \n  };\n};\n```\n\n`seq(fn1, fn2, fn3, ...)`, ä¼šé¡ºåºæ‰§è¡Œæ‰€æœ‰å‡½æ•°ï¼Œè¿™äº›å‡½æ•°åœ¨ç®¡é“ä¸­æ—¶å¹³è¡Œçš„ï¼Œå®ƒä»¬éƒ½æ¥å—ç®¡é“ä¸­ä¸Šä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ä½œä¸ºå‚æ•°ã€‚é€šå¸¸æ”¾åœ¨ç®¡é“çš„æœ«å°¾ã€‚\n\n### fork-join\n\n```javascript\nfunction fork (join, ...fns) {\n  return function (val) {\n    let result = []\n    fns.forEach(fn => result.push(fn(val)));\n    join(...result)\n  }\n}\n```\n\n`fork`ç›¸å¯¹äº`seq`å¢åŠ äº†ä¸€æ­¥ï¼Œå°†æ‰€æœ‰å‡½æ•°çš„æ‰§è¡Œç»“æœä¼ é€’ç»™`join`ï¼Œå†åšä¸€æ¬¡å¤„ç†ã€‚\n\næœªå®Œ...\n\n## Functor\n\n**`functor`æ˜¯å®ç°äº†`map`å‡½æ•°å¹¶éµå®ˆä¸€äº›ç‰¹å®šè§„åˆ™çš„å®¹å™¨ç±»å‹ã€‚**æ¯”å¦‚ä¸‹é¢è¿™ä¸ª`Just`å®¹å™¨\n\n```typescript\nclass Just<T> {\n  private _value: T;\n  constructor(value: T) {\n    this._value = value\n  }\n  map(fn: (...args: any[]) => any): Wrapper {\n    return Just.of(fn(this._value))\n  }\n\tstatic of<U>(value: U) {\n    return new Monad(value);\n  }\n}\n```\n\nè¿™ä¸ª**Justå®¹å™¨**å°±æ˜¯ä¸€ä¸ª**Functorï¼ˆå‡½å­ï¼‰**\n\n- å°è£…äº†valueï¼Œå®¹å™¨å¤–æ— æ³•ä¿®æ”¹`_value`ã€‚ä»è€Œä¿æŠ¤æ•°æ®\n- æä¾›mapå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†åŸå§‹å€¼ä¼ ç»™å‚æ•°å‡½æ•°ï¼Œå¹¶å°†ç»“æœå†æ¬¡å°è£…ã€‚mapå‡½æ•°å°†æ–¹ä¾¿é“¾å¼è°ƒç”¨\n- ofæ˜¯ä¸€ä¸ªé™æ€å‡½æ•°ã€‚ç”¨äºå°è£…æ•°æ®\n\nä»æœ¬è´¨ä¸Šè®²ï¼ŒFunctor åªæ˜¯ä¸€ä¸ªå¯ä»¥å°†å‡½æ•°åº”ç”¨åˆ°å®ƒåŒ…è£¹çš„å€¼ä¸Šï¼Œå¹¶å°†ç»“æœå†åŒ…è£¹èµ·æ¥çš„**æ•°æ®ç»“æ„**ã€‚\n\n## Maybe\n\n`Maybe`ä¹Ÿå±äº`Functor`ï¼Œå®ƒåœ¨`Just`ä¸Šå¢åŠ äº†é”™è¯¯å¤„ç†\n\n```typescript\nclass Maybe<T> {\n  private _value: T;\n  constructor(value: T) {\n    this._value = value\n  }\n  isNothing(): boolean {\n    return this._value === undefined || this._value === null\n  }\n  map(fn: (...args: any[]) => any) {\n    return this.isNothing() ? Maybe.of(null) : Maybe.of(fn(this._value))\n  }\n\tstatic of<U>(value: U) {\n    return new Monad(value);\n  }\n}\n```\n\nå½“å‡ºç°nullï¼Œundefinedæ—¶ï¼Œè°ƒç”¨ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\n\n```typescript\nMaybe.of(null).map((a) => a + 3)\n// Maybe { _value: null }\n```\n\n## Monad\n\nä½¿ç”¨`functor`å¯èƒ½ä¼šé€ æˆåµŒå¥—å°è£…çš„æƒ…å†µ\n\n```typescript\nconst num = Maybe.of(Maybe.of(3))\nnum.map(v => v + 1) // error\n```\n\nè¿™æ—¶ï¼Œmapçš„å‚æ•°å‡½æ•°æ¥å—çš„å‚æ•°`v`å®é™…ä¸Šè¿˜æ˜¯ä¸€ä¸ª`Functor`ï¼Œå®ƒå¹¶ä¸èƒ½ç›´æ¥å‚ä¸è¿ç®—ã€‚\n\n`Monad`å¯ä»¥ä½¿`functor`æ‰å¹³åŒ–ã€‚\n\n- æä¾›ä¸€ä¸ª`join`å‡½æ•°ï¼Œå…¶æ„æ˜¯å°†æ‰€æœ‰åµŒå¥—çš„`Functor`åˆå¹¶æˆä¸€ä¸ªã€‚\n- identityç”¨æ¥è·å–åŸå§‹å€¼ï¼Œä¹‹å‰æ‰€æœ‰`this._value`æ›¿æ¢æˆ`this.identity()`\n\n```typescript\nclass Monad<T> {\n  private _value: T;\n  constructor(value: T) {\n    this._value = value;\n  }\n  isNothing(): boolean {\n    const value = this.identity()\n    return value === undefined || value === null;\n  }\n  join() {\n    if (this._value instanceof Monad) {\n      return this.isNothing() ? Monad.of(null) : this._value.join();\n    } else return this;\n  }\n  map(fn: (...args: any[]) => any) {\n    return this.isNothing() ? Monad.of(null) : Monad.of(fn(this.identity()));\n  }\n  static of<U>(value: U) {\n    return new Monad(value);\n  }\n  identity() {\n    return this.join()._value;\n  }\n}\n\nconst num = Monad.of(Monad.of(3));\nnum.map((v) => v + 1); // Monad {_value: 4}\n\n```\n\n## Applicative\n\nä¸Šé¢çš„ä¾‹å­éƒ½æ˜¯å°è£…æ•°æ®ã€‚å¦‚æœå‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ª`functor`ï¼Œå°±éœ€è¦æä¾›ä¸€ä¸ª`apply`æ–¹æ³•ã€‚\n\n```typescript\nclass Applicative<T> {\n  // ...\n  apply(container: Applicative<any>) {\n    return container.map(this._value)\n  }\n  // ...\n}\nconst plus3 = v => v + 3;\nApplicative.of(plus3).apply(Applicative.of(2)) // Applicative {_value: 5}\n```\n\n<hr/>\n\nç»“åˆä¸Šé¢çš„æ‰€æœ‰ä¾‹å­ï¼Œæ¢³ç†ä¸€ä¸‹code\n\n```typescript\nclass Monad<T> {\n  private _value: T;\n  constructor(value: T) {\n    this._value = value;\n  }\n  isNothing(): boolean {\n    return this._value === undefined || this._value === null;\n  }\n  join() {\n    if (this._value instanceof Monad) {\n      return this.isNothing() ? Monad.of(null) : this._value.join();\n    } else return this;\n  }\n  map(fn: (...args: any[]) => any) {\n    return this.isNothing() ? Monad.of(null) : Monad.of(fn(this.identity()));\n  }\n  apply(container: Monad<any>) {\n    console.log(this.identity())\n    return container.map(this.identity())\n  }\n  static of<U>(value: U) {\n    return new Monad(value);\n  }\n  private identity() {\n    return this.join()._value;\n  }\n}\n```\n\n","tags":["programing"],"categories":["Programing"]},{"title":"Webpack5","url":"/posts/46109b3a.html","content":"\n`Webpack5`æ­£å¼ç‰ˆè·`V4`å‘å¸ƒå·²ç»è¿‡å»2å¹´äº†ã€‚æ–°ç‰ˆåšäº†è®¸å¤šAPIå’Œåº•å±‚çš„æ”¹åŠ¨ï¼Œè¿™ä¼šå¯¼è‡´ä¸€äº›ç°æœ‰çš„`plugin`æˆ–è€…`loader`æ— æ³•åœ¨`V5`ç‰ˆæœ¬è¿è¡Œã€‚\n\nå…ˆè´´ä¸€ä¸‹[å®˜æ–¹æ–‡æ¡£](https://webpack.docschina.org/blog/2020-10-10-webpack-5-release/)\n\næœ¬æ–‡æ¢³ç†ä¸€äº›webpckæ‰€åšå‡ºçš„æ¯”è¾ƒé‡è¦çš„æ”¹åŠ¨\n\n- åŠŸèƒ½æ¸…é™¤\n- new URL\n- é•¿æœŸç¼“å­˜\n- æŒä¹…åŒ–ç¼“å­˜\n- tree-shaking\n- è”é‚¦æ¨¡å—\n\n## åŠŸèƒ½æ¸…é™¤\n\né¦–å…ˆï¼Œæ‰€æœ‰åœ¨`V4`æ ‡è®°ä¸ºåºŸå¼ƒçš„apiéƒ½è¢«ç§»é™¤ã€‚å‡çº§å‰å…ˆæ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†è¢«åºŸå¼ƒçš„APIï¼ˆçœ‹æ§åˆ¶å°æ˜¯å¦æœ‰è­¦å‘Šï¼‰\n\n`V5`å–æ¶ˆé»˜è®¤`nodejs`çš„`polyfill`\nåœ¨`V4`ä¸­å¯ä»¥ä½¿ç”¨ä¸€éƒ¨åˆ†`nodejs`çš„APIï¼ˆä¾‹å¦‚:`crypto`æ¨¡å—ï¼‰ã€‚åœ¨`V5`ä¸­ä¸ä¼šå¯¹è¿™äº›APIè¿›è¡Œ`polyfill`ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨`polyfill`\n\nåŸå› ï¼šå®˜æ–¹è®¤ä¸ºåœ¨ç»å¤§æ•°æƒ…å†µä¸‹è¿™äº›`polyfill`éƒ½æ˜¯ä¸å¿…è¦çš„ï¼Œè€Œä¸”å®ƒå¢å¤§äº†`bundle`çš„ä½“ç§¯\n\n### Crypto\n\nå½“ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š\n\n```typescript\nimport CryptoJS from \"crypto-js\";\nconst md5Password = CryptoJS.MD5(\"123123\");\nconsole.log(md5Password);\n```\n\nwepack5ä¼šè‡ªåŠ¨æŠ¥é”™\n\n![node-polyfill](../../images/framework/node-polyfill.jpg)\n\næ ¹æ®æç¤ºæ“ä½œå³å¯ã€‚\n\n### process\n\nnodejsçš„`process`æ¨¡å—æ— æ³•ç›´æ¥ä½¿ç”¨ã€‚\n\nä½¿ç”¨`process`æ˜¯ï¼Œwebpack5ä¼šæŠ¥é”™ï¼Œæç¤ºå¼•å…¥`process`æ¨¡å—çš„`polyfill`ã€‚\n\nå¦‚æœä½¿ç”¨`process.env.NODE_ENV`åˆ™ä¸ä¼šæŠ¥é”™ï¼Œå› ä¸ºwebpackåœ¨è§£æè¿‡ç¨‹ä¸­å°†å…¶å€¼æ›¿æ¢æˆå¯¹åº”`mode`çš„å€¼\nå¯ä»¥ä½¿ç”¨ `DefinePlugin` æˆ– `EnvironmentPlugin` åœ¨é…ç½®ä¸­å®šä¹‰è¿™äº›å˜é‡ã€‚\n\n### å…¶å®ƒæ¨¡å—\n\npathæ¨¡å—éœ€è¦æ‰‹åŠ¨`polyfill`\nurlæ¨¡å—å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚\n\n## new URL\n\n### å¼•å…¥èµ„æºæ–¹å¼\n\n`webpack5`å¯¹èµ„æºæ¨¡å—æä¾›äº†å†…ç½®æ”¯æŒ\n\n- `V4`ä¸­ä½¿ç”¨`import img from './picture.png`ï¼Œéœ€è¦åœ¨`module.rules`ä¸­åšç›¸åº”çš„é…ç½®\n- `V5`ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨`new URL('./picture.png', import.meta.url)`\n\n> import.meta.url æ˜¯å½“å‰æ–‡ä»¶çš„ file: url(ç±»ä¼¼äº__filename)\n> ä½¿ç”¨URLä¼šå‘ javascript æ³¨å…¥ä¸€ä¸ª DataURI\n\n### Worker\n\nç”±ä¸Šï¼Œå¯ä»¥è¿™ä¹ˆä½¿ç”¨workerï¼š`new Worker(new URL(\"./worker.js\", import.meta.url))`\n\nè¿™æ ·å°±å¯ä»¥æ›´å¥½åœ°åœ¨webpackä¸­ä½¿ç”¨ webWorker\n\n## é•¿æœŸç¼“å­˜\n\né•¿æœŸç¼“å­˜çš„ç›®çš„æ˜¯å½“åº”ç”¨é‡æ–°æ‰“åŒ…åå°½å¯èƒ½ä¿æŒæ–‡ä»¶ä¸å˜ï¼Œè¿™æ ·æµè§ˆå™¨å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ç¼“å­˜ã€‚\n\n### name id hash\n\nwebpackæœ€ç»ˆè¾“å‡ºçš„æ–‡ä»¶ç§°ä¸º`bundle`(ä¸`chunk`ä¸€ä¸€å¯¹åº”)ã€‚å…¶æ–‡ä»¶åå–å†³äºwebpackçš„é…ç½®ï¼Œä¾‹å¦‚`filename: [name].[id].[hash]`\n\n- name ä¸ºchunkçš„åç§°ï¼Œnameä¸€èˆ¬å–æ–‡ä»¶åæˆ–è€…æˆ–è€…å¼€å‘è€…é€šè¿‡é­”æ³•æ³¨é‡ŠæŒ‡å®š\n- id ä¸ºchunkIdï¼Œidæ˜¯webpackè‡ªåŠ¨ç”Ÿæˆçš„ï¼ˆ`V4`æ˜¯é€’å¢çš„ï¼‰\n- hash æœ‰åˆ†ä¸ºä¸‰ç§ `hash` `chunkhash` `contenthash`\n  \n> æœ‰æ—¶å€™nameç­‰äºidï¼Ÿ\n> å½“å¼€å‘è€…æ²¡æœ‰æŒ‡å®šnameæ—¶ï¼Œnameé»˜è®¤å–idçš„å€¼\n> ä¾‹å¦‚ï¼šå½“ä½¿ç”¨åŠ¨æ€importï¼Œå´æ²¡ç”¨é­”æ³•æ³¨é‡ŠæŒ‡å®šchunkName(/\\* webpackChunkName: \"home\" \\*/)\n\n### chunkId å’Œ moduleId ä¸ç¨³å®š\n\nåœ¨`V4`ä¸­ï¼Œ`chunkId`å’Œ`moduleId`é»˜è®¤éƒ½æ˜¯é€’å¢çš„ï¼š`1.js -> 2.js -> 3.js -> 4.js`\nä½†æ˜¯å½“åˆ é™¤`2.js`åï¼ŒåŸæ¥çš„`3`å°±å˜æˆ`2`ï¼Œå¯¼è‡´æ— æ³•ç›´æ¥ä½¿ç”¨ç¼“å­˜å†…å®¹ï¼Œè¿™ç§ç°è±¡ä¹Ÿè¢«ç§°ä¸º`chunkId`å’Œ`moduleId`ä¸ç¨³å®š\n\n### å¦‚ä½•ç¨³å®š\n\n`V4`ä¸­ä½¿ç”¨å¤–éƒ¨æ’ä»¶è§£å†³\n\n- chunkIdï¼šå¯å®‰è£…NamedChunksPluginæ’ä»¶æ¥ç¨³å®šchunkIdï¼›æˆ–è€…é…ç½®`optimization.chunkIds='named'`ã€‚\n- moduleIdï¼šå¯å®‰è£…HashedModuleIdsPluginæ’ä»¶è¦†ç›–é»˜è®¤çš„moduleIdè§„åˆ™ï¼Œä½¿ç”¨æ¨¡å—è·¯å¾„ç”Ÿæˆçš„hashä½œä¸ºmoduleIdã€‚\n\n`V5`ä¸­å¯¹`moduleId`å’Œ`chunkId`çš„ç”Ÿæˆç­–ç•¥è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä»è€Œæ— éœ€å¼•å…¥ä»»ä½•æ’ä»¶ï¼ˆç”Ÿäº§æ¨¡å¼ä¸‹æ˜¯é»˜è®¤å¯ç”¨çš„ï¼‰\n\n- moduleIdæ”¹ä¸ºæ ¹æ®ä¸Šä¸‹æ–‡æ¨¡å—è·¯å¾„è®¡ç®—\n- chunkIdæ ¹æ®chunkå†…å®¹è®¡ç®—\n\né…ç½®`optimization`\n\n```typescript\nexport default {\n\n  // ...\n\n  optimization: {\n    chunkIds: 'deterministic',\n    moduleIds: 'deterministic'\n  },\n\n  //...\n\n}\n```\n\n## æŒä¹…åŒ–ç¼“å­˜\n\næŒä¹…åŒ–ç¼“å­˜æ˜¯æŒ‡ç¬¬ä¸€æ¬¡**å…¨é‡æ„å»º**ï¼Œåˆ©ç”¨ç£ç›˜ç¼“å­˜\nåç»­æ„å»ºä¼š è¯»å–ç¼“å­˜ï¼Œç„¶åè¿›è¡Œæ ¡éªŒã€‚\n\n`V4`ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„æ‰‹æ®µï¼Œæ¯”å¦‚`cache-loader`ã€‚`babel-loader`ä¹Ÿæœ‰`cacheDirectory: true`ã€‚\n\n`V5`å†…ç½®äº†ç£ç›˜æŒä¹…åŒ–ç¼“å­˜åŠŸèƒ½\n\n```typescript\nexport default {\n  cache: {\n     // 1. å°†ç¼“å­˜ç±»å‹è®¾ç½®ä¸ºæ–‡ä»¶ç³»ç»Ÿ\n    type: 'filesystem', // é»˜è®¤æ˜¯memory\n    // 2. å°†ç¼“å­˜æ–‡ä»¶å¤¹å‘½åä¸º .temp_cache,\n    // é»˜è®¤è·¯å¾„æ˜¯ node_modules/.cache/webpack\n    cacheDirectory: path.resolve(__dirname, '.temp_cache')\n  },\n};\n```\n\n## Tree-Shakingä¼˜åŒ–\n\n`V5`çš„tree-shakingæ”¯æŒäº†æ›´å¤šçš„åœºæ™¯ã€‚\n\n### åµŒå¥—tree-shaking\n\n```javascript\n// inner.js\nexport const a = 1;\nexport const b = 2;\n\n// module.js\nexport * as inner from './inner';\n// æˆ– import * as inner from './inner'; export { inner };\n\n// user.js\nimport * as module from './module';\nconsole.log(module.inner.a);\n```\n\n`V5` èƒ½å°†bç»™tree-shakingæ‰ã€‚\n\n### å†…éƒ¨tree-shaking\n\n```javascript\nimport { something } from './something';\n\nfunction usingSomething() {\n  return something;\n}\n\nexport function test() {\n  return usingSomething();\n}\n```\n\nå½“è®¾ç½®`\"sideEffects\": false`æ—¶å¹¶ä¸” `test` å¯¼å‡ºæœªè¢«ä½¿ç”¨æ—¶ï¼Œä¸ä½†ä¼šåˆ é™¤`test`ä¹Ÿä¼šåˆ é™¤`something`ã€‚\n\n### Commonjs tree-shaking\n\n`V5`ç°åœ¨æ”¯æŒ`CommonJS`æ¨¡å—çš„tree-shaking\n\n## è”é‚¦æ¨¡å—ï¼ˆModule Federationï¼‰\n\n### æ¦‚è¿°\n\nè”é‚¦æ¨¡å—åº”è¯¥æ˜¯`V5`ä¸­è¾ƒä¸ºäº®çœ¼çš„æ›´æ–°ã€‚è”é‚¦æ¨¡å—æ˜¯ä¸ºäº†è§£å†³åº”ç”¨é—´æ¨¡å—å…±äº«çš„é—®é¢˜ã€‚\n\næ¢å¥è¯è¯´ï¼Œç°åœ¨æœ‰Aã€Bä¸¤ä¸ªåº”ç”¨ã€‚Aåº”ç”¨ä¸­å†™äº†ä¸€ä¸ªå·¥å…·åº“ï¼Œç°åœ¨Båº”ç”¨ä¹Ÿæƒ³ç”¨ã€‚æ€ä¹ˆåŠï¼Ÿ\né¦–å…ˆæŠŠå·¥å…·åº“æŠ½ç¦»å‡ºæ¥\n\n- å‘å¸ƒåˆ°npmã€‚åº”ç”¨installæ¥ä½¿ç”¨\n- æˆ–è€…æ‰“åŒ…æˆUMDï¼Œé€šè¿‡CDNç±»ä¼¼æ–¹å¼ä½¿ç”¨\n\nä½†æ˜¯è¿™ç§æ–¹å¼å°±ä¼šæœ‰ç‰ˆæœ¬é—®é¢˜ï¼ŒAï¼ŒBåº”ç”¨ä½¿ç”¨çš„ç‰ˆæœ¬å¯èƒ½ä¸ä¸€è‡´ã€‚\n\nè”é‚¦æ¨¡å—å¦‚ä½•åšçš„å‘¢ï¼Ÿ\n\nè”é‚¦æ¨¡å—å¯ä»¥è®©Båº”ç”¨ç›´æ¥ä½¿ç”¨Aåº”ç”¨çš„å·¥å…·åº“ã€‚\n\n### ä½¿ç”¨\n\nåœºæ™¯ï¼šä¸¤ä¸ªåº”ç”¨ï¼š`app1`å’Œ`app2`ã€‚åè€…éœ€è¦ä½¿ç”¨å‰è€…`utils.ts`\n\napp1é…ç½®å¦‚ä¸‹ï¼š\n\n```typescript\nimport { ModuleFederationPlugin } from \"webpack\"\n\nexport default {\n  // other webpack configs...\n  plugins: [\n    new ModuleFederationPlugin({\n      // name å½“å‰åº”ç”¨åç§°ï¼Œä¸èƒ½ä¸å…¶å®ƒåº”ç”¨å†²çª\n      name: \"app1\",\n      // UMDæ ‡å‡†å¯¼å‡ºï¼Œå’Œnameä¿æŒä¸€è‡´å³å¯\n      library: { type: \"var\", name: \"app_two\" },\n      // è¿œç¨‹åº”ç”¨æ—¶è¢«å…¶ä»–åº”ç”¨å¼•å…¥çš„jsæ–‡ä»¶åç§°\n      filename: \"remoteEntry.js\",\n      // exposes è¡¨ç¤ºå¯¼å‡ºçš„æ¨¡å—ï¼Œåªæœ‰åœ¨æ­¤ç”³æ˜çš„æ¨¡å—æ‰å¯ä»¥ä½œä¸ºè¿œç¨‹ä¾èµ–è¢«ä½¿ç”¨\n      exposes: {\n        utils: \"./src/libs/utils.ts\"\n      },\n      // sharedå¯ä»¥è®©è¿œç¨‹åŠ è½½çš„æ¨¡å—å¯¹åº”ä¾èµ–æ”¹ä¸ºä½¿ç”¨æœ¬åœ°é¡¹ç›®çš„ Reactæˆ–ReactDOMã€‚\n      shared: [\"vue\", \"vue-router\", \"vuex\"]\n    }),\n    new HtmlWebpackPlugin({\n      template: \"./public/index.html\",\n      chunks: [\"main\"]\n    })\n  ]\n};\n```\n\napp2é…ç½®å¦‚ä¸‹ï¼š\n\n```typescript\nimport { ModuleFederationPlugin } from \"webpack\"\n\nexport default {\n  // other webpack configs...\n  plugins: [\n    new ModuleFederationPlugin({\n      name: \"app2\",\n      // remotes å¯ä»¥å°†å…¶ä»–é¡¹ç›®çš„ name æ˜ å°„åˆ°å½“å‰é¡¹ç›®ä¸­\n      remotes: {\n        app1: \"app1\",\n      },\n      shared: [\"vue\", \"vue-router\", \"vuex\"]\n    }),\n    new HtmlWebpackPlugin({\n      template: \"./public/index.html\",\n      chunks: [\"main\"]\n    })\n  ]\n};\n```\n\nåœ¨app2ä¸­å¼•å…¥æ¨¡å—\n\n```html\n<head>\n  <!-- remoteEntry.js æ˜¯ filenameå­—æ®µçš„å€¼ -->\n  <script src=\"http://localhost:3001/remoteEntry.js\"></script>\n</head>\n```\n\nåœ¨app2ä¸­ä½¿ç”¨\n\n```typescript\nimport utils from 'app1/utils'\n```\n\n`import` çš„å†…å®¹æ˜¯**è¿œç¨‹åº”ç”¨å/æš´éœ²çš„æ¨¡å—å**ï¼Œå¯¹åº”webpacké…ç½®é‡Œé¢çš„nameå’Œexpose\n\n### ç©æ³•\n\n#### å¾®å‰ç«¯\n\nè”é‚¦æ¨¡å—ä¸ä»…æ”¯æŒå¯¼å‡ºåº”ç”¨çš„æŸä¸ªæ¨¡å—ï¼Œä¹Ÿæ”¯æŒexposeæ•´ä¸ªåº”ç”¨ï¼ˆexpose entryï¼‰\n\nå¯¹äº ä¸»ä»åº”ç”¨ï¼ˆä¸€ä¸ªä¸»åº”ç”¨ + å¤šä¸ªå­/å¾®åº”ç”¨ï¼‰è¿™ç§å¾®å‰ç«¯æ¶æ„\n\nå¾®åº”ç”¨æš´éœ²è‡ªå·±ï¼Œä¸»åº”ç”¨ç®¡ç†è·¯ç”±å¹¶ä½¿ç”¨å¾®åº”ç”¨\n\nå…¬å…±æ¨¡å—å†™åœ¨ä¸»åº”ç”¨ä¸­å¹¶æš´éœ²å‡ºæ¥ï¼Œå¾®åº”ç”¨å†ä½¿ç”¨\n\n#### å…¬å…±ç»„ä»¶æœåŠ¡\n\nå¦‚æœå›¢é˜Ÿå†…éƒ¨æœ‰ç»„ä»¶åº“æˆ–å·¥å…·åº“ã€‚ç°åœ¨ä¸ç”¨å‘å¸ƒåˆ°npmä¸Šã€‚å¯ä»¥å•ç‹¬éƒ¨ç½²ä¸€ä¸ª **å…¬å…±ç»„ä»¶æœåŠ¡**ã€‚\n\n![common_component_structure](../../images/framework/common_component_structure.jpg)","tags":["javascript","webpack","æ¶æ„"],"categories":["Webpack"]},{"title":"HTTPé¦–éƒ¨","url":"/posts/8b77beaa.html","content":"\nhttpé¦–éƒ¨åˆ†ä¸ºå››éƒ¨åˆ†â€”â€”**è¯·æ±‚è¡Œ/çŠ¶æ€è¡Œ**ã€**è¯·æ±‚/å“åº”é¦–éƒ¨å­—æ®µ**ã€**é€šç”¨é¦–éƒ¨å­—æ®µ**ã€**å®ä½“é¦–éƒ¨å­—æ®µ**ç»„æˆã€‚\n\næ¢³ç†ä¸€ä¸‹å½“ä½œå­—å…¸ï¼Œä»¥ä¾¿æ—¥åæŸ¥é˜…ã€‚\n\n## é¦–éƒ¨ä¸€è§ˆ\n\nHTTP/1.1 è§„èŒƒå®šä¹‰äº†å¦‚ä¸‹ 47 ç§é¦–éƒ¨å­—æ®µã€‚\n\n| é¦–éƒ¨å­—æ®µå      | è¯´æ˜                               |\n| --------------- | ---------------------------------- |\n| `Cache-Control` | ï¼ˆå¼ºï¼‰ç¼“å­˜æ§åˆ¶ï¼Œ1.0è¿˜æœ‰ä¸ª`Expired` |\n| `Connection`    |                                    |\n\n## é€šç”¨é¦–éƒ¨å­—æ®µ\n\né€šç”¨é¦–éƒ¨å­—æ®µæ˜¯æŒ‡ï¼Œè¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡åŒæ–¹éƒ½ä¼šä½¿ç”¨çš„é¦–éƒ¨ã€‚\n\n### Cache-Control\n\nåœºæ™¯ï¼šæµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡ç«¯è¿”å›èµ„æºå¹¶å†**response header**åŠ ä¸Š`Cache-Control: max-age=56700000`ã€‚æµè§ˆå™¨æ¥å—èµ„æºå¹¶æŠŠèµ„æºå’Œç›¸å…³å¤´ä¿¡æ¯ç¼“å­˜ä¸‹æ¥ã€‚å½“ç¬¬äºŒæ¬¡è¯·æ±‚æ”¹èµ„æºæ—¶ï¼Œå…ˆä»ç¼“å­˜ä¸­æ‰¾ï¼Œè®¡ç®—ç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶é—´å’Œ`max-age`æ¥åˆ¤æ–­æ˜¯å¦è¿‡æœŸã€‚è‹¥æ²¡è¿‡æœŸåˆ™å–ç¼“å­˜å†…å®¹ï¼Œè‹¥è¿‡æœŸå†å‘æœåŠ¡å™¨è¯·æ±‚ã€‚\n\nè¿™ä¸ªå­—æ®µæ—¢å¯ä»¥å‡ºç°åœ¨è¯·æ±‚å¤´ä¸­ä¹Ÿå¯ä»¥å‡ºç°åœ¨å“åº”å¤´ä¸­ï¼Œä½†å‚æ•°ä¸å¤ªä¸€æ ·\n\n#### è¯·æ±‚å¤´å‚æ•°\n\n| æŒ‡ä»¤              | å‚æ•° | è¯´æ˜                                                        |\n| ----------------- | ---- | ----------------------------------------------------------- |\n| `no-cache`        | æ—    | ä¸ä½¿ç”¨å¼ºç¼“å­˜ï¼Œå¼ºåˆ¶å‘æºæœåŠ¡å™¨å†æ¬¡éªŒè¯ï¼ˆä½¿ç”¨åå•†ç¼“å­˜ï¼‰        |\n| `no-store`        | æ—    | ä¸ä½¿ç”¨ç¼“å­˜                                                  |\n| `max-age=[ ç§’]`   | ç§’   | ç¼“å­˜çš„æ—¶é—´                                                  |\n| `max-stale=[ ç§’]` | ç§’   | å¯çœç•¥ï¼Œå¯å®¹å¿çš„æœ€å¤§è¿‡æœŸæ—¶é—´, æ¥å—age+staleæ—¶é—´å†…çš„ç¼“å­˜æ•°æ® |\n| `min-fresh=[ ç§’]` | ç§’   | `min-fresh=60`è¦æ±‚ï¼ˆç¼“å­˜ï¼‰æœåŠ¡å™¨è¿”å›ç¼“å­˜æ—¶é—´æœªè¿‡60sçš„èµ„æº   |\n| `no-transform`    | æ—    | ç¼“å­˜ä¸èƒ½æ”¹å˜å®ä½“ä¸»ä½“çš„åª’ä½“ç±»å‹                              |\n| `only-if-cached`  | æ—    | å®Œå…¨ä½¿ç”¨ç¼“å­˜ï¼Œè‹¥æœªå‘½ä¸­è¿”å›`504 Gateway Timeout`             |\n| `cache-extension` | æ—    | æ–°æŒ‡ä»¤æ ‡è®°ï¼ˆtokenï¼‰                                         |\n\n`cache-extension` tokenå¯ä»¥æ‰©å±•`Cache-Control`é¦–éƒ¨å­—æ®µå†…çš„æŒ‡ä»¤\nä¾‹å¦‚ï¼š`Cache-Control: private, community=\"UCI\"`\nå…¶ä¸­`community`å±äºæ‰©å±•æŒ‡ä»¤\n\n#### å“åº”å¤´å‚æ•°\n\n| æŒ‡ä»¤               | å‚æ•° | è¯´æ˜                                           |\n| ------------------ | ---- | ---------------------------------------------- |\n| `public`           | æ—    | å¯ä»¥è¢«ä»»æ„æ–¹ç¼“å­˜                               |\n| `private`          | æ—    | ä»…å¯è¢«ç‰¹å®šç”¨æˆ·ç¼“å­˜                             |\n| `no-cache`         | æ—    | å¯çœç•¥ï¼Œä½¿ç”¨ç¼“å­˜å‰å…ˆå‘æœåŠ¡ç«¯éªŒè¯æœ‰æ•ˆæ€§ï¼ˆåå•†ï¼‰ |\n| `no-store`         | æ—    | ä¸ç¼“å­˜è¯·æ±‚å’Œå“åº”å†…å®¹                           |\n| `no-transform`     | æ—    | ç¼“å­˜ä¸èƒ½æ”¹å˜å®ä½“ä¸»ä½“çš„åª’ä½“ç±»å‹                 |\n| `must-revalidate`  | æ—    | å¯ç¼“å­˜ä½†å¿…é¡»å†å‘æºæœåŠ¡å™¨è¿›è¡Œç¡®è®¤               |\n| `proxy-revalidate` | æ—    | è¦æ±‚ä¸­é—´ç¼“å­˜æœåŠ¡å™¨å¯¹ç¼“å­˜çš„å“åº”æœ‰æ•ˆæ€§å†è¿›è¡Œç¡®è®¤ |\n| `max-age=[ ç§’]`    | ç§’   | ç¼“å­˜çš„æ—¶é—´                                     |\n| `s-maxage=[ ç§’]`   | ç§’   | **å…¬å…±ç¼“å­˜æœåŠ¡å™¨**å“åº”çš„æœ€å¤§Ageå€¼              |\n| `cache-extension`  | æ—    | æ–°æŒ‡ä»¤æ ‡è®°ï¼ˆtokenï¼‰                            |\n\n### Connection\n\n`Connection`é¦–éƒ¨å­—æ®µæœ‰ä¸¤ä¸ªä½œç”¨\n\n1. æ§åˆ¶ä¸å†è½¬å‘ç»™ä»£ç†çš„é¦–éƒ¨å­—æ®µ\n2. ç®¡ç†æŒä¹…åŒ–è¿æ¥\n\n#### æ§åˆ¶ä¸å†è½¬å‘ç»™ä»£ç†çš„é¦–éƒ¨å­—æ®µ\n\nä½¿ç”¨æ–¹å¼ï¼šå†è¯·æ±‚å¤´åŠ ä¸Š`Connection: ä¸å†è½¬å‘çš„é¦–éƒ¨å­—æ®µå`\nå½“è¯·æ±‚å‘é€ç»™ä»£ç†æœåŠ¡å™¨æ—¶ï¼Œä»£ç†æœåŠ¡å™¨ä¼šå‰”é™¤æŒ‡å®šé¦–éƒ¨å­—æ®µï¼Œç„¶åå†è½¬å‘ç»™æºæœåŠ¡å™¨\n\n#### æŒä¹…åŒ–è¿æ¥\n\n`HTTP/1.1`é»˜è®¤å…¨éƒ¨éƒ½æ˜¯æŒä¹…åŒ–è¿æ¥ï¼Œå½“æœåŠ¡ç«¯æƒ³æ–­å¼€è¿æ¥æ—¶ï¼Œåœ¨å“åº”å¤´ä¸­æŒ‡å®šå­—æ®µ`Connection: close`\n\n`HTTP/1.0`é»˜è®¤æ˜¯éæŒä¹…åŒ–è¿æ¥ã€‚è‹¥æƒ³å»ºç«‹æŒä¹…åŒ–è¿æ¥ï¼Œè¯·æ±‚åŒæ–¹éƒ½è¦åœ¨å¤´ä¿¡æ¯ä¸­åŠ ä¸Š`Connection: Keep-Alive`\n\n### Date\n\n`Date`è¡¨ç¤ºåˆ›å»ºHTTPæŠ¥æ–‡çš„æ—¥æœŸå’Œæ—¶é—´ï¼Œæ ¼å¼å¦‚ï¼š`Date: Tue, 03 Jul 2012 04:40:59 GMT`\n\n### Pragma\n\n`Pragma: no-cache`ä¸`Cache-Control: no-cache`ä½œç”¨ç›¸åŒã€‚æ˜¯ä¸ºäº†å…¼å®¹`HTTP/1.0`è€Œå­˜åœ¨çš„\n\n### Trailer\n\nå“åº”é¦–éƒ¨ã€‚`Trailer`å­—æ®µæŒ‡æ˜åœ¨æŠ¥æ–‡ä¸»ä½“åè®°å½•äº†å“ªäº›é¦–éƒ¨å­—æ®µï¼Œå…è®¸å‘é€æ–¹åœ¨åˆ†å—å‘é€çš„æ¶ˆæ¯åé¢æ·»åŠ é¢å¤–çš„å…ƒä¿¡æ¯\nä½¿ç”¨ï¼š`Trailer: Expires`\n\n### Transfer-Encoding\n\næŒ‡å®šæŠ¥æ–‡ä¸»ä½“çš„ä¼ è¾“ç¼–ç ï¼ŒHTTP/1.1 çš„ä¼ è¾“ç¼–ç æ–¹å¼ä»…å¯¹åˆ†å—ä¼ è¾“ç¼–ç æœ‰æ•ˆã€‚\nä½¿ç”¨ï¼š`Transfer-Encoding: chunk`\n\n### Upgrade\n\nç”¨äºæ£€æµ‹èƒ½å¦å‡çº§é€šä¿¡åè®®ï¼Œå…¶å‚æ•°å€¼å¯ä»¥ç”¨æ¥æŒ‡å®šä¸€ä¸ªå®Œå…¨ä¸åŒçš„é€šä¿¡åè®®ã€‚\nä½¿ç”¨ï¼š\n\n```text\nUpgrade: TLS/1.0, HTTP/1.1\nConnection: Upgrade\n```\n\né€šå¸¸é…åˆ`Connection`ä½¿ç”¨ï¼Œå› ä¸º`Upgrade`å­—æ®µä¸éœ€è¦è½¬å‘\n\n### Via\n\nç”¨äºè¿½è¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„è¯·æ±‚å’Œå“åº”æŠ¥æ–‡çš„ä¼ è¾“è·¯å¾„\n\n![via_header](../../images/å›¾è§£HTTP/via_header.png)\n\n### Warning\n\nè¿”å›ä¸ç¼“å­˜ç›¸å…³çš„è­¦å‘Šï¼Œ\nä¾‹å¦‚ï¼š`Warning: 113 gw.hackr.jp:8080 \"Heuristic expiration\" Tue, 03`\næ ¼å¼ï¼š`Warning: [è­¦å‘Šç ][è­¦å‘Šçš„ä¸»æœº:ç«¯å£å·]â€œ[è­¦å‘Šå†…å®¹]â€([æ—¥æœŸæ—¶é—´])`\n\n## è¯·æ±‚é¦–éƒ¨å­—æ®µ\n\nè¯·æ±‚é¦–éƒ¨å­—æ®µæ˜¯ä»å®¢æˆ·ç«¯å¾€æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚æŠ¥æ–‡ä¸­æ‰€ä½¿ç”¨çš„å­—æ®µï¼Œç”¨äºè¡¥å……è¯·æ±‚çš„é™„åŠ ä¿¡æ¯ã€å®¢æˆ·ç«¯ä¿¡æ¯ã€å¯¹å“åº”å†…å®¹ç›¸å…³çš„ä¼˜å…ˆçº§ç­‰å†…å®¹ã€‚\n\n### Accept\n\nå‘ŠçŸ¥æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„åª’ä½“ç±»å‹æˆ–åª’ä½“ç±»å‹ä¼˜å…ˆé¡ºåºï¼Œç”¨qè¡¨ç¤ºæƒé‡ï¼ˆå–0~1ï¼Œé»˜è®¤1ï¼‰\nä½¿ç”¨ï¼š`Accept: text/html,application/xhtml+xml,application/xml;q=0.9`\n\nå¸¸è§åª’ä½“ç±»å‹:\n\n1. æ–‡æœ¬æ–‡ä»¶\n   - `text/html`ã€`text/plain`ã€`text/css`\n   - `application/xhtml+xml`ã€`application/xml`\n2. å›¾ç‰‡æ–‡ä»¶\n   - `image/jpeg`ã€`image/gif`ã€`image/png`\n3. è§†é¢‘æ–‡ä»¶\n   - `video/mpeg`ã€`video/quicktime`\n4. åº”ç”¨ç¨‹åºä½¿ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶\n   - `application/octet-stream`ã€`application/zip`\n\n### Accept-Charset\n\nå‘ŠçŸ¥æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„å­—ç¬¦é›†æˆ–å­—ç¬¦é›†çš„ä¼˜å…ˆé¡ºåºï¼Œä¹Ÿå¯ä»¥ç”¨qæ¥è¡¨ç¤ºæƒé‡\nä½¿ç”¨ï¼š`Accept-Charset: iso-8859-5, unicode-1-1;q=0.8`\n\n### Accept-Encoding\n\nå‘ŠçŸ¥æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„å†…å®¹ç¼–ç æˆ–å†…å®¹ç¼–ç ä¼˜å…ˆçº§é¡ºåº\nä½¿ç”¨: `Accept-Encoding: gzip, deflate`\n\nå¸¸è§ç¼–ç æ–¹å¼ï¼š\n\n- gzip\nç”±æ–‡ä»¶å‹ç¼©ç¨‹åº gzipï¼ˆGNU zipï¼‰ç”Ÿæˆçš„ç¼–ç æ ¼å¼ï¼ˆRFC1952ï¼‰ï¼Œé‡‡ç”¨ Lempel-Ziv ç®—æ³•ï¼ˆLZ77ï¼‰åŠ 32 ä½å¾ªç¯å†—ä½™æ ¡éªŒï¼ˆCyclic Redundancy Checkï¼Œé€šç§° CRCï¼‰ã€‚\n- compress\nç”± UNIX æ–‡ä»¶å‹ç¼©ç¨‹åº compress ç”Ÿæˆçš„ç¼–ç æ ¼å¼ï¼Œé‡‡ç”¨ Lempel-Ziv-Welch ç®—æ³•ï¼ˆLZWï¼‰ã€‚\n- deflate\nç»„åˆä½¿ç”¨ zlib æ ¼å¼ï¼ˆRFC1950ï¼‰åŠç”± deflate å‹ç¼©ç®—æ³•ï¼ˆRFC1951ï¼‰ç”Ÿæˆçš„ç¼–ç æ ¼å¼ã€‚\n- identity\nä¸æ‰§è¡Œå‹ç¼©æˆ–ä¸ä¼šå˜åŒ–çš„é»˜è®¤ç¼–ç æ ¼å¼\n\né‡‡ç”¨æƒé‡ q å€¼æ¥è¡¨ç¤ºç›¸å¯¹ä¼˜å…ˆçº§ï¼Œè¿™ç‚¹ä¸é¦–éƒ¨å­—æ®µ Accept ç›¸åŒã€‚å¦å¤–ï¼Œä¹Ÿå¯ä½¿ç”¨æ˜Ÿå·ï¼ˆ*ï¼‰ä½œä¸ºé€šé…ç¬¦ï¼ŒæŒ‡å®šä»»æ„çš„ç¼–ç æ ¼å¼ã€‚\n\n### Accept-Language\n\nå‘ŠçŸ¥æœåŠ¡å™¨å®¢æˆ·ç«¯æ‰€æœŸæœ›çš„è‡ªç„¶è¯­è¨€é›†ï¼ˆæŒ‡ä¸­æ–‡æˆ–è‹±æ–‡ç­‰ï¼‰ï¼Œä»¥åŠè‡ªç„¶è¯­è¨€é›†çš„ç›¸å¯¹ä¼˜å…ˆçº§ã€‚\n\nä½¿ç”¨ï¼š`Accept-Language: zh-cn,zh;q=0.7,en-us,en;q=0.3`\n\n### Authorization\n\nå‘ŠçŸ¥æœåŠ¡å™¨å®¢æˆ·ç«¯çš„è®¤è¯ä¿¡æ¯ã€‚\nå½“å®¢æˆ·ç«¯æœªæºå¸¦è®¤è¯ä¿¡æ¯ï¼ŒæœåŠ¡ç«¯ä¼šè¿”å›**401 Unauthorized**\nä½¿ç”¨ï¼š`Authorization: Basic dWVub3NlbjpwYXNzd29yZA==`\n\n### Expect\n\nå‘é€ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œè¯·æ±‚å¤´æºå¸¦`Expect: 100-continue`ï¼Œä¼šå…ˆå»è¯¢é—®Serveræ˜¯å¦æ„¿æ„æ¥å—æ•°æ®\næ¥æ”¶åˆ°Serverè¿”å›çš„`100-continue`åº”ç­”ä»¥åï¼Œæ‰èƒ½æŠŠæ•°æ®POSTç»™Server\n\n### From\n\nè¯¥å­—æ®µç”¨æ¥è®°å½•ç”¨æˆ·çš„ç”µå­é‚®ä»¶åœ°å€ï¼Œä½¿ç”¨ï¼š`From: yourname@outlook.com`\n\n### Hostï¼ˆé‡è¦æ¦‚å¿µï¼‰\n\nå…ˆæ˜ç¡®**è™šæ‹Ÿä¸»æœºçš„æ¦‚å¿µ**â€”â€”ä¸€å°æœåŠ¡å™¨å¯¹åº”ä¸€ä¸ªå…¬ç½‘IPåœ°å€ï¼Œä¸€ä¸ªIPåˆå¯ä»¥å¯¹åº”å¤šä¸ªåŸŸåï¼Œé‚£ä¹ˆå¦‚ä½•é€šè¿‡ä¸åŒåŸŸåè®¿é—®å¯¹åº”æœåŠ¡å™¨ä¸Šä¸åŒçš„ç«™ç‚¹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œå°†æœåŠ¡å™¨åˆ’åˆ†æˆå¤šä¸ªè™šæ‹Ÿä¸»æœºï¼Œåœ¨è¯·æ±‚å¤´ä¸ŠåŠ ä¸Š`Host`å­—æ®µæŒ‡å®šå¯¹åº”è™šæ‹Ÿä¸»æœºåç§°ï¼Œè¿™æ ·å°±èƒ½è®¿é—®åˆ°å¯¹åº”çš„ç«™ç‚¹\n\n> `nginx` åˆ’åˆ†è™šæ‹Ÿä¸»æœºå¾ˆç®€å•ï¼Œç›´æ¥è®¾ç½®ä¸åŒçš„`server_name`å³å¯\n\n### If-Match\n\nå½¢å¦‚`If-*`çš„å­—æ®µç§°ä¹‹ä¸ºæ¡ä»¶è¯·æ±‚ï¼Œåªæœ‰åˆ¤æ–­æŒ‡å®šæ¡ä»¶ä¸ºçœŸæ—¶ï¼Œæ‰ä¼šæ‰§è¡Œè¯·æ±‚ã€‚\n\nå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼Œæºå¸¦`If-Match: \"123456\"`ã€‚æœåŠ¡ç«¯ä¸ºå®ä½“èµ„æºç”Ÿæˆå®ä½“æ ‡è®°`ETag`ï¼Œç„¶ååˆ¤æ–­`If-Match`å’Œ`ETag`çš„å€¼ã€‚è‹¥ç›¸åŒï¼Œåˆ™è¿”å›å®ä½“èµ„æºï¼›è‹¥ä¸åŒï¼Œåˆ™è¿”å›**412 Precondition Failed**\n\n> If-matchçš„å–å€¼è¿˜å¯ä»¥æ—¶`*`ï¼Œè¡¨ç¤ºè®©æœåŠ¡ç«¯å¿½ç•¥`ETag`\n\n### If-Modified-Since\n\nè¿™ä¸ªè¯·æ±‚å¤´ä¸**åå•†ç¼“å­˜**æœ‰å…³\n\n- å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡å‘é€è¯·æ±‚ã€‚æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œè¿”å›å®ä½“èµ„æºå¹¶åŠ ä¸Šå“åº”å¤´`Last-Modified`å…¶å€¼ä¸ºè¯¥èµ„æºæœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´ã€‚å®¢æˆ·ç«¯æ”¶åˆ°å“åº”åç¼“å­˜è¯¥èµ„æºå’Œ`Last-Modified`\n- å®¢æˆ·ç«¯ç¬¬äºŒæ¬¡å‘é€è¯·æ±‚ï¼Œåœ¨è¯·æ±‚å¤´ä¸Šæºå¸¦`If-Modified-Since`ï¼Œå…¶å€¼ä¸ºä¸Šä¸€æ¬¡æœåŠ¡ç«¯è¿”å›çš„`Last-Modified`å€¼ã€‚å½“æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œæ£€æŸ¥å¯¹åº”å®ä½“èµ„æºæœ€æ–°çš„`Last-Modified`å¹¶ä¸`If-Modified-Since`å¯¹æ¯”åˆ¤æ–­æ˜¯å¦è¿‡æœŸã€‚è‹¥æœªè¿‡æœŸï¼Œåˆ™è¿”å›**304 Not Modified**è¡¨ç¤ºå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ç¼“å­˜ï¼›è‹¥è¿‡æœŸï¼Œè¿”å›æ–°çš„å®ä½“èµ„æºå’Œ`Last-Modified`\n\n### If-None-Match\n\nè¿™ä¸ªå­—æ®µä¸`If-Match`ä½œç”¨ç›¸å\n\nå¾…ç»­...\n\n## å“åº”é¦–éƒ¨å­—æ®µ\n\nå“åº”é¦–éƒ¨å­—æ®µæ˜¯æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”æŠ¥æ–‡ä¸­æ‰€ä½¿ç”¨çš„å­—æ®µ\n\n### Accept-Ranges\n\nç”¨æ¥å‘ŠçŸ¥å®¢æˆ·ç«¯èƒ½å¦å¤„ç†èŒƒå›´è¯·æ±‚\n\n- Accept-Ranges: bytes  æ”¯æŒ\n- Accept-Ranges: none   ä¸æ”¯æŒ\n\n### Age\n\nå‘ŠçŸ¥å®¢æˆ·ç«¯ï¼ŒæºæœåŠ¡å™¨åœ¨å¤šä¹…å‰åˆ›å»ºäº†å“åº”\n\n`Age: 600` å•ä½ï¼šs\n\n### ETag\n\nETagæ˜¯å“åº”èµ„æºçš„å”¯ä¸€æ€§æ ‡è¯†ï¼Œå½“èµ„æºæ”¹å˜ï¼ŒETagä¹Ÿä¼šå˜åŒ–\n\n- å¼ºETagï¼šä¸è®ºå®ä½“å‘ç”Ÿå¤šä¹ˆç»†å¾®çš„å˜åŒ–éƒ½ä¼šæ”¹å˜å…¶å€¼ `ETag: \"usagi-1234\"`\n- å¼±ETagï¼šåªæœ‰èµ„æºå‘ç”Ÿäº†æ ¹æœ¬æ”¹å˜ï¼Œäº§ç”Ÿå·®å¼‚æ—¶æ‰ä¼šæ”¹å˜ ETag å€¼ `ETag: W/\"usagi-1234\"`\n\n### Location\n\n`Location: http://www.usagidesign.jp/sample.html`\n\nå¼•å¯¼å®¢æˆ·ç«¯å»æŒ‡å®šä½ç½®è¯·æ±‚èµ„æºï¼Œé…åˆ 3XX: Redirection\n\n### Proxy-Authenticate\n\n`Proxy-Authenticate: Basic realm=\"Usagidesign Auth\"`\n\næ²¡ææ‡‚\n\n### Retry-After\n\n`Retry-After: 120`ï¼Œå•ä½sï¼Œä¹Ÿå¯ä»¥æ˜¯å…·ä½“æ—¶é—´\n\nå‘ŠçŸ¥å®¢æˆ·ç«¯ï¼Œåœ¨å¤šä¹…åå†æ¬¡å‘é€è¯·æ±‚ã€‚é…åˆ `503 Service Unavailable`æˆ–`3xx Redirect`ä½¿ç”¨\n\n### Server\n\nå‘ŠçŸ¥å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨ä¸Šå®‰è£…çš„HTTPæœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„ä¿¡æ¯ã€‚\n\n- `Server: Apache/2.2.17 (Unix)`\n- `Server: Apache/2.2.6 (Unix) PHP/5.2.5`\n\n### Vary\n\n","tags":["NetWork","HTTP Header"],"categories":["NetWork"]},{"title":"HTTPæ¢³ç†","url":"/posts/3b531846.html","content":"## HTTPå·¥ä½œæ¨¡å‹\n\nä¸€æ¬¡HTTPè¯·æ±‚æ¶‰åŠåˆ°ä¸¤ä¸ªè§’è‰²â€”â€”**å®¢æˆ·ç«¯**å’Œ**æœåŠ¡ç«¯**ã€‚\n\n1. å®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ˆæŠ¥æ–‡ï¼‰\n2. æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚å¼€å§‹å¤„ç†\n3. ç„¶åæŠŠå“åº”ï¼ˆæŠ¥æ–‡ï¼‰å‘é€å›å®¢æˆ·ç«¯\n\n![httpå·¥ä½œæ¨¡å‹](../../images/å›¾è§£HTTP/httpå·¥ä½œæ¨¡å‹.jpg)\n\n## æŒä¹…åŒ–è¿æ¥å’Œç®¡çº¿åŒ–\n\n### æŒä¹…åŒ–è¿æ¥\n\nä¼ è¾“å±‚çš„`TCP`åè®®ï¼Œè§„å®šé€šä¿¡åŒæ–¹å¿…é¡»**å…ˆå»ºç«‹è¿æ¥**å†é€šä¿¡ã€‚\n\nåœ¨`HTTP`çš„åˆå§‹ç‰ˆæœ¬ï¼Œæ¯è¿›è¡Œä¸€æ¬¡HTTPé€šä¿¡å°±è¦æ–­å¼€ä¸€æ¬¡TCPï¼Œå¤šä¸ªHTTPè¯·æ±‚ä¸èƒ½å¤ç”¨ä¸€ä¸ªTCPè¿æ¥\n\nåœ¨`HTTP1.1`ä¸­ï¼Œé»˜è®¤å¼€å¯æŒä¹…åŒ–è¿æ¥ï¼Œæ˜¯å¤šä¸ªHTTPè¯·æ±‚å¯ä»¥å¤ç”¨åŒä¸€ä¸ªTCPè¿æ¥ã€‚åªè¦ä»»æ„ä¸€ç«¯æ²¡æœ‰æ˜ç¡®æå‡ºæ–­å¼€è¿æ¥ï¼Œåˆ™ä¿æŒ TCP è¿æ¥çŠ¶æ€ã€‚\n\n![æŒä¹…åŒ–è¿æ¥](../../images/å›¾è§£HTTP/æŒä¹…åŒ–è¿æ¥.jpg)\n\n### ç®¡çº¿åŒ–\n\næŒä¹…è¿æ¥ä½¿å¾—å¤šæ•°è¯·æ±‚ä»¥ç®¡çº¿åŒ–ï¼ˆpipeliningï¼‰æ–¹å¼å‘é€æˆä¸ºå¯èƒ½ã€‚ä»å‰å‘é€è¯·æ±‚åéœ€ç­‰å¾…å¹¶æ”¶åˆ°å“åº”ï¼Œæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚ç®¡çº¿åŒ–æŠ€æœ¯å‡ºç°åï¼Œä¸ç”¨ç­‰å¾…å“åº”äº¦å¯ç›´æ¥å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚\n\n## æ— çŠ¶æ€å’ŒCookie\n\n### æ— çŠ¶æ€åè®®\n\n`HTTP`åè®®è‡ªèº«ä¸å…·å¤‡ä¿å­˜ä¹‹å‰å‘é€è¿‡çš„è¯·æ±‚æˆ–å“åº”çš„åŠŸèƒ½\næ¯å½“æœ‰æ–°çš„è¯·æ±‚å‘é€æ—¶ï¼Œå°±ä¼šæœ‰å¯¹åº”çš„æ–°å“åº”äº§ç”Ÿã€‚åè®®æœ¬èº«å¹¶ä¸ä¿ç•™ä¹‹å‰ä¸€åˆ‡çš„è¯·æ±‚æˆ–å“åº”æŠ¥æ–‡çš„ä¿¡æ¯ã€‚\n\nä½†æ˜¯æ— çŠ¶æ€ä¹Ÿä¼šå¯¼è‡´æ–°çš„é—®é¢˜â€”â€”ç”¨æˆ·ç™»é™†çŠ¶æ€å¦‚ä½•ä¿å­˜ï¼Ÿ\n\näºæ˜¯å¼•å…¥äº†`Cookie`\n\n### Cookie\n\n`Cookie` æ˜¯é€šè¿‡åœ¨è¯·æ±‚å’Œå“åº”æŠ¥æ–‡ä¸­å†™å…¥ `Cookie` ä¿¡æ¯æ¥æ§åˆ¶å®¢æˆ·ç«¯çš„çŠ¶æ€ã€‚\n\n1. å®¢æˆ·ç«¯å‘é€è¯·æ±‚æŠ¥æ–‡\n2. æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œå¤„ç†ã€‚åœ¨å“åº”æŠ¥æ–‡ä¸­æ·»åŠ ä¸€ä¸ª`Set-Cookie`çš„é¦–éƒ¨å­—æ®µ\n3. å®¢æˆ·ç«¯æ”¶åˆ°å“åº”ï¼Œå–å‡º`Set-Cookie`çš„ä¿¡æ¯\n4. å®¢æˆ·ç«¯ä»¥åå‘é€çš„è¯·æ±‚ï¼Œåœ¨è¯·æ±‚æŠ¥æ–‡é¦–éƒ¨åŠ ä¸Š`Cookie`ã€‚è¿™æ ·æœåŠ¡ç«¯å°±èƒ½è¯†åˆ«å®¢æˆ·ç«¯äº†ã€‚\n\n## HTTP æŠ¥æ–‡\n\nç”¨äº HTTP åè®®äº¤äº’çš„ä¿¡æ¯è¢«ç§°ä¸º HTTP æŠ¥æ–‡ã€‚è¯·æ±‚ç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰çš„HTTP æŠ¥æ–‡å«åš**è¯·æ±‚æŠ¥æ–‡**ï¼Œå“åº”ç«¯ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰çš„å«åš**å“åº”æŠ¥æ–‡**ã€‚HTTP æŠ¥æ–‡æœ¬èº«æ˜¯ç”±å¤šè¡Œï¼ˆç”¨ CR+LF ä½œæ¢è¡Œç¬¦ï¼‰æ•°æ®æ„æˆçš„**å­—ç¬¦ä¸²æ–‡æœ¬**ã€‚\n\nHTTPæŠ¥æ–‡ç”±**æŠ¥æ–‡é¦–éƒ¨ï¼ˆheaderï¼‰**å’Œ**æŠ¥æ–‡ä¸»ä½“ï¼ˆbodyï¼‰**æ„æˆï¼Œä¸¤è€…ä»¥**ç©ºè¡Œï¼ˆCR+LFï¼‰**åˆ†éš”\n\n> æŠ¥æ–‡ï¼šæ˜¯ HTTP é€šä¿¡ä¸­çš„åŸºæœ¬å•ä½ï¼Œç”± 8 ä½ç»„å­—èŠ‚æµï¼ˆoctet sequenceï¼Œå…¶ä¸­ octet ä¸º 8 ä¸ªæ¯”ç‰¹ï¼‰ç»„æˆï¼Œé€šè¿‡ HTTP é€šä¿¡ä¼ è¾“ã€‚\n\n## æå‡ä¼ è¾“é€Ÿç‡\n\n### å‹ç¼©\n\n**å†…å®¹ç¼–ç **ä¿æŒå®ä½“ä¿¡æ¯åŸæ ·å‹ç¼©ï¼Œå†…å®¹ç¼–ç åçš„å®ä½“ç”±å®¢æˆ·ç«¯æ¥æ”¶å¹¶è´Ÿè´£è§£ç ã€‚\n\nå¸¸ç”¨çš„å†…å®¹ç¼–ç æœ‰ä»¥ä¸‹å‡ ç§ã€‚\n- gzipï¼ˆGNU zipï¼‰\n- compressï¼ˆUNIX ç³»ç»Ÿçš„æ ‡å‡†å‹ç¼©ï¼‰\n- deflateï¼ˆzlibï¼‰\n- identityï¼ˆä¸è¿›è¡Œç¼–ç ï¼‰\n\n### åˆ†å—\n\n**åˆ†å—ä¼ è¾“ç¼–ç **ä¼šå°†å®ä½“ä¸»ä½“åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼ˆå—ï¼‰ã€‚\nä½¿ç”¨åˆ†å—ä¼ è¾“ç¼–ç çš„å®ä½“ä¸»ä½“ä¼šç”±æ¥æ”¶çš„å®¢æˆ·ç«¯è´Ÿè´£è§£ç ï¼Œæ¢å¤åˆ°ç¼–ç å‰çš„å®ä½“ä¸»ä½“ã€‚\n\n## å¤šéƒ¨åˆ†å¯¹è±¡é›†åˆ\n\n`HTTP`åè®®å‘é€çš„æŠ¥æ–‡ä¸»ä½“å¯ä»¥åŒ…å«å¤šä¸ªç±»å‹å®ä½“ã€‚\nå¤šéƒ¨åˆ†å¯¹è±¡é›†åˆåŒ…å«çš„å¯¹è±¡å¦‚ä¸‹ï¼š\n\n- multipart/form-data: `Content-Type: multipart/form-data; boundary=AaB03x`\n- multipart/byteranges: `Content-Type: multipart/byteranges; boundary=THIS_STRING_SEPARATES`\n\n`Content-Type`å®šä¹‰èµ„æºç±»å‹\n`boundary`å®šä¹‰ä¸åŒç±»å‹å®ä½“ä¹‹é—´çš„åˆ†éš”ç¬¦\n\n## èŒƒå›´è¯·æ±‚\n\næŒ‡å®šèŒƒå›´å‘é€çš„è¯·æ±‚å«åš**èŒƒå›´è¯·æ±‚**\nbyte èŒƒå›´çš„æŒ‡å®šå½¢å¼å¦‚ä¸‹ã€‚\n- 5001~10 000 å­—èŠ‚ï¼š`Range: bytes=5001-10000`\n- ä» 5001 å­—èŠ‚ä¹‹åå…¨éƒ¨çš„: `Range: bytes=5001-`\n- ä»ä¸€å¼€å§‹åˆ° 3000 å­—èŠ‚å’Œ 5000~7000 å­—èŠ‚çš„å¤šé‡èŒƒå›´: `Range: bytes=-3000, 5000-7000`\n\né’ˆå¯¹èŒƒå›´è¯·æ±‚ï¼Œå“åº”ä¼šè¿”å›çŠ¶æ€ç ä¸º 206 Partial Content çš„å“åº”æŠ¥æ–‡ã€‚å¦å¤–ï¼Œå¯¹äºå¤šé‡èŒƒå›´çš„èŒƒå›´è¯·æ±‚ï¼Œå“åº”ä¼šåœ¨é¦–éƒ¨å­—æ®µ Content-Type æ ‡æ˜ multipart/byteranges åè¿”å›å“åº”æŠ¥æ–‡ã€‚\n\n## å†…å®¹åå•†\n\nå†…å®¹åå•†æœºåˆ¶æ˜¯æŒ‡å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å°±å“åº”çš„èµ„æºå†…å®¹è¿›è¡Œäº¤æ¶‰ï¼Œç„¶åæä¾›ç»™å®¢æˆ·ç«¯æœ€ä¸ºé€‚åˆçš„èµ„æºã€‚\n\næ¯”å¦‚è¯´ï¼Œå®¢æˆ·ç«¯æµè§ˆå™¨æ˜¯è‹±æ–‡çš„ï¼ŒæœåŠ¡å™¨è¿”å›çš„ç½‘é¡µä¹Ÿä¼šæ˜¯è‹±æ–‡çš„ã€‚\n\nç›¸å…³é¦–éƒ¨å­—æ®µå¦‚ä¸‹ï¼š\n- `Accept`\n- `Accept-Charset`\n- `Accept-Encoding`\n- `Accept-Language`\n- `Content-Language`\n\n## HTTPçŠ¶æ€ç \n\n|     | ç±»åˆ«                           | è¯´æ˜                       |\n| --- | ------------------------------ | -------------------------- |\n| 1XX | Informational(ä¿¡æ¯æ€§çŠ¶æ€ç )    | æ¥æ”¶åˆ°çš„è¯·æ±‚æ­£åœ¨å¤„ç†       |\n| 2XX | Success(æˆåŠŸçŠ¶æ€å—)            | è¯·æ±‚æ­£å¸¸å¤„ç†å®Œæ¯•           |\n| 3XX | Redirection(é‡å®šå‘çŠ¶æ€å—)      | éœ€è¦è¿›è¡Œé™„åŠ æ“ä½œå·²å®Œæˆè¯·æ±‚ |\n| 4XX | Client Error(å®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ) | æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚         |\n| 5XX | Server Error(æœåŠ¡å™¨é”™è¯¯çŠ¶æ€å—) | æœåŠ¡å™¨å¤„ç†è¯·æ±‚å‡ºé”™         |\n\n### 2XX\n\n#### 200 OK\n\nè¡¨ç¤ºå®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚åœ¨æœåŠ¡ç«¯è¢«æ­£å¸¸å¤„ç†äº†\n\n#### 204 No Content\n\nè¯·æ±‚å¤„ç†æˆåŠŸï¼Œä½†æ˜¯æ²¡æœ‰èµ„æºè¯¾è¿”å›\n\n#### 206 Partial Content\n\nå®¢æˆ·ç«¯è¿›è¡Œäº†èŒƒå›´è¯·æ±‚ï¼ŒæœåŠ¡å™¨æˆåŠŸæ‰§è¡Œäº†è¿™éƒ¨åˆ†è¯·æ±‚ã€‚\nå“åº”æŠ¥æ–‡ä¸­åŒ…å«ç”± Content-Range æŒ‡å®šèŒƒå›´çš„å®ä½“å†…å®¹ã€‚\n\n### 3XX\n\n#### 301 Moved Permanently\n\nè¡¨ç¤ºæ‰€è¯·æ±‚çš„èµ„æºå·²è½¬ç§»åˆ°äº†æ–°çš„`URI`\n\n#### 302 Found\n\nä¸´æ—¶é‡å®šå‘ï¼Œè¯¥çŠ¶æ€ç è¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²è¢«åˆ†é…äº†æ–°çš„ URIï¼Œå¸Œæœ›ç”¨æˆ·ï¼ˆæœ¬æ¬¡ï¼‰èƒ½ä½¿ç”¨æ–°çš„ URI è®¿é—®ã€‚\n\nå’Œ 301 Moved Permanently çŠ¶æ€ç ç›¸ä¼¼ï¼Œä½† 302 çŠ¶æ€ç ä»£è¡¨çš„èµ„æºä¸æ˜¯è¢«æ°¸ä¹…ç§»åŠ¨ï¼Œåªæ˜¯ä¸´æ—¶æ€§è´¨çš„ã€‚æ¢å¥è¯è¯´ï¼Œå·²ç§»åŠ¨çš„èµ„æºå¯¹åº”çš„URI å°†æ¥è¿˜æœ‰å¯èƒ½å‘ç”Ÿæ”¹å˜ã€‚\n\n#### 303 See Other\n\nè¯¥çŠ¶æ€ç è¡¨ç¤ºç”±äºè¯·æ±‚å¯¹åº”çš„èµ„æºå­˜åœ¨ç€å¦ä¸€ä¸ª URIï¼Œåº”ä½¿ç”¨ GETæ–¹æ³•å®šå‘è·å–è¯·æ±‚çš„èµ„æºã€‚\n\n303 çŠ¶æ€ç å’Œ 302 Found çŠ¶æ€ç æœ‰ç€ç›¸åŒçš„åŠŸèƒ½ï¼Œä½† 303 çŠ¶æ€ç æ˜ç¡®è¡¨ç¤ºå®¢æˆ·ç«¯åº”å½“é‡‡ç”¨ GET æ–¹æ³•è·å–èµ„æºï¼Œè¿™ç‚¹ä¸ 302 çŠ¶æ€ç æœ‰åŒºåˆ«ã€‚\n\n#### 304 Not Modified\n\næœåŠ¡ç«¯è¿”å›304ï¼Œè¡¨ç¤ºèµ„æºæ²¡æœ‰æ”¹åŠ¨ã€‚æµè§ˆå™¨å¯ä»¥ä»æœ¬åœ°ç¼“å­˜ä¸­è¯»å–èµ„æºã€‚\n\n#### 307 Temporary Redirect\n\nä¸´æ—¶é‡å®šå‘ã€‚è¯¥çŠ¶æ€ç ä¸ 302 Found æœ‰ç€ç›¸åŒçš„å«ä¹‰ã€‚å°½ç®¡ 302 æ ‡å‡†ç¦æ­¢ POST å˜æ¢æˆ GETï¼Œä½†å®é™…ä½¿ç”¨æ—¶å¤§å®¶å¹¶ä¸éµå®ˆã€‚\n307 ä¼šéµç…§æµè§ˆå™¨æ ‡å‡†ï¼Œä¸ä¼šä» POST å˜æˆ GETã€‚ä½†æ˜¯ï¼Œå¯¹äºå¤„ç†å“åº”æ—¶çš„è¡Œä¸ºï¼Œæ¯ç§æµè§ˆå™¨æœ‰å¯èƒ½å‡ºç°ä¸åŒçš„æƒ…å†µã€‚\n\n### 4XX\n\n#### 400 Bad Request\n\nè¡¨ç¤ºè¯·æ±‚æŠ¥æ–‡å­˜åœ¨é”™è¯¯\n\n#### 401 Unauthorized\n\næ²¡æœ‰é€šè¿‡HTTPè®¤è¯ï¼Œå½“æµè§ˆå™¨åˆæ¬¡æ¥æ”¶åˆ° 401 å“åº”ï¼Œä¼šå¼¹å‡ºè®¤è¯ç”¨çš„å¯¹è¯çª—å£ã€‚\n\n#### 403 Forbidden\n\nè¯¥çŠ¶æ€ç è¡¨æ˜å¯¹è¯·æ±‚èµ„æºçš„è®¿é—®è¢«æœåŠ¡å™¨æ‹’ç»äº†\n\n#### 404 Not Found\n\næ‰€è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ã€‚\n\n### 5XX\n\n#### 500 Internal Server Error\n\nè¯¥çŠ¶æ€ç è¡¨æ˜æœåŠ¡å™¨ç«¯åœ¨æ‰§è¡Œè¯·æ±‚æ—¶å‘ç”Ÿäº†é”™è¯¯\n\n#### 503 Service Unavailable\n\nè¯¥çŠ¶æ€ç è¡¨æ˜æœåŠ¡å™¨æš‚æ—¶å¤„äºè¶…è´Ÿè½½æˆ–æ­£åœ¨è¿›è¡Œåœæœºç»´æŠ¤ï¼Œç°åœ¨æ— æ³•å¤„ç†è¯·æ±‚ã€‚\nå¦‚æœäº‹å…ˆå¾—çŸ¥è§£é™¤ä»¥ä¸ŠçŠ¶å†µéœ€è¦çš„æ—¶é—´ï¼Œæœ€å¥½å†™å…¥RetryAfter é¦–éƒ¨å­—æ®µå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\n","tags":["NetWork","HTTP"],"categories":["NetWork"]},{"title":"Webç½‘ç»œåŸºç¡€","url":"/posts/4e5b3a92.html","content":"\n## TCP/IP\n\n`TCP/IP`æ˜¯äº’è”ç½‘ç›¸å…³çš„å„ç±»åè®®æ—çš„æ€»ç§°\n`TCP/IP`å…·æœ‰åˆ†å±‚ç»“æ„ï¼Œåˆ†ä¸ºï¼šåº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚å’Œæ•°æ®é“¾è·¯å±‚\n\n### åº”ç”¨å±‚\n\nåº”ç”¨å±‚å†³å®šäº†å‘ç”¨æˆ·æä¾›åº”ç”¨æœåŠ¡æ—¶é€šä¿¡çš„æ´»åŠ¨ã€‚\nç›¸å…³åè®®ï¼š`FTP`ã€`DNS`ä»¥åŠ`HTTP`\n\n### ä¼ è¾“å±‚\n\nä¼ è¾“å±‚æä¾›å¤„äºç½‘ç»œè¿æ¥ä¸­çš„ä¸¤å°è®¡ç®—æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“\nç›¸å…³åè®®ï¼š`TCP`å’Œ`UDP`\n\n### ç½‘ç»œå±‚\n\nç½‘ç»œå±‚è§„å®šäº†æ•°æ®åŒ…é€šè¿‡æ€æ ·çš„ä¼ è¾“çº¿è·¯åˆ°è¾¾å¯¹æ–¹è®¡ç®—æœº\nç›¸å…³åè®®ï¼š`IP`\n\n### æ•°æ®é“¾è·¯å±‚\n\næ•°æ®é“¾è·¯æ˜¯ç”¨æ¥å¤„ç†è¿æ¥ç½‘ç»œçš„**ç¡¬ä»¶éƒ¨åˆ†**\nä¾‹å¦‚ï¼š`NIC(ç½‘å¡)`ã€`å…‰çº¤`ç­‰ç‰©ç†å¯è§éƒ¨åˆ†\n\n### é€šä¿¡ä¼ è¾“æµ\n\n![TCPIPåˆ†å±‚](../../images/å›¾è§£HTTP/TCPIPåˆ†å±‚.png)\n\nå‘é€ç«¯å†æ¯ä¸€å±‚éƒ½ä¼šæ‰“ä¸ŠåŒ…å«è¯¥å±‚æ‰€å±çš„ä¸€ä¸ªé¦–éƒ¨ã€‚å½“æ¥æ”¶ç«¯æ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œä¼šä¾æ¬¡æ‹†å¼€é¦–éƒ¨ã€‚\n\n## ä¸HTTPæœ‰å…³çš„åè®®\n\n### IP\n\n**ç½‘é™…åè®®(Internet Protocol, IP)**ä½äºç½‘ç»œå±‚ï¼Œå…¶ä½œç”¨æ˜¯æŠŠæ•°æ®åŒ…ä¼ é€ç»™å¯¹æ–¹ã€‚å…·ä½“å¦‚ä½•è§„å®šä¼ é€å‘¢ï¼Ÿ\n\næ¯ä¸ªç½‘ç»œèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ª**IPåœ°å€**ï¼Œæ¯ä¸€å°è®¡ç®—æœºçš„ç½‘å¡éƒ½æœ‰ä¸€ä¸ªå›ºå®šçš„**MACåœ°å€**ã€‚\nIPåœ°å€åˆå¯ä»¥é€šè¿‡`ARPåè®®`è½¬æ¢æˆMACåœ°å€\n\næ•°æ®åŒ…å‘é€è¿‡ç¨‹å¦‚ä¸‹ï¼š\n\n1. ç½‘å…³ï¼ˆä¸€èˆ¬ä¸ºè·¯ç”±å™¨ï¼‰çš„ IP åœ°å€è¢« ARP åè®®è§£æä¸º MAC åœ°å€ã€‚æ ¹æ®è¯¥ MAC åœ°å€ï¼Œæºä¸»æœºå°†æ•°æ®åŒ…å‘é€åˆ°ç½‘å…³ã€‚\n2. ç½‘å…³æ ¹æ®æ•°æ®åŒ…ä¸­çš„ç½‘æ®µ ID å¯»æ‰¾ç›®æ ‡ç½‘ç»œã€‚å¦‚æœæ‰¾åˆ°ï¼Œå°†æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡ç½‘æ®µï¼›å¦‚æœæ²¡æ‰¾åˆ°ï¼Œé‡å¤æ­¥éª¤ï¼ˆ1ï¼‰å°†æ•°æ®åŒ…å‘é€åˆ°ä¸Šä¸€çº§ç½‘å…³ã€‚\n3. æ•°æ®åŒ…ç»è¿‡ç½‘å…³è¢«å‘é€åˆ°æ­£ç¡®çš„ç½‘æ®µä¸­ã€‚ç›®æ ‡IPåœ°å€è¢«ARPåè®®è§£æä¸º MAC åœ°å€ã€‚æ ¹æ®è¯¥ MAC åœ°å€ï¼Œæ•°æ®åŒ…è¢«å‘é€ç»™ç›®æ ‡åœ°å€çš„ä¸»æœºã€‚\n\n### TCP\n\n**ä¼ è¾“æ§åˆ¶åè®®( Transport Control Protocol, TCP)**ä½äºä¼ è¾“å±‚ï¼Œæä¾›å¯é çš„**å­—èŠ‚æµæœåŠ¡**å³å°†å¤§å—æ•°æ®åˆ†å‰²æˆæŠ¥æ–‡æ®µä¸ºå•ä½çš„æ•°æ®åŒ…è¿›è¡Œç®¡ç†ã€‚\n\nä¸‰æ¬¡æ¡æ‰‹\n\nå‘é€ç«¯é¦–å…ˆå‘é€ä¸€ä¸ªå¸¦`SYN`æ ‡å¿—çš„æ•°æ®åŒ…ç»™å¯¹æ–¹ã€‚æ¥æ”¶ç«¯æ”¶åˆ°åï¼Œä¼šå›ä¼ ä¸€ä¸ªå¸¦æœ‰`SYN/ACK`æ ‡å¿—çš„æ•°æ®åŒ…ä»¥è¡¨ç¤ºä¼ è¾¾ç¡®è®¤ä¿¡æ¯ã€‚æœ€åï¼Œå‘é€ç«¯å†å‘é€ä¸€ä¸ªå¸¦æœ‰`ACK`æ ‡å¿—çš„æ•°æ®åŒ…ï¼Œä»£è¡¨â€œæ¡æ‰‹â€ç»“æŸ\n\n### DNS\n\n**åŸŸåè§£ææœåŠ¡(Domain Name System, DNS)**ä½äºåº”ç”¨å±‚ï¼Œæä¾›é€šè¿‡åŸŸåæŸ¥æ‰¾IPåœ°å€ï¼Œæˆ–è€…é€†å‘ä»IPåœ°å€æŸ¥æ‰¾åŸŸåçš„æœåŠ¡\n\n## HTTPåè®®ä¸å…¶å®ƒåè®®çš„å…³ç³»\n\n![æ•°æ®è¯·æ±‚ä¸åè®®](../../images/å›¾è§£HTTP/æ•°æ®è¯·æ±‚ä¸åè®®.png)\n\n## URLä¸URI\n\n### åŒºåˆ«\n\nç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼ˆUniform Resource Identifier, URIï¼‰\nç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆUniform Resource Locatorï¼Œ URLï¼‰\nç»Ÿä¸€èµ„æºåç§°ï¼ˆUniform Resource Nameï¼Œ URNï¼‰\n\n`URL`å’Œ`URN`éƒ½æ˜¯`URI`çš„å­é›†ã€‚æ¯”å¦‚è¯´äººä»¬çš„èº«ä»½è¯å·ç å°±æ˜¯`URN`ï¼ˆèƒ½å¤Ÿå”¯ä¸€æ ‡è¯†ï¼‰ï¼Œä¸€ä¸ªç½‘ç«™`http://zxffan.github.io/`å°±æ˜¯`URL`ã€‚å®ƒä»¬éƒ½å±äº`URI`\n\n### URIæ ¼å¼\n\n![URIæ ¼å¼](../../images/å›¾è§£HTTP/URIæ ¼å¼.png)\n\n#### åè®®æ–¹æ¡ˆå\n\nè¯¸å¦‚ï¼š`HTTP`ã€`HTTPS`\n\n#### ç™»å½•ä¿¡æ¯\n\nå¯é€‰é¡¹ï¼ŒæŒ‡å®šç”¨æˆ·åå’Œå¯†ç \n\n#### æœåŠ¡å™¨åœ°å€\n\næœåŠ¡å™¨åœ°å€å¯ä»¥æ˜¯åŸŸåï¼Œä¹Ÿå¯ä»¥æ˜¯IPåœ°å€\n\n#### æœåŠ¡å™¨ç«¯å£å·\n\nå¯é€‰ï¼Œæ²¡æœ‰å–é»˜è®¤ç«¯å£å·ï¼Œä¸åŒåè®®æœ‰ä¸åŒçš„é»˜è®¤ç«¯å£å·ã€‚\n`HTTP`æ˜¯`80`ï¼›`HTTPS`æ˜¯`443`\n\n#### å¸¦å±‚æ¬¡çš„æ–‡ä»¶è·¯å¾„\n\næŒ‡å®šæœåŠ¡å™¨ä¸Šçš„**æ–‡ä»¶è·¯å¾„**æ¥å®šä½ç‰¹æŒ‡çš„èµ„æº\n\n#### æŸ¥è¯¢å­—ç¬¦ä¸²\n\nå¯é€‰ï¼Œä½¿ç”¨æŸ¥è¯¢å­—ç¬¦ä¸²å‘æŒ‡å®šèµ„æºä¼ å…¥ä»»æ„å‚æ•°\n\n#### ç‰‡æ®µæ ‡è¯†ç¬¦\n\nå¯é€‰ï¼Œæ ‡è®°å·²è·å–èµ„æºçš„å­èµ„æº","tags":["NetWork","HTTP","TCP/IP"],"categories":["NetWork"]},{"title":"CSS Review","url":"/posts/6e1418c.html","content":"\n## æµè§ˆå™¨æ¸²æŸ“\n\næµè§ˆå™¨è§£æä¸€ä¸ªé¡µé¢ä¼šæŒ‰ç…§ä»¥ä¸‹æµç¨‹ï¼š\n\n1. æ ¹æ®`HTML`æ„å»º`DOM Tree`\n2. æ ¹æ®`CSS`æ„å»º`CSSOM Tree`\n3. `DOM Tree`å’Œ`CSSOM Tree`åˆå¹¶ç”Ÿæˆ`Render Tree`\n4. å¸ƒå±€ï¼šè®¡ç®—å…ƒç´ çš„å¤§å°åŠä½ç½®\n5. ç»˜åˆ¶ï¼šå°†`Render Tree`ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è½¬æ¢æˆå±å¹•ä¸Šçš„å®é™…åƒç´ \n   \n### å¦‚ä½•ä»`HTML`åˆ°`DOM Tree`ï¼Ÿ\n\nè¯»å–HTMLæ–‡æ¡£çš„å­—èŠ‚(Bytes)\nå°†å­—èŠ‚è½¬æ¢æˆå­—ç¬¦(Chars)\nä¾æ®å­—ç¬¦ç¡®å®šæ ‡ç­¾(Tokens)\nå°†æ ‡ç­¾è½¬æ¢æˆèŠ‚ç‚¹(Nodes)\nä»¥èŠ‚ç‚¹ä¸ºåŸºå‡†æ„å»ºDOMæ ‘ã€‚\n\n### å¦‚ä½•ä»`CSS`åˆ°`CSSOM Tree`ï¼Ÿ\n\nä¸DOMæ ‘çš„æ„å»ºè¿‡ç¨‹ç±»ä¼¼ã€‚\n\n### é˜»å¡æ¸²æŸ“\n\nåœ¨ç”Ÿæˆ`Dom Tree`çš„è¿‡ç¨‹ä¸­ï¼Œ`script`æ ‡ç­¾ä¼šé˜»å¡æ¸²æŸ“çº¿ç¨‹å·¥ä½œã€‚æ­¤æ—¶ï¼Œæ§åˆ¶æƒäº¤ç»™äº†**JSå¼•æ“çº¿ç¨‹**ï¼Œ JavaScriptè„šæœ¬æ‰§è¡Œå®Œæˆä¹‹åå†äº¤ç”±æ¸²æŸ“å¼•æ“ç»§ç»­è§£æã€‚\n\nä¸ºä»€ä¹ˆè¦é˜»å¡ï¼Ÿ\n`JS`æ˜¯èƒ½å¤Ÿæ“ä½œDOMçš„ã€‚`JS`å¼€å§‹å·¥ä½œåå¹¶ä¸ç¡®å®šDOMçš„ç»“æ„ï¼ˆå› ä¸ºä¼šå˜ï¼‰ï¼Œæ‰€ä»¥æš‚åœæ¸²æŸ“çº¿ç¨‹å·¥ä½œã€‚\n\n### å›æµå’Œé‡ç»˜\n\n#### å›æµ\n\nå›æµï¼ˆé‡æ’ï¼‰æ˜¯æŒ‡å½“DOMèŠ‚ç‚¹çš„**å‡ ä½•å±æ€§**ï¼ˆä½ç½®ã€å¤§å°ç­‰ï¼‰å‘ç”Ÿæ”¹å˜åï¼Œæ¸²æŸ“çº¿ç¨‹éœ€è¦é‡æ–°è®¡ç®—ä½ç½®å’Œå½¢çŠ¶çš„ç°è±¡ã€‚\næ¢å¥è¯è¯´ï¼Œå°±æ˜¯DOMèŠ‚ç‚¹çš„å˜åŒ–å¯¼è‡´æ–‡æ¡£æµå˜åŒ–ã€‚\n\n#### é‡ç»˜\n\né‡ç»˜æ˜¯æŒ‡å½“DOMèŠ‚ç‚¹çš„**å¤–è§‚å±æ€§**ï¼ˆé¢œè‰²ã€é€æ˜åº¦ã€æ–‡å­—ç­‰ï¼‰ï¼Œæ¸²æŸ“çº¿ç¨‹éœ€è¦é‡æ–°ç»˜åˆ¶çš„ç°è±¡ã€‚\næ¢å¥è¯è¯´ï¼Œå°±æ˜¯DOMèŠ‚ç‚¹çš„å˜åŒ–ä¸ä¼šå¯¼è‡´æ–‡æ¡£æµå˜åŒ–ã€‚\nå›æµä¸€å®šå¯¼è‡´é‡ç»˜ï¼Œé‡ç»˜ä¸ä¸€å®šå¯¼è‡´å›æµã€‚\nå°½å¯èƒ½çš„é¿å…å›æµçš„å‘ç”Ÿã€‚å½“éœ€è¦æ”¹å˜å…ƒç´ ä½ç½®æ—¶ï¼Œä½¿ç”¨`transform`ä»£æ›¿`top bottom left right`ã€‚å‰è€…åªä¼šå¼•å‘å›¾å±‚é‡ç»˜ï¼Œè¿˜ä¼šé—´æ¥å¯åŠ¨GPUåŠ é€Ÿã€‚\n\n## ä¹ æƒ¯ï¼šCSSå±æ€§æ’åºä¹¦å†™\n\næ¯”è¾ƒå¥½çš„ä¹¦å†™é¡ºåºæ˜¯æŒ‰ç…§ç±»å‹æ’åºã€‚\n\næŒ‰ç…§`å¸ƒå±€` â†’ `å°ºå¯¸` â†’ `ç•Œé¢` â†’ `æ–‡å­—` â†’ `äº¤äº’`çš„æ–¹å¼é¡ºåºä¹¦å†™CSSå±æ€§\n\n### å¸ƒå±€å±æ€§\n\n-  æ˜¾ç¤ºï¼š`display` `visibility`\n-  æº¢å‡ºï¼š`overflow` `overflow-x` `overflow-y`\n-  æµ®åŠ¨ï¼š`float` `clear`\n-  å®šä½ï¼š`position` `left` `right` `top` `bottom` `z-index`\n-  åˆ—è¡¨ï¼š`list-style` `list-style-type` `list-style-position` `list-style-image`\n-  è¡¨æ ¼ï¼š`table-layout` `border-collapse` `border-spacing` `caption-side` `empty-cells`\n-  å¼¹æ€§ï¼š`flex-flow` `flex-direction` `flex-wrap` `justify-content` `align-content` `align-items` `align-self` `flex` `flex-grow` `flex-shrink` `flex-basis` `order`\n-  å¤šåˆ—ï¼š`columns` `column-width` `column-count` `column-gap` `column-rule` `column-rule-width` `column-rule-style` `column-rule-color` `column-span` `column-fill` `column-break-before` `column-break-after` `column-break-inside`\n-  æ ¼æ …ï¼š`grid-columns` `grid-rows`\n\n### å°ºå¯¸å±æ€§\n\n-  æ¨¡å‹ï¼š`box-sizing`\n-  è¾¹è·ï¼š`margin` `margin-left` `margin-right` `margin-top` `margin-bottom`\n-  å¡«å……ï¼š`padding` `padding-left` `padding-right` `padding-top` `padding-bottom`\n-  è¾¹æ¡†ï¼š`border` `border-width` `border-style` `border-color` `border-colors` `border-[direction]-<param>`\n-  åœ†è§’ï¼š`border-radius` `border-top-left-radius` `border-top-right-radius` `border-bottom-left-radius` `border-bottom-right-radius`\n-  æ¡†å›¾ï¼š`border-image` `border-image-source` `border-image-slice` `border-image-width` `border-image-outset` `border-image-repeat`\n-  å¤§å°ï¼š`width` `min-width` `max-width` `height` `min-height` `max-height`\n\n### ç•Œé¢å±æ€§\n\n-  å¤–è§‚ï¼š`appearance`\n-  è½®å»“ï¼š`outline` `outline-width` `outline-style` `outline-color` `outline-offset` `outline-radius` `outline-radius-[direction]`\n-  èƒŒæ™¯ï¼š`background` `background-color` `background-image` `background-repeat` `background-repeat-x` `background-repeat-y` `background-position` `background-position-x` `background-position-y` `background-size` `background-origin` `background-clip` `background-attachment` `bakground-composite`\n-  é®ç½©ï¼š`mask` `mask-mode` `mask-image` `mask-repeat` `mask-repeat-x` `mask-repeat-y` `mask-position` `mask-position-x` `mask-position-y` `mask-size` `mask-origin` `mask-clip` `mask-attachment` `mask-composite` `mask-box-image` `mask-box-image-source` `mask-box-image-width` `mask-box-image-outset` `mask-box-image-repeat` `mask-box-image-slice`\n-  æ»¤é•œï¼š`box-shadow` `box-reflect` `filter` `mix-blend-mode` `opacity`,\n-  è£å‰ªï¼š`object-fit` `clip`\n-  äº‹ä»¶ï¼š`resize` `zoom` `cursor` `pointer-events` `touch-callout` `user-modify` `user-focus` `user-input` `user-select` `user-drag`\n\n### æ–‡å­—å±æ€§\n\n-  æ¨¡å¼ï¼š`line-height` `line-clamp` `vertical-align` `direction` `unicode-bidi` `writing-mode` `ime-mode`\n-  æ–‡æœ¬ï¼š`text-overflow` `text-decoration` `text-decoration-line` `text-decoration-style` `text-decoration-color` `text-decoration-skip` `text-underline-position` `text-align` `text-align-last` `text-justify` `text-indent` `text-stroke` `text-stroke-width` `text-stroke-color` `text-shadow` `text-transform` `text-size-adjust`\n-  å­—ä½“ï¼š`src` `font` `font-family` `font-style` `font-stretch` `font-weight` `font-variant` `font-size` `font-size-adjust` `color`\n-  å†…å®¹ï¼š`overflow-wrap` `word-wrap` `word-break` `word-spacing` `letter-spacing` `white-space` `caret-color` `tab-size` `content` `counter-increment` `counter-reset` `quotes` `page` `page-break-before` `page-break-after` `page-break-inside`\n\n### äº¤äº’å±æ€§\n\n-  æ¨¡å¼ï¼š`will-change` `perspective` `perspective-origin` `backface-visibility`\n-  å˜æ¢ï¼š`transform` `transform-origin` `transform-style`\n-  è¿‡æ¸¡ï¼š`transition` `transition-property` `transition-duration` `transition-timing-function` `transition-delay`\n-  åŠ¨ç”»ï¼š`animation` `animation-name` `animation-duration` `animation-timing-function` `animation-delay` `animation-iteration-count` `animation-direction` `animation-play-state` `animation-fill-mode`\n\n## ç›’æ¨¡å‹\n\nè€ç”Ÿå¸¸è°ˆâ€”â€”ç›’æ¨¡å‹\n\n### ç›’æ¨¡å‹\n\næ ‡å‡†ç›’æ¨¡å‹ ï¼ˆ`box-sizing`ä¸º`content-box`ï¼‰\næ€ªå¼‚ï¼ˆIEï¼‰ç›’æ¨¡å‹ï¼ˆ`box-sizing`ä¸º`border-box`ï¼‰\n\n![æ ‡å‡†ç›’æ¨¡å‹å’Œæ€ªå¼‚ç›’æ¨¡å‹](../../images/æ ‡å‡†ç›’æ¨¡å‹å’Œæ€ªå¼‚ç›’æ¨¡å‹.png)\n\n### è§†è§‰æ ¼å¼åŒ–æ¨¡å‹\n\nå—çº§å…ƒç´ ï¼š`display`å£°æ˜ä¸º`block`ã€`list-item`ã€`table`ã€`flex`æˆ–`grid`æ—¶\nè¡Œå†…å…ƒç´ ï¼š`display`å£°æ˜ä¸º`inline`ã€`inline-block`ã€`inline-table`ã€`inline-flex`æˆ–`inline-grid`æ—¶\n\n### æ ¼å¼åŒ–ä¸Šä¸‹æ–‡\n\n| ä¸Šä¸‹æ–‡           | ç¼©å†™  | ç‰ˆæœ¬ | è¯´æ˜         |\n| ---------------- | ----- | ---- | ------------ |\n| å—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡   | `BFC` | 2    | å—çº§ç›’å­å®¹å™¨ |\n| è¡Œå†…æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ | `IFC` | 2    | è¡Œå†…ç›’å­å®¹å™¨ |\n| å¼¹æ€§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ | `FFC` | 3    | å¼¹æ€§ç›’å­å®¹å™¨ |\n| æ ¼æ …æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ | `GFC` | 3    | æ ¼æ …ç›’å­å®¹å™¨ |\n\n`BFC`â€”â€”å—çº§æ ¼å¼ä¸Šä¸‹æ–‡é€šå¸¸ç”±ä¸€ä¸ªçˆ¶å…ƒç´ å’Œè‹¥å¹²å­å…ƒç´ ç»„æˆã€‚\nåŒä¸€ä¸ªBFCçš„å­å…ƒç´ ä»¥åŠç›¸é‚»çš„çˆ¶å­å…ƒç´ ä¼šå‘ç”Ÿ**marginé‡å **ç°è±¡ï¼Œä¸åŒBFCçš„å…ƒç´ ä¸ä¼šå‘ç”Ÿé‡å ã€‚\nBFCå¯ä»¥è‡ªåŠ¨æ’‘å¼€å…ƒç´ ï¼ˆåŒ…å«æµ®åŠ¨å…ƒç´ ï¼‰\n\n## å±æ€§ä¼˜å…ˆçº§\n\n!importantï¼š `10000`\nå†…è”æ ·å¼ã€å¤–è”æ ·å¼ï¼š`1000`\nIDé€‰æ‹©å™¨ï¼š`100`\nç±»é€‰æ‹©å™¨ã€ä¼ªç±»é€‰æ‹©å™¨ã€å±æ€§é€‰æ‹©å™¨ï¼š`10`\nå…ƒç´ é€‰æ‹©å™¨ã€ä¼ªå…ƒç´ é€‰æ‹©å™¨ï¼š`1`\né€šé…é€‰æ‹©å™¨ã€åä»£é€‰æ‹©å™¨ã€å…„å¼Ÿé€‰æ‹©å™¨ï¼š`0`\n\n## å¸ƒå±€\n\n### æ™®é€šå¸ƒå±€\n\nç¬¦åˆé»˜è®¤å¸ƒå±€è§„åˆ™ã€‚å—çº§å…ƒç´ å æ»¡ä¸€è¡Œã€‚ä¸å¤Ÿä¸€è¡Œè‡ªåŠ¨æ¢è¡Œ\n\n### æµ®åŠ¨å¸ƒå±€\n\nä½¿ç”¨`float: left | right`ä½¿å…ƒç´ æµ®åŠ¨ï¼ˆä¼šè„±ç¦»æ­£å¸¸æ–‡æ¡£æµï¼‰ã€‚\n\n### å®šä½å¸ƒå±€\n\nä½¿ç”¨`position: relative | absolute | fixed`è®¾ç½®ç›¸å¯¹/ç»å¯¹å®šä½ã€‚\n`top | left | right | bottom`è®¾ç½®ä½ç½®\n\n### è¡¨æ ¼å¸ƒå±€ï¼ˆä¸è¦ä½¿ç”¨ï¼‰\n\nä½¿ç”¨`table`ç‰¹æ€§æ¥å¸ƒå±€\nå¾ˆå°çš„æ”¹åŠ¨å°±ä¼šå¯¼è‡´`table`å‘ç”Ÿå›æµã€‚\n\n### å¼¹æ€§å¸ƒå±€\n\nä½¿ç”¨`display: flex | inline-flex`è®¾ç½®å¼¹æ€§ç›’å­å®¹å™¨\n\n### å¤šåˆ—å¸ƒå±€\n\nä½¿ç”¨`column-width`å’Œ`column-count`æ¥è®¾ç½®åˆ—å®½å’Œåˆ—æ•°ï¼ˆå…¼å®¹IE10ï¼‰\nå¯ä»¥ä½¿ç”¨`columns: column-width column-count`ç®€å†™å½¢å¼\n\n`column-rule`å±æ€§è§„å®šäº†åˆ—ä¸åˆ—ä¹‹é—´çš„ç›´çº¿\n`column-rule: column-rule-width column-rule-style column-rule-color`ä¸`border`å±æ€§ç±»ä¼¼\n\n`column-span: none | all`ï¼Œ`all`è¡¨ç¤ºè·¨è¶Šæ‰€æœ‰åˆ—ã€‚\n\n### æ …æ ¼å¸ƒå±€\n\nä½¿ç”¨`display: grid | inline-grid`æ¥è®¾ç½®æ …æ ¼å®¹å™¨\n\n### å“åº”å¼å¸ƒå±€\n\nä½¿ç”¨å“åº”å¼å•ä½ï¼š`vw`ã€`vh`ã€`rem`ç­‰\nä½¿ç”¨åª’ä½“æŸ¥è¯¢\n\n```css\n@media screen and (max-width: 300px) {\n    body {\n        background-color: red;\n    }\n}\n```\n\n## å†…ç½®å‡½æ•°Function\n\n### é¢œè‰²å‡½æ•°\n\n`rgb()`ï¼šRGBé¢œè‰²å‡½æ•°ï¼Œ**çº¢ç»¿è“**\n`rgba()`ï¼šRGBAé¢œè‰²å‡½æ•°ï¼Œ**Aï¼šé€æ˜åº¦**\n\n`hsl()`ï¼šHSLé¢œè‰²å‡½æ•°ã€‚\nHï¼šè‰²ç›¸ï¼ˆ0-360degï¼‰ï¼Œ`0deg`å’Œ`360deg`ä¸ºçº¢è‰²ï¼Œ`120deg`ä¸ºç»¿è‰²ï¼Œ`240deg`ä¸ºè“è‰²ã€‚\nSï¼šé¥±å’Œåº¦ï¼ˆ0-100%ï¼‰ï¼Œ`0%`ä¸ºç°è‰²ï¼Œ`100%`ä¸ºå…¨è‰²ã€‚\nLï¼šäº®åº¦ï¼ˆ0-100%ï¼‰ï¼Œ`0%`ä¸ºæœ€æš—ï¼Œ`100%`ä¸ºæœ€äº®ã€‚\n\n`hsla()`ï¼šHSLAé¢œè‰²å‡½æ•°\n\n### å±æ€§å‡½æ•°\n\n`attr`ï¼šè·å–èŠ‚ç‚¹å±æ€§ï¼Œç›®å‰åªèƒ½é…åˆä¼ªå…ƒç´ çš„`content`å±æ€§ä½¿ç”¨\n`var`ï¼šè·å–å˜é‡\n\n```css\n--font-color: red;\n\n.warn-tip {\n    font-color: var(--font-color);\n}\n```\n\n### æ•°å­¦å‡½æ•°\n\n`min()`ï¼šæœ€å°å€¼\n`max()`ï¼šæœ€å¤§å€¼\n\n`clamp()`ï¼šè®¡ç®—åŒºé—´èŒƒå›´\n`clamp(MIN, VAL, MAX)`ï¼Œæœ€å°å€¼ã€é¦–é€‰å€¼ã€æœ€å¤§å€¼ã€‚ç›¸å½“äº`max`(MIN, `min`(VAL, MAX))\n\n`calc()`ï¼šè®¡ç®—ã€‚`æ•°å€¼`ã€`é•¿åº¦`ã€`è§’åº¦`ã€`æ—¶é—´`å’Œ`ç™¾åˆ†æ¯”`éƒ½èƒ½ä½œä¸ºå‚æ•°\n\n`counter()/counters()`ï¼šè®¡æ•°å™¨ï¼Œåªèƒ½ç”¨äºä¼ªå…ƒç´ çš„`content`å±æ€§ã€‚\néœ€è¦ç»“åˆ`counter-reset`å’Œ`counter-increment`ä¸¤ä¸ªå±æ€§ä½¿ç”¨\n\n- `counter-reset`ï¼šé‡ç½®è®¡æ•°å™¨åç§°ä¸åˆå§‹å€¼ï¼Œç¼–å†™å½¢å¼ä¸º`counter-reset:name val`\n- `counter-increment`ï¼šå¯¹æŒ‡å®šè®¡æ•°å™¨ç´¯è®¡å…¶è®¡æ•°å€¼ï¼Œç¼–å†™å½¢å¼ä¸º`counter-increment:name`ï¼Œåœ¨ä½¿ç”¨åˆ°çš„åœ°æ–¹å£°æ˜å°±ä¼šç´¯åŠ \n\n```css\ncounter-reset: times 1; /* åˆå§‹åŒ–times */\n\ncounter-increment: times 1; /* time åŠ 1 */\n\n.count::after {\n    content: counter(times);\n}\n```\n\n### èƒŒæ™¯å‡½æ•°\n\n`url()`ï¼šå›¾åƒè·¯å¾„\n`element()`ï¼ˆonly Firfoxï¼‰ï¼šå¯ä»¥å°†ç½‘ç«™ä¸­çš„æŸéƒ¨åˆ†å½“ä½œå›¾ç‰‡æ¸²æŸ“ï¼Œè¿”å›ä¸€ä¸ªå›¾åƒã€‚ç»“åˆbackgroundç­‰å±æ€§ä½¿ç”¨\n` image-set()`ï¼šå›¾åƒé›†åˆï¼Œæ ¹æ®å±å¹•åˆ†è¾¨ç‡åŒ¹é…åˆé€‚å›¾åƒ\næ¸å˜ï¼š\n\n- `linear-gradient()`ï¼šçº¿æ€§æ¸å˜\n- `radial-gradient()`ï¼šå¾„å‘æ¸å˜\n- `conic-gradient()`ï¼šé”¥å½¢æ¸å˜\n- `repeat-linear-gradient()`\n- `repeat-radial-gradient()`\n- `repeat-conic-gradient()`\n\n### æ»¤é•œå‡½æ•°\n\nç»“åˆ`filter`å±æ€§ä½¿ç”¨\n\n`blur(100)`ï¼šæ¨¡ç³Šï¼Œå…·ä½“å€¼é»˜è®¤0\n`brightness(%)`ï¼šäº®åº¦\n`contrast(%)`ï¼šå¯¹æ¯”åº¦\n`drop-shadow(h-shadow v-shadow blur spread color)`ï¼šé˜´å½±\n`grayscale(%)`ï¼šç°åº¦\n`hue-rotate(deg)`ï¼šè‰²ç›¸æ—‹è½¬\n`invert(%)`ï¼šåè½¬\n`opacity(%)`ï¼šé€æ˜åº¦\n`saturate(%)`ï¼šé¥±å’Œåº¦\n`sepia(%)`ï¼šè¤è‰²\n\n### å›¾å½¢å‡½æ•°\n\nç»“åˆ`clip-path`ä½¿ç”¨ï¼Œç”¨æ¥è£å‰ªåŒºåŸŸ\n\n`circle(30% at 50% 50%)`ï¼šåœ†å½¢è£å‰ªï¼Œ**åŠå¾„ at åœ†å¿ƒ**\n`ellipse(20px 10px at 50% 50%)`ï¼šæ¤­åœ†å½¢è£å‰ªï¼Œ**æ¨ªè½´ çºµè½´ at åœ†å¿ƒ**\n`inset(100px 50px)`ï¼šçŸ©å½¢ï¼Œé•¿å®½\n`path()`ï¼šæŒ‰ç…§è·¯å¾„è£å‰ª\n`polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)`ï¼šæŒ‰ç…§å¤šè¾¹å½¢è£å‰ªï¼ˆé¡ºæ—¶é’ˆï¼‰\n\n### å˜æ¢å‡½æ•°\n\nç»“åˆ`transform`å±æ€§ä½¿ç”¨\n\n`rotate(deg | turn)`\n`translate(x, y)`\n`scale(x y)`\n`skew(x, y)`\n`perspective()`ï¼šè®¾ç½®é€è§†è¯•å›¾\n\n### ç¼“åŠ¨å‡½æ•°\n\n`cubic-bezier()`ï¼šè´å¡å°”æ›²çº¿\n`steps()`ï¼šé€å¸§\n\n## å˜é‡Variable\n\n`CSS`æœ‰è‡ªå·±çš„ä¸€å¥—å˜é‡ç³»ç»Ÿã€‚å…¼å®¹æ€§å¦‚ä¸‹ï¼š\n\n![css var](../../images/css var.jpg)\n\n### è®¤è¯†\n\n- å£°æ˜ï¼š`--å˜é‡å`\n- è¯»å–ï¼š`var(--å˜é‡å, é»˜è®¤å€¼)`\n- ç±»å‹\n  - æ™®é€šï¼šåªèƒ½ç”¨ä½œ`å±æ€§å€¼`ä¸èƒ½ç”¨ä½œ`å±æ€§å`\n  - å­—ç¬¦ï¼šä¸å­—ç¬¦ä¸²æ‹¼æ¥ `\"Hello, \"var(--name)`\n  - æ•°å€¼ï¼šä½¿ç”¨`calc()`ä¸æ•°å€¼å•ä½è¿ç”¨ `var(--width) * 10px`\n- ä½œç”¨åŸŸ\n  - èŒƒå›´ï¼šåœ¨`å½“å‰èŠ‚ç‚¹å—ä½œç”¨åŸŸ`åŠå…¶`å­èŠ‚ç‚¹å—ä½œç”¨åŸŸ`ä¸‹æœ‰æ•ˆ\n  - ä¼˜å…ˆçº§åˆ«ï¼š`å†…è”æ ·å¼ = å¤–è”æ ·å¼ > IDé€‰æ‹©å™¨ > ç±»é€‰æ‹©å™¨ = ä¼ªç±»é€‰æ‹©å™¨ = å±æ€§é€‰æ‹©å™¨ > å…ƒç´ é€‰æ‹©å™¨ = ä¼ªå…ƒç´ é€‰æ‹©å™¨ > é€šé…é€‰æ‹©å™¨ = åä»£é€‰æ‹©å™¨ = å…„å¼Ÿé€‰æ‹©å™¨`\n\n### ä½¿ç”¨æŠ€å·§\n\n#### ä¸»é¢˜æ¢è‚¤\n\n```vue\n<template>\n\t<div ref=\"container\" style=\"--theme-color: white\"></div>\n\t<button @click=\"switchTheme\">æ¢è‚¤</button>\n</template>\t\n\n<script>\nexport default {\n    methods: {\n        switchTheme() {\n            this.$refs.container.style.setProperty(\"--theme-color\", \"red\")\n        }\n    }\n}\n</script>\n\n<style lang=\"scss\">\n    .container {\n        --bg-color: var(--theme-color);\n        background-color: var(--bg-color);\n    }\n</style>\n```\n\nå¯è§ï¼Œ`css`å˜é‡å¯ä»¥ä¸`JS`è¿›è¡Œäº¤äº’ã€‚`scss`çš„å˜é‡åšä¸åˆ°ã€‚\n\n#### æ‚¬æµ®è§†å·®\n\n```vue\n<template>\n  <div ref=\"bg\" class=\"bruce flex-ct-x\" data-title=\"æ‚¬æµ®è§†å·®æŒ‰é’®\">\n    <a\n      ref=\"btn\"\n      class=\"parallax-btn\"\n      data-name=\"å¦™ç”¨CSSå˜é‡ï¼Œè®©ä½ çš„CSSå˜å¾—æ›´å¿ƒåŠ¨\"\n      @mousemove=\"move\"\n      @mouseup=\"up\"\n      @mousedown=\"down\"\n      @mouseleave=\"leave\"\n    ></a>\n  </div>\n</template>\n\n<script>\nexport default {\n  mounted() {\n    this.bgStyle = this.$refs.bg.style;\n    this.btnRect = this.$refs.btn.getBoundingClientRect();\n  },\n  methods: {\n    down(e) {\n      this.bgStyle.setProperty(\"--tz\", \"-25px\");\n    },\n    leave(e) {\n      this.bgStyle.setProperty(\"--ty\", \"0\");\n      this.bgStyle.setProperty(\"--rx\", \"0\");\n      this.bgStyle.setProperty(\"--ry\", \"0\");\n    },\n    move(e) {\n      const dx = e.offsetX - this.btnRect.width / 2;\n      const dy = e.offsetY - this.btnRect.height / 2;\n      this.bgStyle.setProperty(\"--rx\", `${dy / -1}deg`);\n      this.bgStyle.setProperty(\"--ry\", `${dx / 10}deg`);\n    },\n    up() {\n      this.bgStyle.setProperty(\"--tz\", \"-12px\");\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.bruce {\n  transform: perspective(800px);\n  transform-style: preserve-3d;\n\n  height: 100vh;\n\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.parallax-btn {\n  position: relative;\n  width: 400px;\n  height: 50px;\n  cursor: pointer;\n  user-select: none;\n  line-height: 50px;\n  text-align: center;\n  font-size: 18px;\n  color: #fff;\n  &::before {\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    border-radius: 4px;\n    background: linear-gradient(135deg, #6e8efb, #a777e3);\n    box-shadow: 0 2px 5px rgba(#000, 0.2);\n    content: \"\";\n    will-change: transform;\n    transform: translateY(var(--ty, 0)) rotateX(var(--rx, 0))\n      rotateY(var(--ry, 0)) translateZ(var(--tz, -12px));\n    transition: box-shadow 500ms ease, transform 200ms ease;\n  }\n  &::after {\n    display: inline-block;\n    position: relative;\n    font-weight: bold;\n    content: attr(data-name);\n    will-change: transform;\n    transform: translateY(var(--ty, 0)) rotateX(var(--rx, 0))\n      rotateY(var(--ry, 0));\n    transition: transform 200ms ease;\n  }\n  &:hover::before {\n    box-shadow: 0 5px 15px rgba(#000, 0.3);\n  }\n}\n</style>\n```\n\n## é€‰æ‹©å™¨Selector\n\n### åŸºç¡€é€‰æ‹©å™¨\n\n| é€‰æ‹©å™¨   | åˆ«å       | è¯´æ˜             | ç‰ˆæœ¬ |\n| -------- | ---------- | ---------------- | ---- |\n| `tag`    | æ ‡ç­¾é€‰æ‹©å™¨ | æŒ‡å®šç±»å‹çš„`æ ‡ç­¾` | 1    |\n| `#id`    | IDé€‰æ‹©å™¨   | æŒ‡å®šèº«ä»½çš„`æ ‡ç­¾` | 1    |\n| `.class` | ç±»é€‰æ‹©å™¨   | æŒ‡å®šç±»åçš„`æ ‡ç­¾` | 1    |\n| `*`      | é€šé…é€‰æ‹©å™¨ | æ‰€æœ‰ç±»å‹çš„`æ ‡ç­¾` | 2    |\n\n### å±‚æ¬¡é€‰æ‹©å™¨\n\n| é€‰æ‹©å™¨  | åˆ«å             | è¯´æ˜                 | ç‰ˆæœ¬ |\n| ------- | ---------------- | -------------------- | ---- |\n| `a b`   | `åä»£é€‰æ‹©å™¨`     | å…ƒç´ çš„`åä»£å…ƒç´ `     | 1    |\n| `a > b` | `å­ä»£é€‰æ‹©å™¨`     | å…ƒç´ çš„`å­ä»£å…ƒç´ `     | 2    |\n| `a + b` | `ç›¸é‚»åŒèƒé€‰æ‹©å™¨` | å…ƒç´ ç›¸é‚»çš„`åŒèƒå…ƒç´ ` | 2    |\n| `a ~ b` | `é€šç”¨åŒèƒé€‰æ‹©å™¨` | å…ƒç´ åé¢çš„`åŒèƒå…ƒç´ ` | 3    |\n\n### é›†åˆé€‰æ‹©å™¨\n\n| é€‰æ‹©å™¨    | åˆ«å         | è¯´æ˜             | ç‰ˆæœ¬ |\n| --------- | ------------ | ---------------- | ---- |\n| `a, b`    | `å¹¶é›†é€‰æ‹©å™¨` | å¤šä¸ªæŒ‡å®šçš„`å…ƒç´ ` | 1    |\n| `a.class` | `äº¤é›†é€‰æ‹©å™¨` | æŒ‡å®šç±»åçš„`å…ƒç´ ` | 1    |\n\n### æ¡ä»¶é€‰æ‹©å™¨\n\n| é€‰æ‹©å™¨        | è¯´æ˜                                     | ç‰ˆæœ¬ |\n| ------------- | ---------------------------------------- | ---- |\n| `:lang`       | æŒ‡å®šæ ‡è®°è¯­è¨€çš„`å…ƒç´ `ï¼Œä¾‹ï¼š`p:lang(en)`   | 2    |\n| `:dir()`      | æŒ‡å®šç¼–å†™æ–¹å‘çš„`å…ƒç´ `                     | 4    |\n| `:has`        | åŒ…å«æŒ‡å®šå…ƒç´ çš„`å…ƒç´ `                     | 4    |\n| `:is`         | æŒ‡å®šæ¡ä»¶çš„`å…ƒç´ `                         | 4    |\n| `:not`        | éæŒ‡å®šæ¡ä»¶çš„`å…ƒç´ `                       | 4    |\n| `:where`      | æŒ‡å®šæ¡ä»¶çš„`å…ƒç´ `                         | 4    |\n| `:scope`      | æŒ‡å®š`å…ƒç´ `ä½œä¸ºå‚è€ƒç‚¹                     | 4    |\n| `:any-link`   | æ‰€æœ‰åŒ…å«`href`çš„`é“¾æ¥å…ƒç´ `               | 4    |\n| `:local-link` | æ‰€æœ‰åŒ…å«`href`ä¸”å±äºç»å¯¹åœ°å€çš„`é“¾æ¥å…ƒç´ ` | 4    |\n\n> ä¸Šé¢è®¸å¤šé€‰æ‹©å™¨ï¼Œç›®å‰ä¸»æµæµè§ˆå™¨éƒ½æœªå®ç°\n\n### è¡Œä¸ºé€‰æ‹©å™¨\n\n| é€‰æ‹©å™¨        | è¯´æ˜             | ç‰ˆæœ¬ |\n| ------------- | ---------------- | ---- |\n| `:active`     | é¼ æ ‡æ¿€æ´»çš„`å…ƒç´ ` | 1    |\n| `:hover`      | é¼ æ ‡æ‚¬æµ®çš„`å…ƒç´ ` | 1    |\n| `::selection` | é¼ æ ‡é€‰ä¸­çš„`å…ƒç´ ` | 3    |\n\n### çŠ¶æ€é€‰æ‹©å™¨\n\n| é€‰æ‹©å™¨               | è¯´æ˜                                                         | ç‰ˆæœ¬ |\n| -------------------- | ------------------------------------------------------------ | ---- |\n| `:target`            | å½“å‰é”šç‚¹çš„`å…ƒç´ `                                             | 3    |\n| `:link`              | æœªè®¿é—®çš„`é“¾æ¥å…ƒç´ `                                           | 1    |\n| `:visited`           | å·²è®¿é—®çš„`é“¾æ¥å…ƒç´ `                                           | 1    |\n| `:focus`             | è¾“å…¥èšç„¦çš„`è¡¨å•å…ƒç´ `                                         | 2    |\n| `:required`          | è¾“å…¥å¿…å¡«çš„`è¡¨å•å…ƒç´ `                                         | 3    |\n| `:valid`             | è¾“å…¥åˆæ³•çš„`è¡¨å•å…ƒç´ `                                         | 3    |\n| `:invalid`           | è¾“å…¥éæ³•çš„`è¡¨å•å…ƒç´ `                                         | 3    |\n| `:in-range`          | è¾“å…¥èŒƒå›´ä»¥å†…çš„`è¡¨å•å…ƒç´ `                                     | 3    |\n| `:out-of-range`      | è¾“å…¥èŒƒå›´ä»¥å¤–çš„`è¡¨å•å…ƒç´ `                                     | 3    |\n| `:checked`           | é€‰é¡¹é€‰ä¸­çš„`è¡¨å•å…ƒç´ `<br />æ­é…`appearance`ï¼Œå¯ä»¥è‡ªå®šä¹‰é»˜è®¤çš„å•é€‰ã€å¤é€‰æ¡† | 3    |\n| `:optional`          | é€‰é¡¹å¯é€‰çš„`è¡¨å•å…ƒç´ `ï¼Œæ²¡æœ‰`required`çš„éƒ½æ˜¯                   | 3    |\n| `:enabled`           | äº‹ä»¶å¯ç”¨çš„`è¡¨å•å…ƒç´ `ï¼Œä¸`disabled`ç›¸å¯¹åº”                     | 3    |\n| `:disabled`          | äº‹ä»¶ç¦ç”¨çš„`è¡¨å•å…ƒç´ `                                         | 3    |\n| `:read-only`         | åªè¯»çš„`è¡¨å•å…ƒç´ `ï¼Œä¸`read-write`ç›¸å¯¹åº”                       | 3    |\n| `:read-write`        | å¯è¯»å¯å†™çš„`è¡¨å•å…ƒç´ `                                         | 3    |\n| `:target-within`     | å†…éƒ¨é”šç‚¹å…ƒç´ å¤„äºæ¿€æ´»çŠ¶æ€çš„`å…ƒç´ `                             | 4    |\n| `:focus-within`      | å†…éƒ¨è¡¨å•å…ƒç´ å¤„äºèšç„¦çŠ¶æ€çš„`å…ƒç´ `                             | 4    |\n| `:focus-visible`     | è¾“å…¥èšç„¦çš„`è¡¨å•å…ƒç´ `                                         | 4    |\n| `:blank`             | è¾“å…¥ä¸ºç©ºçš„`è¡¨å•å…ƒç´ `                                         | 4    |\n| `:user-invalid`      | è¾“å…¥åˆæ³•çš„`è¡¨å•å…ƒç´ `                                         | 4    |\n| `:indeterminate`     | é€‰é¡¹æœªå®šçš„`è¡¨å•å…ƒç´ `                                         | 4    |\n| `:placeholder-shown` | å ä½æ˜¾ç¤ºplaceholderçš„`è¡¨å•å…ƒç´ `(input)                       | 4    |\n| `:current()`         | æµè§ˆä¸­çš„`å…ƒç´ `                                               | 4    |\n| `:past()`            | å·²æµè§ˆçš„`å…ƒç´ `                                               | 4    |\n| `:future()`          | æœªæµè§ˆçš„`å…ƒç´ `                                               | 4    |\n| `:playing`           | å¼€å§‹æ’­æ”¾çš„`åª’ä½“å…ƒç´ `                                         | 4    |\n| `:paused`            | æš‚åœæ’­æ”¾çš„`åª’ä½“å…ƒç´ `                                         | 4    |\n\n### ç»“æ„é€‰æ‹©å™¨\n\n| é€‰æ‹©å™¨                 | è¯´æ˜                                                      | ç‰ˆæœ¬ |\n| ---------------------- | --------------------------------------------------------- | ---- |\n| `:root`                | æ–‡æ¡£çš„`æ ¹å…ƒç´ `ï¼Œå³`html`<br />é€šå¸¸åœ¨è¿™å£°æ˜å…¨å±€å˜é‡        | 3    |\n| `:empty`               | æ— å­å…ƒç´ çš„`å…ƒç´ `                                          | 3    |\n| `:first-letter`        | å…ƒç´ çš„`é¦–å­—æ¯`                                            | 1    |\n| `:first-line`          | å…ƒç´ çš„`é¦–è¡Œ`                                              | 1    |\n| `:nth-child(n)`        | æŒ‡å®šå…ƒç´ çš„çˆ¶å…ƒç´ çš„ç¬¬nä¸ª**å­å…ƒç´ **                         | 3    |\n| `:nth-last-child(n)`   | æŒ‡å®šå…ƒç´ çš„çˆ¶å…ƒç´ çš„å€’æ•°ç¬¬nä¸ªå­å…ƒç´                          | 3    |\n| `:first-child`         | æŒ‡å®šå…ƒç´ çš„çˆ¶å…ƒç´ çš„ç¬¬ä¸€ä¸ª**å­å…ƒç´ **                        | 2    |\n| `:last-child`          | æŒ‡å®šå…ƒç´ çš„çˆ¶å…ƒç´ çš„æœ€åä¸€ä¸ª**å­å…ƒç´ **                      | 3    |\n| `:only-child`          | çˆ¶å…ƒç´ ä»…æœ‰è¯¥å…ƒç´ çš„`å…ƒç´ `                                  | 3    |\n| `:nth-of-type(n)`      | æŒ‡å®šå…ƒç´ çš„çˆ¶å…ƒç´ çš„ç¬¬nä¸ªä¸æŒ‡å®šå…ƒç´ ç›¸åŒæ ‡ç­¾çš„**å­å…ƒç´ **     | 3    |\n| `:nth-last-of-type(n)` | æŒ‡å®šå…ƒç´ çš„çˆ¶å…ƒç´ çš„å€’æ•°ç¬¬nä¸ªä¸æŒ‡å®šå…ƒç´ ç›¸åŒæ ‡ç­¾çš„**å­å…ƒç´ ** | 3    |\n| `:first-of-type`       | æŒ‡å®šå…ƒç´ çš„çˆ¶å…ƒç´ çš„ç¬¬ä¸€ä¸ªä¸æŒ‡å®šå…ƒç´ ç›¸åŒæ ‡ç­¾çš„**å­å…ƒç´ **    | 3    |\n| `:last-of-type`        | æŒ‡å®šå…ƒç´ çš„çˆ¶å…ƒç´ çš„æœ€åä¸€ä¸ªä¸æŒ‡å®šå…ƒç´ ç›¸åŒæ ‡ç­¾çš„**å­å…ƒç´ **  | 3    |\n| `:only-of-type`        | çˆ¶å…ƒç´ ä»…æœ‰è¯¥æ ‡ç­¾çš„`æ ‡ç­¾`                                  | 3    |\n\n### å±æ€§é€‰æ‹©å™¨\n\n| é€‰æ‹©å™¨        | è¯´æ˜                                           | ç‰ˆæœ¬ |\n| ------------- | ---------------------------------------------- | ---- |\n| `[attr]`      | æŒ‡å®šå±æ€§çš„`å…ƒç´ `                               | 2    |\n| `[attr=val]`  | å±æ€§ç­‰äºæŒ‡å®šå€¼çš„`å…ƒç´ `                         | 2    |\n| `[attr*=val]` | å±æ€§åŒ…å«æŒ‡å®šå€¼çš„`å…ƒç´ `                         | 3    |\n| `[attr^=val]` | å±æ€§ä»¥æŒ‡å®šå€¼å¼€å¤´çš„`å…ƒç´ `                       | 3    |\n| `[attr$=val]` | å±æ€§ä»¥æŒ‡å®šå€¼ç»“å°¾çš„`å…ƒç´ `                       | 3    |\n| `[attr~=val]` | å±æ€§åŒ…å«æŒ‡å®šå€¼(å®Œæ•´å•è¯)çš„`å…ƒç´ `(ä¸æ¨èä½¿ç”¨)   | 2    |\n| `[attr|=val]` | å±æ€§ä»¥æŒ‡å®šå€¼(å®Œæ•´å•è¯)å¼€å¤´çš„`å…ƒç´ `(ä¸æ¨èä½¿ç”¨) | 2    |\n\n### ä¼ªå…ƒç´ \n\n| é€‰æ‹©å™¨     | è¯´æ˜                             | ç‰ˆæœ¬ |\n| ---------- | -------------------------------- | ---- |\n| `::before` | åœ¨æŒ‡å®šå…ƒç´ æ‰€æœ‰å­å…ƒç´ å‰æ’å…¥çš„å†…å®¹ | 2    |\n| `::after`  | åœ¨æŒ‡å®šå…ƒç´ æ‰€æœ‰å­å…ƒç´ åæ’å…¥çš„å†…å®¹ | 2    |\n\n## èƒŒæ™¯Background\n\n### æ‰€æœ‰å±æ€§\n\n`background`å­å±æ€§ä¼—å¤šï¼Œå…¶å±æ€§å–å€¼ä¹Ÿå¾ˆå¤šã€‚\n\nbackground-colorï¼šé¢œè‰²\n\n- `transparent`ï¼šé€æ˜(`é»˜è®¤`)\n- `Keyword`ï¼šé¢œè‰²å…³é”®å­—\n- `HEX`ï¼šåå…­è¿›åˆ¶è‰²å½©æ¨¡å¼\n- `RGB`æˆ–`RGBA`ï¼šRGB/Aè‰²å½©æ¨¡å¼\n- `HSL`æˆ–`HSLA`ï¼šHSL/Aè‰²å½©æ¨¡å¼\n- `Color1/Color2`ï¼šè¦†ç›–é¢œè‰²ï¼ŒèƒŒæ™¯é¢œè‰²å¯èƒ½æ˜¯`Color1`ï¼Œè‹¥èƒŒæ™¯å›¾åƒæ— æ•ˆåˆ™ä½¿ç”¨`Color2`ä»£æ›¿`Color1`\n\nbackground-imageï¼šå›¾åƒ\n\n- `none`ï¼šæ— å›¾åƒ(`é»˜è®¤`)\n- `url()`ï¼šå›¾åƒè·¯å¾„\n\nbackground-repeatï¼šå›¾åƒå¹³é“ºæ–¹å¼\n\n- `repeat`ï¼šå›¾åƒåœ¨æ°´å¹³æ–¹å‘å’Œå‚ç›´æ–¹å‘é‡å¤(`é»˜è®¤`)\n- `repeat-x`ï¼šå›¾åƒåœ¨æ°´å¹³æ–¹å‘é‡å¤\n- `repeat-y`ï¼šå›¾åƒåœ¨å‚ç›´æ–¹å‘é‡å¤\n- `no-repeat`ï¼šå›¾åƒä»…é‡å¤ä¸€æ¬¡\n- `space`ï¼šå›¾åƒä»¥ç›¸åŒé—´è·å¹³é“ºä¸”å¡«å……æ•´ä¸ªèŠ‚ç‚¹\n- `round`ï¼šå›¾åƒè‡ªåŠ¨ç¼©æ”¾ç›´åˆ°é€‚åº”ä¸”å¡«å……æ•´ä¸ªèŠ‚ç‚¹\n\nbackground-attachmentï¼šå›¾åƒä¾é™„æ–¹å¼\n\n- `scroll`ï¼šå›¾åƒéšé¡µé¢æ»šåŠ¨è€Œç§»åŠ¨(`é»˜è®¤`)\n- `fixed`ï¼šå›¾åƒä¸ä¼šéšé¡µé¢æ»šåŠ¨è€Œç§»åŠ¨\n\nbackground-positionï¼šå›¾åƒèµ·å§‹ä½ç½®\n\n- `Position`ï¼šä½ç½®ï¼Œå¯ç”¨ä»»ä½•é•¿åº¦å•ä½ï¼Œç¬¬äºŒä¸ªä½ç½®(Yè½´)ä¸å£°æ˜é»˜è®¤æ˜¯`50%`(é»˜è®¤`0% 0%`)\n- `Keyword`ï¼šä½ç½®å…³é”®å­—`leftã€rightã€topã€bottomã€center`ï¼Œå¯å•åŒä½¿ç”¨ï¼Œç¬¬äºŒä¸ªå…³é”®å­—ä¸å£°æ˜é»˜è®¤æ˜¯`center`\n\nbackground-sizeï¼šå›¾åƒå°ºå¯¸æ¨¡å¼\n\n- `auto`ï¼šè‡ªåŠ¨è®¾ç½®å°ºå¯¸(`é»˜è®¤`)\n- `cover`ï¼šå›¾åƒæ‰©å±•è‡³è¶³å¤Ÿå¤§ï¼Œä½¿å…¶å®Œå…¨è¦†ç›–æ•´ä¸ªåŒºåŸŸï¼Œå›¾åƒæŸäº›éƒ¨åˆ†ä¹Ÿè®¸æ— æ³•æ˜¾ç¤ºåœ¨åŒºåŸŸä¸­\n- `contain`ï¼šå›¾åƒæ‰©å±•è‡³æœ€å¤§å°ºå¯¸ï¼Œä½¿å…¶å®½åº¦å’Œé«˜åº¦å®Œå…¨é€‚åº”æ•´ä¸ªåŒºåŸŸ\n- `Size`ï¼šå°ºå¯¸ï¼Œå¯ç”¨ä»»ä½•é•¿åº¦å•ä½ï¼Œç¬¬äºŒä¸ªå°ºå¯¸(é«˜)ä¸å£°æ˜é»˜è®¤æ˜¯`auto`\n\nbackground-originï¼šå®šä½åŒºåŸŸ(ä¸background-positionç»“åˆä½¿ç”¨)\n\n- `padding-box`ï¼šå›¾åƒç›¸å¯¹å¡«å……å®šä½(`é»˜è®¤`)\n- `border-box`ï¼šå›¾åƒç›¸å¯¹è¾¹æ¡†å®šä½\n- `content-box`ï¼šå›¾åƒç›¸å¯¹å†…å®¹å®šä½\n\nbackground-clipï¼šç»˜åˆ¶åŒºåŸŸ\n\n- `border-box`ï¼šå›¾åƒè¢«è£å‰ªåˆ°è¾¹æ¡†ä¸è¾¹è·çš„äº¤ç•Œå¤„(`é»˜è®¤`)\n- `padding-box`ï¼šå›¾åƒè¢«è£å‰ªåˆ°å¡«å……ä¸è¾¹æ¡†çš„çš„äº¤ç•Œå¤„\n- `content-box`ï¼šå›¾åƒè¢«è£å‰ªåˆ°å†…å®¹ä¸å¡«å……çš„äº¤ç•Œå¤„\n\nbackground-blend-modeï¼šæ··åˆæ¨¡å¼\n\n- `normal`ï¼šæ­£å¸¸(`é»˜è®¤`)\n- `color-burn`ï¼šé¢œè‰²åŠ æ·±\n- `color-dodge`ï¼šé¢œè‰²å‡æ·¡\n- `color`ï¼šé¢œè‰²\n- `darken`ï¼šå˜æš—\n- `difference`ï¼šå·®å€¼\n- `exclusion`ï¼šæ’é™¤\n- `hard-light`ï¼šå¼ºå…‰\n- `hue`ï¼šè‰²ç›¸\n- `lighten`ï¼šå˜äº®\n- `luminosity`ï¼šäº®åº¦\n- `multiply`ï¼šæ­£ç‰‡å åº•\n- `overlay`ï¼šå åŠ \n- `saturation`ï¼šé¥±å’Œåº¦\n- `screen`ï¼šæ»¤è‰²\n- `soft-light`ï¼šæŸ”å…‰\n\n>`background`å±æ€§å¯ä»¥è¿å†™ã€‚\n>\n>- `background: color image repeat attachment position/size`\n>- æ”¯æŒå¤šé‡èƒŒæ™¯ï¼š`background-image: url($bg-4), url($bg-3);`\n\n### èƒŒæ™¯æ¸å˜\n\n`CSS`æ¸å˜åˆ†ä¸º3ç§ï¼š\n\n-  **çº¿æ€§æ¸å˜**ï¼šæ²¿ç€æŒ‡å®šæ–¹å‘ä»èµ·ç‚¹åˆ°ç»ˆç‚¹é€æ¸æ”¹å˜é¢œè‰²ï¼Œæ¸å˜å½¢çŠ¶æ˜¯ä¸€æ¡`ç›´çº¿`\n-  **å¾„å‘æ¸å˜**ï¼šæ²¿ç€ä»»æ„æ–¹å‘ä»åœ†å¿ƒå¾€å¤–é¢é€æ¸æ”¹å˜é¢œè‰²ï¼Œæ¸å˜å½¢çŠ¶æ˜¯ä¸€ä¸ª`åœ†å½¢`æˆ–`æ¤­åœ†å½¢`\n-  **é”¥å½¢æ¸å˜**ï¼šæ²¿ç€é¡ºæ—¶é’ˆæ–¹å‘ä»åœ†å¿ƒå¾€å¤–é¢é€æ¸æ”¹å˜é¢œè‰²ï¼Œæ¸å˜å½¢çŠ¶æ˜¯ä¸€ä¸ª`åœ†é”¥ä½“`\n\nç›¸å…³å±æ€§æœ‰**6ä¸ª**\n\n-  **linear-gradient()**ï¼šçº¿æ€§æ¸å˜\n-  **radial-gradient()**ï¼šå¾„å‘æ¸å˜\n-  **conic-gradient()**ï¼šé”¥å½¢æ¸å˜\n-  **repeating-linear-gradient()**ï¼šé‡å¤çº¿æ€§æ¸å˜\n-  **repeating-radial-gradient()**ï¼šé‡å¤å¾„å‘æ¸å˜\n-  **repeating-conic-gradient()**ï¼šé‡å¤é”¥å½¢æ¸å˜\n\n#### çº¿æ€§æ¸å˜\n\n`background-image: linear-gradient(direction, color-stop)`\n\n- `direction`ï¼šæ–¹å‘\n  - `Keyword`ï¼šæ–¹å‘å…³é”®å­—`to left/right/top/bottom/top left/top right/bottom left/bottom right`(é»˜è®¤`to bottom`)\n  - `Angle`ï¼šè§’åº¦ï¼Œä»¥é¡ºæ—¶é’ˆæ–¹å‘çš„å‚ç›´çº¿å’Œæ¸å˜çº¿çš„å¤¹è§’è®¡ç®—ï¼Œè¶…å‡ºNåœˆåˆ™è®¡ç®—å‰©ä½™è§’åº¦\n- `color-stop`ï¼šè‰²æ ‡\n  - `Color`ï¼šé¢œè‰²ï¼Œå¯å‚è€ƒ`background-color`å–å€¼ï¼Œåœ¨æŒ‡å®šä½ç½®äº§ç”Ÿæ¸å˜æ•ˆæœæ‰€ä½¿ç”¨çš„é¢œè‰²\n  - `Position`ï¼šä½ç½®ï¼Œå¯å‚è€ƒ`background-position`çš„`Position`å–å€¼ï¼Œåœ¨æŒ‡å®šä½ç½®äº§ç”Ÿæ¸å˜æ•ˆæœ\n\n```css\n.elem {\n    width: 400px;\n    height: 200px;\n    background-image: linear-gradient(to bottom, #f66, #66f);\n    /* ç­‰ä»·äº */\n    background-image: linear-gradient(to bottom, #f66 0, #66f 100%);\n    \n    /* color start end  */\n    /* background-image: linear-gradient(to bottom, #f66 0 50%, #66f 100%); */\n}\n```\n\n`css`çš„è§’åº¦è·Ÿç›´è§’åæ ‡ç³»ä¸åŒï¼Œæ­£ä¸Šæ–¹ä¸º0åº¦ï¼Œç±»ä¼¼è¡¨ç›˜\n\n![css degree](../../images/css degree.jpg)\n\n#### å¾„å‘æ¸å˜\n\n`background-image: radial-gradient(shape size at position, color-stop)`\n\nå¾„å‘æ¸å˜å¯ä»¥ç”¨æ¥è¯é¥¼å›¾ã€‚\n\n- Shapeï¼šå½¢çŠ¶\n  - `ellipse`ï¼šæ¤­åœ†å½¢(`é»˜è®¤`)\n  - `circle`ï¼šåœ†å½¢\n- Sizeï¼šå°ºå¯¸\n  - `farthest-corner`ï¼šä»åœ†å¿ƒåˆ°ç¦»åœ†å¿ƒæœ€è¿œçš„è§’ä¸ºåŠå¾„(`é»˜è®¤`)\n  - `farthest-side`ï¼šä»åœ†å¿ƒåˆ°ç¦»åœ†å¿ƒæœ€è¿œçš„è¾¹ä¸ºåŠå¾„\n  - `closest-corner`ï¼šä»åœ†å¿ƒåˆ°ç¦»åœ†å¿ƒæœ€è¿‘çš„è§’ä¸ºåŠå¾„\n  - `closest-side`ï¼šä»åœ†å¿ƒåˆ°ç¦»åœ†å¿ƒæœ€è¿‘çš„è¾¹ä¸ºåŠå¾„\n  - `Size`ï¼šå°ºå¯¸ï¼Œå¯ç”¨ä»»ä½•é•¿åº¦å•ä½ï¼Œå®½å’Œé«˜å¿…é¡»åŒæ—¶å£°æ˜\n- Positionï¼šä½ç½®\n  - `Keyword`ï¼šä½ç½®å…³é”®å­—`leftã€rightã€topã€bottomã€center`(é»˜è®¤`center`)\n  - `Position`ï¼šä½ç½®ï¼Œå¯ç”¨ä»»ä½•é•¿åº¦å•ä½\n- color-stopï¼šè‰²æ ‡\n  - `Color`ï¼šé¢œè‰²ï¼Œå¯å‚è€ƒ`background-color`å–å€¼ï¼Œåœ¨æŒ‡å®šä½ç½®äº§ç”Ÿæ¸å˜æ•ˆæœæ‰€ä½¿ç”¨çš„é¢œè‰²\n  - `Position`ï¼šä½ç½®ï¼Œå¯å‚è€ƒ`background-position`çš„`Position`å–å€¼ï¼Œåœ¨æŒ‡å®šä½ç½®äº§ç”Ÿæ¸å˜æ•ˆæœ\n\n```css\n.elem {\n    width: 400px;\n    height: 200px;\n    background-image: radial-gradient(100px 100px, #f66, #66f);\n    /* ç­‰ä»·äº */\n    background-image: radial-gradient(ellipse 100px 100px at center, #f66, #66f);\n}\n```\n\n#### é”¥å½¢æ¸å˜\n\n`background-image: conic-gradient(color-stop)`\n\n**color-stop**ï¼šè‰²æ ‡\n\n- `Color`ï¼šé¢œè‰²ï¼Œå¯å‚è€ƒ`background-color`å–å€¼ï¼Œåœ¨æŒ‡å®šä½ç½®äº§ç”Ÿæ¸å˜æ•ˆæœæ‰€ä½¿ç”¨çš„é¢œè‰²\n- `Position`ï¼šä½ç½®ï¼Œå¯å‚è€ƒ`background-position`çš„`Position`å–å€¼ï¼Œåœ¨æŒ‡å®šä½ç½®äº§ç”Ÿæ¸å˜æ•ˆæœ\n\n```css\n.elem {\n    width: 400px;\n    height: 200px;\n    background-image: conic-gradient(#f66, #66f);\n    /* ç­‰ä»·äº */\n    background-image: conic-gradient(#f66 0, #66f 100%);\n}\n```\n#### å®ç°ç½‘æ ¼å›¾å±‚\n```vue\n<template>\n\t<div class=\"grid-box\"></div>\n</template>\n\n<style>\n    background-image: linear-gradient(\n        to top right,\n        #eee 25%,\n        transparent 25%,\n        transparent 75%,\n        #eee 75%,\n        #eee 100%\n    ),\n      linear-gradient(\n        to top right,\n        #eee 25%,\n        transparent 25%,\n        transparent 75%,\n        #eee 75%,\n        #eee 100%\n    );\n    background-position: 0 0, 10px 10px;\n    background-size: 20px 20px;\n</style> \n```\n\n### é®ç½©\n\né®ç½©æˆ–è€…è¯´è’™ç‰ˆï¼Œå°±æ˜¯åœ¨èƒŒæ™¯ä¸Šå†åŠ ä¸€å±‚ã€‚å®ƒå¯ä»¥å®ç°è¯¸å¦‚è£å‰ªèƒŒæ™¯çš„æ•ˆæœã€‚\n\n`mask`å­å±æ€§æ¯”`background`å­å±æ€§å·®ä¸å¤šã€‚\n\nmask-modeï¼šæ¨¡å¼\n\n- `match-source`ï¼šæ ¹æ®å›¾åƒç±»å‹é‡‡ç”¨åˆé€‚çš„é®ç½©æ¨¡å¼(`é»˜è®¤`)\n- `alpha`ï¼šæ ¹æ®å›¾åƒé€æ˜åº¦é‡‡ç”¨åˆé€‚çš„é®ç½©æ¨¡å¼\n- `luminance`ï¼šæ ¹æ®å›¾åƒäº®åº¦é‡‡ç”¨åˆé€‚çš„é®ç½©æ¨¡å¼\n\nmask-imageï¼šå›¾åƒ\n\n- `none`ï¼šæ— å›¾åƒ(`é»˜è®¤`)\n- `url()`ï¼šå›¾åƒè·¯å¾„\n\nmask-repeatï¼šå›¾åƒå¹³é“ºæ–¹å¼\n\n- `repeat`ï¼šå›¾åƒåœ¨æ°´å¹³æ–¹å‘å’Œå‚ç›´æ–¹å‘é‡å¤(`é»˜è®¤`)\n- `repeat-x`ï¼šå›¾åƒåœ¨æ°´å¹³æ–¹å‘é‡å¤\n- `repeat-y`ï¼šå›¾åƒåœ¨å‚ç›´æ–¹å‘é‡å¤\n- `no-repeat`ï¼šå›¾åƒä»…é‡å¤ä¸€æ¬¡\n- `space`ï¼šå›¾åƒä»¥ç›¸åŒé—´è·å¹³é“ºä¸”å¡«å……æ•´ä¸ªèŠ‚ç‚¹\n- `round`ï¼šå›¾åƒè‡ªåŠ¨ç¼©æ”¾ç›´åˆ°é€‚åº”ä¸”å¡«å……æ•´ä¸ªèŠ‚ç‚¹\n\nmask-positionï¼šå›¾åƒèµ·å§‹ä½ç½®\n\n- `Position`ï¼šä½ç½®ï¼Œå¯ç”¨ä»»ä½•é•¿åº¦å•ä½ï¼Œç¬¬äºŒä¸ªä½ç½®(Yè½´)ä¸å£°æ˜é»˜è®¤æ˜¯`50%`(é»˜è®¤`0% 0%`)\n- `Keyword`ï¼šä½ç½®å…³é”®å­—`leftã€rightã€topã€bottomã€center`ï¼Œå¯å•åŒä½¿ç”¨ï¼Œç¬¬äºŒä¸ªå…³é”®å­—ä¸å£°æ˜é»˜è®¤æ˜¯`center`\n\nmask-sizeï¼šå›¾åƒå°ºå¯¸æ¨¡å¼\n\n- `auto`ï¼šè‡ªåŠ¨è®¾ç½®å°ºå¯¸(`é»˜è®¤`)\n- `cover`ï¼šå›¾åƒæ‰©å±•è‡³è¶³å¤Ÿå¤§ï¼Œä½¿å…¶å®Œå…¨è¦†ç›–æ•´ä¸ªåŒºåŸŸï¼Œå›¾åƒæŸäº›éƒ¨åˆ†ä¹Ÿè®¸æ— æ³•æ˜¾ç¤ºåœ¨åŒºåŸŸä¸­\n- `contain`ï¼šå›¾åƒæ‰©å±•è‡³æœ€å¤§å°ºå¯¸ï¼Œä½¿å…¶å®½åº¦å’Œé«˜åº¦å®Œå…¨é€‚åº”æ•´ä¸ªåŒºåŸŸ\n- `Size`ï¼šå°ºå¯¸ï¼Œå¯ç”¨ä»»ä½•é•¿åº¦å•ä½ï¼Œç¬¬äºŒä¸ªå°ºå¯¸(é«˜)ä¸å£°æ˜é»˜è®¤æ˜¯`auto`\n\nmask-originï¼šå®šä½åŒºåŸŸ(ä¸mask-positionç»“åˆä½¿ç”¨)\n\n- `padding-box`ï¼šå›¾åƒç›¸å¯¹å¡«å……å®šä½(`é»˜è®¤`)\n- `border-box`ï¼šå›¾åƒç›¸å¯¹è¾¹æ¡†å®šä½\n- `content-box`ï¼šå›¾åƒç›¸å¯¹å†…å®¹å®šä½\n\nmask-clipï¼šç»˜åˆ¶åŒºåŸŸ\n\n- `border-box`ï¼šå›¾åƒè¢«è£å‰ªåˆ°è¾¹æ¡†ä¸è¾¹è·çš„äº¤ç•Œå¤„(`é»˜è®¤`)\n- `padding-box`ï¼šå›¾åƒè¢«è£å‰ªåˆ°å¡«å……ä¸è¾¹æ¡†çš„çš„äº¤ç•Œå¤„\n- `content-box`ï¼šå›¾åƒè¢«è£å‰ªåˆ°å†…å®¹ä¸å¡«å……çš„äº¤ç•Œå¤„\n\nmask-compositeï¼šæ··åˆæ¨¡å¼\n\n- `source-over`ï¼šå åŠ ï¼Œæ˜¾ç¤ºé®ç½©å›¾åƒåˆå¹¶å¤„\n- `subtract`ï¼šç›¸å‡ï¼Œä¸æ˜¾ç¤ºé®ç½©å›¾åƒé‡åˆå¤„\n- `intersect`ï¼šç›¸äº¤ï¼Œæ˜¾ç¤ºé®ç½©å›¾åƒé‡åˆå¤„\n- `exclude`ï¼šæ’é™¤ï¼Œæ˜¾ç¤ºé®ç½©å›¾åƒåˆå¹¶å¤„ä½†ä¸æ˜¾ç¤ºé‡åˆå¤„\n\n## é˜´å½±Shadow\n\né˜´å½±ä¸‰å‰‘å®¢â€”â€”`box-shadow`ã€`text-shadow`ã€`drop-shadow()`\n\n- æƒ³è¦ç›’å­è½®å»“äº§ç”Ÿé˜´å½±æ•ˆæœï¼Œä½¿ç”¨`box-shadow`\n- æƒ³è¦æ–‡æœ¬è½®å»“äº§ç”Ÿé˜´å½±æ•ˆæœï¼Œä½¿ç”¨`text-shadow`\n- æƒ³è¦é€æ˜å›¾åƒçš„éé€æ˜éƒ¨åˆ†è½®å»“äº§ç”Ÿé˜´å½±æ•ˆæœï¼Œä½¿ç”¨`fliter:drop-shadow()`\n\nä¸‰ä¸ªæ–¹æ³•å‚æ•°ç±»ä¼¼ï¼š\n\n```css\nbox-shadow: offset-x offset-y blur spread color position\ntext-shadow: offset-x offset-y blur color\nfilter: drop-shadow(offset-x, offset-y, blur, color)\n```\n\n- OffsetXï¼šæ°´å¹³åç§»ï¼Œé˜´å½±çš„æ°´å¹³ä½ç½®(å¿…é€‰)\n  - `Offset`ï¼šåç§»ï¼Œå¯ç”¨ä»»ä½•é•¿åº¦å•ä½ï¼Œå…è®¸è´Ÿå€¼ï¼Œæ­£å€¼å‘å³è´Ÿå€¼å‘å·¦(é»˜è®¤`0`)\n- OffsetYï¼šå‚ç›´åç§»ï¼Œé˜´å½±çš„å‚ç›´ä½ç½®(å¿…é€‰)\n  - `Offset`ï¼šåç§»ï¼Œå¯ç”¨ä»»ä½•é•¿åº¦å•ä½ï¼Œå…è®¸è´Ÿå€¼ï¼Œæ­£å€¼å‘ä¸‹è´Ÿå€¼å‘ä¸Š(é»˜è®¤`0`)\n- Blurï¼šæ¨¡ç³ŠåŠå¾„ï¼Œé˜´å½±çš„æ¸…æ™°ç¨‹åº¦(è™šè‰²)\n  - `Length`ï¼šé•¿åº¦ï¼Œå¯ç”¨ä»»ä½•é•¿åº¦å•ä½ï¼Œå€¼è¶Šå¤§è¾¹ç¼˜è¶Šæ¨¡ç³Š(é»˜è®¤`0`)\n- Spreadï¼šæ‰©å±•è·ç¦»ï¼Œé˜´å½±çš„å®ä½“å°ºå¯¸(å®è‰²)\n  - `Length`ï¼šé•¿åº¦ï¼Œå¯ç”¨ä»»ä½•é•¿åº¦å•ä½ï¼Œå…è®¸è´Ÿå€¼ï¼Œæ­£å€¼æ‰©å¤§è´Ÿå€¼ç¼©å°(é»˜è®¤`0`)\n- Colorï¼šæŠ•å½±é¢œè‰²\n  - `transparent`ï¼šé€æ˜(`é»˜è®¤`)\n  - `Keyword`ï¼šé¢œè‰²å…³é”®å­—\n  - `HEX`ï¼šåå…­è¿›åˆ¶è‰²å½©æ¨¡å¼\n  - `RGB`æˆ–`RGBA`ï¼šRGB/Aè‰²å½©æ¨¡å¼\n  - `HSL`æˆ–`HSLA`ï¼šHSL/Aè‰²å½©æ¨¡å¼\n- Positionï¼šæŠ•å½±ä½ç½®\n  - `outset`ï¼šé˜´å½±æ˜¾ç¤ºåœ¨å¤–éƒ¨(`é»˜è®¤`)\n  - `inset`ï¼šé˜´å½±æ˜¾ç¤ºåœ¨å†…éƒ¨\n\n## æ»¤é•œFilter\n\n`css`çš„`filter`å±æ€§æä¾›äº†ä¼—å¤šçš„å›¾ç‰‡å¤„ç†æ•ˆæœã€‚\n\nblur()ï¼šæ¨¡ç³Š\n\n- `Length`ï¼šé•¿åº¦ï¼Œå¯ç”¨ä»»ä½•é•¿åº¦å•ä½ï¼Œå€¼ä¸º`0`æ˜¾ç¤ºåŸå›¾ï¼Œå€¼è¶Šå¤§è¶Šæ¨¡ç³Š\n\nbrightness()ï¼šäº®åº¦\n\n- `Percentage`ï¼šç™¾åˆ†æ¯”ï¼Œå¯ç”¨`0~1`ä»£æ›¿ï¼Œå€¼ä¸º`0`æ˜¾ç¤ºå…¨é»‘ï¼Œå€¼ä¸º`100%`æ˜¾ç¤ºåŸå›¾ \n\ncontrast()ï¼šå¯¹æ¯”åº¦\n\n- `Percentage`ï¼šç™¾åˆ†æ¯”ï¼Œå¯ç”¨`0~1`ä»£æ›¿ï¼Œå€¼ä¸º`0`æ˜¾ç¤ºå…¨é»‘ï¼Œå€¼ä¸º`100%`æ˜¾ç¤ºåŸå›¾ \n\ndrop-shadow()ï¼šé˜´å½±\n\n- å‚è€ƒä¸Šè¿°é˜´å½±\n\ngrayscale()ï¼šç°åº¦\n\n- `Percentage`ï¼šç™¾åˆ†æ¯”ï¼Œå¯ç”¨`0~1`ä»£æ›¿ï¼Œå€¼ä¸º`0`æ˜¾ç¤ºåŸå›¾ï¼Œå€¼ä¸º`100%`æ˜¾ç¤ºå…¨ç° \n\nhue-rotate()ï¼šè‰²ç›¸æ—‹è½¬\n\n- `Angle`ï¼šè§’åº¦ï¼Œå€¼ä¸º`0`æ˜¾ç¤ºåŸå›¾ï¼Œå€¼ä¸º`0~360deg`å‡å¼±åŸå›¾è‰²å½©ï¼Œå€¼è¶…è¿‡`360deg`åˆ™ç›¸å½“ç»•Nåœˆå†è®¡ç®—å‰©ä½™çš„å€¼\n\ninvert()ï¼šåç›¸\n\n- `Percentage`ï¼šç™¾åˆ†æ¯”ï¼Œå¯ç”¨`0~1`ä»£æ›¿ï¼Œå€¼ä¸º`0`æ˜¾ç¤ºåŸå›¾ï¼Œå€¼ä¸º`100%`å®Œå…¨åè½¬åŸå›¾è‰²å½© \n\nopacity()ï¼šé€æ˜åº¦\n\n- `Percentage`ï¼šç™¾åˆ†æ¯”ï¼Œå¯ç”¨`0~1`ä»£æ›¿ï¼Œå€¼ä¸º`0`æ˜¾ç¤ºé€æ˜ï¼Œå€¼ä¸º`100%`æ˜¾ç¤ºåŸå›¾ \n\nsaturate()ï¼šé¥±å’Œåº¦\n\n- `Percentage`ï¼šç™¾åˆ†æ¯”ï¼Œå¯ç”¨`0~1`ä»£æ›¿ï¼Œå€¼ä¸º`0`å®Œå…¨ä¸é¥±å’ŒåŸå›¾ï¼Œå€¼ä¸º`100%`æ˜¾ç¤ºåŸå›¾\n\nsepia()ï¼šè¤è‰²\n\n- `Percentage`ï¼šç™¾åˆ†æ¯”ï¼Œå¯ç”¨`0~1`ä»£æ›¿ï¼Œå€¼ä¸º`0`æ˜¾ç¤ºåŸå›¾ï¼Œå€¼ä¸º`100%`æ˜¾ç¤ºè¤è‰²\n\n> å½“èŠ‚ç‚¹å£°æ˜ä¸ä¸º`none`çš„`filter`æ—¶ï¼Œè‹¥å…¶å­èŠ‚ç‚¹æœ‰`position: absolute/fixed`çš„å…ƒç´ ã€‚å®ƒä¼šç›¸å¯¹äº`filter`èŠ‚ç‚¹è¿›è¡Œå®šä½\n\n## å˜æ¢Transform\n\nå˜æ¢åˆ†ä¸º2Då’Œ3Då˜æ¢ï¼Œé€šè¿‡`transform-style`å±æ€§æ¥å£°æ˜\n\n- **flat**ï¼šæ‰€æœ‰å˜æ¢æ•ˆæœåœ¨å¹³é¢ä¸Šå‘ˆç°(`é»˜è®¤`)\n- **preserve-3d**ï¼šæ‰€æœ‰å˜æ¢æ•ˆæœåœ¨ç©ºé—´ä¸Šå‘ˆç°\n\nå˜æ¢æ•ˆæœé€šè¿‡`transform`å±æ€§æ¥å£°æ˜ï¼š\n\ntranslate()ï¼šä½ç§»\n- **translate(x,y)**ï¼š2Dä½ç§»\n- **translate3d(x,y,z)**ï¼š3Dä½ç§»\n- **translateX(x)**ï¼šXè½´ä½ç§»ï¼Œç­‰åŒäº`translate(x,0)`æˆ–`translate3d(x,0,0)`\n- **translateY(y)**ï¼šYè½´ä½ç§»ï¼Œç­‰åŒäº`translate(0,y)`æˆ–`translate3d(0,y,0)`\n- **translateZ(z)**ï¼šZè½´ä½ç§»ï¼Œç­‰åŒäº`translate3d(0,0,z)`\n- æè¿°\n  - å•ä½ï¼š`Length`é•¿åº¦ï¼Œå¯ç”¨ä»»ä½•é•¿åº¦å•ä½ï¼Œå…è®¸è´Ÿå€¼\n  - é»˜è®¤ï¼šXYZè½´ä¸å£°æ˜é»˜è®¤æ˜¯`0`\n  - æ­£å€¼ï¼šæ²¿Xè½´å‘å³ä½ç§»/æ²¿Yè½´å‘ä¸Šä½ç§»/æ²¿Zè½´å‘å¤–ä½ç§»\n  - è´Ÿå€¼ï¼šæ²¿Xè½´å‘å·¦ä½ç§»/æ²¿Yè½´å‘ä¸‹ä½ç§»/æ²¿Zè½´å‘å†…ä½ç§»\n\nscale()ï¼šç¼©æ”¾\n- **scale(x,y)**ï¼š2Dç¼©æ”¾\n- **scale3d(x,y,z)**ï¼š3Dç¼©æ”¾\n- **scaleX(x)**ï¼šXè½´ç¼©æ”¾ï¼Œç­‰åŒäº`scale(x,1)`æˆ–`scale3d(x,1,1)`\n- **scaleY(y)**ï¼šYè½´ç¼©æ”¾ï¼Œç­‰åŒäº`scale(1,y)`æˆ–`scale3d(1,y,1)`\n- **scaleZ(z)**ï¼šZè½´ç¼©æ”¾ï¼Œç­‰åŒäº`scale3d(1,1,z)`\n- æè¿°\n  - å•ä½ï¼š`Number`æ•°å€¼æˆ–`Percentage`ç™¾åˆ†æ¯”ï¼Œå…è®¸è´Ÿå€¼\n  - é»˜è®¤ï¼šXYZè½´ä¸å£°æ˜é»˜è®¤æ˜¯`1`æˆ–`100%`\n  - æ­£å€¼ï¼š`0<(x,y,z)<1`æ²¿Xè½´ç¼©å°/æ²¿Yè½´ç¼©å°/æ²¿Zè½´å˜åšï¼Œ`(x,y,z)>1`æ²¿Xè½´æ”¾å¤§/æ²¿Yè½´æ”¾å¤§/æ²¿Zè½´å˜è–„\n  - è´Ÿå€¼ï¼š`-1<(x,y,z)<0`ç¿»è½¬æ²¿Xè½´ç¼©å°/æ²¿Yè½´ç¼©å°/æ²¿Zè½´å˜åšï¼Œ`(x,y,z)<-1`ç¿»è½¬æ²¿Xè½´æ”¾å¤§/æ²¿Yè½´æ”¾å¤§/æ²¿Zè½´å˜è–„\n\nskew()ï¼šæ‰­æ›²\n- **skew(x,y)**ï¼š2Dæ‰­æ›²\n- **skewX(x)**ï¼šXè½´æ‰­æ›²ï¼Œç­‰åŒäº`skew(x,0)`\n- **skewY(y)**ï¼šYè½´æ‰­æ›²ï¼Œç­‰åŒäº`skew(0,y)`\n- æè¿°\n  - å•ä½ï¼š`Angle`è§’åº¦æˆ–`Turn`å‘¨\n  - é»˜è®¤ï¼šXYè½´ä¸å£°æ˜é»˜è®¤æ˜¯`0`\n  - æ­£å€¼ï¼šæ²¿Xè½´å‘å·¦æ‰­æ›²/æ²¿Yè½´å‘ä¸‹æ‰­æ›²\n  - è´Ÿå€¼ï¼šæ²¿Xè½´å‘å³æ‰­æ›²/æ²¿Yè½´å‘ä¸Šæ‰­æ›²\n\nrotate()ï¼šæ—‹è½¬\n-  **rotate()**ï¼š2Dæ—‹è½¬\n-  **rotate3d(x,y,z,a)**ï¼š3Dæ—‹è½¬ï¼Œ`[x,y,z]`æ˜¯ä¸€ä¸ªå‘é‡ï¼Œæ•°å€¼éƒ½æ˜¯`0~1`\n-  **rotateX(a)**ï¼šXè½´æ—‹è½¬ï¼Œç­‰åŒäº`rotate(1,0,0,a)`ï¼Œæ­£å€¼æ—¶æ²¿Xè½´å‘ä¸Šé€†æ—¶é’ˆæ—‹è½¬ï¼Œè´Ÿå€¼æ—¶æ²¿Xè½´å‘ä¸‹é¡ºæ—¶é’ˆæ—‹è½¬\n-  **rotateY(a)**ï¼š3D Yè½´æ—‹è½¬ï¼Œç­‰åŒäº`rotate(0,1,0,a)`ï¼Œæ­£å€¼æ—¶æ²¿Yè½´å‘å³é€†æ—¶é’ˆæ—‹è½¬ï¼Œè´Ÿå€¼æ—¶æ²¿Yè½´å‘å·¦é¡ºæ—¶é’ˆæ—‹è½¬\n-  **rotateZ(a)**ï¼š3D Zè½´æ—‹è½¬ï¼Œç­‰åŒäº`rotate(0,0,1,a)`ï¼Œæ­£å€¼æ—¶æ²¿Zè½´é¡ºæ—¶é’ˆæ—‹è½¬ï¼Œè´Ÿå€¼æ—¶æ²¿Zè½´é€†æ—¶é’ˆæ—‹è½¬\n- æè¿°\n  - å•ä½ï¼š`Angle`è§’åº¦æˆ–`Turn`å‘¨\n  - æ­£å€¼ï¼š2Dæ—‹è½¬æ—¶é¡ºæ—¶é’ˆæ—‹è½¬\n  - è´Ÿå€¼ï¼š2Dæ—‹è½¬æ—¶é€†æ—¶é’ˆæ—‹è½¬\n\nmatrix()ï¼šçŸ©é˜µ(å¤ªè¿‡å¤æ‚ï¼Œå¯æ”¾å¼ƒ)\n-  **matrix(a,b,c,d,e,f)**ï¼š2DçŸ©é˜µ(ä½ç§»ã€ç¼©æ”¾ã€æ‰­æ›²ã€æ—‹è½¬çš„ç»¼åˆå‡½æ•°)\n-  **matrix(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p)**ï¼š3DçŸ©é˜µ(ä½ç§»ã€ç¼©æ”¾ã€æ‰­æ›²ã€æ—‹è½¬çš„ç»¼åˆå‡½æ•°)\n\nperspective()ï¼šè§†è·\n- `Length`ï¼šé•¿åº¦ï¼Œå¯ç”¨ä»»ä½•é•¿åº¦å•ä½\n  - å€¼è¶Šå°ï¼Œç”¨æˆ·ä¸ç©ºé—´Zè½´è·ç¦»è¶Šè¿‘ï¼Œè§†è§‰æ•ˆæœè¶Šå¼º\n  - å€¼è¶Šå¤§ï¼Œç”¨æˆ·ä¸ç©ºé—´Zè½´è·ç¦»è¶Šè¿œï¼Œè§†è§‰æ•ˆæœè¶Šå¼±\n\nä½¿ç”¨Transformé»˜è®¤ä¼šä½¿æµè§ˆå™¨å¼€å¯GPUåŠ é€Ÿï¼Œå› æ­¤æ€§èƒ½æ›´å¥½\n\n## è¿‡æ¸¡Transition\n\n### å±æ€§\n\ntransition-propertyï¼šå±æ€§\n\n- `all`ï¼šå…¨éƒ¨å±æ€§è¿‡æ¸¡(`é»˜è®¤`)\n- `none`ï¼šæ— å±æ€§è¿‡æ¸¡\n- `String`ï¼šæŸä¸ªå±æ€§è¿‡æ¸¡\n\ntransition-durationï¼šæ—¶é—´\n- `Time`ï¼šç§’æˆ–æ¯«ç§’(é»˜è®¤`0`)\n\ntransition-timing-functionï¼šç¼“åŠ¨å‡½æ•°\n- `ease`ï¼šé€æ¸å˜æ…¢ï¼Œç­‰åŒäº`cubic-bezier(.25,.1,.25,1)`(`é»˜è®¤`)\n- `linear`ï¼šåŒ€é€Ÿï¼Œç­‰åŒäº`cubic-bezier(0,0,1,1)`\n- `ease-in`ï¼šåŠ é€Ÿï¼Œç­‰åŒäº`cubic-bezier(.42,0,1,1)`\n- `ease-out`ï¼šå‡é€Ÿï¼Œç­‰åŒäº`cubic-bezier(0,0,.58,1)`\n- `ease-in-out`ï¼šå…ˆåŠ é€Ÿåå‡é€Ÿï¼Œç­‰åŒäº`cubic-bezier(.42,0,.58,1)`\n- `cubic-bezier`ï¼šè´å¡å°”æ›²çº¿ï¼Œ`(x1,y1,x2,y2)`å››ä¸ªå€¼ç‰¹å®šäºæ›²çº¿ä¸Šçš„ç‚¹`P1`å’Œ`P2`ï¼Œæ‰€æœ‰å€¼éœ€åœ¨`[0,1]`åŒºåŸŸå†…\n\ntransition-delayï¼šæ—¶å»¶\n\n- `Time`ï¼šç§’æˆ–æ¯«ç§’(é»˜è®¤`0`)\n\nç”±äº`duration`å’Œ`delay`çš„å–å€¼éƒ½æ˜¯æ—¶é—´ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå‘ç”Ÿæ··æ·†ã€‚\n\n- `duration`å’Œ`delay`ä½œç”¨äºæ‰€æœ‰èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬è‡ªèº«çš„`::before`å’Œ`::after`\n- `transition`ä¸­å‡ºç°ä¸¤ä¸ªæ—¶é—´å€¼æ—¶ï¼Œç¬¬ä¸€ä¸ªè§£æä¸º`duration`ï¼Œç¬¬äºŒä¸ªè§£æä¸º`delay`\n- `transition`ä¸­å‡ºç°ä¸€ä¸ªæ—¶é—´å€¼æ—¶ï¼Œè§£æä¸º`duration`\n\n### è´å¡å°”æ›²çº¿\n\né€šè¿‡`cubic-bezier()`æ¥è®¾ç½®ä¸€ä¸ªè´å¡å°”æ›²çº¿å€¼ã€‚`transform-timing-function`çš„å€¼éƒ½æ˜¯é¢„è®¾å¥½çš„è´å¡å°”æ›²çº¿å€¼ã€‚\n\n[CubicBezier](https://cubic-bezier.com/)ä¸Šå¯ä»¥æŸ¥çœ‹å…·ä½“æ•ˆæœ\n\n![transform-timing-function](../../images/transform-timing-function.jpg)\n\n## åŠ¨ç”»Animation\n\n### å±æ€§\n\n`animation`å¯å£°æ˜çš„ä¸¤ç§åŠ¨ç”»ï¼š\n\n-  **å…³é”®å¸§åŠ¨ç”»**ï¼š\n  - åœ¨æ—¶é—´è½´çš„å…³é”®å¸§ä¸Šç»˜åˆ¶å…³é”®çŠ¶æ€å¹¶ä½¿ä¹‹æœ‰æ•ˆè¿‡æ¸¡ç»„æˆåŠ¨ç”»\n  - é€šè¿‡`@keyframe`å£°æ˜\n-  **é€å¸§åŠ¨ç”»**ï¼š\n  - åœ¨æ—¶é—´è½´çš„æ¯ä¸€å¸§ä¸Šç»˜åˆ¶ä¸åŒå†…å®¹å¹¶ä½¿ä¹‹è¿ç»­æ’­æ”¾ç»„æˆåŠ¨ç”»\n  - å‡†å¤‡ä¸€å¼ `é€å¸§é•¿å›¾`ï¼Œåœ¨`steps()`é‡Œå£°æ˜é€å¸§é•¿å›¾åŠå…¶å±•ç¤ºæ–¹å¼\n\nanimation-nameï¼šåç§°\n\n- `none`ï¼šæ— åŠ¨ç”»(`é»˜è®¤`)\n- `String`ï¼šåŠ¨ç”»åç§°\n\nanimation-durationï¼šæ—¶é—´\n\n- `Time`ï¼šç§’æˆ–æ¯«ç§’(é»˜è®¤`0`)\n\nanimation-timing-functionï¼šç¼“åŠ¨å‡½æ•°\n\n- `ease`ï¼šé€æ¸å˜æ…¢ï¼Œç­‰åŒäº`cubic-bezier(.25,.1,.25,1)`(`é»˜è®¤`)\n- `linear`ï¼šåŒ€é€Ÿï¼Œç­‰åŒäº`cubic-bezier(0,0,1,1)`\n- `ease-in`ï¼šåŠ é€Ÿï¼Œç­‰åŒäº`cubic-bezier(.42,0,1,1)`\n- `ease-out`ï¼šå‡é€Ÿï¼Œç­‰åŒäº`cubic-bezier(0,0,.58,1)`\n- `ease-in-out`ï¼šå…ˆåŠ é€Ÿåå‡é€Ÿï¼Œç­‰åŒäº`cubic-bezier(.42,0,.58,1)`\n- `cubic-bezier`ï¼šè´å¡å°”æ›²çº¿ï¼Œ`(x1,y1,x2,y2)`å››ä¸ªå€¼ç‰¹å®šäºæ›²çº¿ä¸Šçš„ç‚¹`P1`å’Œ`P2`ï¼Œæ‰€æœ‰å€¼éœ€åœ¨`[0,1]`åŒºåŸŸå†…\n- `steps([,[start|end]]?)`ï¼šæŠŠåŠ¨ç”»å¹³å‡åˆ’åˆ†æˆ`nç­‰åˆ†`ï¼Œç›´åˆ°å¹³å‡èµ°å®Œè¯¥åŠ¨ç”»\n- `step-start`ï¼šç­‰åŒäº`steps(1,start)`ï¼ŒæŠŠåŠ¨ç”»åˆ†æˆä¸€æ­¥ï¼ŒåŠ¨ç”»æ‰§è¡Œæ—¶ä»¥å·¦ä¾§ç«¯ç‚¹`0%`ä¸ºå¼€å§‹\n- `step-end`ï¼šç­‰åŒäº`steps(1,end)`ï¼ŒæŠŠåŠ¨ç”»åˆ†æˆä¸€æ­¥ï¼ŒåŠ¨ç”»æ‰§è¡Œæ—¶ä»¥å³ä¾§ç«¯ç‚¹`100%`ä¸ºå¼€å§‹\n\nanimation-delayï¼šæ—¶å»¶\n\n- `Time`ï¼šç§’æˆ–æ¯«ç§’(é»˜è®¤`0`)\n\nanimation-iteration-countï¼šæ’­æ”¾æ¬¡æ•°\n\n- `Number`ï¼šæ•°å€¼(é»˜è®¤`1`)\n- `infinite`ï¼šæ— é™æ¬¡\n\nanimation-directionï¼šè½®æµåå‘æ’­æ”¾(æ’­æ”¾æ¬¡æ•°ä¸ºä¸€æ¬¡åˆ™è¯¥å±æ€§æ— æ•ˆæœ)\n\n- `normal`ï¼šæ­£å¸¸æ’­æ”¾(`é»˜è®¤`)\n- `alternate`ï¼šè½®æµåå‘æ’­æ”¾ï¼Œå¥‡æ•°æ¬¡æ•°æ­£å¸¸æ’­æ”¾ï¼Œå¶æ•°æ¬¡æ•°åå‘æ’­æ”¾\n\nanimation-play-stateï¼šæ’­æ”¾çŠ¶æ€\n\n- `running`ï¼šæ­£åœ¨æ’­æ”¾(`é»˜è®¤`)\n- `paused`ï¼šæš‚åœæ’­æ”¾\n\nanimation-fill-modeï¼šæ’­æ”¾å‰åå…¶æ•ˆæœæ˜¯å¦å¯è§\n\n- `none`ï¼šä¸æ”¹å˜é»˜è®¤è¡Œä¸º(`é»˜è®¤`)\n- `backwards`ï¼šåœ¨æ—¶å»¶æ‰€æŒ‡å®šæ—¶é—´å†…æˆ–åœ¨åŠ¨ç”»å¼€å§‹å‰åº”ç”¨å¼€å§‹å±æ€§(`åœ¨ç¬¬ä¸€ä¸ªå…³é”®å¸§ä¸­å®šä¹‰`)\n- `forwards`ï¼šåœ¨åŠ¨ç”»ç»“æŸåä¿æŒæœ€åä¸€ä¸ªå±æ€§(`åœ¨æœ€åä¸€ä¸ªå…³é”®å¸§ä¸­å®šä¹‰`)\n- `both`ï¼šå‘å‰å’Œå‘åå¡«å……æ¨¡å¼éƒ½è¢«åº”ç”¨\n\n### æ¡ˆä¾‹\n\n#### æ‰“å­—æœº\n\n```vue\n<template>\n\t<div class=\"auto-typing\">Do You Want To Know More About CSS Development Skill</div>\n</template>\n\n<script>\nexport default {}\n</script>\n\n<style>\n@mixin typing($count: 0, $duration: 0, $delay: 0) {\n    overflow: hidden;\n    border-right: 1px solid transparent;\n    width: #{$count + 1}ch;\n    font-family: Consolas, Monaco, monospace;\n    white-space: nowrap;\n    animation: typing #{$duration}s steps($count + 1) #{$delay}s infinite backwards,\n        caret 500ms steps(1) #{$delay}s infinite forwards;\n}\n.auto-typing {\n    font-weight: bold;\n    font-size: 30px;\n    color: #09f;\n    @include typing(52, 5);\n}\n@keyframes caret {\n    50% {\n        border-right-color: currentColor;\n    }\n}\n@keyframes typing {\n    from {\n        width: 0;\n    }\n}\n</style>\n```\n","tags":["css"],"categories":["CSS"]},{"title":"è®¤è¯†RPC","url":"/posts/91c0fa71.html","content":"\n## RPCåˆè¯†\n\n`RPCï¼ˆRemote Procedure Callï¼‰`å³**è¿œç¨‹è¿‡ç¨‹è°ƒç”¨**ã€‚ä¸`Ajax`ç±»ä¼¼ã€‚ä¸»è¦ç”¨äºä¸åŒç«¯ä¹‹é—´çš„é€šä¿¡ã€‚\n\nå’Œ`Ajax`çš„å¼‚åŒä¹‹å¤„ï¼š\n\n1. éƒ½æ˜¯è®¡ç®—æœºä¹‹é—´ç½‘ç»œé€šä¿¡çš„æ–¹å¼\n   1. `Ajax`æ˜¯æµè§ˆå™¨ä¸æœåŠ¡ç«¯ä¹‹é—´çš„é€šä¿¡æ–¹å¼\n   2. `RPC`æ˜¯æœåŠ¡ç«¯ä¹‹é—´çš„é€šä¿¡æ–¹å¼\n2. éƒ½éœ€è¦åŒæ–¹çº¦å®šä¸€ä¸ªæ•°æ®æ ¼å¼\n   1. `Ajax`çº¦å®šæ ¼å¼ä¸º`json`\n   2. `RPC`é€šå¸¸ä½¿ç”¨**äºŒè¿›åˆ¶**\n3. å¯»å€æ–¹å¼\n   1. `Ajax`ä½¿ç”¨`DNS`è¿›è¡Œå¯»å€\n   2. `RPC`ä¹Ÿéœ€è¦å¯»å€ï¼Œå¯èƒ½æ ¹æ®IDæˆ–è€…ä¸€ä¸ª`VIP(è™šæ‹ŸIP)`ã€‚ä½¿ç”¨`DNS`æˆæœ¬å¤ªé«˜ã€‚\n4. åº”ç”¨å±‚åè®®\n   1. `Ajax`ä½¿ç”¨`HTTP`ä½œä¸ºåº”ç”¨å±‚åè®®\n   2. `RPC`é€šå¸¸ä½¿ç”¨äºŒè¿›åˆ¶åè®®ï¼ˆåŸºäºTCPæˆ–UDPï¼‰ï¼Œä¼ è¾“äºŒè¿›åˆ¶æ•°æ®ï¼Œè¿™æ ·ä½“ç§¯å°ï¼Œç¼–è§£ç é€Ÿåº¦å¿«ï¼ˆè®¡ç®—æœºæœ¬èº«å°±åªèƒ½è¯†åˆ«äºŒè¿›åˆ¶ï¼‰ã€‚\n\n## äºŒè¿›åˆ¶ç¼–è§£ç \n\n`RPC`é€šä¿¡ä¼ è¾“çš„æ•°æ®æ˜¯**äºŒè¿›åˆ¶æ•°æ®**ï¼Œè€Œä¸æ˜¯`JSON`æ•°æ®ã€‚\n\nåœ¨`Nodejs`ä¸­ï¼Œå†…ç½®äº†`Buffer`æ¨¡å—ï¼Œå®ƒå¯ä»¥ç”¨æ¥æ“ä½œäºŒè¿›åˆ¶æ•°æ®\n\n### Buffer\n\n#### åˆ›å»ºBuffer\n\n```javascript\n// 1. ä½¿ç”¨Buffer.from\n// åˆ›å»ºä¸€ä¸ª8å­—èŠ‚ bufferäºŒè¿›åˆ¶æ•°æ®\n// æ¯ä¸ªå­—ç¬¦å  1ä¸ªå­—èŠ‚\nconst buffer1 = Buffer.from('helloRPC'); \n\n// 2. Buffer.from çš„å‚æ•°å¯ä»¥ä¸ºæ•°ç»„\n// æ¯ä¸ªæ•°ç»„å…ƒç´  å 1ä¸ªå­—èŠ‚\nconst buffer2 = Buffer.from([1,2,3,4]);\n\n// 3. ä½¿ç”¨Buffer.alloc\n// åˆ›å»ºä¸€ä¸ª20 å­—èŠ‚çš„Buffer\nconst buffer3 = Buffer.alloc(20);\n```\n\n#### è¯»å†™Buffer\n\n`Buffer`å†…æä¾›äº†ä¼—å¤šè¯»å†™`Buffer`æ–¹æ³•ï¼Œè¯¦æƒ…è§[nodejsæ–‡æ¡£-Buffer](https://nodejs.org/api/buffer.html)\n\n```javascript\n// 1. è¯»\n\n// ä»offsetå¼€å§‹ï¼Œè¯»ä¸€ä¸ªå¸¦ç¬¦å·8ä½çš„æ•´å‹\nbuffer.readInt8(0) // å‚æ•°ä¸ºoffsetï¼Œé»˜è®¤ä¸º0\n\n// ä»offsetå¼€å§‹ï¼Œè¯»ä¸€ä¸ª32ä½çš„float\n// BEä»£è¡¨å¤§ç«¯æ¨¡å¼ï¼ŒLEä»£è¡¨å°ç«¯æ¨¡å¼\nbuffer.readFloatBE(0)\n\n// 2. å†™\n// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦å†™å…¥çš„å€¼\n// ç¬¬äºŒä¸ªå‚æ•°æ˜¯ offset\nbuffer2.writeInt8(12, 1)\nbuffer3.writeInt16BE(255, 2)\n```\n\n> å¤§ç«¯æ¨¡å¼ï¼ˆbig-endian, BEï¼‰å’Œå°ç«¯æ¨¡å¼ï¼ˆlittle-endian, LEï¼‰\n>\n> ä¸¤è€…ä¸»è¦æŒ‡å­˜æ”¾å­—èŠ‚çš„é¡ºåºä¸åŒï¼ŒBEå°†é«˜ä½æ”¾åœ¨ä½åœ°å€ï¼ŒLEå°†é«˜ä½æ”¾åœ¨é«˜åœ°å€\n>\n> 16ä½äºŒè¿›åˆ¶: 0000 0010 1110 1100\n>\n> ä½¿ç”¨ writeInt16BE(128, 0), åœ¨åç§»é‡ä½0çš„ä½ç½®å†™å…¥128(2è¿›åˆ¶æ˜¯ 1000 0000)ã€‚å†™å…¥å\n>\n> 16ä½äºŒè¿›åˆ¶ï¼š**1000 0000** 1110 1100ï¼ˆåŠ é»‘ä¸ºå†™å…¥çš„ï¼‰\n>\n> å¦‚æœä½¿ç”¨writeInt16LE(128, 0)ï¼Œåœ¨åç§»é‡0çš„ä½ç½®å†™å…¥128(2è¿›åˆ¶æ˜¯ 1000 0000)ã€‚å†™å…¥å\n>\n> 16ä½äºŒè¿›åˆ¶ï¼š**0000 1000** 1110 1100ï¼ˆåŠ é»‘ä¸ºå†™å…¥çš„ï¼‰\n>\n> å¯è§ä¸¤è€…å†™å…¥é¡ºåºä¸åŒ\n\n#### å°ç»“\n\nåœ¨è¿›è¡Œ`RPC`é€šä¿¡æ—¶ï¼Œéœ€è¦åˆ›å»ºBufferå¯¹è±¡ï¼Œç„¶åè¯»å†™æ•°æ®ã€‚\n\nå¯æ˜¯è¿™ç§æ–¹å¼å¤ªå¤æ‚ï¼Œè¿œæ²¡æœ‰`json`æ–¹ä¾¿ã€‚åè€…åªéœ€è¦é€šè¿‡`JSON.stringify`å’Œ`JSON.parse`è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–å³å¯ã€‚\n\n`Google`æä¾›äº†ä¸€ä¸ª[protocol buffers](https://github.com/protocolbuffers/protobuf)äºŒè¿›åˆ¶ç¼–è§£ç åº“ï¼Œå¯ä»¥å’Œä½¿ç”¨`json`ä¸€æ ·æ–¹ä¾¿\n\n### Protocol Buffers\n\n[Protocol Buffers](https://github.com/protocolbuffers/protobuf)æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶ç¼–ç åº“ã€‚æœ¬èº«æä¾›äº†ä¼—å¤šè¯­è¨€çš„å®ç°ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿä»‹ç»å…¶æ˜¯ä¸€ä¸ªè¯­è¨€æ— å…³çš„åº“\n\næ‰€ä»¥å¯ä»¥åœ¨nodjsä¸Šä½¿ç”¨å®ƒç¼–ç æ•°æ®ï¼Œåœ¨å…¶å®ƒç¯å¢ƒä¸‹ï¼ˆæ¯”å¦‚JAVAã€Pythonï¼‰æ¥ä½¿ç”¨å®ƒè§£ç æ•°æ®ã€‚\n\nå…ˆå®‰è£…`npm install protocol-buffers`\n\nç¬¬ä¸€æ­¥éœ€è¦ç¼–å†™`proto`æ–‡ä»¶ï¼Œä¾‹å¦‚`test.proto`æ¥çº¦æŸäºŒè¿›åˆ¶æ–‡ä»¶çš„æ ¼å¼ã€‚\n\n```proto\nmessage Column {\n\trequired int32 id = 1;\n\trequired string name = 2;\n\trequired float price = 3\n}\n```\n\nç„¶åå°±å¯ä»¥å¯¼å…¥ä½¿ç”¨\n\n```javascript\nconst protobuf =  require('protocol-buffers');\nconst fs = require('fs')\n\n// åˆ›å»ºschema\nconst schema = protobuf(fs.redFileSync(__dirname + '/test.proto', 'utf-8'));\n\n// ç¼–ç \nconst buf = schema.Column.encode({id:1, name: 'ff', price: 99.9});\n\n// è§£ç \nconst data = schema.Column.decode(buf)\n```\n\n## æ­å»ºå¤šè·¯å¤ç”¨çš„RPCé€šé“\n\n### å®ç°åŠåŒå·¥é€šä¿¡\n\n#### åŸç†\n\né€šè¿‡ä½¿ç”¨`ndoejs`å†…ç½®çš„`net`æ¨¡å—æ¥æ­å»ºé€šä¿¡çš„åŒç«¯ã€‚\n\n`nodejs`å†…ç½®çš„`http`æ¨¡å—ä¹Ÿæ˜¯åŸºäº`net`æ¨¡å—çš„ã€‚åªæ˜¯`http`æ¨¡å—ç”¨çš„æ˜¯`http`åè®®ã€‚`rpc`å¹¶ä¸ç”¨`http`åè®®ã€‚\n\nåŠåŒå·¥é€šä¿¡å³åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªæ–¹å‘çš„æ•°æ®ä¼ è¾“ã€‚\n\n![å•åŒå·¥](../../images/å•åŒå·¥.png)\n\n#### ç¼–ç \n\næ•°æ®mock\n\n```javascript\n// mock.js\nconst data = {\n  121391: \"ç¬¬ä¸€è¯¾ï¼šåŒ—äº¬æ•…äº‹\",\n  121392: \"ç¬¬äºŒè¯¾ï¼šèƒŒå½±-æœ±è‡ªæ¸…\",\n  121393: \"ç¬¬ä¸‰è¯¾ï¼šæœ€åä¸€è¯¾\",\n  121394: \"ç¬¬å››è¯¾ï¼šæ˜¥\",\n  121395: \"ç¬¬äº”è¯¾ï¼šæµå—çš„å†¬å¤©\",\n};\n\nexports.getDataById = function (id) {\n  return data[id];\n};\n\nexports.mockId = function () {\n  const index = Math.ceil(Math.random() * 4);\n  return Object.keys(data)[index];\n};\n\n```\n\næœåŠ¡ç«¯\n\nç›‘å¬æ•°æ®ï¼Œæ”¶åˆ°æ•°æ®åï¼Œå»¶æ—¶1så°†ç»“æœè¿”å›ã€‚\n\n```javascript\n// server\nconst net = require(\"net\");\nconst { getDataById } = require(\"./mock.js\");\n\nconst server = net.createServer((socket) => {\n  socket.on(\"data\", (buffer) => {\n    // è§£æbufferï¼Œè·å–id\n    const id = buffer.readInt32BE();\n\n    // 1ç§’å è¿”å›æ•°æ®\n    setTimeout(() => {\n      const data = getDataById(id);\n      socket.write(Buffer.from(data));\n    }, 1000);\n  });\n});\n\nserver.listen(4000);\n\n```\n\nå®¢æˆ·ç«¯\n\nå…ˆå‘é€æ•°æ®ï¼Œå½“æ”¶åˆ°æœåŠ¡ç«¯å¤„ç†ç»“æœåï¼Œè¾“å‡ºç»“æœå¹¶å†æ¬¡å‘é€æ•°æ®ã€‚\n\n```javascript\n// client\nconst net = require(\"net\");\nconst { mockId } = require(\"./mock.js\");\n\nconst socket = new net.Socket({});\n\nsocket.connect({\n  host: \"127.0.0.1\",\n  port: 4000,\n});\n\nfunction sendData() {\n  const id = mockId();\n  const buffer = Buffer.alloc(4);\n  buffer.writeInt32BE(id);\n  socket.write(buffer);\n}\n\nsocket.on(\"data\", (buffer) => {\n  console.log(buffer.toString());\n  sendData();\n});\n\nsendData();\n\n```\n\n### å®ç°å…¨åŒå·¥é€šä¿¡\n\n#### åŸç†\n\nå…¨åŒå·¥é€šä¿¡å³åŒä¸€æ—¶åˆ»ï¼Œé€šä¿¡é“¾è·¯ä¸Šå¯ä»¥æœ‰å¤šä¸ªæ–¹å‘çš„æ•°æ®ä¼ è¾“ã€‚ç›¸æ¯”å•åŒå·¥é€šä¿¡ä¼šå¸¦æ¥ä¸¤ä¸ªé—®é¢˜ã€‚\n\n![å…¨åŒå·¥](../../images/å…¨åŒå·¥.png)\n\né—®é¢˜ä¸€ï¼šå®¢æˆ·ç«¯åŒä¸€æ—¶é—´å‘é€ä¸¤ä¸ªæ•°æ®åŒ…ã€‚æœåŠ¡ç«¯æ¥æ”¶åˆ°çš„é¡ºåºä¸å‘é€é¡ºåºä¸ä¸€è‡´ã€‚å› æ­¤æœåŠ¡ç«¯ä¸çŸ¥é“æ•°æ®åŒ…å¯¹åº”æ˜¯å“ªæ¬¡å‘é€çš„ã€‚\n\nè§£å†³ï¼šæ•°æ®åŒ…å¢åŠ ä¸€ä¸ª**é¦–éƒ¨**ï¼Œé¦–éƒ¨å­˜æ”¾ä¸€ä¸ª**æ ‡è¯†ID**ã€‚ä»è€Œè¯†åˆ«æ•°æ®åŒ…ã€‚\n\n\n\né—®é¢˜äºŒï¼šå½“å®¢æˆ·ç«¯è¿ç»­å‘é€nçš„æ•°æ®åŒ…ï¼ŒTCPåº•å±‚ä¼šè¿›è¡Œä¼˜åŒ–ï¼Œå°†è¿™äº›ï¼ˆäºŒè¿›åˆ¶ï¼‰æ•°æ®åŒ…åˆå¹¶æˆä¸€ä¸ªï¼Œå¯¼è‡´æœåŠ¡ç«¯ä»¥ä¸ºåªæ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…ã€‚\n\nè§£å†³ï¼šåœ¨æ•°æ®åŒ…é¦–éƒ¨ï¼Œå†å¢åŠ ä¸€ä¸ª**bodyé•¿åº¦æ ‡è¯†**ï¼ŒæŒ‡æ˜è¿™ä¸ªäºŒè¿›åˆ¶æ•°æ®çš„é•¿åº¦ã€‚æ”¶åˆ°æ•°æ®åè¿›è¡ŒæŒ‰ç…§**é•¿åº¦æ ‡è¯†**æ‹†åŒ…ã€‚\n\nç”±æ­¤ï¼Œæ–°çš„æ•°æ®åŒ…ç»“æ„å¦‚ä¸‹ï¼š\n\n![å…¨åŒå·¥æ•°æ®æŠ¥æ–‡](../../images/å…¨åŒå·¥æ•°æ®æŠ¥æ–‡.png)\n\n#### ç¼–ç \n\n`mock.js`å†…å®¹ä¸å˜\n\nå¢åŠ `handler.js`ç”¨äºå¤„ç†æ¥å—çš„æ•°æ®å’Œå‘é€æ•°æ®\n\n```javascript\nmodule.exports = function (socket) {\n  let oldBuffer = null;\n  let sequence = 0;\n\n  function handleBuffer(buffer) {\n    const dataArray = [];\n    if (oldBuffer) buffer = Buffer.concat([oldBuffer, buffer]);\n\n    let completeLength = 0;\n    while ((completeLength = checkComplete(buffer))) {\n      // packageä¸ºä¸€ä¸ªæ•°æ®åŒ…\n      const package = buffer.slice(0, completeLength);\n      // å¤„ç†å‰©ä½™çš„æ•°æ®åŒ…\n      buffer = buffer.slice(completeLength);\n\n      const header = package.slice(0, 6);\n      const body = package.slice(6);\n      const parsedData = {\n        sequence: header.readInt16BE(),\n        data: body.toString(),\n      };\n      dataArray.push(parsedData);\n    }\n\n    oldBuffer = buffer;\n\n    return dataArray;\n\n    // æ£€æŸ¥bufferå®Œæ•´æ€§\n    // æ ¹æ®é¦–éƒ¨çš„èŒƒå›´æ ‡è¯†æ¥åˆ¤æ–­\n    function checkComplete(buffer) {\n      if (buffer.length < 6) {\n        return 0;\n      }\n      const bodyLength = buffer.readInt32BE(2);\n      const packageLength = 6 + bodyLength;\n      return buffer.length < packageLength ? 0 : packageLength;\n    }\n  }\n\n  function sendBuffer(data, seq) {\n    // å†™å…¥body\n    const body = Buffer.from(data);\n\n    // å†™å…¥é¦–éƒ¨\n    const header = Buffer.alloc(6);\n    header.writeInt16BE(seq || sequence++);\n    header.writeInt32BE(body.length, 2);\n\n    // æ‹¼æ¥headerå’Œbody\n    const buffer = Buffer.concat([header, body]);\n\n    socket.write(buffer);\n  }\n\n  return {\n    handleBuffer,\n    sendBuffer,\n  };\n};\n\n```\n\næœåŠ¡ç«¯`server.js`\n\n```javascript\n// server\nconst net = require(\"net\");\nconst { getDataById } = require(\"./mock.js\");\nconst createHandler = require(\"./handler.js\");\n\nconst server = net.createServer((socket) => {\n  const handler = createHandler(socket);\n  socket.on(\"data\", (buffer) => {\n    // è§£æbufferï¼Œè·å–id\n    const dataArray = handler.handleBuffer(buffer);\n    dataArray.forEach((data) => {\n      console.log(\n        `æœåŠ¡ç«¯æ”¶åˆ°æ•°æ®ï¼š\\n\\tsequence:${data.sequence}\\n\\tdata:${data.data}`\n      );\n      // 1ç§’å è¿”å›æ•°æ®\n      setTimeout(() => {\n        const responseData = getDataById(data.data);\n        handler.sendBuffer(responseData);\n      }, 1000);\n    });\n  });\n});\n\nserver.listen(4000);\n\n```\n\nå®¢æˆ·ç«¯`client.js`\n\n```javascript\n// client\nconst net = require(\"net\");\nconst { mockId } = require(\"./mock.js\");\nconst createHandler = require(\"./handler.js\");\n\nconst socket = new net.Socket({});\n\nsocket.connect({\n  host: \"127.0.0.1\",\n  port: 4000,\n});\n\nconst handler = createHandler(socket);\n\nsocket.on(\"data\", (buffer) => {\n  const dataArray = handler.handleBuffer(buffer);\n\n  dataArray.forEach((data) => {\n    console.log(\n      `å®¢æˆ·ç«¯æ”¶åˆ°æ•°æ®ï¼š\\n\\tsequence:${data.sequence}\\n\\tdata:${data.data}`\n    );\n  });\n});\n\n// è¿ç»­å‘é€10ä¸ªæ•°æ®åŒ…\nfor (let i = 0; i < 10; i++) {\n  const id = mockId();\n  handler.sendBuffer(id);\n}\n\n```\n\n> ä¾‹å­è¿‡äºç®€å•ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨`Buffer`\n>\n> å®é™…ä½¿ç”¨æ¨èé€šè¿‡`protocol buffers`å¤„ç†äºŒè¿›åˆ¶æ•°æ®","tags":["ç½‘ç»œ","Nodejs"],"categories":["Nodejs"]},{"title":"æ•°ç»„å»é‡","url":"/posts/d5def5e2.html","content":"\næ•°ç»„å»é‡æ¶‰åŠåˆ°çš„åœºæ™¯è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œé¢è¯•ä¸­ä¹Ÿæœ‰å¾ˆå¤§é¢‘ç‡è¢«é—®åˆ°ã€‚\n\nä»æ•°æ®ç»“æœè§’åº¦æ¥è¯´ï¼šæ•°ç»„å±äºçº¿æ€§è¡¨ã€‚é€‚åˆåšæŸ¥è¯¢ï¼Œä¸é€‚åˆå¢åˆ ã€‚\n\nå»é‡çš„å®ç°æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œæ€»çš„æ¥è¯´å¯åˆ†ä¸º**åŸåœ°å»é‡**å’Œ**éåŸåœ°å»é‡**ä¸¤ç§\n\n> *åŸåœ°ç®—æ³•*ä¸­çš„*åŸåœ°*æ˜¯æŒ‡*ç®—æ³•*æ‰€éœ€çš„è¾…åŠ©ç©ºé—´æ˜¯å¸¸é‡ï¼ŒåŠç©ºé—´å¤æ‚åº¦O(1)\n\n## éåŸåœ°ç®—æ³•\n\néåŸåœ°ç®—æ³•å¯èƒ½æ¯”è¾ƒç¬¦åˆ**ä¸å¯å˜æ•°æ®`Immutable Data`**æ•°æ®çš„æ€æƒ³ã€‚ä¹Ÿæ˜¯æ¯”è¾ƒæ¨èçš„é£æ ¼ã€‚\n\n### ç”¨Set\n\næ•°æ®é‡ä¸å¤§çš„ï¼Œç”¨setå³å¯ã€‚\n\n```typescript\nfunction unique(nums: number[]): number[] {\n  return Array.from(new Set(nums));\n}\n```\n\n### å¾ªç¯\n\nå¾ªç¯ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•çš„\n\n```typescript\nfunction unique(nums: number[]): number[] {\n  let result: number[] = [];\n    \n  // å¾ªç¯\n  nums.forEach((item) => {\n    // æ²¡æœ‰å°±åŠ å…¥\n    if (result.indexOf(item) === -1) {\n      result.push(item);\n    }\n  });\n  return result;\n}\n```\n\n### ä½¿ç”¨é«˜é˜¶å‡½æ•°\n\næ•°ç»„æä¾›äº†ä¸€äº›é«˜é˜¶å‡½æ•°ï¼Œ`filter`ã€`reduce`ç­‰ï¼Œå¯ä»¥ç”¨æ¥å®ç°å»é‡ã€‚\n\nä½¿ç”¨`reduce`ï¼šåŸç†å’Œå¾ªç¯ä¸€æ ·ï¼Œå°±æ˜¯ç”¨åˆ°äº†`reduce`è¿™ä¸ªapi\n\n```typescript\nfunction unique(nums: number[]): number[] {\n  return nums.reduce<number[]>((total, current) => {\n    if (total.indexOf(current) === -1) total.push(current);\n    return total;\n  }, []);\n}\n```\n\nä½¿ç”¨`filter`ï¼š\n\n```typescript\nfunction unique(nums: number[]): number[] {\n  return nums.filter((item, index) => nums.indexOf(item) === index);\n}\n```\n\n### å…¶ä»–æƒ…å†µï¼šæ•°ç»„å…ƒç´ æ˜¯ä¸ªå¯¹è±¡\n\nè¿™æ ·çš„è¯ï¼Œå¾…æ¯”è¾ƒçš„å€¼å°±ä¸æ˜¯æ•°ç»„å…ƒç´ ï¼Œè€Œæ˜¯æ•°ç»„å…ƒç´ ï¼ˆå¯¹è±¡ï¼‰çš„æŸä¸ªkeyï¼š\n\né¢˜ç›®ï¼š**æŒ‰ç…§å¯¹è±¡çš„idå»é‡**ã€‚\n\n1. åŸºäºå¾ªç¯çš„ä¾‹å­ï¼š\n\n```typescript\ninterface IElement {\n  id: number;\n  name: string;\n}\n\nfunction unique(nums: IElement[]): IElement[] {\n  let result: IElement[] = [];\n\n  // å¾ªç¯\n  nums.forEach((item) => {\n    // æ²¡æœ‰å°±åŠ å…¥\n    if (result.every((r) => r.id !== item.id)) { // ********è¿™é‡Œä¸ä¸€æ ·********\n      result.push(item);\n    }\n  });\n  return result;\n}\n\nconst arr = [\n  { id: 1, name: \"aa\" },\n  { id: 1, name: \"bb\" },\n  { id: 2, name: \"cc\" },\n  { id: 3, name: \"dd\" },\n];\n\nconsole.log(unique(arr))\n// [ { id: 1, name: 'aa' }, { id: 2, name: 'cc' }, { id: 3, name: 'dd' } ]\n```\n\nåªæ˜¯åˆ¤æ–­çš„æ–¹å¼å˜äº†ï¼Œè¿™é‡Œä½¿ç”¨åˆ°äº†æ•°ç»„çš„`every`æ–¹æ³•ã€‚\n\né«˜é˜¶å‡½æ•°`reduce`ä¹ŸåŒç†ï¼Œå°±æ˜¯åˆ¤æ–­æ˜¯å¦ç›¸åŒçš„æ–¹å¼å˜äº†ã€‚\n\n`filter`çš„è¯ä¹Ÿä¸€æ ·ï¼Œè¿™é‡Œä½¿ç”¨åˆ°äº†`findIndex`æ–¹æ³•\n\n```typescript\nfunction unique(nums: IElement[]): IElement[] {\n  return nums.filter((item, index) => {\n      \n    // *******è¿™é‡Œåˆ¤æ–­å˜äº†********\n    const firstIndex = nums.findIndex((n) => n.id === item.id);\n    return firstIndex === index;\n  });\n}\n```\n\nä»¥ä¸Šæ–¹æ³•æœ¬è´¨ä¸Šéƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå¹¶æœªå¯¹åŸæ•°ç»„åšä»»ä½•ä¿®æ”¹ã€‚\n\n## åŸåœ°ç®—æ³•\n\nåŸåœ°ç®—æ³•ä¸éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œç›´æ¥ä¿®æ”¹åŸæ•°ç»„å³å¯ã€‚\n\næŒ‰ä¸¤ç§æƒ…å†µåˆ†æï¼š**æœ‰åºæ•°ç»„**å’Œ**æ— åºæ•°ç»„**\n\n### æœ‰åºæ•°ç»„\n\næŠŠåŸæ•°ç»„åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ç»“æœæ•°ç»„ï¼ˆæ— é‡å¤çš„ï¼‰ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯å¾…éå†æ•°ç»„\n\nåˆå§‹çŠ¶æ€ä¸‹ï¼š\n\n![æ•°ç»„å»é‡-åŒæŒ‡é’ˆ](../../images/algorithm/æ•°ç»„å»é‡-åŒæŒ‡é’ˆ.jpg)\n\næ•°ç»„æ˜¯æœ‰åºçš„ï¼Œæ¯æ¬¡éå†éƒ½åˆ¤æ–­ä¸€ä¸‹`j`å’Œ`i`å¯¹åº”çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœä¸ç›¸ç­‰å°±å°†`j`å¯¹åº”çš„å€¼æ’å…¥ç»“æœæ•°ç»„ä¸­ï¼Œåä¹‹åˆ™ä¸åšæ“ä½œç»§ç»­éå†ã€‚\n\næœ€åå†ä¿®æ”¹ä¸€ä¸‹æ•°ç»„çš„é•¿åº¦ã€‚è¿™ç§æ–¹æ³•ä¹Ÿå«åš**åŒæŒ‡é’ˆæ³•**\n\n```typescript\nfunction unique(nums: number[]): void {\n  let i = 0;\n\n  // éå†æ•°ç»„\n  for (let j = 1; j < nums.length; j++) {\n    // æœ‰åº\n    if (nums[i] !== nums[j]) {\n      nums[++i] = nums[j];\n    }\n  }\n    \n  // ä¿®æ”¹æ•°ç»„é•¿åº¦\n  nums.length = i + 1;\n}\n\nconst arr = [1, 2, 2, 3, 4, 4, 5, 6, 6, 7];\n\nunique(arr);\nconsole.log(arr);\n```\n\n### æ— åºæ•°ç»„\n\næ— åºæ•°ç»„å»é‡ï¼Œ\n\n1. ç¬¬ä¸€ç§æ€æƒ³ï¼šå…ˆæ’åºï¼Œå†ç”¨ä¸Šé¢çš„æ–¹æ³•\n2. éå†+åˆ é™¤\n\n```typescript\nfunction unique(nums: number[]): void {\n  for (let i = 0; i < nums.length; i++) {\n    const target = nums[i];\n    \n    if (nums.indexOf(target) !== i) {\n      // è¯´æ˜åŸæ•°ç»„ æœ‰ä¸æ­¢ä¸€ä¸ªå½“å‰å…ƒç´ \n      // é‚£å°± åˆ é™¤å½“å‰å…ƒç´ ï¼ˆå¤šä½™çš„ï¼‰\n      nums.splice(i, 1);\n      i--; // è°ƒæ•´ç´¢å¼•\n    }\n  }\n}\n```\n\nä¸Šé¢ç”¨åˆ°äº†`splice`è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒä¹Ÿæ˜¯åŸºäº**åŸåœ°ç®—æ³•**ã€‚æ‰€ä»¥æ•´ä¸ª`unique`å‡½æ•°ä¹Ÿæ˜¯*åŸåœ°*çš„ã€‚\n\n### å…¶å®ƒæƒ…å†µï¼šæ•°ç»„å…ƒç´ æ˜¯ä¸ªå¯¹è±¡\n\næ”¹ä¸€ä¸‹æ¯”è¾ƒå¯¹è±¡å°±å¯ä»¥äº†ã€‚\n\nåŸºäºæ— åºæ•°ç»„çš„ä¾‹å­ï¼š\n\n```typescript\ninterface IElement {\n  id: number;\n  name: string;\n}\n\nfunction unique(nums: IElement[]): void {\n  for (let i = 0; i < nums.length; i++) {\n    const target = nums[i];\n    \n    // ***********æ”¹ä¸€ä¸‹åˆ¤æ–­è§„åˆ™***********\n    const firstIndex = nums.findIndex((n) => n.id === target.id);\n    if (firstIndex !== i) {\n      nums.splice(i, 1);\n      i--;\n    }\n  }\n}\n\nconst arr = [\n  { id: 1, name: \"aa\" },\n  { id: 1, name: \"bb\" },\n  { id: 2, name: \"cc\" },\n  { id: 3, name: \"dd\" },\n];\n\nunique(arr);\nconsole.log(arr);\n```\n\n","tags":["JavaScript","TypeScript","Algorithm"],"categories":["Algorithm"]},{"title":"Rustå­¦ä¹ ç¬”è®°-Ownership","url":"/posts/2c967516.html","content":"\næœ¬ç³»åˆ—æ–‡ç« æ˜¯ç¬”è€…å­¦ä¹ `Rust`æ—¶æ‰€åšçš„ç¬”è®°ï¼Œä¾›æ—¥åç¿»é˜…å¤ä¹ ã€‚\n\n## Ownership?\n\n`ownership`ï¼ˆæ‰€æœ‰æƒï¼‰æ˜¯ä¸€å¥—ç”¨æ¥é«˜æ•ˆç®¡ç†å†…å­˜çš„æ–¹æ¡ˆã€‚\n\nå†…å­˜ç®¡ç†ä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼š\n\n1. `GC(garbage collection)`ï¼šå¦‚`java`ã€`javascript`ï¼Œå®ƒä»¬éƒ½æœ‰åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä¼šä¸åœåœ°æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸ä¼šè¢«ä½¿ç”¨åˆ°çš„å†…å­˜ï¼Œç„¶åé‡Šæ”¾å®ƒ\n2. æ‰‹åŠ¨æ–¹å¼ï¼šå¦‚`Cè¯­è¨€`ï¼Œéœ€è¦å¼€å‘è€…æ‰‹åŠ¨åˆ†é…å’Œé‡Šæ”¾å†…å­˜ã€‚\n\n`Rust`åˆ™æ˜¯åœ¨ç¼–è¯‘æ—¶å°±èƒ½çŸ¥é“ä½•æ—¶éœ€è¦é‡Šæ”¾å†…å­˜ï¼Œè€Œæ— éœ€ç­‰åˆ°è¿è¡Œæ—¶ï¼Œæ‰€ä»¥ä¸ä¼šå½±å“åˆ°ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ã€‚\n\n### æ ˆå†…å­˜å’Œå †å†…å­˜\n\næ ˆå†…å­˜ï¼š\n\n1. æŒ‰ç…§è·å–å€¼çš„é¡ºåºå­˜å‚¨æ•°æ®ï¼ŒæŒ‰ç…§ç›¸åçš„é¡ºåºåˆ é™¤å€¼\n2. æ ˆå†…å­˜å­˜å‚¨çš„æ•°æ®éƒ½æ˜¯å®šé•¿çš„\n\nå †å†…å­˜ï¼š\n\n1. æ— ç»„ç»‡çš„\n2. å­˜å‚¨æ•°æ®æ—¶ï¼Œå†…å­˜åˆ†é…å™¨ä¼šæ‰¾åˆ°ä¸€å—è¶³å¤Ÿå­˜æ”¾çš„å†…å­˜æ¥å­˜æ”¾ï¼Œå¹¶å°†å…¶æ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼Œç„¶åè¿”å›ä¸€ä¸ªæŒ‡é’ˆã€‚æŒ‡é’ˆæ˜¯å®šé•¿çš„å¹¶ä¸”å­˜æ”¾åœ¨æ ˆå†…å­˜ä¸­\n3. è®¿é—®å †å†…å­˜æ¯”è®¿é—®æ ˆå†…å­˜æ›´è€—æ—¶ã€‚æ ˆå†…å­˜æ˜¯ç›¸é‚»çš„ï¼Œè€Œè®¿é—®å †å†…å­˜éœ€è¦åœ¨å†…å­˜ä¸­è·³è·ƒ\n\n### Ownershipè§„åˆ™\n\n1. `Rust`ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª`owner`å˜é‡\n2. `owner`ç¦»å¼€å…¶ä½œç”¨åŸŸæ—¶ï¼Œè¯¥å€¼ä¼šè¢«åˆ é™¤\n\n```rust\nfn main() {\n  // æ­¤å¤„ï¼šsæ— æ³•è®¿é—®\n  let s = \"hello\";\n  // æ­¤å¤„ï¼šså¯ä»¥è®¿é—®\n} // æ­¤å¤„ï¼šç¦»å¼€ä½œç”¨åŸŸï¼Œsæ— æ³•è®¿é—®\n```\n\n`s`æ˜¯å­—ç¬¦ä¸²å­—é¢é‡çš„`owner`ï¼Œç¦»å¼€å…¶ä½œç”¨åŸŸå°±æ— æ³•è®¿é—®\n\n### å­—ç¬¦ä¸²ä¸`Ownership`\n\nä»¥å­—ç¬¦ä¸²ç±»å‹æ¥è¯´æ˜`Ownership`ã€‚å…¶å®ƒï¼ˆå­˜å‚¨åœ¨å †å†…å­˜çš„ï¼‰ç±»å‹åŒç†\n\nå£°æ˜ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨å­—é¢é‡æˆ–è€…`String`\n\n```rust\nfn main() {\n  let mut s = String::from(\"hello\")\n  \n  s.push_str(\", rust!\");\n  \n  println!(\"{}\", s);\n}\n```\n\nåŒºåˆ«ï¼šå­—ç¬¦ä¸²å­—é¢é‡ä¸å¯ä¿®æ”¹ï¼Œ`String`æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„\n\n#### å†…å­˜å’Œåˆ†é…\n\nå¯¹äºå­—ç¬¦ä¸²å­—é¢é‡ï¼Œåœ¨ç¼–è¯‘æ—¶å°±å·²çŸ¥å…¶é•¿åº¦ï¼ˆå¹¶ä¸”ä¸èƒ½æ”¹å˜ï¼‰\n\nè€Œ`String`ç±»å‹ï¼Œä¸ºäº†ä¿æŒå…¶å¯å˜æ€§ï¼Œéœ€è¦æ»¡è¶³ä¸¤ç‚¹ï¼š\n\n1. åœ¨è¿è¡Œæ—¶è¯·æ±‚å†…å­˜åˆ†é…ï¼šä½¿ç”¨`String::from`å°±ä¼šåœ¨è¿è¡Œæ—¶æ¥è¯·æ±‚å†…å­˜åˆ†é…\n2. å½“Stringä½¿ç”¨å®Œåï¼Œéœ€è¦å°†å†…å­˜è¿”è¿˜ç»™å†…å­˜åˆ†é…å™¨ï¼ˆå†…å­˜å›æ”¶ï¼‰ï¼š`Rust`æ˜¯å½“å˜é‡ç¦»å¼€å…¶ä½œç”¨åŸŸæ—¶å°±ä¼šè‡ªåŠ¨è°ƒç”¨`drop`å‡½æ•°ï¼Œæ¥å›æ”¶å…¶å†…å­˜ã€‚\n\n#### Move\n\n```rust\nfn main() {\n  let s1 = String::from(\"hello\");\n  let s2 = s1;\n  // æ­¤å¤„ï¼šs2æœ‰æ•ˆï¼Œs1æ— æ•ˆ\n}\n```\n\nè¯´æ˜ï¼š\n\n1. `String`æ˜¯å­˜å‚¨åœ¨å †å†…å­˜ä¸­çš„ï¼Œ`s2 = s1`åªä¼šå¤åˆ¶æ ˆå†…å­˜çš„æ•°æ®ï¼ˆå«æŒ‡é’ˆï¼‰è€Œä¸ä¼šå†æ‹·è´ä¸€ä»½å †å†…å­˜æ•°æ®\n2. `s2 = s1`å«åš`s1`çš„`ownership`ç§»åŠ¨(move)åˆ°äº†`s2`ï¼Œåˆ™`s1`ä¼šæ— æ•ˆå³æ— æ³•å†è®¿é—®ã€‚è¿™ä¹ˆåšçš„åŸå› æ˜¯é˜²æ­¢å˜é‡ç¦»å¼€ä½œç”¨åŸŸåå¯¹åŒä¸€å—å †å†…å­˜å›æ”¶ä¸¤æ¬¡ã€‚\n\n#### Clone\n\nå¦‚æœéœ€è¦å¯¹å †å†…å­˜è¿›è¡Œæ·±æ‹·è´ï¼Œå°±éœ€è¦è°ƒç”¨å…¬å…±æ–¹æ³•`clone`\n\n```rust\nfn main() {\n  let s1 = String::from(\"hello\");\n  let s2 = s1.clone();\n  // s1 s2éƒ½æœ‰æ•ˆ\n}\n```\n\n#### Copy\n\nå‰é¢æ‰€è¯´çš„è§„åˆ™é€‚ç”¨äºå †å†…å­˜çš„æ•°æ®ï¼Œè€Œå¯¹äºæ ˆå†…å­˜æ•°æ®åˆ™ä¸ä¸€æ ·\n\n```rust\nfn main() {\n  let x = 5;\n  let y = x;\n  // x y éƒ½æœ‰æ•ˆ\n}\n```\n\nè¿™æ˜¯å› ä¸º`i32`ç±»å‹å…·æœ‰`copy`ç‰¹æ€§\n\nå…·æœ‰`copy`ç‰¹æ€§çš„æœ‰ï¼š\n\n1. æ‰€æœ‰æ•´å‹\n2. å¸ƒå°”ç±»å‹\n3. æµ®ç‚¹ç±»å‹\n4. å­—ç¬¦ç±»å‹`char`\n5. å…ƒç»„ç±»å‹ï¼Œå‰æï¼šå…ƒç»„çš„æˆå‘˜éƒ½æ˜¯å…·æœ‰`copy`ç‰¹æ€§çš„\n\n### å‡½æ•°ä¸`Ownership`\n\n#### ä¼ å‚\n\nå‡½æ•°ä¼ å‚çš„åœºæ™¯æ¶‰åŠåˆ°äº†`ownership`çš„`move`\n\n```rust\nfn main() {\n  let s = String::from(\"hello\");\n  takes_ownership(s);\n  // s æ— æ•ˆï¼ŒStringå‘ç”Ÿmove\n  \n  let x = 10;\n  makes_copy(x);\n  // x ä¾æ—§æœ‰æ•ˆï¼Œxå…·æœ‰copyç‰¹æ€§\n} // xç¦»å¼€ä½œç”¨åŸŸ å‡ºæ ˆï¼›sç¦»å¼€ä½œç”¨åŸŸï¼Œç”±äºå·²ç»æ— æ•ˆäº†ä¸ä¼šè¿›è¡Œå›æ”¶\n\nfn takes_ownership(some_string: String) {\n  println!(\"{}\", some_string);\n} // some_stringç¦»å¼€ä½œç”¨åŸŸï¼Œè¿›è¡Œå›æ”¶\n\nfn makes_copy(some_integer: i32) {\n  println!(\"{}\", some_integer);\n} // some_integerç¦»å¼€ä½œç”¨åŸŸ å‡ºæ ˆ\n```\n\n> å†…å­˜å›æ”¶(drop)é’ˆå¯¹å †å†…å­˜ï¼Œæ ˆå†…å­˜æ˜¯å‡ºæ ˆ(pop off)\n\n#### è¿”å›å€¼å’Œä½œç”¨åŸŸ\n\nå‡½æ•°çš„è¿”å›å€¼ä¹Ÿä¼šè½¬ç§»`ownership`\n\n```rust\nfn main() {\n  let s1 = gives_ownership();         // gives_ownershipå°†è¿”å›å€¼moveç»™s1\n\n  let s2 = String::from(\"hello\");\n\n  let s3 = takes_and_gives_back(s2);  // s2 å‘ç”Ÿmove\n                                        // takes_and_gives_backå°†è¿”å›å€¼moveç»™s3\n} \n// s3ç¦»å¼€ä½œç”¨åŸŸï¼Œå‘ç”Ÿdrop\n// s2ç¦»å¼€ä½œç”¨åŸŸï¼Œä½†å·²ç»moveäº†\n// s1ç¦»å¼€ä½œç”¨åŸŸï¼Œå‘ç”Ÿdrop\n\nfn gives_ownership() -> String {            \n  let some_string = String::from(\"hello\"); \n\n  some_string // some_string moveç»™è°ƒç”¨å‡½æ•°\n} // some_stringï¼Œå·²ç»moveäº†\n\nfn takes_and_gives_back(a_string: String) -> String { \n\n    a_string  // a_string moveç»™è°ƒç”¨å‡½æ•°\n} // a_string ç¦»å¼€ä½œç”¨åŸŸï¼Œå‘ç”Ÿdrop\n```\n\nç”±äº`ownership`å­˜åœ¨`move`ï¼Œæ‰€ä»¥åªæœ‰å½“å‡½æ•°å°†æ•°æ®è¿”å›ï¼Œæˆ‘ä»¬æ‰èƒ½å†æ¬¡ä½¿ç”¨ã€‚`Rust`æ”¯æŒå¤šè¿”å›å€¼ï¼Œæ‰€ä»¥ä¸ä¼šå¹²æ‰°å…¶å®ƒè¿”å›å€¼æ•°æ®ã€‚\n\n```rust\nfn main() {\n    let s1 = String::from(\"hello\");\n\n    let (s2, len) = calculate_length(s1);\n\n    println!(\"The length of '{}' is {}.\", s2, len);\n}\n\nfn calculate_length(s: String) -> (String, usize) { // è¿”å›ç±»å‹æ˜¯ä¸€ä¸ªå…ƒç»„\n    let length = s.len();\n\n    (s, length) // å¤šè¿”å›å€¼\n}\n```\n\n## References\n\n### Immutable References\n\nåœ¨å‡½æ•°ä¼ å‚çš„åœºæ™¯ä¸‹ï¼Œç”±äº`ownership`çš„å­˜åœ¨ï¼Œä¸€æ—¦`ownership`å‘ç”Ÿ`move`ã€‚å°±æ— æ³•åœ¨å‡½æ•°ä½“ä¹‹åçš„éƒ¨åˆ†è®¿é—®åˆ°è¯¥å˜é‡ã€‚\n\nè¿™æ˜¯`Rust`æ•…æ„è®¾è®¡çš„ï¼Œä½†`Rust`åˆæä¾›äº†å¦ä¸€ç§å‡½æ•°ä¼ å‚æ–¹å¼è€Œä¸ä¼šå‘ç”Ÿ`move`â€”â€”`å¼•ç”¨(References)`\n\n```rust\nfn main() {\n    let s1 = String::from(\"hello\");\n\n    let len = calculate_length(&s1); // åŠ ä¸ª &å·è¡¨ç¤º åˆ›å»ºä¸€ä¸ªReference æŒ‡å‘s1\n\t\t\n  \t// s1 ä¾æ—§æœ‰æ•ˆ\n}\n// len ç¦»å¼€ä½œç”¨åŸŸï¼Œå‡ºæ ˆ\n// s1 ç¦»å¼€ä½œç”¨åŸŸ drop\n\nfn calculate_length(s: &String) -> usize { // æ¥å—å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ª Reference\n    s.len()\n}\n// sç¦»å¼€ä½œç”¨åŸŸï¼Œå®ƒæ˜¯Reference ä¸ä¼šdrop\n```\n\n`Reference`ä¸ä¼šè·å¾—åŸæ•°æ®çš„`ownership`\n\nä¸Šä¾‹ä¸­ï¼Œæˆ‘ä»¬ç§°`calculate_length`å‡½æ•°`ç§Ÿå€Ÿ(borrowing)`s1\n\nä½†æ˜¯ï¼Œ`calculate_length`å†…éƒ¨ä¸èƒ½ä¿®æ”¹ s1ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™\n\n### Mutable References\n\nå¦‚æœéœ€è¦ä¿®æ”¹`Reference`ï¼Œå°±å¯ä»¥ä½¿ç”¨`&mut s`çš„å½¢å¼å£°æ˜ä¸€ä¸ª`Mutable References`ã€‚\n\n```rust\nfn main() {\n    let mut s = String::from(\"hello\");\n\n    change(&mut s);\n}\n\nfn change(some_string: &mut String) {\n    some_string.push_str(\", world\");\n}\n```\n\nä½†ä¹Ÿæ˜¯åˆé™åˆ¶çš„\n\n1. åŒä¸€ä½œç”¨åŸŸä¸‹ï¼ŒåŒä¸€æ•°æ®å—åªèƒ½æœ‰ä¸€ä¸ª`Mutable References`ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢`Data races`\n2. åœ¨ä½¿ç”¨`Immutable Reference`çš„åŒæ—¶ï¼Œä¸èƒ½ä½¿ç”¨`Mutable References`\n\n### Dangling References\n\næ‚¬æŒ‚å¼•ç”¨ï¼ˆç©ºæŒ‡é’ˆï¼‰ï¼Œçœ‹ä¸ªä¾‹å­\n\n```rust\nfn main() {\n    let reference_to_nothing = dangle();\n}\n\nfn dangle() -> &String {\n    let s = String::from(\"hello\");\n\n    &s\n} // sç¦»å¼€ä½œç”¨åŸŸ drop\n// å‡½æ•°è¿”å› sçš„Referenceï¼Œä½†så·²ç»è¢«dropã€‚è¿™ä¸ªreferenceå°±æ˜¯Dangling References\n```\n\nRustæ˜¯ä¸å…è®¸è¿™ç§æƒ…å†µå‘ç”Ÿçš„ï¼Œæ‰€ä»¥è¿™æ ·å†™ä¼šæŠ¥é”™ã€‚\n\n## Slice\n\n### å­—ç¬¦ä¸²åˆ‡ç‰‡\n\nåˆ‡ç‰‡(`slice`)åŒæ ·ä¹Ÿä¸ä¼šå‘ç”Ÿ`ownership`è½¬ç§»\n\n```rust\nfn main() {\n  let s = String::from(\"hello world!\");\n  \n  let s1 = &s[0..3];\n  let s2 = &s[3..12];\n  \n  println!(\"{}-{}\", s1, s2); // hel-lo world!\n}\n```\n\n`&s[0..3]`ä¼šåˆ›å»ºsä¸­ç´¢å¼•[0, 2]çš„`Reference`ã€‚\n\næœ‰å‡ ç§å¯ä»¥çœç•¥å€¼çš„å†™æ³•ï¼š\n\n1. `[0..2]`å’Œ`[..2]`æ˜¯ç­‰ä»·çš„\n\n2. `[2..len]`å’Œ`[2..]`ç­‰ä»·ï¼Œ`len`ä¸ºæ€»é•¿åº¦\n3. `[0..len]`å’Œ`[..]`ç­‰ä»·\n\nä»æ•°æ®ç»“æ„è§’åº¦çœ‹ï¼Œ`String Slice`ä¼šå­˜å‚¨èµ·å§‹ä½ç½®å’Œé•¿åº¦ï¼š\n\n![rust-string-slice-structure](../../images/rust-string-slice-structure.png)\n\nå†™ä¸€ä¸ªæŸ¥æ‰¾å­—ç¬¦ä¸²é¦–ä¸ªå•è¯\n\n```rust\nfn main() {\n  let s = String::from(\"hello world!\");\n  \n  let word = first_word(&s); // &s[..]ä¹Ÿå¯ä»¥\n  println!(\"{}\", word); // hello\n}\n\nfn first_word(s: &str) -> &str {\n  let bytes = s.as_bytes();\n  \n  for (i, &item) in bytes.iter().enumerate() {\n    if item == b' ' {\n      return &s[..i];\n    }\n  }\n  \n  &s[..]\n}\n```\n\nå­—ç¬¦ä¸²åˆ‡ç‰‡çš„ç±»å‹æ˜¯`&str`ï¼Œ`&str`ç±»å‹èƒ½å¤Ÿå…¼å®¹`&String`å’Œ`&str`\n\n### å­—ç¬¦ä¸²å­—é¢é‡\n\nå­—ç¬¦ä¸²å­—é¢é‡æœ¬èº«å°±æ˜¯`slice`\n\n```rust\nlet s = \"Hello, World!\"\n```\n\n`s`çš„ç±»å‹å°±æ˜¯`&str`å³ä¸€ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡ã€‚`&str`æ˜¯ä¸€ä¸ª`Immutable Reference`ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²å­—é¢é‡ä¸å¯å˜","tags":["Rust","è¯­è¨€å­¦ä¹ "],"categories":["Rust"]},{"title":"å­¦ä¹ è·¯å¾„","url":"/posts/2b6933ae.html","content":"\n## çŸ¥è¯†æ¦‚è§ˆ\n\n### ä»åŸºæœ¬åŠŸè§’åº¦çœ‹\n\nåŸºæœ¬åŠŸæ‰å®äº†ï¼Œåé¢çš„çŸ¥è¯†æŠ€æœ¯æ‰å¥½æ¨è¿›ã€‚\n\n#### å·¥å…·\n\n1. terminalï¼šå‘½ä»¤è¡Œè‚¯å®šè¦ä¼šç”¨\n2. Gitç‰ˆæœ¬æ§åˆ¶ï¼šåŸç†ã€æ¦‚å¿µä»¥åŠå¸¸è§çš„åœºæ™¯ï¼Œå¿…é¡»å­¦ä¼šgitçš„å‘½ä»¤è¡Œä½¿ç”¨æ–¹æ³•ã€‚ä¸èƒ½è¿‡åˆ†ä¾èµ–GUIå·¥å…·\n3. ç¼–è¾‘å™¨ï¼š`VSCode`ï¼Œè¿™ç©æ„è¿˜ç”¨å­¦ï¼Ÿé”™ï¼Œä½ çœ‹è¿‡`vscode`çš„æ›´æ–°æ—¥å¿—å—ï¼Ÿä½ ä¼šç”¨`vscode`æ¥debugå—ï¼Ÿä½ ä¼šå†™`vscode`æ’ä»¶å—ï¼Ÿ\n\n#### å¼€æºå¸¸è¯†\n\nä½œä¸ºç¨‹åºå‘˜ï¼ŒæŠ€æœ¯ä¸Šç´§è·Ÿå¼€æºç¤¾åŒºå‡†æ²¡é”™ã€‚\n\n1. è¯­ä¹‰ç‰ˆæœ¬å·\n2. `GitHub`ã€`Gitee`ã€`Gitlab`\n3. å¼€æºè®¸å¯\n\n#### æ”¯æ’‘çŸ¥è¯†\n\n1. æ•°æ®ç»“æ„\n2. è®¾è®¡æ¨¡å¼\n3. ç½‘ç»œï¼šäº†è§£`HTTP`å—ï¼Ÿ`HTTP`0.9 - 3.0æœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŸHTTPçš„å¤´ä¿¡æ¯æœ‰å“ªäº›ï¼Ÿå¹²ä»€ä¹ˆç”¨çš„ï¼ŸDNSï¼Ÿ\n4. æµè§ˆå™¨å·¥ä½œæ¨¡å‹\n\n### ä»è¯­è¨€è§’åº¦çœ‹\n\nå‰ç«¯å¼€å‘å››å¤§è¯­è¨€ï¼š`HTML` `CSS` `JavaScript` `WebAssembly`\n\næ¯ä¸€é—¨è¯­è¨€éƒ½æ¶‰åŠåˆ°çŸ¥è¯†çš„å»¶ç”³\n\n`html5`æä¾›äº†ç¹å¤šå¤æ‚çš„`API`\n\n`CSS` çš„é¢„å¤„ç†å™¨æœ‰`less`ã€`scss`ã€`stylus`\n\n`JavaScript` çš„è¶…é›†ï¼š`TypeScript`\n\n`WebAssembly`éœ€è¦å­¦ä¹ ä¸€é—¨ç³»ç»Ÿçº§çš„è¯­è¨€â€”â€”`c++`æˆ–è€…`rust`\n\n### ä»å¹³å°è§’åº¦çœ‹\n\nwebæŠ€æœ¯çš„è·¨å¹³å°æ€§å®å±æœ€å¼ºã€‚webæŠ€æœ¯å‡ ä¹å•¥éƒ½èƒ½åšã€‚\n\nç½‘é¡µç«¯ï¼šæ²¡å•¥å¯è¯´çš„ï¼Œwebæœ€åˆå°±æ˜¯ç”¨æ¥å¹²è¿™ä¸ªçš„\n\nç§»åŠ¨ç«¯ï¼šå°ç¨‹åºã€`react native`ã€`flutter`ï¼ˆä¹Ÿç®—ä¸Šå§ï¼‰ï¼Œè¿˜æœ‰ä¸€å †æ··åˆå¼€å‘å·¥å…·ï¼ŒPWA\n\nå®¢æˆ·ç«¯ï¼š`electron`\n\næœåŠ¡ç«¯ï¼š`express`ã€`koa`ã€`nest.js`\n\n### ä»è§†å›¾å±‚è§’åº¦çœ‹\n\nè§†å›¾å±‚æœ‰ä¸‰å¤§æ¡†æ¶ï¼š`Vue`ã€`React`ã€`Angular`\n\n`Vue`å’Œ`React`éƒ½æ˜¯ç”¨ç»„ä»¶åŒ–å¼€å‘çš„æ€æƒ³æ¥æ„å»ºwebåº”ç”¨ã€‚ä½†å…¶åº•å±‚å®ç°æ–¹å¼å®Œå…¨ä¸ä¸€æ ·ã€‚å­¦ä¹ å®ƒä»¬æ—¶ä¸€å®šè¦æ·±å…¥åº•å±‚ï¼Œæ¯”å¦‚ææ¸…æ¥š`Vueå“åº”å¼`ç©¶ç«Ÿæ˜¯å¦‚ä½•å®ç°çš„ã€‚\n\næ— è®º`Vue`è¿˜æ˜¯`React`éƒ½æ˜¯æ‰€è°“çš„**å•é¡µé¢åº”ç”¨(Single Page Application, SPA)**ã€‚ä¸åˆ©äº`SEO`ï¼Œé¦–å±åŠ è½½æ…¢ï¼Œè¿›è€Œåˆå‡ºç°äº†**æœåŠ¡ç«¯æ¸²æŸ“(Server Side Render, SSR)**ã€‚\n\n### ä»å·¥ç¨‹åŒ–è§’åº¦\n\nå‰ç«¯å·¥ç¨‹åŒ–æ˜¯åŸºäº`nodejs`çš„ã€‚\n\nå‰ç«¯é¡¹ç›®çš„æ„å»ºå·¥å…·æœ‰å¾ˆå¤šï¼Œå¸¸ç”¨çš„æœ‰`Webpack`ã€`Rollup`ã€`Gulp/Grunt`ç­‰ï¼Œä»Šå¹´æœ‰`Vue`å›¢é˜Ÿåˆå‡ºäº†ä¸ª`Vite`ã€‚ä»–ä»¬åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\næœåŠ¡ç«¯æ¸²æŸ“\n\nå¾®å‰ç«¯\n\n**å·¥ç¨‹åŒ–åˆè¦è€ƒè™‘å“ªäº›ç»†èŠ‚é—®é¢˜ï¼Ÿ**ï¼ˆå¤ªå¤šäº†ï¼‰\n\n`node`çš„åŒ…ç®¡ç†æœ‰`npm`å’Œ`yarn`ä¸¤ç§ï¼Œä»–ä»¬åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n### ä»æœåŠ¡ç«¯è§’åº¦çœ‹\n\n`JavaScript`å¯ä»¥é€šè¿‡`nodejs`æ¥å†™æœåŠ¡ç«¯ç¨‹åºã€‚ä¸è¿‡åˆå†’å‡ºäº†ä¸ª`deno`ï¼Œå¼•å…¥äº†ååˆ†æœ‰è¶£çš„æ¦‚å¿µï¼Œä»–ä»¬æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ\n\nè‡³å°‘æŒæ¡ä¸€ä¸ªæœåŠ¡ç«¯çš„æ¡†æ¶å§ï¼šè½»é‡çº§çš„æœ‰`Express`ã€`Koa`ã€‚é‡é‡çº§çš„æ¯”è¾ƒæ¨è`Nest.js`\n\næœ‰äº†æœåŠ¡ç«¯ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥å¼•å…¥`BFF`å±‚äº†\n\næœ‰äº†æœåŠ¡ç«¯ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥åšæœåŠ¡ç«¯æ¸²æŸ“äº†\n\næœ‰äº†æœåŠ¡ç«¯ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ç”¨`GraphQL`äº†\n\næœ‰äº†æœåŠ¡ç«¯ï¼Œæ˜¯ä¸æ˜¯æ­å»ºMockæœåŠ¡ï¼Œæ€§èƒ½ç›‘æ§ã€é”™è¯¯ç›‘æ§äº†\n\næœ‰äº†æœåŠ¡ç«¯ï¼Œæ˜¯ä¸æ˜¯è¿˜å¯ä»¥å­¦ä¹ ä¸‹æ•°æ®åº“\n\n## é˜¶æ®µé›¶ï¼šä¹ æƒ¯å…»æˆ\n\né˜¶æ®µé›¶æ˜¯è´¯ç©¿æ•´ä¸ªå­¦ä¹ è®¡åˆ’çš„ï¼Œæ—¨åœ¨å…»æˆè‡ªå¾‹çš„å­¦ä¹ ä¹ æƒ¯ã€‚\n\n- [ ] æ¯å¤©è‡³å°‘ä¸€é“ç®—æ³•é¢˜ï¼Œ`LeetCode`åˆ·èµ·æ¥ã€‚ï¼ˆæ¯é“é¢˜éƒ½è¦å†™ç­”é¢˜ç¬”è®°å“¦ï¼‰\n\n## é˜¶æ®µä¸€ï¼šå¤¯å®åŸºç¡€\n\nä¼šä»å‰ç«¯å››å¤§è¯­è¨€å…¥æ‰‹ï¼Œ`HTML` `CSS` `JavaScript` ä¸‰è€…ç»“åˆèµ·æ¥å­¦ä¹ ã€‚`WebAssembly`ä¹Ÿä¼šæ·±å…¥äº†è§£\n\n- [ ] [JavaScriptç°ä»£æ•™ç¨‹](https://zh.javascript.info/)ç»“åˆçº¢å®ä¹¦ï¼Œææ‡‚`JavaScript`çš„æ–¹æ–¹é¢é¢ã€‚\n- [ ] æ¢³ç†`H5`æ–°å¢ç‰¹æ€§ï¼Œæ¯”å¦‚canvasã€éŸ³è§†é¢‘æ–¹é¢ï¼ˆè¿™éœ€è¦ç»“åˆ`JS`å­¦ä¹ ï¼‰\n- [ ] å­¦ä¹ `CSS`åŸºæœ¬æ¦‚å¿µï¼ŒæŒæ¡é¡µé¢å¸ƒå±€ä»¥åŠä¼—å¤šçš„`CSS3`å±æ€§ç”¨æ³•\n- [ ] [TypeScriptå­¦ä¹ ](https://jkchao.github.io/typescript-book-chinese/)\n- [ ] `WebAssembly`çš„å®ç°åŸç†ï¼Œæ‰‹æ‘¸æ‰‹å†™ä¸€ä¸‹`wasm`\n\n> è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿä¼šç©¿æ’å­¦ä¹ ä¸€äº›å…¶å®ƒå†…å®¹ï¼Œæ¯”å¦‚æµè§ˆå™¨å·¥ä½œæ¨¡å‹ç­‰ã€‚\n\n## é˜¶æ®µäºŒï¼šè§†å›¾å±‚åº“\n\nè¿™ä¸ªé˜¶æ®µä¼šå¯¹`React`å’Œ`Vue`ç”Ÿæ€è¿›è¡Œå­¦ä¹ ã€‚æ²¡é”™ã€‚ä¸¤ä¸ªéƒ½è¦å­¦ï¼\n\n- [ ] å­¦ä¹ ä¸¤è€…å¼€å‘æ€è·¯ã€‚æŒæ¡å…¶æä¾›æ¯ä¸€ä¸ª`API`\n- [ ] å°è¯•å†™ä¸ªç»„ä»¶åº“\n- [ ] **æ·±å…¥æºç **ï¼Œææ‡‚å…¶è®¾è®¡æ€æƒ³\n\n> é˜…è¯»æºç è¿‡ç¨‹ä¸­ï¼Œä¼šç©¿æ’ä¸€ä¸‹**è®¾è®¡æ¨¡å¼**ä»¥åŠ**æ•°æ®ç»“æ„**çš„å­¦ä¹ \n\n## é˜¶æ®µä¸‰ï¼šå·¥ç¨‹åŒ–\n\nä»å·¥ç¨‹åŒ–è§’åº¦æ€è€ƒå‰ç«¯å»ºè®¾ã€‚\n\n- [ ] æ„å»ºå·¥å…·å­¦ä¹ \n  - [ ] å­¦ä¼š`webpack`æ„å»ºé¡¹ç›®\n  - [ ] æ·±å…¥äº†è§£`webpack`åŸç†\n  - [ ] äº†è§£å…¶å®ƒæ„å»ºå·¥å…·`rollup`å’Œ`gulp`\n- [ ] å‰ç«¯å·¥ç¨‹åŒ–çš„åº”ç”¨åœºæ™¯\n- [ ] å¼•å…¥ä¸­é—´å±‚`BFF`ï¼Œç ”ç©¶ä¸€ä¸‹å‰ç«¯ä½“ç³»å»ºè®¾ã€‚\n- [ ] å¾®å‰ç«¯çš„åº”ç”¨\n\n## é˜¶æ®µå››ï¼šå¤šç«¯å¼€å‘\n\nè¿™ä¸ªé˜¶æ®µå°±æ¶‰åŠåˆ°å…¶å®ƒåœºæ™¯äº†ã€‚æ¯”å¦‚è¯´ç§»åŠ¨ç«¯ã€å®¢æˆ·ç«¯ç”šè‡³æœåŠ¡ç«¯ã€‚\n\n- [ ] ç§»åŠ¨ç«¯\n  - [ ] ç†Ÿç»ƒç¼–å†™ç§»åŠ¨ç«¯é¡µé¢ï¼Œï¼ˆç§»åŠ¨ç«¯å¯¹äº¤äº’æœ‰ä¸€å®šçš„è¦æ±‚ï¼‰\n  - [ ] æŒæ¡ `React native`å¼€å‘ç§»åŠ¨ç«¯åº”ç”¨\n- [ ] å®¢æˆ·ç«¯ï¼šElectronæŠ€æœ¯\n- [ ] æœåŠ¡ç«¯ï¼š`nodejs`æœåŠ¡ç«¯é€šå¸¸ç”¨æ¥æ­å»ºBFFå±‚çš„ã€‚\n  - [ ] æŒæ¡`Koa`åŸç†ï¼Œå­¦ä¼šå¼€å‘ä¸­é—´ä»¶ã€‚æ‹†ä¸€ä¸‹`Vite`æºç ç…ä¸€ä¸‹\n  - [ ] `nest.js`ï¼šå¦‚æœçœŸçš„è¦ç”¨nodeç¼–å†™æœåŠ¡ç«¯ï¼Œå®ƒæ˜¯ç›®å‰æœ€å¥½çš„é€‰æ‹©\n","tags":["Plan"],"categories":["Plan"]},{"title":"Interviewç´¢å¼•ä¸€è§ˆ","url":"/posts/bb799ed5.html","content":"\n## JavaScript\n\n### é—­åŒ…\n\n#### 1.ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ\n\nå®šä¹‰ï¼š[é—­åŒ…](https://en.wikipedia.org/wiki/Closure_(computer_programming)) æ˜¯æŒ‡å†…éƒ¨å‡½æ•°æ€»æ˜¯å¯ä»¥è®¿é—®å…¶æ‰€åœ¨çš„å¤–éƒ¨å‡½æ•°ä¸­å£°æ˜çš„å˜é‡å’Œå‚æ•°\n\nä¸‰ç§ä½œç”¨åŸŸï¼š**å…¨å±€ä½œç”¨åŸŸ**ã€**å—ä½œç”¨åŸŸ**ã€**å‡½æ•°ä½œç”¨åŸŸ**\n\nä½œç”¨åŸŸé“¾\n\n#### 2.ä¸ºä»€ä¹ˆæœ‰é—­åŒ…ï¼ˆé—­åŒ…æ˜¯æ€ä¹ˆå½¢æˆçš„ï¼‰ï¼Ÿ\n\nè§£é‡Š**è¯æ³•ç¯å¢ƒ**å¯¹è±¡\n\n- å†…éƒ¨ä¿¡æ¯ï¼šä½œç”¨åŸŸå†…éƒ¨å®šä¹‰çš„å˜é‡ æˆ– å‡½æ•°å‚æ•°\n- å¤–éƒ¨è¯æ³•ç¯å¢ƒçš„å¼•ç”¨\n\nè§£é‡Šå‡½æ•°åˆ›å»ºã€è°ƒç”¨ä»¥åŠæ‰§è¡Œæ—¶çš„è¡¨ç°ï¼š\n\n- å‡½æ•°åˆ›å»ºæ—¶ï¼Œå‡½æ•°å¯¹è±¡çš„`[[environment]]`è®°å½•å‡½æ•°æ‰€åœ¨çš„è¯æ³•ç¯å¢ƒ\n\n- å‡½æ•°è°ƒç”¨æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå‡½æ•°å†…éƒ¨çš„è¯æ³•ç¯å¢ƒå¯¹è±¡ï¼Œå¹¶ä¸”è¯¥å¯¹è±¡çš„å¤–éƒ¨è¯æ³•ç¯å¢ƒçš„å¼•ç”¨æŒ‡å‘å‡½æ•°`[[environment]]`å±æ€§\n\n- å‡½æ•°å†…éƒ¨æ‰§è¡Œæ—¶\n  - ä½¿ç”¨å˜é‡ï¼šé¦–å…ˆä¼šæœç´¢å†…éƒ¨è¯æ³•ç¯å¢ƒï¼Œç„¶åæœç´¢å¤–éƒ¨ç¯å¢ƒï¼Œç„¶åæœç´¢æ›´å¤–éƒ¨çš„ç¯å¢ƒï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°å…¨å±€è¯æ³•ç¯å¢ƒã€‚\n  - ä¿®æ”¹å˜é‡ï¼šå§‹ç»ˆåœ¨å˜é‡æ‰€åœ¨çš„è¯æ³•ç¯å¢ƒä¸­æ›´æ–°å˜é‡\n\nè§£é‡Šï¼Œè¯æ³•ç¯å¢ƒå¯¹è±¡çš„**åƒåœ¾å›æ”¶**ï¼š**è¯æ³•ç¯å¢ƒç†è®ºä¸Šä¸å¯è¾¾ï¼ˆè®¿é—®ï¼‰æ—¶ï¼Œå°±ä¼šè¢«å›æ”¶**\n\n> [é—­åŒ…](https://zh.javascript.info/closure)â€”â€”JavaScriptç°ä»£æ•™ç¨‹\n\n### å˜é‡æå‡\n\nvarçš„ä½œç”¨åŸŸï¼šå…¨å±€ä½œç”¨åŸŸã€å‡½æ•°ä½œç”¨åŸŸã€‚æ²¡æœ‰å—ä½œç”¨åŸŸ\n\nvarå£°æ˜çš„å˜é‡ï¼Œä¼šè¢«æå‡åˆ°ä½œç”¨åŸŸé¡¶éƒ¨\n\nåœ¨å—ä½œç”¨åŸŸä¸­ç”¨varå£°æ˜å˜é‡ï¼Œä¼šè¢«æå‡åˆ°å¤–å±‚ä½œç”¨åŸŸ\n\nvarçš„å˜é‡æå‡åªæ˜¯**å£°æ˜æå‡è€Œä¸æ˜¯èµ‹å€¼æå‡**\n\n### åŸå‹é“¾\n\n#### ä»€ä¹ˆæ˜¯åŸå‹å’ŒåŸå‹é“¾ï¼Œæœ‰ä»€ä¹ˆç”¨ï¼Ÿ\n\nåŸå‹ï¼šjsä¸­ï¼Œå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªéšè—å±æ€§â€”â€”`[[Prototype]]`å³åŸå‹ï¼Œæˆ–ç§°ä¸ºåŸå‹å¯¹è±¡\n\n- é€šè¿‡å¯¹è±¡çš„`__proto__`èƒ½å¤Ÿè®¿é—®å’Œè®¾ç½®åŸå‹å¯¹è±¡ï¼Œå³åŸå‹å¯¹è±¡çš„`getter/setter`ã€‚è¿™ä¸ªapiæ˜¯éæ ‡å‡†çš„ï¼Œåº”è¯¥é€šè¿‡åŸå‹æ–¹æ³•æ¥è·å–å’Œè®¾ç½®åŸå‹å¯¹è±¡[Object.create(proto, descriptors?)](https://developer.mozilla.org/zh/docs/Web/JavaScript/Reference/Global_Objects/Object/create) ã€[Object.getPrototypeOf(obj)](https://developer.mozilla.org/zh/docs/Web/JavaScript/Reference/Global_Objects/Object/getPrototypeOf) å’Œ[Object.setPrototypeOf(obj, proto)](https://developer.mozilla.org/zh/docs/Web/JavaScript/Reference/Global_Objects/Object/setPrototypeOf) \n\n- é€šè¿‡å¯¹è±¡çš„æ„é€ å‡½æ•°æ¥è®¿é—®åŸå‹å¯¹è±¡ï¼šæ„é€ å‡½æ•°æœ‰ä¸€ä¸ª`prototype`å±æ€§ï¼ˆè¿™æ˜¯å‡½æ•°çš„ä¸€ä¸ª**å¸¸è§„å±æ€§**ï¼‰ï¼Œæ‰€æœ‰ç”±å…¶æ„é€ å‡ºæ¥çš„å®ä¾‹å¯¹è±¡çš„åŸå‹å¯¹è±¡ç­‰äºè¿™ä¸ª`prototype`å±æ€§\n\nåŸå‹é“¾ï¼šç”±åŸå‹å¯¹è±¡ç»„æˆçš„é“¾å¼ç»“æ„è¢«ç§°ä¸ºåŸå‹é“¾\n\næœ‰ä»€ä¹ˆç”¨ï¼šå®ç°ç»§æ‰¿ï¼Œå…±äº«æ•°æ®\n\n#### ä¸ºä»€ä¹ˆä¼šæœ‰åŸå‹é“¾ï¼Ÿ\n\næ–°å»ºå¯¹è±¡æ˜¯ä¼šè‡ªåŠ¨è®¾ç½®åŸå‹å¯¹è±¡\n\n- å¯¹è±¡å­—é¢é‡ï¼šå…¶åŸå‹å¯¹è±¡æ˜¯`Object`\n- æ„é€ å‡½æ•°ï¼šæ–°å¯¹è±¡çš„åŸå‹å¯¹è±¡æ˜¯å…¶æ„é€ å‡½æ•°çš„`prototype`å±æ€§ï¼ˆæ–°å¯¹è±¡çš„`__proto__`æŒ‡å‘å…¶æ„é€ å‡½æ•°ï¼‰\n\n- åŸå§‹ç±»å‹ï¼ˆå¦‚å­—ç¬¦ä¸²ã€æ•°å­—å’Œå¸ƒå°”å€¼ï¼‰ï¼Œå½“è®¿é—®å®ƒä»¬çš„å±æ€§æ—¶ï¼Œ**ä¸´æ—¶åŒ…è£…å™¨å¯¹è±¡**å°†ä¼šé€šè¿‡å†…å»ºçš„æ„é€ å™¨ `String`ã€`Number` å’Œ `Boolean` è¢«åˆ›å»ºï¼ˆ**å€¼** `null` **å’Œ** `undefined` **æ²¡æœ‰å¯¹è±¡åŒ…è£…å™¨**ï¼‰\n\n#### newè¿ç®—ç¬¦\n\nç”¨äºä»æ„é€ å‡½æ•°/ç±»æ¥å®ä¾‹åŒ–å¯¹è±¡ï¼Œ\n\n1. å…ˆåˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡\n2. ç„¶åæ‰§è¡Œæ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°å†…çš„`this`æŒ‡ç©ºå¯¹è±¡ï¼Œå¯¹ç©ºå¯¹è±¡ç»§ç»­åˆå§‹åŒ–ï¼Œç„¶åè¿”å›\n3. å°†ç©ºå¯¹è±¡çš„åŸå‹å¯¹è±¡è®¾ç½®ä¸ºæ„é€ å‡½æ•°çš„`prototype`å±æ€§\n\n#### Object.create\n\n`Object.create(obj)`ç”¨äºä»å·²æœ‰å¯¹è±¡æ¥åˆ›å»ºæ–°å¯¹è±¡\n\n1. å…ˆåˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡\n2. ç„¶åå°†ç©ºå¯¹è±¡çš„åŸå‹å¯¹è±¡è®¾ç½®ä¸ºobj\n\n#### typeof å’Œ instancof\n\n`typeof`åŸç†ï¼š **ä¸åŒçš„å¯¹è±¡åœ¨åº•å±‚éƒ½è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶ï¼Œåœ¨Javascriptä¸­äºŒè¿›åˆ¶å‰ï¼ˆä½ï¼‰ä¸‰ä½å­˜å‚¨å…¶ç±»å‹ä¿¡æ¯**ã€‚\n\n`instanceof` ç”¨æ¥æ¯”è¾ƒä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºæŸä¸€ä¸ªæ„é€ å‡½æ•°çš„å®ä¾‹ï¼Œå®ƒä¼šæ²¿ç€**åŸå‹é“¾**æ¥åˆ¤æ–­ã€‚\n\n### JSå¼‚æ­¥è§£å†³æ–¹æ¡ˆ\n\né“¾æ¥ï¼š[æ‰‹æ’•Promise](/posts/d884e9d5.html)\n\nJavaScriptä¸­æœ‰ä¸¤ä¸­å¼‚æ­¥è§£å†³æ–¹æ³•â€”â€”`Promise`å’Œ`Generator`\n\n`async/await`æ˜¯`Generator`çš„è¯­æ³•ç³–ï¼Œå®ƒå°†`generator`è½¬æˆäº†`Promise`\n\n#### Promiseç»“åˆEventloop\n\nè€ƒç‚¹ï¼šç»“åˆ`EventLoop`æ¥åˆ†æï¼Œç»™åˆ°ä»£ç åˆ†æ`console.log`çš„é¡ºåº\n\n#### æ‰‹å†™Promiseæ–¹æ³•\n\n[æ‰‹æ’•Promise](https://zxffan.github.io/posts/d884e9d5.html)\n\n#### Promiseå’Œasync/awaitçš„åŒºåˆ«\n\n- `async/await`ä»¥åŒæ­¥çš„æ–¹å¼æ¥ä¹¦å†™`promise`\n- `async/await`èƒ½å¤Ÿæ•æ‰å¼‚æ­¥ä»£ç çš„error\n\n### JSæ¨¡å—è§„èŒƒ\n\n#### CJS ESM AMD UMD IIFEä»€ä¹ˆåŒºåˆ«\n\n#### CJSå’ŒESMçš„åŒºåˆ«\n\n[CommonJSå’ŒES6æ¨¡å—å¾ªç¯åŠ è½½å¤„ç†çš„åŒºåˆ«](https://juejin.cn/post/6844903747290660878)\n\n\n\n## ç½‘ç»œ\n\n### ä¸ƒå±‚åè®®\n\n### TCP&UDP\n\n### HTTPS&TLS/SSLåå•†\n\n## æµè§ˆå™¨\n\n### æµè§ˆå™¨çš„ä¸€å¸§éƒ½åšäº†äº›ä»€ä¹ˆï¼Ÿ\n\n[æµè§ˆå™¨å¸§åŸç†å‰–æ](https://juejin.cn/post/6844903808762380296)\n\n[åŸæ–‡](https://aerotwist.com/blog/the-anatomy-of-a-frame/)","tags":["å‰ç«¯","interview"],"categories":["Interview"]},{"title":"ææ‡‚EventLoop","url":"/posts/d0699962.html","content":"\n## JavaScript&å•çº¿ç¨‹\n\n### è¿›ç¨‹ä¸çº¿ç¨‹\n\nè¿›ç¨‹æ˜¯cpuåˆ†é…èµ„æºçš„æœ€å°å•ä½ï¼›çº¿ç¨‹æ˜¯cpuè°ƒåº¦çš„æœ€å°å•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ã€‚\n\ncpuç»™è¿›ç¨‹åˆ†é…èµ„æºï¼Œè¿›ç¨‹å†åˆ›å»ºçº¿ç¨‹å»å·¥ä½œã€‚å®é™…å¹²æ´»çš„æ˜¯çº¿ç¨‹ã€‚åŒä¸€è¿›ç¨‹ä¸‹çš„çº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹çš„èµ„æºã€‚\n\né€šå¸¸ï¼Œè¿›ç¨‹ä¹‹é—´æ˜¯**å¹¶è¡Œæ‰§è¡Œ**ï¼›çº¿ç¨‹ä¹‹é—´æ˜¯**å¹¶å‘æ‰§è¡Œ**\n\n### æµè§ˆå™¨çš„å¤šè¿›ç¨‹æ¨¡å‹\n\nä»¥å¼€æºçš„`Chromium`æµè§ˆå™¨ä¸ºä¾‹ï¼Œå½“æ‰“å¼€æµè§ˆå™¨å°±ä¼šåˆ›å»ºä¸€ä¸ªä¸»è¿›ç¨‹ï¼Œæ¯æ‰“å¼€ä¸€ä¸ª`tab`å°±ä¼šå†åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ã€‚è¿™ä¸ªå­è¿›ç¨‹ç®¡ç†æ¯ä¸ªé¡µé¢ã€‚è€Œåœ¨è¿™ä¸ªå­è¿›ç¨‹ä¸­åˆæœ‰è‹¥å¹²çº¿ç¨‹ï¼Œä¾‹å¦‚ï¼šUIçº¿ç¨‹ã€JSå¼•æ“çº¿ç¨‹ã€æµè§ˆå™¨äº‹ä»¶çº¿ç¨‹ ã€httpè¯·æ±‚çº¿ç¨‹ã€EventLoopè½®è¯¢å¤„ç†çº¿ç¨‹ç­‰ã€‚\n\n### JavaScriptå•çº¿ç¨‹\n\nä¸Šé¢æåˆ°çš„`JSå¼•æ“çº¿ç¨‹`å°±æ˜¯è¿è¡Œ`JavaScript`ä»£ç çš„é‚£ä¸ªçº¿ç¨‹ã€‚æ‰€ä»¥è¯´JavaScriptæ˜¯å•çº¿ç¨‹çš„ï¼Œå…¶å®æ›´åŠ å‡†ç¡®åœ°è¯´ï¼Œåº”è¯¥æ˜¯`JavaScript`çš„`runtime`æ˜¯å•çº¿ç¨‹çš„ã€‚\n\nWhy?\n\nè¿™æ˜¯ç”±`JavaScript`çš„ç”¨é€”å†³å®šçš„ã€‚`JS`æœ€åˆæ˜¯è¢«è®¾è®¡æˆæµè§ˆå™¨è„šæœ¬è¯­è¨€\n\nå¦‚æœè®¾è®¡æˆå¤šçº¿ç¨‹çš„è¯ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®æˆ–ä¿®æ”¹domçš„è¯ï¼Œå°±ä¹±å¥—äº†ï¼Œè¿™æ—¶å¿…é¡»å¼•å…¥**é”**äº†ï¼Œè¿™å¯¹è„šæœ¬è¯­è¨€æ¥è¯´æ²¡æœ‰å¿…è¦ã€‚\n\n### Web Worker\n\n`H5`çš„`Web Worker`æ ‡å‡†å¯ä»¥è®©ä¸»çº¿ç¨‹åˆ›å»ºå­çº¿ç¨‹ï¼Œä½†å®ƒå¹¶æœªè¿èƒŒ`JavaScript`è®¾è®¡åˆè¡·ï¼Œåº”ä¸ºå®ƒå¯¹å­çº¿ç¨‹æœ‰å¾ˆå¤šé™åˆ¶ï¼š\n\n1. å­çº¿ç¨‹å®Œå…¨ç”±ä¸»çº¿ç¨‹æ§åˆ¶\n2. å­çº¿ç¨‹ä¸èƒ½æ“ä½œDOM\n\næ›´å¤š`Web Worker`ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[é˜®ä¸€å³°ç½‘ç»œæ—¥å¿—](http://www.ruanyifeng.com/blog/2018/07/web-worker.html)\n\n## åŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡\n\n### å•çº¿ç¨‹çš„é—®é¢˜\n\nå·²ç»æ˜ç¡®äº†`javascript`æ˜¯ä¸€é—¨å•çº¿ç¨‹çš„è¯­è¨€ã€‚\n\nä½†æ˜¯å•çº¿ç¨‹ä¼šé¢ä¸´ä¸€ä¸ªé—®é¢˜ï¼š\n\næˆ‘ä»¬çš„ä»£ç æ—¶ä¸€è¡Œä¸€è¡Œåœ°æ‰§è¡Œï¼Œå½“å‰é¢çš„æ²¡æœ‰æ‰§è¡Œå®Œï¼Œåé¢åœ°å°±éœ€è¦ç­‰å¾…ã€‚\n\nå¦‚æœç¨‹åºä¸­é—´æœ‰ä¸ªè¯·æ±‚æ¥å£ä»£ç å—ï¼Œé‚£ä¹ˆå½“æ¥å£æ²¡æœ‰è¿”å›å†…å®¹ï¼Œåé¢åœ°ä»£ç å°±éœ€è¦ä¸€ç›´ç­‰å¾…ã€‚è¿™æ—¶æ•´ä¸ªçº¿ç¨‹æ˜¯å¡æ­»çš„ã€‚\n\nè¿™æ˜¾ç„¶ä¸è¡Œï¼Œ`JavaScript`å¼•å…¥äº†**åŒæ­¥ä»»åŠ¡**å’Œ**å¼‚æ­¥ä»»åŠ¡**çš„æ¦‚å¿µæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n\n### EventLoop\n\n![åŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡](../../images/JavaScript/åŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡.webp)\n\nåŒæ­¥ä»»åŠ¡å°±æ˜¯éœ€è¦ç«‹å³æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå®ƒæ²¡æ‰§è¡Œå®Œåé¢çš„éœ€è¦ç­‰å¾…\n\nå¼‚æ­¥ä»»åŠ¡å°±æ˜¯ä¸éœ€è¦ç«‹å³æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæ¯”å¦‚ajaxæ¥å£è¯·æ±‚ã€`setTimeout`ç­‰ã€‚å¦‚æœæ˜¯å¼‚æ­¥ä»»åŠ¡å°±ä¼šåœ¨`Event Table`ä¸­æ³¨å†Œï¼Œå½“æŒ‡å®šçš„äº‹ä»¶å®Œæˆä¹‹åï¼ˆä¾‹å¦‚æ¥å£è¿”å›å“åº”äº†ï¼‰ï¼Œå°±å°†å…¶å›è°ƒå‡½æ•°æ”¾åˆ°`Event Queue`ä¸­\n\nå½“ä¸»çº¿ç¨‹å†…çš„åŒæ­¥ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯•åï¼Œä¼šå»è¯»`Event Queue`ä¸­çš„å‡½æ•°ï¼Œæ”¾å…¥ä¸»çº¿ç¨‹æ‰§è¡Œã€‚\n\nä¸Šè¿°è¿‡ç¨‹ä¼šä¸€ç›´é‡å¤æ‰§è¡Œï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸º`Event Loop`ã€‚\n\n## å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡\n\nåŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡æ˜¯å¹¿ä¹‰ä¸Šçš„åˆ’åˆ†ã€‚è€Œå®ä»»åŠ¡(`macro task`)å’Œå¾®ä»»åŠ¡(`micro task`)æ˜¯æ›´ä¸ºç²¾ç»†çš„åˆ’åˆ†\n\n### åˆ’åˆ†\n\nå®ä»»åŠ¡ï¼š\n\n| #                       | æµè§ˆå™¨ | Node |\n| :---------------------- | :----: | :--: |\n| `main script`           |   âœ…    |  âœ…   |\n| `I/O`                   |   âœ…    |  âœ…   |\n| `setTimeout`            |   âœ…    |  âœ…   |\n| `setInterval`           |   âœ…    |  âœ…   |\n| `setImmediate`          |   âŒ    |  âœ…   |\n| `requestAnimationFrame` |   âœ…    |  âŒ   |\n\nå¾®ä»»åŠ¡ï¼š\n\n| #                            | æµè§ˆå™¨ | Node |\n| :--------------------------- | :----: | :--: |\n| `process.nextTick`           |   âŒ    |  âœ…   |\n| `MutationObserver`           |   âœ…    |  âŒ   |\n| `Promise.then catch finally` |   âœ…    |  âœ…   |\n\nå¾®ä»»åŠ¡æ˜¯å±äºå®ä»»åŠ¡çš„ï¼Œæ¢å¥è¯è¯´ï¼Œä¸€ä¸ªå®ä»»åŠ¡å¯ä»¥åŒ…å«å¤šä¸ªå¾®ä»»åŠ¡\n\n### æ‰§è¡Œæµç¨‹\n\nä»¥æµè§ˆå™¨ä¸ºä¾‹ï¼Œç”±ä¸¤ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œ**å®ä»»åŠ¡é˜Ÿåˆ—**å­˜æ”¾å®ä»»åŠ¡ï¼›**å¾®ä»»åŠ¡é˜Ÿåˆ—**å­˜æ”¾å¾®ä»»åŠ¡\n\n`main script`ä¹Ÿå°±æ˜¯`script`æ ‡ç­¾é‡Œçš„ä»£ç æ˜¯ç¬¬ä¸€ä¸ªå®ä»»åŠ¡ã€‚å­˜æ”¾è‡³å®ä»»åŠ¡é˜Ÿåˆ—\n\nå½“ç¬¬ä¸€æ¬¡Event Loopæ—¶ï¼Œæ£€æŸ¥ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œé¦–å…ˆæ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¾®ä»»åŠ¡çš„ä¼˜å…ˆçº§æ¯”å®ä»»åŠ¡é«˜ï¼‰å‘ç°æ²¡æœ‰ä»»åŠ¡ï¼›å†å»æ£€æŸ¥å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç°æœ‰ä»»åŠ¡`main script`å–å‡ºæ‰§è¡Œã€‚\n\n`main script`é‡Œæœ‰å¯èƒ½åˆæœ‰å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ï¼Œå†åˆ†åˆ«æ”¾å…¥ç›¸åº”é˜Ÿåˆ—ã€‚\n\n### å‡ ä¸ªAPI\n\n#### setImmediate\n\nè¿™ä¸ªAPIæ˜¯`nodejs`ç‹¬æœ‰çš„ï¼Œè¡¨ç¤ºåœ¨ä¸€æ¬¡`Event Loop`æ‰§è¡Œå®Œæ¯•åè°ƒç”¨\n\n#### process.nextTick\n\nè¿™ä¸ªAPIä¹Ÿæ˜¯`nodejs`ç‹¬æœ‰çš„ï¼Œä»–ä¼šå°†æ³¨å†Œçš„å›è°ƒå‡½æ•°æ’å…¥å½“å‰å¾®ä»»åŠ¡é˜Ÿåˆ—çš„é˜Ÿé¦–ã€‚\n\n```javascript\nprocess.nextTick(() => console.log(1));\nPromise.resolve().then(() => console.log(2));\nprocess.nextTick(() => console.log(3));\nPromise.resolve().then(() => console.log(4));\nconsole.log(5);\n\n// output: 5 1 3 2 4\n```\n\n#### Promise\n\n`promise`æ˜¯`es2015`æ–°å¢çš„APIã€‚æä¾›äº†å¼ºå¤§çš„å¼‚æ­¥ç‰¹æ€§ã€‚\n\n`promise`çš„`executor`æ˜¯ä¸€ä¸ªåŒæ­¥å‡½æ•°ä¼šç«‹å³æ‰§è¡Œï¼Œ`then`ä¸­çš„å›è°ƒä¼šè¢«æ³¨å†Œä¸ºå¾®ä»»åŠ¡\n\n```javascript\nnew Promise((resolve, reject) => {\n    console.log(1);\n    resolve();\n}).then(() => {\n    console.log(3)\n})\nconsole.log(2)\n\n// output: 1 2 3\n```\n\n#### async/await\n\n`async/await`ä»…ä»…å½±å“çš„æ˜¯å‡½æ•°å†…çš„æ‰§è¡Œï¼Œè€Œä¸ä¼šå½±å“åˆ°å‡½æ•°ä½“å¤–çš„æ‰§è¡Œé¡ºåºã€‚\n\n```javascript\nasync function async1() {\n    console.log(\"async1 start\");\n    await  async2();\n    console.log(\"async1 end\");\n}\n\nasync  function async2() {\n    console.log('async2');\n}\n\nconsole.log(\"script start\");\n\nsetTimeout(function () {\n    console.log(\"settimeout\");\n},0);\n\nasync1();\n\n// output: \n// script start\n// async1 start\n// async2\n// async1 end\n// settimeout\n```\n\n`await async2()`ç›¸å½“äºæ‰§è¡Œä¸€ä¸ª`Promise`ï¼Œ`console.log('async2');`å±äº`executor`ï¼›`awaait`åé¢çš„å†…å®¹ç›¸å½“äº`then`ï¼Œä¼šè¢«æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚\n\n## ç»¼åˆè¯•é¢˜\n\nåœ¨ç½‘ä¸Šæ‰¾åˆ°è¿™ä¹ˆä¸€é“ç»¼åˆé¢˜ï¼š\n\n```javascript\nasync function async1() {\n    console.log(\"async1 start\");\n    await  async2();\n    console.log(\"async1 end\"); // async1 end\n}\nasync  function async2() {\n    console.log('async2');\n}\nconsole.log(\"script start\");\n\nsetTimeout(function () { // setTimeout1\n    console.log(\"settimeout\");\n});\nasync1()\nnew Promise(function (resolve) {\n    console.log(\"promise1\");\n    resolve();\n}).then(function () {  // promise then\n    console.log(\"promise2\");\n});\nsetImmediate(()=>{ // setImmediate\n    console.log(\"setImmediate\")\n})\nprocess.nextTick(()=>{ // nextTick\n    console.log(\"process\")\n})\nconsole.log('script end'); \n```\n\nåˆ†æï¼š\n\n1. è¾“å‡º`script start`ï¼ŒsetTimeout1æ”¾å…¥å®ä»»åŠ¡é˜Ÿåˆ—\n   1. å®ä»»åŠ¡é˜Ÿåˆ—ï¼š[setTimeout1]\n   2. å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼š[]\n2. æ‰§è¡Œasync1ï¼Œè¾“å‡º`async1 start`ï¼Œæ‰§è¡Œasync2ï¼Œè¾“å‡º`async2`;å°†`async1 end`æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—\n   1. å®ä»»åŠ¡é˜Ÿåˆ—ï¼š[setTimeout1]\n   2. å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼š[async1 end]\n3. æ‰§è¡ŒPromiseçš„`executor`ï¼Œè¾“å‡º`promise1`ï¼›å°†`promise then`æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—\n   1. å®ä»»åŠ¡é˜Ÿåˆ—ï¼š[setTimeout1]\n   2. å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼š[async1 end, promise then]\n4. é‡åˆ°setImmediateï¼Œå°†`setImmediate`æ”¾å…¥å®ä»»åŠ¡é˜Ÿåˆ—\n   1. å®ä»»åŠ¡é˜Ÿåˆ—ï¼š[setTimeout1ï¼Œ setImmediate]\n   2. å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼š[async1 end, promise then]\n5. é‡åˆ°process.nextTickï¼Œå°†`nextTick`æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—é˜Ÿé¦–\n   1. å®ä»»åŠ¡é˜Ÿåˆ—ï¼š[setImmediate, setTimeout1]\n   2. å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼š[nextTick ,async1 end, promise then]\n6. è¾“å‡º`script end`\n7. å…ˆä¾æ¬¡å–å‡ºå¾®ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡æ‰§è¡Œï¼Œè¾“å‡ºï¼š`process`ã€`async1 end`ã€`promise2`\n8. ç„¶åä¾æ¬¡å–å‡ºæ‰€æœ‰å®ä»»åŠ¡æ‰§è¡Œï¼Œè¾“å‡ºï¼š`settimeout`ã€`setImmediate`\n\n## å¼‚æ­¥æ˜¯æ€ä¹ˆå®ç°çš„\n\næ ¹æ®ä¸Šæ–‡å¯ä»¥äº†è§£åˆ°ã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œé€šè¿‡çº¿ç¨‹åˆ‡æ¢æ¥å®ç°å¼‚æ­¥ã€‚\n\n`nodejs`ä¹Ÿæ˜¯ç±»ä¼¼ã€‚å®ƒä¾èµ–äº`libuv`æ¨¡å—ã€‚`libuv`é€šè¿‡çº¿ç¨‹æ± æ¥å®ç°å¼‚æ­¥æ“ä½œ\n\n","tags":["javascript","nodejs","browser"],"categories":["JavaScript"]},{"title":"Webpack-é—®é¢˜æ¢³ç†","url":"/posts/378e5729.html","content":"\n## Webpackä¸å…¶å®ƒæ„å»ºå·¥å…·æœ‰ä½•ä¸åŒï¼Ÿ\n\n### ä¸Gulpå’ŒGrunt\n\n1. `Gulp`å’Œ`Grunt`æ‰“åŒ…çš„æ€è·¯æ˜¯ï¼š **éå†æºæ–‡ä»¶**â†’**åŒ¹é…è§„åˆ™**â†’**æ‰“åŒ…** ï¼ˆæ‰“åŒ…çš„æ–‡ä»¶æŒ‡å®šçš„ï¼‰ï¼Œ`webpack`æ˜¯æŒ‰ç…§æ¨¡å—çš„**ä¾èµ–å…³ç³»**è¿›è¡Œæ‰“åŒ…\n2. webpackè§£å†³äº†æ¨¡å—åŒ–çš„é—®é¢˜ï¼Œè€Œ`Gulp`å’Œ`Grunt`æ²¡æœ‰  \n\n### ä¸rollup\n\n1. rollupæœ€å…ˆæå‡º`tree shaking`ï¼Œwebpackä¹Ÿå·²ç»æ”¯æŒ\n2. rollupä¸æ”¯æŒ`code split`å’Œ`dynamic import`\n3. ç»éªŒæ³•åˆ™ï¼šåº“ä½¿ç”¨`rollup`æ„å»ºï¼Œåº”ç”¨ä½¿ç”¨`webpack`æ„å»º\n\n## Webpack çš„æœ‰å‡ ç§ä½¿ç”¨æ–¹æ³•ï¼Ÿ\n\n### é€šè¿‡`webpack-cli`å’Œ`npm script`ï¼Œ\n\n```json\n{\n    \"script\": {\n        \"dev\": \"webpack --mode development ./src/es/index.js --module-bind js=babel-loader\",\n        \"build\": \"webpack --mode production ./src/es/index.js --module-bind js=babel-loader\" \n    }\n}\n```\n\n### ç¼–ç¨‹å¼è°ƒç”¨\n\n```javascript\nconst { webpack } = require('webpack')\n\nconst config = getWebpackConfig() // ç”Ÿæˆé…ç½®æ–‡ä»¶\nconst compiler = webpack(config)\ncompiler.run()\n```\n\n## Webpacké…ç½®æ–‡ä»¶æœ‰å‡ ç§å†™æ³•\n\nwebpackä¸ä»…æ”¯æŒ`javascript`è¿˜æ”¯æŒ`Typescript`ã€`CoffeeScript`\n\n### å‡½æ•°\n\n```javascript\nmodule.exports = (env, argv) => {\n    return { // å¿…é¡»è¿”å›ä¸€ä¸ªå¯¹è±¡\n        entry: {\n            main: './src/index.js'\n        },\n        mode: env.production ? 'production' : 'development',\n        plugins: []\n    }\n}\n```\n\n`env`å’Œ`argv`ä¸¤ä¸ªå‚æ•°å¯¹åº”è¿™`webpack-cli`é€‰é¡¹\n\n> é€‚ç”¨åœºæ™¯ï¼š éœ€è¦é€šè¿‡ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥åŒºåˆ†ç”Ÿäº§ç¯å¢ƒï¼ˆproductionï¼‰å’Œå¼€å‘ç¯å¢ƒï¼ˆdevelopmentï¼‰ï¼Œ\n\n### Promise\n\n```javascript\nmodule.exports = () => {\n    return new Primise((resolve, reject) => {\n        // å¤„ç†æ“ä½œ\n        setTimeout(() => {\n            resolve({\n                entry: './src/index.js',\n            })\n        })\n    })\n}\n```\n\n> é€‚ç”¨åœºæ™¯ï¼šéœ€è¦å¼‚æ­¥åŠ è½½ä¸€äº› Webpack é…ç½®éœ€è¦åšçš„å˜é‡\n\n### æ•°ç»„\n\n```javascript\nmodule.exports = [{\n\toutput: {\n      filename: './dist-amd.js',\n      libraryTarget: 'amd'\n    },\n    entry: './app.js',\n    mode: 'production',\n  }, {\n    output: {\n      filename: './dist-commonjs.js',\n      libraryTarget: 'commonjs'\n    },\n    entry: './app.js',\n    mode: 'production',\n  }]\n```\n\næ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä¸ºä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œæ‰€æœ‰çš„é…ç½®å¯¹è±¡éƒ½ä¼šæ„å»ºã€‚\n\n> é€‚ç”¨åœºæ™¯ï¼šæ‰“åŒ…åº“ï¼Œæ—¢æƒ³æ‰“åŒ…æˆ`AMD` åˆæƒ³ æ‰“åŒ…æˆ `CommonJS`\n\n### å•ä¸ªé…ç½®å¯¹è±¡\n\næœ€å¸¸ç”¨\n\n## å¦‚ä½•æŒ‡å®šåº“æ‰“åŒ…å‡ºæ¥çš„è§„èŒƒï¼Ÿ\n\n`output.library`å¯ä»¥æŒ‡å®šåº“æ‰“åŒ…å‡ºæ¥çš„åç§°ï¼Œæ”¯æŒå ä½ç¬¦å¦‚`[name]`\n\n`output.libraryTarget`å¯ä»¥æŒ‡å®šåº“æ‰“åŒ…å‡ºæ¥çš„è§„èŒƒï¼Œå–å€¼èŒƒå›´ä¸ºï¼š`var`ã€`assign`ã€`this`ã€`window`ã€`global`ã€`commonjs`ã€`commonjs2`ã€`commonjs-module`ã€`amd`ã€`umd`ã€`umd2`ã€`jsonp`ï¼Œé»˜è®¤æ˜¯`var`\n\n### Webpackèƒ½å¤Ÿæ„å»ºå‡ºå“ªäº›ç¨‹åºï¼Ÿ\n\n`target`ï¼šå¯ä»¥æŒ‡å®šæ„å»ºç›®æ ‡ï¼Œå–å€¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š\n\n1. `web`ï¼š é»˜è®¤ï¼Œç¼–è¯‘ä¸ºç±»æµè§ˆå™¨ç¯å¢ƒé‡Œå¯ç”¨ï¼›\n2. `node`ï¼šç¼–è¯‘ä¸ºç±» Node.js ç¯å¢ƒå¯ç”¨ï¼ˆä½¿ç”¨ Node.js require åŠ è½½ chunkï¼‰ï¼›\n3. ` async-node`ï¼šç¼–è¯‘ä¸ºç±» Node.js ç¯å¢ƒå¯ç”¨ï¼ˆä½¿ç”¨ fs å’Œ vm å¼‚æ­¥åŠ è½½åˆ†å—ï¼‰ï¼› \n4. `electron-main`ï¼šç¼–è¯‘ä¸º Electron ä¸»è¿›ç¨‹ï¼› \n5. `electron-renderer`ï¼šç¼–è¯‘ä¸º Electron æ¸²æŸ“è¿›ç¨‹ï¼› \n6. `node-webkit`ï¼šç¼–è¯‘ä¸º `Webkit `å¯ç”¨ï¼Œå¹¶ä¸”ä½¿ç”¨ jsonp å»åŠ è½½åˆ†å—ã€‚æ”¯æŒ Node.js å†…ç½®æ¨¡å—å’Œ nw.gui å¯¼å…¥ï¼ˆå®éªŒ\n   ç‰¹æ€§ï¼‰ï¼›\n7.  `webworker`ï¼šç¼–è¯‘æˆä¸€ä¸ª `WebWorker`ã€‚\n\n##  Webpackæœ‰å‡ ç§hashï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n1. `[hash]`ï¼šæ˜¯æ•´ä¸ªé¡¹ç›® æ•´ä¸ªé¡¹ç›®çš„ hash å€¼ï¼Œå…¶æ ¹æ®æ¯æ¬¡ç¼–è¯‘å†…å®¹è®¡ç®—å¾—åˆ°ï¼Œæ¯æ¬¡ç¼–è¯‘ä¹‹åéƒ½ä¼šç”Ÿæˆæ–°çš„ hashï¼Œå³ä¿®æ”¹ä»» ä½•æ–‡ä»¶éƒ½ä¼šå¯¼è‡´æ‰€æœ‰æ–‡ä»¶çš„ hash å‘ç”Ÿæ”¹å˜ï¼›åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­è™½ç„¶å…¥å£ä¸åŒï¼Œä½†æ˜¯ hash æ˜¯ç›¸åŒçš„ï¼›hash æ— æ³•å®ç° å‰ç«¯é™æ€èµ„æºåœ¨æµè§ˆå™¨ä¸Šé•¿ç¼“å­˜ï¼Œè¿™æ—¶å€™åº”è¯¥ä½¿ç”¨ `chunkhash`ï¼›\n2. ` [chunkhash]`ï¼šæ ¹æ®ä¸åŒçš„å…¥å£æ–‡ä»¶ï¼ˆentryï¼‰è¿›è¡Œä¾èµ–æ–‡ä»¶è§£æï¼Œæ„å»ºå¯¹åº”çš„ chunkï¼Œç”Ÿæˆç›¸åº”çš„ hashï¼›åªè¦ç»„æˆ entry çš„æ¨¡å—æ–‡ä»¶æ²¡æœ‰å˜åŒ–ï¼Œåˆ™å¯¹åº”çš„ hash ä¹Ÿæ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬é¡¹ç›®ä¼˜åŒ–æ—¶ï¼Œä¼šå°†å…¬å…±åº“ä»£ç æ‹†åˆ†åˆ°ä¸€ èµ·ï¼Œå› ä¸ºå…¬å…±åº“ä»£ç å˜åŠ¨è¾ƒå°‘çš„ï¼Œä½¿ç”¨ chunkhash å¯ä»¥å‘æŒ¥æœ€é•¿ç¼“å­˜çš„ä½œç”¨ï¼› \n3. `[contenthash]`ï¼šä½¿ç”¨ `chunkhash `å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå½“åœ¨ä¸€ä¸ª JS æ–‡ä»¶ä¸­å¼•å…¥äº† CSS æ–‡ä»¶ï¼Œç¼–è¯‘åå®ƒä»¬çš„ hash æ˜¯ ç›¸åŒçš„ã€‚è€Œä¸”ï¼Œåªè¦ JS æ–‡ä»¶å†…å®¹å‘ç”Ÿæ”¹å˜ï¼Œä¸å…¶å…³è”çš„ CSS æ–‡ä»¶ hash ä¹Ÿä¼šæ”¹å˜ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¯ä»¥æŠŠ CSS ä» JS ä¸­ä½¿ç”¨`mini-css-extract-plugin` æˆ– `extract-text-webpack-plugin`æŠ½ç¦»å‡ºæ¥å¹¶ä½¿ç”¨ `contenthash`ã€‚\n\n## Webpackæ”¯æŒå‡ ç§SourceMapï¼Ÿ\n\n`devtool`ï¼šç”¨æ¥é…ç½®`sourceMap`ï¼Œå–å€¼å¦‚ä¸‹\n\n| devtool                        | æ„å»ºé€Ÿåº¦ | é‡æ–°æ„å»ºé€Ÿåº¦ | ç”Ÿäº§ç¯å¢ƒ | å“è´¨(quality)          |\n| :----------------------------- | :------- | :----------- | :------- | :--------------------- |\n| ç•™ç©ºï¼Œnone                     | +++      | +++          | yes      | æ‰“åŒ…åçš„ä»£ç            |\n| eval                           | +++      | +++          | no       | ç”Ÿæˆåçš„ä»£ç            |\n| cheap-eval-source-map          | +        | ++           | no       | è½¬æ¢è¿‡çš„ä»£ç ï¼ˆä»…é™è¡Œï¼‰ |\n| cheap-module-eval-source-map   | o        | ++           | no       | åŸå§‹æºä»£ç ï¼ˆä»…é™è¡Œï¼‰   |\n| eval-source-map                | â€“        | +            | no       | åŸå§‹æºä»£ç              |\n| cheap-source-map               | +        | o            | no       | è½¬æ¢è¿‡çš„ä»£ç ï¼ˆä»…é™è¡Œï¼‰ |\n| cheap-module-source-map        | o        | -            | no       | åŸå§‹æºä»£ç ï¼ˆä»…é™è¡Œï¼‰   |\n| inline-cheap-source-map        | +        | o            | no       | è½¬æ¢è¿‡çš„ä»£ç ï¼ˆä»…é™è¡Œï¼‰ |\n| inline-cheap-module-source-map | o        | -            | no       | åŸå§‹æºä»£ç ï¼ˆä»…é™è¡Œï¼‰   |\n| source-map                     | â€“        | â€“            | yes      | åŸå§‹æºä»£ç              |\n| inline-source-map              | â€“        | â€“            | no       | åŸå§‹æºä»£ç              |\n| hidden-source-map              | â€“        | â€“            | yes      | åŸå§‹æºä»£ç              |\n| nosources-source-map           | â€“        | â€“            | yes      | æ— æºä»£ç å†…å®¹           |\n\n> ä¸€èˆ¬åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæ¨èç”Ÿäº§ç¯å¢ƒä¸ä½¿ç”¨æˆ–è€…ä½¿ç”¨`source-map` ï¼ˆå¦‚æœæœ‰ Sentry è¿™ç±»é”™è¯¯è·Ÿè¸ªç³»è¿™ç±»é”™è¯¯è·Ÿè¸ªç³»ç»Ÿï¼‰ï¼Œå¼€å‘ç¯å¢ƒä½¿ç”¨ `cheap-module-eval-source-map`\n\n## è§£é‡Šä¸€ä¸‹`bundle`ã€`chunk`å’Œ`module`\n\n`module`: å¼€å‘ä¸­æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½å¯ä»¥çœ‹åš moduleï¼Œæ¨¡å—ä¸å±€é™äº jsï¼Œä¹ŸåŒ…å« cssã€å›¾ç‰‡ç­‰ \n\n`chunk`: ä»£ç å—ï¼Œä¸€ä¸ª chunk å¯ä»¥ç”±å¤šä¸ªæ¨¡å—ç»„æˆ\n\n`bundle`: æœ€ç»ˆæ‰“åŒ…å®Œæˆçš„æ–‡ä»¶ï¼Œä¸€èˆ¬å°±æ˜¯å’Œ chunk ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œbundle å°±æ˜¯å¯¹ chunk è¿›è¡Œå‹ç¼©æ‰“åŒ…ç­‰å¤„ç†åçš„äº§å‡º \n\n##  Webpackä¸­loaderå¦‚ä½•ä½¿ç”¨ï¼Ÿä»¥åŠloaderçš„æ‰§è¡Œé¡ºåº\n\n### å¦‚ä½•ä½¿ç”¨\n\n1. åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®\n2. å†…è”é…ç½®æ–¹å¼`const html = require('html-loader!./loader.html');` æˆ–è€…`import html from 'html-loader!./loader.html';`\n\n### æ‰§è¡Œé¡ºåº\n\nä»å³åˆ°å·¦ï¼Œä»ä¸‹åˆ°ä¸Š\n\n## Webpackå¦‚ä½•å®ç°æŒ‰éœ€åŠ è½½ï¼Ÿä»€ä¹ˆæ˜¯é­”æ³•æ³¨é‡Šï¼Ÿ\n\nwebpackä¸­é€šè¿‡`import`å‡½æ•°å®ç°æŒ‰éœ€åŠ è½½ï¼Œä¹Ÿè¢«ç§°ä¸ºåŠ¨æ€å¯¼å…¥(`dynamic import`)ï¼Œ\n\n1. è¯¥å‡½æ•°è¿”å›`Promise`\n2. å¯¼å…¥çš„æ–‡ä»¶è¢«æ‰“åŒ…åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œå…·ä½“å¾—çœ‹`splitChunk`é…ç½®\n\né­”æ³•æ³¨é‡Šï¼š\n\n`webpackInclude`ï¼šå¦‚æœæ˜¯ import çš„ä¸€ä¸ªç›®å½•ï¼Œåˆ™å¯ä»¥æŒ‡å®šéœ€è¦å¼•å…¥çš„æ–‡ä»¶ç‰¹æ€§ï¼Œä¾‹å¦‚åªåŠ è½½ json æ–‡ä»¶ï¼š`/\\.json$/`\n\n`webpackExclude`ï¼šå¦‚æœæ˜¯ import çš„ä¸€ä¸ªç›®å½•ï¼Œåˆ™å¯ä»¥æŒ‡å®šéœ€è¦è¿‡æ»¤çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ `/\\.noimport\\.json$/`ï¼› \n\n`webpackChunkName`ï¼šè¿™æ˜¯ chunk æ–‡ä»¶çš„åç§°ï¼Œä¾‹å¦‚ lazy-nameï¼› \n\n`webpackPrefetch`: æ˜¯å¦é¢„å–æ¨¡å—ï¼ŒåŠå…¶ä¼˜å…ˆçº§ï¼Œå¯é€‰å€¼trueã€æˆ–è€…æ•´æ•°ä¼˜å…ˆçº§åˆ«ï¼Œ0 ç›¸å½“äº trueï¼Œwebpack 4.6+æ”¯æŒï¼›\n\n` webpackPreload` æ˜¯å¦é¢„åŠ è½½æ¨¡å—ï¼ŒåŠå…¶ä¼˜å…ˆçº§ï¼Œå¯é€‰å€¼trueã€æˆ–è€…æ•´æ•°ä¼˜å…ˆçº§åˆ«ï¼Œ0 ç›¸å½“äº trueï¼Œwebpack 4.6+æ”¯æŒï¼› \n\n`webpackMode`: å¯é€‰å€¼lazy/lazy-once/eager/weakã€‚\n\n```javascript\nimport(/* webpackChunkName: \"image\", webpackInclude: /\\.(png|jpg|gif)/ */ './assets/img'); \n```\n\n## Babelçš„æœ€ä½³å®è·µ\n\n`@babel/preset-env`æ­é…`useBuiltIns: \"usage\"`å®ç°çœŸæ­£çš„æŒ‰éœ€åŠ è½½ã€‚éœ€è¦è½¬æ¢çš„åœ°æ–¹ä¼šè‡ªåŠ¨è½¬æ¢\n\n```javascript\n// babel.config.js\nmodule.exports = function(api) {\n  api.cache(true)\n\n  const presets = [\n    [\n      '@babel/preset-env',\n      {\n        modules: false,\n        corejs: 3, // æŒ‡å®šcorejs çš„ç‰ˆæœ¬\n        useBuiltIns: 'usage',\n      },\n    ],\n  ]\n  const plugins = []\n\n  return {\n    presets,\n    plugins,\n  }\n}\n```\n\n> `moudles`æŒ‡å®šå°†`ES module `è½¬æ¢æˆå…¶å®ƒæ¨¡å—è§„èŒƒï¼Œå¯èƒ½å–å€¼æœ‰ `\"amd\" | \"umd\" | \"systemjs\" | \"commonjs\" | \"cjs\" | \"auto\" | false`ï¼›falseè¡¨ç¤ºä¸å»è½¬æ¢\n>\n> å¼ºçƒˆå»ºè®®`false`ï¼Œå¦åˆ™ä¼šå½±å“`Webpack`è¿›è¡Œä¼˜åŒ–ï¼ˆ`Tree Shaking`å¿…é¡»åŸºäº`ES moudle`ï¼‰\n\n## BabelåŸç†\n\nBabelçš„è¯­æ³•è½¬æ¢è¿‡ç¨‹ä¸»è¦ç»å†ä¸‰ä¸ªæ­¥éª¤ï¼š\n\n1. è§£æï¼ˆParseï¼‰ï¼šå¯¹JavaScrptä»£ç è§£æ**è¯æ³•è¯­æ³•åˆ†æ**ï¼Œæœ€ç»ˆç”Ÿæˆä¸€ä¸ª`AST`ã€‚ç”¨çš„æ˜¯`@babel/parser`\n2. è½¬æ¢ï¼ˆTransformï¼‰ï¼šå¯¹`AST`è¿›è¡Œéå†ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­å¯ä»¥è¿›è¡Œæ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹ç­‰æ“ä½œã€‚ç”¨çš„æ˜¯`@babel/traverse`\n3. ç”Ÿæˆï¼ˆGenerateï¼‰ï¼šè½¬æ¢åå¾—åˆ°ä¸€æ£µæ–°æ ‘ï¼Œç„¶åå°†æ ‘è½¬æ¢æˆä»£ç ï¼Œç”¨çš„æ˜¯`@babel/generator`\n\n![Babelå¤„ç†è¿‡ç¨‹](../../images/Babelå¤„ç†è¿‡ç¨‹.png)\n\n## å¦‚ä½•ç¼–å†™ä¸€ä¸ªBabelæ’ä»¶\n\nBabelåœ¨è½¬æ¢é˜¶æ®µä¼šéå†`AST`ï¼Œé‚£ä¹ˆBabelæ’ä»¶å°±æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ç¼–å†™`visitor`\n\n```javascript\n// babel plugin demo\nexport default function({ types: t }) {\n    return {\n      visitor: {\n          Identifier(path, state) {},\n          FunctionDeclaration(path, state) {},\n          BinaryExpression(path, state) {},\n      }\n    };\n};\n```\n\n `type` å­—æ®µè¡¨ç¤ºéå†æ—¶æ¯ä¸ªèŠ‚ç‚¹çš„ç±»å‹ï¼ˆå¦‚ï¼š `\"FunctionDeclaration\"`ï¼Œ`\"Identifier\"`ï¼Œæˆ– `\"BinaryExpression\"`ï¼‰\n\néå†è¿‡ç¨‹ä¸­æ¯å½“åœ¨æ ‘ä¸­é‡è§ä¸€ä¸ª `Identifier` çš„æ—¶å€™ä¼šè°ƒç”¨ `Identifier()` æ–¹æ³•ã€‚\n\n`Identifier(path, state) {}`ä»£è¡¨è¿›å…¥èŠ‚ç‚¹æ—¶è§¦å‘\n\n```javascript\nexport default function({ types: t }) {\n\treturn {\n      visitor: {\n          Identifier: {\n              enter(path, state) {},\n              exit(path, state) {}, // é€€å‡ºæ—¶è§¦å‘\n          },\n      }\n    };\n};\n```\n\n> å…³äºBabelæ’ä»¶è¯¦ç»†å†™æ³•ï¼Œè¯·æŸ¥é˜…[æ–‡æ¡£](https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md)\n>\n> ç¼–å†™Babelæ’ä»¶éœ€è¦ç†Ÿæ‚‰`AST`ç»“æ„ï¼Œå¯ä»¥å€ŸåŠ©[AST Exploer](https://astexplorer.net/)æ¥å­¦ä¹ AST\n\n## Babelå¦‚ä½•é’ˆå¯¹ä¸åŒæµè§ˆå™¨åšé€‚é…\n\n`Browserslist`ç”¨æ¥æŒ‡å®šé€‚é…çš„æµè§ˆå™¨çš„å·¥å…·ï¼Œ`Babel`å’Œ`Postcss`ç­‰å·¥å…·éƒ½ä¼šä½¿ç”¨`Browserlist`ã€‚\n\nåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º`.browserslistrc`æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹\n\n```text\nlast 2 version\n> 1%\nnot ie <= 11\nnot dead\n```\n\nå¯ä»¥åœ¨[browserl.ist](https://browserl.ist/)ä¸Šæ£€æŸ¥æ‰€æ”¯æŒçš„æµè§ˆå™¨åˆ—è¡¨\n\n![Browserslist](../../images/Browserslist.png)\n\n## Webpackä¸­å¦‚ä½•å¢å¼ºCSSåŠŸèƒ½\n\n### CSS Module\n\n`css`éƒ½æ˜¯å…¨å±€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæ–‡ä»¶çš„æ ·å¼å¯èƒ½è¢«å¦ä¸€ä¸ªæ–‡ä»¶çš„`css`æ ·å¼æ±¡æŸ“ã€‚ä»¥å‰å¸¸ç”¨è§£å†³æ–¹æ³•å°±æ˜¯é‡‡ç”¨`BEM`è§„èŒƒï¼Œä½†æ˜¯è§„èŒƒæ€»ä¼šæœ‰äººä¸éµå®ˆã€‚`css module`èƒ½å¾ˆå¥½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n\n`css module`é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç»™è®©`css`æ¨¡å—åŒ–ã€‚ä¸»è¦è§£å†³é—®é¢˜æœ‰ï¼š\n\n1. è§£å†³ CSS ç±»éƒ½æ˜¯å…¨å±€çš„ï¼Œå®¹æ˜“é€ æˆå…¨å±€æ±¡æŸ“ï¼ˆæ ·å¼å†²çªï¼‰\n2. JS å’Œ CSS å…±äº«ç±»åï¼Œå³JS å¯ä»¥ç›´æ¥ä½¿ç”¨ CSS çš„ç±»åä½œä¸ºå¯¹è±¡å€¼\n3. å¯ä»¥æ–¹ä¾¿çš„ç¼–å†™å‡ºæ›´åŠ å¥å£®å’Œæ‰©å±•æ–¹ä¾¿çš„ CSSã€‚\n\n```jsx\n// react\nimport style from './style.css'\n\nexport function Home() {\n    return <div style={style.box}>Hello</div>\n}\n```\n\n```vue\n<!-- vue -->\n<template>\n  <p :class=\"$style.red\">\n    This should be red\n  </p>\n</template>\n\n<style module>\n.red {\n  color: red;\n}\n.bold {\n  font-weight: bold;\n}\n</style>\n```\n\nå¼€å¯æ–¹æ³•ï¼š`css-loader` å¢åŠ  `modules: true` çš„é€‰é¡¹\n\n```javascript\nmodule.exports = {\n    //...\n    module: {\n        rules: [\n            {\n                test: /\\.css$/,\n                use: [\n                    {\n                        loader: 'css-loader',\n                        options: {\n                            modules: true\n                        }\n                    }\n                ]\n            }\n        ]\n    }\n}\n```\n\n### CSSé¢„å¤„ç†å™¨\n\n`cssé¢„å¤„ç†å™¨`å°±æ˜¯åœ¨cssæœ¬èº«çš„åŸºç¡€ä¸Šï¼Œå¢å¼ºäº†è¯­æ³•ã€‚å¢åŠ äº†å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­ã€è¿ç®—ã€å‡½æ•°ä»¥åŠä½œç”¨åŸŸç­‰\n\nå¸¸è§çš„`cssé¢„å¤„ç†å™¨`æœ‰ï¼š`sass(scss)`ã€`less`ã€`stylus`\n\n### PostCSS\n\n`Postcss`æ˜¯ä¸€ä¸ªç±»ä¼¼`Babel`çš„å·¥å…·ï¼Œåªä¸è¿‡`Postcss`å¤„ç†çš„æ˜¯cssæ–‡ä»¶ã€‚\n\n`Postcss` æ ¸å¿ƒæ˜¯å°† CSS è§£ææˆ ASTï¼Œç„¶ åé€šè¿‡å„ç§æ’ä»¶åšå„ç§è½¬æ¢ï¼Œæœ€ç»ˆç”Ÿæˆå¤„ç†åçš„æ–° CSSï¼Œè·Ÿ Babel åœ¨åŠŸèƒ½å’Œå®ç°ä¸Šéƒ½ç±»ä¼¼ã€‚\n\nåœ¨`Webpack`ä¸­ä½¿ç”¨éœ€è¦å®‰è£…`postcss-loader`\n\né…ç½®æ–¹æ³•ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»ºä¸€ä¸ª`postcss.config.js`æ–‡ä»¶ï¼Œå†™å…¥é…ç½®å†…å®¹ï¼Œå¦‚ä¸‹\n\n```javascript\nconst postcssPresetEnv = require('postcss-preset-env')\nconst postcssImport = require('postcss-import')\n\nmodule.exports = {\n  plugins: [\n      postcssPresetEnv({ autoprefixer: { grid: true }}),\n      postcssImport()\n  ],\n}\n\n```\n\n`postcss`å’Œ`babel`ä¸€æ ·éƒ½æœ‰è‡ªå·±çš„æ’ä»¶ç³»ç»Ÿã€‚\n\n1. `postcss-preset-env`æ˜¯`postcss`å¸¸ç”¨çš„æ’ä»¶é›†åˆï¼Œå…·ä½“ç‰¹æ€§è¯·æŸ¥é˜…[æ–‡æ¡£](https://preset-env.cssdb.org/)\n2. `postcss-import`æ˜¯è®©`postcss`è§„åˆ™ä½œç”¨çš„`@import`çš„CSSæ–‡ä»¶ã€‚\n\n2. å¸¸ç”¨çš„è¿˜æœ‰ä¸€ä¸ª[postcss-px-to-viewport](https://github.com/evrone/postcss-px-to-viewport)æ’ä»¶ï¼Œç”¨æ¥å°†`px`è½¬æˆ`vw`ï¼Œåœ¨ç§»åŠ¨ç«¯ä¸Šæ¯”è¾ƒå¸¸ç”¨ã€‚\n\n## Webpackå¦‚ä½•æ‰“åŒ…å¤šé¡µé¢ï¼Ÿ\n\n`Wepack`å®ç°å¤šé¡µé¢æ‰“åŒ…éœ€è¦é€šè¿‡`html-webpack-plugin`æ¥å®ç°\n\n```javascript\nconst HtmlWebpackPlugin = require('html-webpack-plugin')\n\nmodule.exports = {\n    entry: {\n        index: './src/main.js',\n        post: './src/post.js'\n    },\n    plugins: [\n        new HtmlWebpackPlugin({\n            template: './public/index.html',\n            filename: 'index.html',\n            chunks: ['index']\n        }),\n        new HtmlWebpackPlugin({\n            template: './public/post.html',\n                filename: 'post.html',\n            chunks: ['post']\n        }),\n    ]\n}\n```\n\næ³¨æ„:\n\n1. éœ€è¦æ‰“åŒ…å‡ ä¸ªé¡µé¢å°±å¢åŠ å‡ ä¸ª`HtmlWebpackPluginå®ä¾‹`\n2. `chunks`æŒ‡å®šå½“å‰é¡µé¢åŒ…å«é‚£äº›chunk\n3. è¿˜å¯ä»¥ä½¿ç”¨`excludeChunks`æ¥æ’é™¤ä¸éœ€è¦çš„`chunk`\n4. ä½¿ç”¨`webpack-dev-server`æ—¶ï¼Œé€šè¿‡http://ip:port/indexè®¿é—®`index`é¡µé¢ï¼›é€šè¿‡http://ip:port/index/postè®¿é—®`post`é¡µé¢\n\n## è§£é‡Šä¸€ä¸‹`webpack-dev-server`çš„åŸç†\n\n- `webpack-dev-server`æ˜¯ä¸€ä¸ªåŸºäº`express`çš„æœ¬åœ°æœåŠ¡å™¨ã€‚\n\n- å®ƒé€šè¿‡`webpack-dev-middleware`ä¸­é—´ä»¶æ¥ä¸º`webpack`æ‰“åŒ…ç”Ÿæˆçš„èµ„æºæ–‡ä»¶æä¾›webæœåŠ¡ã€‚\n\n- åŒæ—¶è¿˜å°†å¼€å¯ä¸€ä¸ª`websocket`è¿æ¥æ¥å®ç°çƒ­æ›´æ–°ã€‚\n\n## `webpack-dev-server`çš„æœ€ä½³å®è·µ\n\n### çƒ­æ›´æ–°\n\n1. é…ç½®`devServer.hot`ä¸º`true`ï¼›é…ç½®`devServer.inline`ä¸ºtrueï¼ˆé»˜è®¤ï¼‰ã€‚è¿™ä¼šåœ¨`entry`ä¸­æ·»åŠ ç›¸åº”ä»£ç \n2. å¢åŠ `webpack.HotModuleReplacementPlugin`è¿™ä¸ª`plugin`\n\n> å¦‚æœä½¿ç”¨`webpack-cli`ï¼Œç›´æ¥åŠ ä¸Š`--hot`å°±è‡ªåŠ¨å®ç°ä¸Šé¢ä¸¤æ­¥\n\n### proxy\n\n`devServer.proxy`å¯ä»¥å®ç°æœ¬åœ°è·¨åŸŸé—®é¢˜\n\n```javascript\nmodule.exports = {\n    devServer: {\n        proxy: {\n            '/api': {\n                target: 'http://ip:port', // æ‰€æœ‰è¯·æ±‚è·¯å¾„åŒ…å«/apiçš„è¯·æ±‚ï¼Œéƒ½ä¼šè¢«è½¬å‘åˆ°è¿™ä¸ªåœ°å€\n                pathRewrite: {'^/api', ''}\n            }\n        }\n    }\n}\n```\n\n### è‡ªå®šä¹‰ä¸­é—´ä»¶\n\nåœ¨ `webpack-dev-server` ä¸­æœ‰ä¸¤ä¸ªæ—¶æœºå¯ä»¥æ’å…¥è‡ªå·±å®ç°çš„ä¸­é—´ä»¶ï¼Œåˆ†åˆ«æ˜¯ `devServer.before` å’Œ `devServer.after `ï¼Œå³` webpack-dev-server `åŠ è½½æ‰€æœ‰å†…éƒ¨ä¸­é—´ä»¶ä¹‹å‰å’Œä¹‹åä¸¤ä¸ªæ—¶æœºã€‚é€šå¸¸ç”¨æ¥å®ç°`mockServer`\n\n```javascript\nmodule.exports = {\n    devServer: {\n        before(app, server) {\n            app.get('/api/get-use-info', (req, res) => {\n                res.json({name: 'zxffan', gender: 'male'})\n            })\n        }\n    }\n}\n```\n\n### Gzip\n\nå°†`devServer.compress`è®¾ç½®æˆ`true`\n\n### å¸¸ç”¨API\n\n- `devServer.historyApiFallback`ï¼šé…ç½®å¦‚æœæ‰¾ä¸åˆ°é¡µé¢å°±é»˜è®¤æ˜¾ç¤ºçš„é¡µé¢ï¼›\n- `devServer.compress`ï¼šå¯ç”¨ gzip å‹ç¼©ï¼›\n- `devServer.hotOnly`ï¼šå¯ç”¨çƒ­æ›´æ–°ï¼Œå¹¶ä¸”æ„å»ºå¤±è´¥çš„æ—¶å€™ä¸ä¼šåˆ·æ–°ç½‘é¡µï¼›\n- `devServer.inline`ï¼šæ¨¡å¼åˆ‡æ¢ï¼Œé»˜è®¤ä¸ºå†…è”æ¨¡å¼ï¼Œä½¿ç”¨`false`åˆ‡æ¢åˆ° iframe æ¨¡å¼ï¼›\n- `devServer.open`ï¼šå¯åŠ¨åï¼Œæ˜¯å¦è‡ªåŠ¨ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€é¦–é¡µï¼›\n- `devServer.openPage`ï¼šå¯åŠ¨åï¼Œè‡ªåŠ¨ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€æŒ‡å®šçš„é¡µé¢ï¼›\n- `devServer.overlay`ï¼šæ˜¯å¦å…è®¸ä½¿ç”¨å…¨å±è¦†ç›–çš„æ–¹å¼æ˜¾ç¤ºç¼–è¯‘é”™è¯¯ï¼Œé»˜è®¤ä¸å…è®¸ï¼›\n- `devServer.port`ï¼šç›‘å¬ç«¯å£å·ï¼Œé»˜è®¤ 8080ï¼›\n- `devServer.host`ï¼šæŒ‡å®š hostï¼Œä½¿ç”¨`0.0.0.0`å¯ä»¥è®©å±€åŸŸç½‘å†…å¯è®¿é—®ï¼›\n- `devServer.contentBase`ï¼šå‘Šè¯‰æœåŠ¡å™¨ä»å“ªé‡Œæä¾›å†…å®¹ï¼Œåªæœ‰åœ¨ä½ æƒ³è¦æä¾›é™æ€æ–‡ä»¶æ—¶æ‰éœ€è¦ï¼›\n- `devServer.publicPath`ï¼šè®¾ç½®å†…å­˜ä¸­çš„æ‰“åŒ…æ–‡ä»¶çš„è™šæ‹Ÿè·¯å¾„æ˜ å°„ï¼ŒåŒºåˆ«äº`output.publicPath`ï¼›\n- `devServer.staticOptions`ï¼šä¸º `Expressjs` çš„ `express.static`é…ç½®å‚æ•°ï¼Œ[å‚è€ƒæ–‡æ¡£]( http://expressjs.com/en/4x/api.html#express.static)\n- `devServer.clientLogLevel`ï¼šåœ¨ inline æ¨¡å¼ä¸‹ç”¨äºæ§åˆ¶åœ¨æµè§ˆå™¨ä¸­æ‰“å°çš„ log çº§åˆ«ï¼Œå¦‚`error`, `warning`, `info` or `none`ï¼›\n- `devServer.quiet`ï¼šé™é»˜æ¨¡å¼ï¼Œè®¾ç½®ä¸º`true`åˆ™ä¸åœ¨æ§åˆ¶å°è¾“å‡º logï¼›\n- `devServer.noInfo`ï¼šä¸è¾“å‡ºå¯åŠ¨ logï¼›\n- `devServer.lazy`: ä¸ç›‘å¬æ–‡ä»¶å˜åŒ–ï¼Œè€Œæ˜¯å½“è¯·æ±‚æ¥çš„æ—¶å€™å†é‡æ–°ç¼–è¯‘ï¼›\n- `devServer.watchOptions`ï¼šwatch ç›¸å…³é…ç½®ï¼Œå¯ä»¥ç”¨äºæ§åˆ¶é—´éš”å¤šå°‘ç§’æ£€æµ‹æ–‡ä»¶çš„å˜åŒ–ï¼›\n- `devServer.headers`ï¼šè‡ªå®šä¹‰è¯·æ±‚å¤´ï¼Œä¾‹å¦‚è‡ªå®šä¹‰ userAgent ç­‰ï¼›\n- `devServer.https`ï¼šhttps éœ€è¦çš„è¯ä¹¦ç­¾åç­‰é…ç½®ã€‚\n\n## Webpackä¼˜åŒ–â€”â€”å¦‚ä½•å‡å°æ‰“åŒ…åçš„æ–‡ä»¶ä½“ç§¯\n\næ‰“åŒ…åçš„æ–‡ä»¶ä¸»è¦åˆ†ä¸ºä¸‰ç±»â€”â€”`js`ã€`css`å’Œ`å…¶å®ƒé™æ€èµ„æºæ–‡ä»¶ï¼ˆå›¾ç‰‡ç­‰ï¼‰`\n\n### å¦‚ä½•å‡å°JSæ–‡ä»¶ä½“ç§¯\n\n1. å‹ç¼©ä»£ç ï¼šä½¿ç”¨[terser-webpack-plugin](https://www.npmjs.com/package/terser-webpack-plugin)å¯¹`es moudule`çš„ä»£ç è¿›è¡Œå‹ç¼©\n2. `tree shaking`ï¼Œä»£ç éœ€è¦éµå¾ª`es module`\n3. åˆç†è®¾ç½®`splitChunk`æ‹†åˆ†é€»è¾‘\n4. ç¬¬ä¸‰æ–¹åº“æŒ‰éœ€å¼•å…¥\n5. ä½¿ç”¨`scope hoisting`\n\n> webpackçš„`mode`è®¾ç½®ä¸º`production`æ—¶ï¼Œwebpackå°±ä¼šè‡ªåŠ¨åšä¸€äº›é€šç”¨çš„ä¼˜åŒ–é…ç½®\n\né…ç½®å¦‚ä¸‹\n\n```javascript\nconst TerserWebpackPluin = require('terser-webpack-plugin')\n\nmodule.exports = {\n    // ...\n    \n    mode: 'production',\n    \n    optimization: {\n        concatenateModules: true, // å¼€å¯ scope hoisting(modeä¸ºproductionä¼šè‡ªåŠ¨å¼€å¯)\n        minimize: true,\n        minimizer: [\n            new TerserWebpackPluin({\n                test: /\\.js(\\?.*)?$/i,\n                include: /src/,\n                //exclude\n                cache: true, // å¼€å¯ç¼“å­˜\n                parallel: true, // é»˜è®¤true å¼€å¯å¤šçº¿ç¨‹\n                terserOptions: {\n                    compress: {\n                        unused: true, // åˆ é™¤æ— ç”¨çš„ä»£ç  \n                        drop_debugger: true, // åˆ æ‰ debugger \n                        drop_console: true, // ç§»é™¤ console \n                        dead_code: true, // ç§»é™¤æ— ç”¨çš„ä»£ç \n                    }\n                }\n            })\n        ]\n    }\n}\n```\n\n### å¦‚ä½•å‡å°CSSæ–‡ä»¶ä½“ç§¯\n\n1. å‹ç¼©ä»£ç ï¼šä½¿ç”¨`cssnao`(`postcss` æ’ä»¶)æ¥è¿›è¡Œä»£ç å‹ç¼©ï¼Œå…¶å®`css-loader`å·²ç»é›†æˆäº†`cssnano`\n2. æŠ½ç¦»CSSï¼šé€šè¿‡`mini-css-extract-plugin`å°†CSSå†…å®¹æŠ½ç¦»åˆ°CSSæ–‡ä»¶ä¸­\n\né…ç½®å†…å®¹å¦‚ä¸‹\n\n```javascript\nconst MiniCssExtractPlugin = require('mini-css-extract-plugin')\n\nmodule.exports = {\n    // ...\n    \n    module: {\n        rules: [\n            {\n                test: /\\.css$/,\n                use: [\n                    'style-loader',\n                    MiniCssExtractPlugin.loader,\n                    {\n                        loader: 'css-loader',\n                        options: {\n                           \tminimize: {/* CSSNano Options */}\n                        }\n                    }\n                ]\n            }\n        ]\n    },\n    plugins: [\n        new MiniCssExtractPlugin({\n            filename: '[name].css',\n        })\n    ]\n}\n```\n\n### å¦‚ä½•å¤„ç†å›¾ç‰‡ç­‰é™æ€èµ„æº\n\n1. `url-loader`å¯ä»¥å°†å°å›¾ç‰‡è½¬æˆ`Data URL`å†…è”åˆ°JSä¸­ï¼Œä»è€Œå‡å°‘è¯·æ±‚æ•°é‡\n2. å¯¹äº`svg`ï¼Œä½¿ç”¨`svg-url-loader`\n\n```javascript\nmodule.exports = {\n    module: {\n        rules: [\n            {\n                test: /\\.(png|jpg|jpeg)$/,\n                use: [\n                    {\n                        loader: 'url-loader',\n                        options: {\n                            limit: 100, //å•ä½kbï¼Œå°äºè¿™ä¸ªå¤§å°çš„ä¼šè¢«è½¬æˆData URL\n                        }\n                    }\n                ]\n            }\n        ]\n    }\n}\n```\n\n\n\n## Webpackä¼˜åŒ–â€”â€”å¦‚ä½•åˆ©ç”¨ç¼“å­˜\n\nä¸»è¦æ€è·¯å°±æ˜¯ï¼Œå°†é¡¹ç›®ä¸­ä¸å¤ªå®¹æ˜“å˜åŒ–çš„ä»£ç ï¼ˆæ¯”å¦‚ç¬¬ä¸‰æ–¹åº“vueã€reactï¼‰å•ç‹¬æŠ½ç¦»å‡ºæ¥ï¼Œåˆ©ç”¨`CDN`æˆ–é…ç½®æµè§ˆå™¨ç¼“å­˜ä»¥å‡å°‘å¯¹å…¶çš„è¯·æ±‚ã€‚\n\n### å¦‚ä½•æ‹†åˆ†å‡ºæ¥ï¼ˆ`Code Splitting`ï¼‰\n\n1. é…ç½®å¤šä¸ªentry\n2. ä½¿ç”¨`dynamic import`å’Œ`split chunk`æ¥æ‹†åˆ†ä»£ç \n3. ä½¿ç”¨`external`ä¸æ‰“åŒ…è¿™äº›ä¸€äº›ç¬¬ä¸‰æ–¹åº“ï¼Œç„¶åé€šè¿‡`cdn`å¼•å…¥\n\nç‰¹åˆ«è¯´ä¸€ä¸‹`split chunk`ï¼Œä»¥ä¸‹æ—¶é»˜è®¤é…ç½®\n\n```javascript\nmodule.exports = {\n    // ...\n    optimization: {\n        splitChunks: {\n            chunks: 'async', // ä¸‰é€‰ä¸€ï¼š \"initial\" | \"all\" | \"async\" (é»˜è®¤)\n            minSize: 30000, // æœ€å°å°ºå¯¸ï¼Œ30Kï¼Œdevelopment ä¸‹æ˜¯10kï¼Œè¶Šå¤§é‚£ä¹ˆå•ä¸ªæ–‡ä»¶è¶Šå¤§ï¼Œchunk æ•°å°±ä¼šå˜å°‘ï¼ˆé’ˆå¯¹äºæå–å…¬å…± chunk çš„æ—¶å€™ï¼Œä¸ç®¡å†å¤§ä¹Ÿä¸ä¼šæŠŠåŠ¨æ€åŠ è½½çš„æ¨¡å—åˆå¹¶åˆ°åˆå§‹åŒ–æ¨¡å—ä¸­ï¼‰å½“è¿™ä¸ªå€¼å¾ˆå¤§çš„æ—¶å€™å°±ä¸ä¼šåšå…¬å…±éƒ¨åˆ†çš„æŠ½å–äº†\n            maxSize: 0, // æ–‡ä»¶çš„æœ€å¤§å°ºå¯¸ï¼Œ0ä¸ºä¸é™åˆ¶ï¼Œä¼˜å…ˆçº§ï¼šmaxInitialRequest/maxAsyncRequests < maxSize < minSize\n            minChunks: 1, // é»˜è®¤1ï¼Œè¢«æå–çš„ä¸€ä¸ªæ¨¡å—è‡³å°‘éœ€è¦åœ¨å‡ ä¸ª chunk ä¸­è¢«å¼•ç”¨ï¼Œè¿™ä¸ªå€¼è¶Šå¤§ï¼ŒæŠ½å–å‡ºæ¥çš„æ–‡ä»¶å°±è¶Šå°\n            maxAsyncRequests: 5, // åœ¨åšä¸€æ¬¡æŒ‰éœ€åŠ è½½çš„æ—¶å€™æœ€å¤šæœ‰å¤šå°‘ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œä¸º 1 çš„æ—¶å€™å°±ä¸ä¼šæŠ½å–å…¬å…± chunk äº†\n            maxInitialRequests: 3, // é’ˆå¯¹ä¸€ä¸ª entry åšåˆå§‹åŒ–æ¨¡å—åˆ†éš”çš„æ—¶å€™çš„æœ€å¤§æ–‡ä»¶æ•°ï¼Œä¼˜å…ˆçº§é«˜äº cacheGroupï¼Œæ‰€ä»¥ä¸º 1 çš„æ—¶å€™å°±ä¸ä¼šæŠ½å– initial common äº†\n            automaticNameDelimiter: '~', // æ‰“åŒ…æ–‡ä»¶ååˆ†éš”ç¬¦\n            name: true, // æ‹†åˆ†å‡ºæ¥æ–‡ä»¶çš„åå­—ï¼Œé»˜è®¤ä¸º trueï¼Œè¡¨ç¤ºè‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶åï¼Œå¦‚æœè®¾ç½®ä¸ºå›ºå®šçš„å­—ç¬¦ä¸²é‚£ä¹ˆæ‰€æœ‰çš„ chunk éƒ½ä¼šè¢«åˆå¹¶æˆä¸€ä¸ª\n            cacheGroups: {\n                vendors: {\n                    test: /[\\\\/]node_modules[\\\\/]/, // æ­£åˆ™è§„åˆ™ï¼Œå¦‚æœç¬¦åˆå°±æå– chunkï¼Œ\n                    test(module, chunks) { // è¿˜å¯ä»¥æ˜¯å‡½æ•°\n                        return module.type === 'javascrtipt/auto'\n                    },\n                    priority: -10 // ç¼“å­˜ç»„ä¼˜å…ˆçº§ï¼Œå½“ä¸€ä¸ªæ¨¡å—å¯èƒ½å±äºå¤šä¸ª chunkGroupï¼Œè¿™é‡Œæ˜¯ä¼˜å…ˆçº§\n                },\n                default: {\n                    minChunks: 2,\n                    priority: -20, // æƒé‡ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ¨¡å—æ»¡è¶³äº†å¤šä¸ªç¼“å­˜ç»„çš„æ¡ä»¶å°±ä¼šå»æŒ‰ç…§æƒé‡åˆ’åˆ†ï¼Œè°çš„æƒé‡é«˜å°± ä¼˜å…ˆæŒ‰ç…§è°çš„è§„åˆ™å¤„ç†ã€‚\n                    reuseExistingChunk: true // å¦‚æœè¯¥chunkåŒ…å«çš„moduleséƒ½å·²ç»å¦ä¸€ä¸ªè¢«åˆ†å‰²çš„chunkä¸­å­˜åœ¨ï¼Œé‚£ä¹ˆç›´æ¥å¼•ç”¨å·²å­˜åœ¨çš„chunkï¼Œä¸ä¼šå†é‡æ–°äº§ç”Ÿä¸€ä¸ª\n                }\n            }\n        }\n    }\n};\n```\n\n`chunks`æœ‰ä¸‰ä¸ªå€¼`initial`ã€`all`å’Œ`async`(é»˜è®¤)\n\n1. `chunks`ä¸º`async`ï¼šåªæœ‰`dynamic import`æ‰ä¼šè¢«æ‹†åˆ†å‡ºå»\n2. `chunks`ä¸º`initial`ï¼š`dynamic import`è‚¯å®šä¼šè¢«æ‹†åˆ†å‡ºå»ï¼Œç¬¦åˆ`cacheGroup`è§„åˆ™å¹¶ä¸”ä½“ç§¯å¤§äº`minSize`ä¹Ÿä¼šè¢«æ‹†åˆ†å‡ºå»ï¼ˆæ— è®ºæ˜¯å¦`dynamic import`ï¼‰;ä½†æ˜¯éåŠ¨æ€å¯¼å…¥å’ŒåŠ¨æ€å¯¼å…¥çš„å…¬å…±éƒ¨åˆ†æ²¡æœ‰æ‹†åˆ†åœ¨ä¸€èµ·ï¼Œè€Œåœ¨å•ç‹¬æ‹†åˆ†æˆä¸åŒçš„chunk\n3. `chunks`ä¸º`all`ï¼ˆæ¨èï¼‰ï¼šéåŠ¨æ€å¯¼å…¥å’ŒåŠ¨æ€å¯¼å…¥çš„å…¬å…±éƒ¨åˆ†ä¼šæ‹†åˆ†åœ¨ä¸€èµ·ï¼ˆç¬¦åˆcacheGroupè§„åˆ™ï¼‰\n\n`cacheGroup`(ç¼“å­˜ç»„)é…ç½®äº†æ‹†åˆ†é€»è¾‘ã€‚\n\n### å¦‚ä½•è®¾ç½®ç¼“å­˜\n\n`CDN`æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œç›´æ¥å†HTMLä¸­å¼•å…¥å³å¯ã€‚\n\nå¯¹äºæµè§ˆå™¨ç¼“å­˜ï¼Œå½“æµè§ˆå™¨è¯·æ±‚è¿™äº›èµ„æºæ—¶ï¼ŒæœåŠ¡ç«¯è®¾ç½®`Cache-Control`å“åº”å¤´ï¼Œæ¯”å¦‚`Cache-Control: max-age=31536000`ï¼Œè¡¨ç¤ºå½“å‰èµ„æºç¼“å­˜ä¸€å¹´ï¼ˆ31536000=360024365ï¼‰ã€‚åªè¦ä¸€å¹´å†…è¯¥èµ„æºä¸å‘ç”Ÿå˜åŒ–å°±ä¼šä¸€ç›´ä»ç¼“å­˜ä¸­è¯»å–ã€‚\n\n## Webpackä¼˜åŒ–â€”â€”å¦‚ä½•åŠ å¿«æ‰“åŒ…é€Ÿåº¦\n\n1. é…ç½®è·¯å¾„åˆ«åâ€”â€”`resolve.alias`ï¼Œä»¥å‡å°‘ç›®å½•æŸ¥æ‰¾æ¬¡æ•°\n2. å¢åŠ é»˜è®¤æ–‡ä»¶åç¼€åâ€”â€”`resolve.extensions`\n3. æ’é™¤ä¸éœ€è¦è§£æçš„æ¨¡å—\n   1. `module.noParse`ï¼Œä¾‹å¦‚`noParse: /node_modules\\/jquery.js/`ã€‚å¿½ç•¥å¯¹éƒ¨åˆ†æ²¡é‡‡ç”¨æ¨¡å—åŒ–çš„æ–‡ä»¶é€’å½’è§£æå¤„ç†ï¼Œä¾‹å¦‚ï¼šjQueryã€ ChartJSï¼Œå®ƒä»¬ä½“ç§¯åºå¤§åˆæ²¡æœ‰é‡‡ç”¨æ¨¡å—åŒ–æ ‡å‡†ï¼Œè®© Webpack å»è§£æè¿™äº›æ–‡ä»¶è€—æ—¶åˆæ²¡æœ‰æ„ä¹‰\n   2. `module.rules`ä¸­é…ç½®åˆé€‚çš„`include`å’Œ`exclude`ã€‚\n4. åˆ©ç”¨å¤šçº¿ç¨‹ï¼š`thread-loader`å’Œ`happypack`(å·²ç»ä¸ç»´æŠ¤äº†)\n5. `webpack`çš„`DllPlugin`å’Œ`DllReferencePlugin`ï¼Œå°†ä¸€äº›ä¸ä¼šå˜åŒ–çš„å†…å®¹æŠ½ç¦»å‡ºæ¥ï¼Œå¹¶ä¸”é¿å…äºŒæ¬¡æ‰“åŒ…ã€‚\n6. ç¼“å­˜`Cache`ï¼šå¾ˆå¤š`loader`éƒ½æä¾›äº†ç¼“å­˜æœºåˆ¶\n   1. `babel-loader`ï¼šè®¾ç½®`cacheDirectory:true`å°†ä¼šå¼€å¯ç¼“å­˜\n7. æ¢ç”¨é«˜æ€§èƒ½çš„loaderæˆ–æ’ä»¶\n   1. sassï¼šä½¿ç”¨`fast-sass-loader`ä»£æ›¿`sass-loader`\n\né‡ç‚¹è¯´ä¸€ä¸‹`DllPlugin`å’Œ`DllReferencePlugin`ï¼š\n\n`DllPlugin`å¯ä»¥å°†ç¬¬ä¸‰æ–¹åº“å•ç‹¬æ‰“åŒ…åˆ°ä¸€ä¸ª`bundle`ä¸­ï¼Œè¿˜ä¼šç”Ÿæˆä¸€ä¸ª`manifest.json`æ–‡ä»¶\n\n`DllReferencPlugin`è¯»å–è¿™ä¸ª`manifest.json`æ–‡ä»¶ï¼Œåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­å°±ä¸ä¼šå°†ä¹‹å‰æŠ½ç¦»å†…å®¹æ‰“åŒ…è¿›æ¥\n\n\n\n```javascript\n// webpack.config.dll.js\nconst { DllPlugin } = require('webpack')\n\nmodule.exports = {\n    // ...\n    mode: 'production',\n    entry: {\n        vendor: ['vue', 'vue-router', 'vuex'] // å°†è¿™äº›ç¬¬ä¸‰æ–¹åº“æŠ½ç¦»å‡ºæ¥\n    },\n    \n    output: {\n        filename: 'dll/[name][chunkhash].js',\n        library: '[name][chunkhash]',\n        path: './dist'\n    },\n    \n    plugins: [\n        new DllPlugin({\n            path: 'dll/manifest.json', // è®¾ç½®manifest.jsonçš„è·¯å¾„\n            name: '[name]_[chunkhash]',\n            context: __dirname\n        })\n    ]\n}\n```\n\nä½¿ç”¨`webpack.config.dll.js`æ‰“åŒ…ä¸€æ¬¡ï¼Œå°†`vue`ã€`vuex`å’Œ`vue-router`æ‰“åŒ…å‡ºæ¥ã€‚ç”Ÿæˆ`vender[hash].js`å’Œ`manifest.json`\n\nç„¶åé…ç½®`webpack.config.js`\n\n```javascript\nconst { DllReferencePlugin } = require('webpack')\nconst manifest = require('./dll/manifest.json')\n\nmodule.exports = {\n    entry: {\n        main: './src/index.js'\n    },\n    output: {\n        filename: '[name][chunkhash].js'\n    },\n    plugin: [\n        new DllReferencePlugin({\n            context: __dirname\n            manifest // é…ç½®manifest\n        })\n    ]\n}\n```\n\næ‰“åŒ…æœ€åç”Ÿæˆçš„`main.js`ä¸­ä¸ä¼šåŒ…å«`vendor`é‡Œçš„å†…å®¹ã€‚\n\n> webpack5æå‡ºäº†`federal module`ï¼ˆè”é‚¦æ¨¡å—ï¼‰ï¼›ä¹Ÿå¯ä»¥æå–å…¬å…±æ¨¡å—\n\n## è§£é‡Šä¸€ä¸‹Webpackä¸­`Tree-shaking`åŸç†ï¼Ÿ\n\nåŸºäº`ES module`åšé™æ€åˆ†æï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°±èƒ½åˆ†æå‡ºå…¶æ¨¡å—ä¾èµ–å…³ç³»ï¼ˆæ— éœ€ç­‰åˆ°è¿è¡Œæ—¶ï¼‰ã€‚ç„¶ååˆ©ç”¨`uglifyjs`æˆ–`terser-webpack-plugin`æ¥åˆ é™¤å¤šä½™å†…å®¹\n\n`tree shaking`çš„æ³¨æ„ç‚¹ï¼š\n\n1. å¿…é¡»ä½¿ç”¨`es module`è§„èŒƒ\n2. ä¸æ”¯æŒå¯¹`class`çš„`tree shaking`\n3. å‡å°‘å‰¯ä½œç”¨ï¼Œå…·æœ‰å‰¯ä½œç”¨çš„ä»£ç ä¸ä¼šè¢«æ¶ˆé™¤\n\n> çº¯å‡½æ•°ï¼šå¯¹äºç›¸åŒçš„è¾“å…¥å°±æœ‰ç›¸åŒçš„è¾“å‡ºï¼Œä¸ä¾èµ–å¤–éƒ¨ç¯å¢ƒï¼Œä¹Ÿä¸æ”¹å˜å¤–éƒ¨ç¯å¢ƒã€‚\n>\n> éçº¯å‡½æ•°è¢«ç§°ä¸ºå…·æœ‰å‰¯ä½œç”¨çš„å‡½æ•°\n>\n> 1. ç¡®ä¿ä»£ç ä¸­æ²¡æœ‰å‰¯ä½œç”¨\n> 2. åœ¨`package.json`ä¸­é…ç½®`sideEffects: [\"./src/side_effect.js\"]`(æŒ‡å®šå…·æœ‰å‰¯ä½œç”¨çš„å†…å®¹)æˆ–è€…`sideEffects:false`ï¼ˆå®Œå…¨æ²¡æœ‰å‰¯ä½œç”¨ï¼‰ï¼Œè¿™æ ·webpackå°±ä¼šè·³è¿‡å‰¯ä½œç”¨çš„ä»£ç \n\n## Checklist\n\n### é…ç½®æ–‡ä»¶ç®¡ç†\n\n`npm script`é…ç½®è„šæœ¬å‘½ä»¤ï¼Œä¾‹å¦‚`node ./scripts/dev.js`\n\nä½¿ç”¨ç¼–ç¨‹å¼APIï¼Œè€Œä¸é‡‡ç”¨`webpack-cli`ï¼ˆä¸ªäººä¹ æƒ¯ï¼‰\n\næ‹†åˆ†é…ç½®æ–‡ä»¶ï¼šå¼€å‘ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒç­‰\n\n`scripts`ç›®å½•ä¸‹æœ‰ä¸€ä¸ª`config`ç›®å½•ç”¨æ¥å­˜æ”¾å„ä¸ªç¯å¢ƒçš„é…ç½®æ–‡ä»¶\n\n### åˆç†çš„æ‹†åˆ†\n\nåˆç†è®¾ç½®`splitchunks`ã€`DDLPlugin`æˆ–`Federal Module`ï¼Œå¤ªç»†ä¸åˆ©äºç¼“å­˜ï¼Œå¤ªç²—åˆä¼šå½±å“åŠ è½½é€Ÿåº¦ã€‚ï¼Œ\n\næ‹†åˆ†åŸåˆ™ï¼š\n\n1. å˜æ›´é¢‘ç‡å°çš„éƒ¨åˆ†æ‹†åˆ†å‡ºæ¥ï¼ˆä¾‹å¦‚ç¬¬ä¸‰æ–¹åº“ï¼‰\n2. å…¬å…±éƒ¨åˆ†æ‹†åˆ†å‡ºæ¥\n3. æŒ‰ç…§è·¯ç”±æ‹†åˆ†\n\n### Hash\n\n1. JavaScript æ–‡ä»¶ä½¿ç”¨ï¼š`[chunkhash]`ï¼›\n2. CSS æ–‡ä»¶ä½¿ç”¨ï¼š`[contenthash]`ï¼›\n3. å…¶ä»–é™æ€èµ„æºç”¨ï¼š`[hash]`ï¼Œä¾‹å¦‚å›¾ç‰‡ã€å­—ä½“ç­‰ï¼Œåœ¨`url-loader`ä¸­é…ç½®`[hash]`\n\n### codeè§„èŒƒ\n\n1. å¿…é¡»ä½¿ç”¨`ES Module`ï¼Œæ–¹é¢`Tree-Shaking`ï¼Œæ³¨æ„å‰¯ä½œç”¨ä»£ç \n2. åˆç†ä½¿ç”¨`webpack magic comments`\n3. é€‰æ‹©ç¬¦åˆ`es module`è§„èŒƒçš„ç¬¬ä¸‰æ–¹åº“ï¼Œä¾‹å¦‚`lodash-es`\n\n## å¦‚ä½•è°ƒè¯•Webpack\n\nåœ¨`vscode`ä¸­æ‰“ä¸‹æ–­ç‚¹ï¼Œç„¶åæŒ‰`F5`ï¼Œé€‰æ‹©`nodejs`ï¼ˆ`webpack`æ˜¯åŸºäºnodeçš„åº“ï¼‰ã€‚å°±å¯ä»¥è¿›è¡Œè°ƒè¯•\n\nå¦‚æœéœ€è¦è‡ªå®šä¹‰`debug`ï¼Œåˆ›å»º`launch.json`æ–‡ä»¶è¿›ä¸€æ­¥è‡ªå®šä¹‰ã€‚","tags":["javascript","webpack","æ¶æ„"],"categories":["Webpack"]},{"title":"Rustå­¦ä¹ ç¬”è®°-å˜é‡&ç±»å‹&functions&æ³¨é‡Š&æ§åˆ¶æµ","url":"/posts/452059e7.html","content":"\næœ¬ç³»åˆ—æ–‡ç« æ˜¯ç¬”è€…å­¦ä¹ `Rust`æ—¶æ‰€åšçš„ç¬”è®°ï¼Œä¾›æ—¥åç¿»é˜…å¤ä¹ ã€‚\n\n## å˜é‡å’Œå¯å˜æ€§\n\nåœ¨`Rust`ä¸­å®šä¹‰ä¸€ä¸ªå˜é‡å¾ˆç®€å•ï¼š`let x = 100`ï¼Œä½†è¿™ä¸ª`x`æ—¶`immutable`ï¼ˆä¸å¯å˜çš„ï¼‰\n\n```rust\nfn main() {\n\tlet x = 100;\n\tx = 200; // error\n}\n```\n\nåœ¨`Rust`ä¸­å®šä¹‰ä¸€ä¸ªå¯å˜å˜é‡ä¹Ÿå¾ˆç®€å•ï¼š`let mut x = 100`ï¼Œå…¶ä¸­çš„`mut`ä»£è¡¨`mutable`\n\n### å¸¸é‡\n\nåœ¨`Rust`ä¸­ä½¿ç”¨`const`æ¥å®šä¹‰ä¸€ä¸ªå¸¸é‡ï¼š`const MAX_POINT: u32 = 150_000`\n\nå¸¸é‡å³**ä¸å˜åŒ–çš„é‡çš„**ï¼Œé‚£ä¹ˆ**å¸¸é‡**å’Œ**`immutable`å˜é‡**æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ\n\n1. å¸¸é‡å¿…é¡»æ˜¾ç¤ºæ³¨æ˜ç±»å‹ã€‚\n2. å¸¸é‡å¯ä»¥åœ¨ä»»ä½•ä½œç”¨åŸŸä¸‹ï¼ˆåŒ…æ‹¬å…¨å±€ä½œç”¨åŸŸï¼‰å£°æ˜ï¼Œ`let`ä»¥åŠå…¶å®ƒä»£ç å†…å®¹å¿…é¡»åœ¨`fucntion`ä¸‹å£°æ˜\n3. å¸¸é‡çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ï¼Œä¸èƒ½æ˜¯å‡½æ•°æˆ–å…¶å®ƒå¿…é¡»å†è¿è¡Œæ—¶æ‰èƒ½è®¡ç®—å‡ºç»“æœçš„å€¼ã€‚\n4. å¸¸é‡é€šå¸¸å®šä¹‰åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹ï¼Œç”¨æ¥é¿å…ç¡¬ç¼–ç é—®é¢˜ã€‚\n\n> `Rust`ä¸­å¸¸é‡çš„å‘½åè§„èŒƒï¼šå…¨éƒ¨å¤§å†™ï¼Œç”¨ä¸‹åˆ’çº¿è¿æ¥\n>\n> `Rust`ä¸­çš„æ•°å€¼ï¼š`100_000`ä»£è¡¨`100,000`å³`100000`\n\n### Shadowing\n\nåœ¨`Rust`ä¸­å…è®¸åœ¨åŒä¸€ä¸ªä½œç”¨åŸŸä¸‹ï¼Œä¸€ä¸ªå˜é‡è¢«å£°æ˜ä¸¤æ¬¡\n\n```rust\nfn main() {\n    let sentence = \"I heart you!\";\n    let sentence = sentence.len();\n    println!(sentence); // sentence is 12\n}\n```\n\n`sentence`ç¬¬ä¸€æ¬¡å£°æ˜ä¸ºä¸€ä¸ª`string`ï¼›ç¬¬äºŒæ¬¡å£°æ˜å˜æˆ`number`ã€‚å¯ä»¥ç†è§£ä¸ºç¬¬ä¸€ä¸ª`sentence`è¢«ç¬¬äºŒä¸ª`sentence`ç»™`shadowed`(éšè—)äº†ã€‚åé¢è®¿é—®åˆ°çš„éƒ½æ˜¯ç¬¬äºŒä¸ªã€‚\n\n`Shadowing`æœ€å¤§çš„å¥½å¤„å°±æ˜¯ï¼š**ç¬¬äºŒæ¬¡å£°æ˜æ—¶å¯ä»¥ä¿®æ”¹å˜é‡ç±»å‹ï¼Œå¯ä»¥ç”¨äºç±»å‹è½¬æ¢çš„åœºæ™¯**\n\n## æ•°æ®ç±»å‹\n\n`Rust`æ˜¯ä¸€é—¨é™æ€ç±»å‹è¯­è¨€ã€‚åœ¨ç¼–è¯‘æ—¶`Rust`å°±å¿…é¡»çŸ¥é“æ‰€æœ‰æ•°æ®çš„ç±»å‹ã€‚\n\n`Rust`ä¸­çš„æ•°æ®ç±»å‹åˆ†ç±»ä¸¤ç§ï¼š**æ ‡é‡ç±»å‹(Scalar Types)**å’Œ**å¤åˆç±»å‹(Compound Types)**\n\n### æ ‡é‡ç±»å‹\n\næ ‡é‡ç±»å‹æœ‰ï¼šæ•´å‹ã€æµ®ç‚¹å‹ã€å¸ƒå°”å‹ã€å­—ç¬¦å‹\n\n#### æ•´å‹\n\n`let x: u32 = 100`ï¼Œå°±æ˜¯å®šä¹‰ä¸€ä¸ªæ— ç¬¦å·çš„32ä½æ•´å‹\n\n`let x: i32 = 100`ï¼Œæ˜¯å®šä¹‰ä¸€ä¸ªå¸¦ç¬¦å·çš„32ä½æ•´å‹\n\n| å¤§å°    | å¸¦ç¬¦å·ï¼ˆSignedï¼‰ | æ— ç¬¦å·ï¼ˆUnsignedï¼‰ |\n| ------- | ---------------- | ------------------ |\n| 8-bit   | `i8`             | `u8`               |\n| 16-bit  | `i16`            | `u16`              |\n| 32-bit  | `i32`            | `u32`              |\n| 64-bit  | `i64`            | `u64`              |\n| 128-bit | `i128`           | `u128`             |\n| arch    | `isize`          | `usize`            |\n\nè¡¨ç¤ºèŒƒå›´ï¼šä»¥`16-bit`ä¸ºä¾‹\n\n1. `i16`ï¼šå¸¦ç¬¦å·ï¼Œæœ€é«˜ä½ç¬¦å·ä½ï¼Œè¿˜å‰©15ä½ï¼Œæ‰€ä»¥èƒ½è¡¨ç¤º \n\n$$\n[-2^{15}, 2^{15}-1]\n$$\n\n2. `u16`ï¼šä¸å¸¦ç¬¦å·å³ä¸ºéè´Ÿæ•°ï¼Œæ‰€ä»¥èƒ½è¡¨ç¤º\n\n$$\n[0, 2^{16}-1]\n$$\n\n`isize`å’Œ`usize`å–å†³äºæ“ä½œç³»ç»Ÿï¼Œå¦‚æœæ˜¯64ä½ç³»ç»Ÿå°±å–64ï¼›å¦‚æœæ˜¯32ä½ç³»ç»Ÿå°±å–32ã€‚\n\nåœ¨`Rust`ä¸­å¯ä»¥ä»¥å¤šç§å½¢å¼ä¹¦å†™æ•´å‹å­—é¢é‡ï¼š\n\n| Number literals  | Example       |\n| ---------------- | ------------- |\n| Decimal          | `98_222`      |\n| Hex              | `0xff`        |\n| Octal            | `0o77`        |\n| Binary           | `0b1111_0000` |\n| Byte (`u8` only) | `b'A'`        |\n\né™¤äº†Byteå­—é¢é‡éƒ½å¯ä»¥ä½¿ç”¨**ç±»å‹åç¼€ï¼ˆtype suffixï¼‰**ï¼š`let num = 120u32`å’Œ`let num:u32 = 120`æ˜¯ä¸€æ ·çš„\n\né™¤äº†Byteå­—é¢é‡éƒ½å¯ä»¥ä½¿ç”¨**`_`è§†è§‰åˆ†éš”ç¬¦**ï¼š`100_000`ä»£è¡¨`100,000`å³`100000`\n\n> å¦‚æœä¸æŒ‡å®šæ•°å€¼ç±»å‹ï¼ŒRusté»˜è®¤`i32`\n\næ•´å‹æº¢å‡ºï¼š`u8`åªèƒ½è¡¨ç¤º`[0,255]`èŒƒå›´çš„å€¼ï¼Œå½“å–`256`å°±ä¼šå‘ç”Ÿæº¢å‡º\n\n1. `debug`æ¨¡å¼ä¸‹ï¼Œ`Rust`ä¼šè¿›è¡Œæº¢å‡ºæ£€æµ‹ï¼Œå½“æº¢å‡ºå‘ç”Ÿï¼Œç¨‹åºå‘ç”Ÿ`panic`\n2. `release`æ¨¡å¼ä¸‹ï¼Œ`Rust`ä¸ä¼šè¿›è¡Œæ£€æµ‹ï¼Œ`256`ä¼šå˜æˆ`0`;`257`å˜æˆ`1`ã€‚\n\n#### æµ®ç‚¹ç±»å‹\n\næµ®ç‚¹ç±»å‹åªæœ‰ä¸¤ç§ï¼š`f32`å’Œ`f64`(é»˜è®¤)ï¼Œå‰è€…è¡¨ç¤º**å•ç²¾åº¦æµ®ç‚¹ç±»å‹**ï¼Œåè€…è¡¨ç¤º**åŒç²¾åº¦æµ®ç‚¹ç±»å‹**ã€‚ä¾‹å¦‚\n\n```rust\nfn main() {\n    let x = 2.1; // f64\n    let x: f32 = 3.1; // f32\n}\n```\n\nä¸ç»å¤§æ•°è¯­è¨€ä¸€æ ·ï¼Œ`Rust`çš„æµ®ç‚¹ç±»å‹ä¹Ÿéµå¾ª`IEEE-754`æ ‡å‡†ï¼Œæ‰€ä»¥ä¹Ÿå­˜åœ¨`0.1 + 0.2`çš„é—®é¢˜ã€‚\n\n#### å¸ƒå°”ç±»å‹\n\nå¸ƒå°”ç±»å‹æœ‰ä¸¤ç§ï¼š`true`å’Œ`false`\n\nå¸ƒå°”ç±»å‹å 1ä¸ªå­—èŠ‚\n\nä½¿ç”¨`bool`æ¥å£°æ˜å¸ƒå°”ç±»å‹ï¼Œä¾‹å¦‚\n\n```rust\nfn main() {\n    let isCheck = true;\n    \n    let hasExist: bool = false;\n}\n```\n\n#### å­—ç¬¦ç±»å‹\n\n`Rust`çš„å­—ç¬¦ç±»å‹å 4ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥èƒ½è¡¨ç¤ºå¾ˆå¤šå­—ç¬¦ï¼Œæ¯”å¦‚å•ä¸ªä¸­æ–‡ã€æ—¥æ–‡ç”šè‡³`emoji`å­—ç¬¦\n\nä½¿ç”¨**å•å¼•å·**å®šä¹‰**å­—ç¬¦å­—é¢é‡**ï¼›ä½¿ç”¨**åŒå¼•å·**å®šä¹‰å­—**ç¬¦ä¸²å­—é¢é‡**ï¼Œä¾‹å¦‚\n\n```rust\nfn main() {\n    let word = 'â™¥';\n    \n    let sentence = \"I â™¥ you!\";\n}\n```\n\n### å¤åˆç±»å‹\n\nå¤åˆç±»å‹æœ‰ä¸¤ç§ï¼šå…ƒç»„å’Œæ•°ç»„\n\n#### å…ƒç»„\n\n```rust\nfn main() {\n    // å®šä¹‰å…ƒç»„\n    let tup: (i32, f64, u8) = (500, 6.4, 1);\n    \n    // ä¹Ÿå¯ä»¥çœç•¥ç±»å‹\n    let tup = (500, 6.4, 1);\n\t\n    // å…ƒç»„å¯ä»¥è§£æ„\n    let (x, y, z) = tup;\n    \n    // ä½¿ç”¨ å…ƒç»„.index çš„æ–¹å¼è®¿é—®\n    let first = tup.0;\n    let second = tup.1;\n}\n```\n\n#### æ•°ç»„\n\n```rust\nfn main() {\n    // å®šä¹‰æ•°ç»„\n    let arr: [i32, i32, i32] = [1, 2, 3];\n    let arr: [i32, 3] = [1, 2, 3];\n    \n    // æ•°ç»„å…ƒç´ éƒ½ä¸€æ ·\n    let arr = [1, 1, 1, 1, 1];\n    let arr = [1; 5];\n    \n    // é€šè¿‡indexè®¿é—®å…ƒç´ \n    let x = arr[0]ï¼›\n}\n```\n\nå…ƒç»„ä¸æ•°ç»„çš„å¼‚åŒç‚¹ï¼š\n\nç›¸åŒç‚¹ï¼š\n\n1. éƒ½æ˜¯å®šé•¿çš„ï¼Œé•¿åº¦ä¸èƒ½å˜åŒ–ã€‚å¦‚æœéœ€è¦ä¸å®šé•¿ï¼Œä½¿ç”¨`vector`\n2. éƒ½æ˜¯æ•°æ®é›†åˆ\n\nä¸åŒç‚¹\n\n1. æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„ç±»å‹å¿…é¡»ç›¸åŒï¼Œè€Œå…ƒç»„å¯ä»¥ä¸ä¸€æ ·\n2. ä½¿ç”¨æ–¹å¼ä¸ä¸€æ ·\n\n## Functions\n\nå‡½æ•°æ˜¯`Rust`ä¸­æœ€ä¸ºæ™®éçš„å­˜åœ¨ã€‚æ¯ä¸ªç¨‹åºéƒ½æœ‰ä¸€ä¸ª`main`å‡½æ•°ä½œä¸ºç¨‹åºçš„å…¥å£å‡½æ•°ã€‚å¯ä»¥é€šè¿‡`fn`å…³é”®å­—æ¥å®šä¹‰å‡½æ•°ã€‚\n\n```rust\nfn main() {\n    print_hello(); // è°ƒç”¨å‡½æ•°\n    \n    let result = plus_two(2);\n    println!(\"The result is {}\", result);\n}\n\nfn print_hello() {\n    println!(\"hello\");\n}\n\nfn plus_two(a: i32) -> i32 { // -> æ³¨æ˜å‡½æ•°è¿”å›å€¼ç±»å‹\n    a + 2 // ä¸åŠ åˆ†å·è¡¨ç¤ºæ˜¯è¡¨è¾¾å¼ï¼Œå‡½æ•°ä½“çš„æœ€åä¸€è¡Œå¦‚æœæ˜¯è¡¨è¾¾å¼é»˜è®¤ä¸ºå‡½æ•°è¿”å›å€¼\n}\n\n```\n\næ³¨æ„ï¼š\n\n1. å‡½æ•°å‚æ•°å¿…é¡»æ³¨æ˜ç±»å‹\n2. æœ‰è¿”å›å€¼å¿…é¡»æ³¨æ˜è¿”å›å€¼ç±»å‹ï¼Œæ²¡æœ‰è¿”å›å€¼é»˜è®¤è¿”å›ç©ºå…ƒç»„å³`()`\n\n### è¯­å¥ä¸è¡¨è¾¾å¼(Statements and Expression)\n\nè¯­å¥(Statements)ï¼šæ‰§è¡ŒæŸç§è¡Œä¸ºï¼Œä¸ä¼šæœ‰è¿”å›å€¼\n\nè¡¨è¾¾å¼(Expression)ï¼šè¿›è¡Œè®¡ç®—å¹¶å°†ç»“æœè¿”å›\n\n```rust\nfn main() {\n    let x = 123; // è¯­å¥ï¼Œä¸ä¼šè¿”å›123\n    \n    let y = { // {} ä»£è¡¨è¡¨è¾¾å¼\n        let x = 124; // è¯­å¥\n        x + 1 // è¡¨è¾¾å¼\n    }; // y = 125\n}\n```\n\n### å‡½æ•°è¿”å›å€¼\n\nä½¿ç”¨`->`æ¥æ³¨æ˜å‡½æ•°è¿”å›å€¼ç±»å‹ï¼›\n\nè¿”å›å¯ä»¥ä½¿ç”¨`return`å…³é”®å­—ï¼›é€šå¸¸ï¼Œå‡½æ•°ä¼šéšå«åœ°å°†æœ€åä¸€ä¸ªè¡¨è¾¾å¼ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ã€‚\n\n## æ³¨é‡Š\n\nå•è¡Œæ³¨é‡Šï¼š`//`\n\næ–‡æ¡£æ³¨é‡Šï¼š `///`ï¼šæ–‡æ¡£æ³¨é‡Šæ”¯æŒ`markdown`è¯­æ³•ï¼Œç”¨æ¥æ³¨é‡ŠæŸä¸ªå‡½æ•°ã€‚å½“ä½¿ç”¨`cargo doc`å‘½ä»¤æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆ`HTMlæ–‡ä»¶`\n\n## æ§åˆ¶æµ\n\nä¸ç»å¤§æ•°è¯­è¨€ä¸€æ ·ï¼Œ`Rust`ä¹Ÿæä¾›äº†æ¡ä»¶åˆ¤æ–­ï¼ˆifï¼‰å’Œå¾ªç¯ï¼ˆloopï¼‰æ¥å®ç°ç¨‹åºæµçš„æ§åˆ¶ã€‚\n\n### ifè¡¨è¾¾å¼\n\n```rust\nfn main() {\n    let number = 3;\n    if number < 2 {\n        println!(\"less than 2\");\n    } else if number == 2 {\n        println!(\"equal to 2\");\n    } else {\n        println!(\"greater than 2\");\n    }\n}\n```\n\næ³¨æ„ï¼šif åå¿…é¡»å€Ÿä¸€ä¸ª è¿”å›`bool`ç±»å‹çš„è¡¨è¾¾å¼ï¼Œä¸æƒ³`JavaScript`ä¼šè‡ªåŠ¨åšç±»å‹è½¬æ¢ã€‚\n\n### letè¯­å¥å’Œif\n\n```rust\nfn main() {\n    let condition = 3 > 2;\n    let number = if condition { 10 } else { 20 }; // 10\n}\n```\n\nèŠ±æ‹¬å·`{}`ä¸­æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œæœ€ç»ˆå°±è¿”å›è¿™ä¸ªè¡¨è¾¾å¼çš„å€¼\n\næ¡ä»¶åˆ†æ”¯è¡¨è¾¾å¼çš„å€¼çš„ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œä¸Šä¾‹éƒ½æ˜¯é»˜è®¤çš„`i32`\n\n### å¾ªç¯Loops\n\n`Rust`ä¸­æä¾›äº†å¤šç§å¾ªç¯æ–¹å¼ï¼Œæœ‰`loop`ã€`while`ä»¥åŠ`for`\n\n#### loop\n\n```rust\nfn main() {\n    let mut times = 1;\n    loop {\n        println!(\"loop times: {}\", times);\n        times += 1;\n        if times > 10 {\n            break;\n        }\n    }\n}\n```\n\n`loop`åªæœ‰é‡åˆ°`break`è¯­å¥æ‰ä¼šæ¨å‡ºå¾ªç¯\n\n#### loopè¿”å›å€¼\n\nåœ¨`break`åæ·»åŠ ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¼šå°†è¡¨è¾¾å¼çš„å€¼è¿”å›\n\n```rust\nfn main() {\n    let mut counter = 0;\n\t\n    // result æ¥å—å€¼\n    let result = loop {\n        counter += 1;\n\n        if counter == 10 {\n            break counter * 2; // è¿”å›å€¼\n        }\n    };\n\n    println!(\"The result is {}\", result); // 20\n}\n```\n\n#### While\n\nå½“å¾ªç¯å–å†³äºä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼æ—¶å¯ä»¥ä½¿ç”¨`while`\n\n```rust\nfn main() {\n    let mut num = 0;\n    while num < 5 {\n        println!(\"num is {}\", num);\n        \n        num += 1;\n    }\n}\n```\n\n#### for\n\nå½“éå†æŸä¸ªé›†åˆæ—¶å¯ä»¥ä½¿ç”¨`for`\n\n```rust\nfn main() {\n    let arr = [1, 2, 3, 4];\n    for ele in arr.iter() {\n        println!(\"current is {}\", ele);\n    }\n}\n```\n\nå½“å·²çŸ¥èŒƒå›´æ—¶å¯ä»¥ä½¿ç”¨`for`\n\n```rust\nfn main() {\n    for num in (1..10).rev() {\n        println!(\"{}!\", num);\n    }\n}\n```\n\n`(1..10)`è¡¨ç¤ºä¸€ä¸ªèŒƒå›´`[1, 9]`\n\n`rev()`è¡¨ç¤º`reverse`\n\n## ç»ƒä¹ \n\n### è½¬æ¢æ‘„æ°åº¦å’Œåæ°åº¦\n\n```rust\nfn main() {\n    let temp_f = to_fahrenheit(37.0);\n    let temp_c = to_celsius(98.6);\n\n    println!(\"{}c equal to {}f\", temp_c, temp_f);\n}\n\n// è½¬æ¢æˆåæ°åº¦\nfn to_fahrenheit(temp: f32) -> f32 {\n    32.0 + temp * 1.8\n}\n\n// è½¬æ¢æˆæ‘„æ°åº¦\nfn to_celsius(temp: f32) -> f32 {\n    (temp - 32.0) / 1.8\n}\n```\n\n### ç”Ÿæˆç¬¬nä¸ªæ–æ³¢é‚£å¥‘æ•°\n\n```rust\nfn main() {\n    let tenth = get_nth_fibonacci(10);\n    println!(\"The tenth is {}\", tenth);\n}\n\nfn get_nth_fibonacci(n: u32) -> u32 {\n    let result = if n == 1 {\n        0\n    } else if n == 2 {\n        1\n    } else {\n        get_nth_fibonacci(n - 1) + get_nth_fibonacci(n - 2)\n    };\n    result\n}\n```\n\n","tags":["Rust","è¯­è¨€å­¦ä¹ "],"categories":["Rust"]},{"title":"Rustå­¦ä¹ ç¬”è®°-ç¯å¢ƒæ­å»º","url":"/posts/85fd164e.html","content":"\næœ¬ç³»åˆ—æ–‡ç« æ˜¯ç¬”è€…å­¦ä¹ `Rust`æ—¶æ‰€åšçš„ç¬”è®°ï¼Œä¾›æ—¥åç¿»é˜…å¤ä¹ ã€‚\n\n## å®‰è£…\n\n`rustup`ä»¥ç”¨æ¥è¿›è¡Œ`Rust`ç‰ˆæœ¬ç®¡ç†çš„å‘½ä»¤è¡Œå·¥å…·ã€‚\n\n### MacOS && Linux\n\n```shell\n$ curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSf | sh\n```\n\nè¯¥å‘½ä»¤æ˜¯ç”¨æ¥ä¸‹è½½ä¸€ä¸ªè„šæœ¬ç„¶åå¼€å§‹å®‰è£…`rustup`å·¥å…·\n\n### Windows\n\nå‰å¾€[Rustå®˜ç½‘](https://www.rust-lang.org/tools/install)ä¸‹è½½`exe`å®‰è£…åŒ…\n\nå®‰è£…è¿‡ç¨‹ä¼šæç¤ºéœ€è¦`C++ build tools`ã€‚æ¯”è¾ƒç®€å•çš„åŠæ³•æ˜¯å®‰è£…[`virtual studio`](https://visualstudio.microsoft.com/zh-hans/downloads/)ã€‚å·¥ä½œè´Ÿè½½ä¸­é€‰æ‹©`C++æ¡Œé¢å¼€å‘`ã€‚\n\n### rustupå¸¸ç”¨å‘½ä»¤\n\n| å‘½ä»¤        | å‘½ä»¤                                                  | å¤‡æ³¨                                           |\n| ----------- | ----------------------------------------------------- | ---------------------------------------------- |\n| `show`      | `rustup show`                                         | æ˜¾ç¤ºå·²å®‰è£…çš„å·¥å…·                               |\n| `update`    | `rustup update`<br />`rustup  self  update`           | æ›´æ–°`rust`å·¥å…·ä»¥åŠ`rustup`<br />åªæ›´æ–°`rustup` |\n| `check`     | `rustup check`                                        | æ£€æŸ¥`rust`å·¥å…·æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬                     |\n| `default`   | `rustup default stable`<br />`rustup default nightly` | åˆ‡æ¢ç‰ˆæœ¬                                       |\n| `install`   | `rustup install nightly`                              | å®‰è£…`rust`å·¥å…·                                 |\n| `uninstall` | `rustup uninstall`<br />`rustup self uninstall`       | åˆ é™¤`rust`å·¥å…·<br />åˆ é™¤`rust`å·¥å…·å’Œ`rustup`   |\n| `doc`       | `rustup doc`                                          | æŸ¥çœ‹æ–‡æ¡£ï¼ˆå¯ä»¥ç¦»çº¿ä½¿ç”¨ï¼‰                       |\n\n## Hello World\n\nåˆ›å»º`main.rs`ï¼Œç¼–å†™ä»£ç \n\n```rust\nfn main() {\n    println!(\"Hello, World\")\n}\n```\n\næ‰§è¡Œä»£ç ï¼š\n\n1. ç¼–è¯‘ï¼šæ‰§è¡Œ`rustc main.rs`ï¼Œä¼šç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶\n2. æ‰§è¡Œï¼š`./main` or `./main.exe`(win)\n3. ç»“æœï¼šå‘½ä»¤è¡Œæ˜¾ç¤º`Hello,World`\n\n## Cargo\n\n`cargo`æ˜¯`Rust`çš„é¡¹ç›®ç®¡ç†å™¨ï¼Œæä¾›äº†ä¸€é”®åˆ›å»ºã€è¿è¡Œä»¥åŠbuild`Rust`é¡¹ç›®çš„å‘½ä»¤ï¼š\n\n1. `cargo new my_project`: åˆ›å»ºé¡¹ç›®\n\n2. `cargo build`: buildæ“ä½œï¼Œåœ¨`/target/debug/`ç›®å½•ä¸‹åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶\n\n3. `cargo run`: buildç„¶årun\n\n4. `cargo check`ï¼šæ£€æŸ¥codeæ˜¯å¦èƒ½å¤Ÿé€šè¿‡ç¼–è¯‘ï¼Œä¸ä¼šåˆ›å»ºåˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶\n\n5. `cargo build --release`: buildæ“ä½œï¼Œä¼šé¢å¤–åšä¼˜åŒ–ä»¥åŠ å¿«ç¨‹åºè¿è¡Œé€Ÿåº¦ï¼Œåœ¨å‘å¸ƒreleaseç‰ˆæœ¬æ—¶ä½¿ç”¨\n\n","tags":["Rust","è¯­è¨€å­¦ä¹ "],"categories":["Rust"]},{"title":"Web Animation API","url":"/posts/af0be6b0.html","content":"\n## Web Animation API\n\nä»¥å‰ï¼Œåœ¨webé¡µé¢å¢åŠ åŠ¨ç”»æ•ˆæœéƒ½æ˜¯é€šè¿‡cssæ¥å®Œæˆçš„ã€‚æ¯”å¦‚`transition`æˆ–è€…`animation`ã€‚æœ‰äº†Web Animation APIå°±å¯ä»¥é€šè¿‡`javascript`æ¥è®¾ç½®ä»¥åŠæ§åˆ¶åŠ¨ç”»ã€‚\n\n### CSSå®ç°åŠ¨ç”»\n\né€šè¿‡csså®ç°ä¸€ä¸ªç®€å•çš„åŠ¨ç”»ï¼Œè®©boxæ—‹è½¬ç§»åŠ¨ï¼Œä»£ç å¦‚ä¸‹ï¼š\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <title>Document</title>\n    <style>\n      .box {\n        width: 100px;\n        height: 100px;\n        background-color: red;\n        animation: move 2s ease-in-out;\n        position: fixed;\n      }\n      @keyframes move {\n        from {\n          transform: rotate(0);\n          left: 0;\n          top: 0;\n        }\n        to {\n          transform: rotate(1turn);\n          left: 80%;\n          top: 80%;\n        }\n      }\n    </style>\n  </head>\n  <body>\n    <div class=\"box\"></div>\n  </body>\n</html>\n\n```\n\n### Javascriptå®ç°åŠ¨ç”»\n\nå°†ä¸Šé¢ä¾‹å­æ”¹æˆJavaScriptï¼Œä»£ç å¦‚ä¸‹\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <title>Document</title>\n    <style>\n      .box {\n        width: 100px;\n        height: 100px;\n        background-color: red;\n        position: fixed;\n      }\n    </style>\n  </head>\n  <body>\n    <div class=\"box\"></div>\n\n    <script>\n      // è·å–dom\n      const ele = document.querySelector(\".box\");\n\t  \n      // è®¾ç½®keyframes\n      const keyframes = [\n        {\n          transform: \"rotate(0)\",\n          left: 0,\n          top: 0,\n        },\n        {\n          transform: \"rotate(1turn)\",\n          left: \"80%\",\n          top: \"80%\",\n        },\n      ];\n      \n      // è®¾ç½®åŠ¨ç”»ï¼Œanimateå‡½æ•°è¿”å›ä¸€ä¸ªAnimationå¯¹è±¡\n      const animation = ele.animate(keyframes, {\n        easing: \"ease-in-out\",\n        duration: 2000, // millisecond\n      });\n      \n      // å¯ä»¥ç›‘å¬æ—¶é—´\n      animation.addEventListener(\"cancel\", () => {\n        console.log(\"cancel\");\n      });\n      animation.addEventListener(\"finish\", () => {\n        console.log(\"finish\");\n      });\n      animation.addEventListener(\"remove\", () => {\n        console.log(\"remove\");\n      });\n      \n      // å–æ¶ˆ\n      // animation.cancel()\n        \n      // æ’­æ”¾\n      // animation.play()\n    </script>\n  </body>\n</html>\n\n```\n\nä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ã€‚ç›´æ¥è°ƒç”¨`animate`æ–¹æ³•å³å¯ã€‚\n\n### å¯¹æ¯”\n\nweb animation apiæ¯”ä¼ ç»Ÿçš„css animationæ–¹æ¡ˆä¼˜ç§€ä¸å°‘ï¼Œèƒ½å¤Ÿæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚\n\n1. å‰è€…æ›´åŠ çµæ´»ï¼Œjavascriptçµæ´»åº¦å¤§äºcss\n2. å‰è€…èƒ½å¤Ÿæ§åˆ¶åŠ¨ç”»ï¼Œè¯¸å¦‚ï¼šæš‚åœã€æ’­æ”¾ç­‰\n3. å‰è€…èƒ½å¤Ÿç›‘å¬åŠ¨ç”»çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œä¾‹å¦‚ï¼šfinishã€cancel\n4. å‰è€…å…¼å®¹æ€§ä¸è¶³ï¼Œieä»¥åŠä¸€äº›ç§»åŠ¨ç«¯ä¸æ”¯æŒã€‚ä½†æ˜¯æœ‰[polyfill](https://github.com/web-animations/web-animations-js)å•Šï¼\n\n## Animation APIä»‹ç»\n\nè°ƒç”¨`animate`æ–¹æ³•åä¼šè¿”å›ä¸€ä¸ª`Animation`å¯¹è±¡ã€‚é€šè¿‡è¿™ä¸ªå¯¹è±¡èƒ½å¤Ÿå®ç°æ§åˆ¶åŠ¨ç”»ä»¥åŠç›‘å¬åŠ¨ç”»çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚\n\n### äº‹ä»¶\n\n| event    | type     | comment                                        |\n| -------- | -------- | ---------------------------------------------- |\n| oncancel | function | animation.cancel()è°ƒç”¨åè§¦å‘                   |\n| onfinish | function | åŠ¨ç”»æ’­æ”¾ç»“æŸåæˆ–è€…animation.finish()è°ƒç”¨åè§¦å‘ |\n\n### å±æ€§\n\n| name        | type                                                      | comment                                                      |\n| ----------- | --------------------------------------------------------- | ------------------------------------------------------------ |\n| currentTime | number                                                    | åŠ¨ç”»æ‰§è¡Œçš„å½“å‰æ—¶é—´ï¼ˆmsï¼‰                                     |\n| playState   | 'idle' \\| 'pending' \\| 'runing' \\| 'paused' \\| 'finished' | ä¸€ä¸ªç”¨æ¥æ ‡è¯†æ’­æ”¾çŠ¶æ€çš„æšä¸¾å€¼<br />idle:ã€€åŠ¨ç”»å½“å‰çš„æ—¶é—´æ˜¯æ— æ³•è§£æçš„ï¼Œå¹¶ä¸”é˜Ÿåˆ—é‡Œæ²¡æœ‰å¤„äºç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚<br />pending:ã€€åŠ¨ç”»å°†ä¸€ç›´ç­‰åˆ°æŸäº›ç­‰å¾…ä¸­çš„ä»»åŠ¡å®Œæˆæ–¹ä¼šæ‰§è¡Œã€‚<br />runningï¼šåŠ¨ç”»å¤„äºæ­£åœ¨è¿è¡ŒçŠ¶æ€ã€‚<br />pausedï¼šåŠ¨ç”»ä¸­æ­¢ï¼Œå¹¶ä¸”[`Animation.currentTime`](https://developer.mozilla.org/zh-CN/docs/Web/API/Animation/currentTime)è¯¥é¡¹å±æ€§ä¸ä¼šæ›´æ–°ã€‚<br />finished:åŠ¨ç”»å·²ç»è¾¾åˆ°æŸä¸€ä¸´ç•Œç‚¹ï¼Œå¹¶ä¸”[`Animation.currentTime`](https://developer.mozilla.org/zh-CN/docs/Web/API/Animation/currentTime)è¯¥é¡¹å±æ€§ä¸ä¼šæ›´æ–°ã€‚ |\n\n### æ–¹æ³•\n\n| name    | type       | comment                                                      |\n| ------- | ---------- | ------------------------------------------------------------ |\n| cancel  | () => void | æ¸…é™¤æ­¤åŠ¨ç”»çš„æ‰€æœ‰[`keyframeEffects`](https://developer.mozilla.org/zh-CN/docs/Web/API/KeyframeEffect)ï¼Œå¹¶ä¸­æ­¢æ’­æ”¾ã€‚ |\n| finish  | () => void | ç«‹å³å®Œæˆï¼Œæ•ˆæœåŒä¸­æ­¢æ’­æ”¾ï¼ˆè§¦å‘äº‹ä»¶ä¸ä¸€æ ·ï¼‰ã€‚                 |\n| pause   | () => void | æš‚åœæ’­æ”¾åŠ¨ç”»                                                 |\n| play    | () => void | å¼€å§‹æˆ–æ¢å¤æ’­æ”¾åŠ¨ç”»ï¼Œæˆ–è€…å¦‚æœä¹‹å‰å®Œæˆï¼Œåˆ™é‡æ–°å¼€å§‹åŠ¨ç”»ã€‚       |\n| reverse | () => void | åè½¬æ’­æ”¾åŠ¨ç”»ï¼Œç›´åˆ°æ’­æ”¾åˆ°åŠ¨ç”»å¼€å§‹æ—¶åœæ­¢ã€‚ å¦‚æœåŠ¨ç”»å®Œæˆæˆ–æœªæ’­æ”¾ï¼Œå®ƒå°†ä»å¤´åˆ°å°¾æ’­æ”¾ã€‚ |\n\næ›´è¯¦ç»†çš„APIä»‹ç»è¯·å‚è€ƒ[MDN](https://developer.mozilla.org/en-US/docs/Web/API/Animation)\n\n","tags":["javascript","animation"],"categories":["JavaScript"]},{"title":"Electron-å®‰å…¨","url":"/posts/b81ed83c.html","content":"\n## XSSè¿›åŒ–åˆ°RCE\n\nWebçš„XSSæ”»å‡»èƒ½åšåˆ°è„šæœ¬æ³¨å…¥ï¼Œè€ŒElectronå…·æœ‰åŸç”Ÿèƒ½åŠ›å¯ä»¥è°ƒç”¨nodejsçš„æ¨¡å—ã€‚è¿™å°±å¯¼è‡´è¿›åŒ–æˆäº†RCEæ”»å‡»(Remote code excute)\n\n```html\n<img onerror=\"require('fs');fs.readFile('./data.json')\"/>\n```\n\nè§£å†³ï¼š\n\n1. åŸºæœ¬çš„XSSé˜²èŒƒæªæ–½\n2. ç®¡ç†nodeæƒé™\n   1. ä¸»è¿›ç¨‹ä»»ä½•æ—¶å€™éƒ½å…è®¸\n   2. æ¸²æŸ“è¿›ç¨‹åŠ è½½æœ¬åœ°èµ„æºæ˜¯å…è®¸\n   3. æ¸²æŸ“è¿›ç¨‹åŠ è½½è¿œç¨‹èµ„æºæ—¶ä¸å…è®¸ï¼Œä½†å¯ä»¥åœ¨preloadä¸­ä½¿ç”¨\n3. é™åˆ¶é“¾æ¥è·³è½¬\n   1. httpså¯ä¿¡åŸŸå…è®¸\n   2. åº”ç”¨æœ¬åœ°åè®®å…è®¸\n   3. fileåè®®ä¸å…è®¸\n\n## cookieå…‹éš†æ”»å‡»\n\nå°†cookieæ–‡ä»¶æ‹·è´åˆ°å…¶å®ƒæœºå™¨ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨\n\nåŸå› ï¼šElectron cookieæ²¡æœ‰æƒ³Chromeé‚£æ ·åŠ å¯†\n\nè§£å†³ï¼š\n\nç”Ÿæˆè®¾å¤‡æŒ‡çº¹ï¼Œå°†cookieä¸è®¾å¤‡æŒ‡çº¹ç»‘å®š\n\n## æºç å®‰å…¨\n\nElectronæ‰“åŒ…å¯ä»¥è®¾ç½®asarï¼Œä½†æ˜¯asaræ˜¯å¯ä»¥è§£å¯†çš„ã€‚\n\n`npm i asar -g`ã€`asar e app.asar unpack`ã€`cd unpack`\n\nè§£å†³ï¼š\n\n1. UIä¸é€»è¾‘åˆ†ç¦»ï¼šUIå±‚ä½¿ç”¨Electronï¼Œé€»è¾‘å±‚ä½¿ç”¨C++æˆ–Rustã€‚é€šè¿‡`N-API`ã€`Neon`è¿æ¥nodejs\n2. WebAssembly\n3. ä»£ç æ··æ·†ï¼Œä½¿ç”¨æ„å»ºå·¥å…·è¿›è¡Œä»£ç æ··æ·†\n4. asarï¼šé˜²æ­¢å°ç™½\n5. [asar Hack](https://www.v2ex.com/t/493344)\n\n## å®‰å…¨äº‹é¡¹\n\nappå±‚\n\n- åšå¥½Webå®‰å…¨\n- [å®˜æ–¹ å®‰å…¨Checklist](https://www.electronjs.org/docs/tutorial/security)ï¼Œ[æ–‡æ¡£]( https://www.electronjs.org/docs/tutorial/security#checklist-securityrecommendations)\n- ä»£ç æ··æ·†\n\nnpm\n\n- nsp/snykï¼Œæ£€æµ‹npmåŒ…çš„å®‰å…¨æ€§\n- å…³æ³¨npmå®˜åš[å®‰å…¨æ–‡ç« ](https://blog.npmjs.org/tagged/security)\n- nodejså®‰å…¨å°ç»„ [Node.js Security WG](https://github.com/nodejs/security-wg)\n\nelectron\n\n- å‡çº§Electronè‡³æœ€æ–°\n- æœ‰é—®é¢˜åé¦ˆsecurity@electronjs.org\n- å°è¯•ç ”ç©¶electronæ„å»ºï¼Œå…·å¤‡é¡¹ç›®åº”æ€¥èƒ½åŠ›\n\n","tags":["javascript","Electron","æ¡Œé¢ç«¯è½¯ä»¶"],"categories":["Electron"]},{"title":"Electron-æµ‹è¯•","url":"/posts/bc68d7e0.html","content":"\n## æµ‹è¯•é‡‘å­—å¡”\n\n![æµ‹è¯•é‡‘å­—å¡”](../../images/æµ‹è¯•é‡‘å­—å¡”.png)\n\nå‰ç«¯è½¯ä»¶æµ‹è¯•å¯ä»¥åˆ†ä¸ºä¸‰æ­¥\n\n### å•å…ƒæµ‹è¯•ï¼ˆ`Unit Test`ï¼‰\n\nå•å…ƒæµ‹è¯•æ˜¯ç”¨æ¥å¯¹ä¸€ä¸ªæ¨¡å—ã€ä¸€ä¸ªå‡½æ•°ã€ä¸€ä¸ªç»„ä»¶æˆ–è€…ä¸€ä¸ªç±»æ¥è¿›è¡Œæ­£ç¡®æ€§æ£€éªŒçš„æµ‹è¯•å·¥ä½œã€‚\n\nå•å…ƒæµ‹è¯•åº”è¯¥æ˜¯æœ€å¤šçš„ï¼Œè€Œä¸”å¿«ã€‚\n\nå•å…ƒæµ‹è¯•é¢—ç²’æ›´ç»†ï¼Œæ›´åŠ å…·ä½“ã€‚æµ‹è¯•å¤±è´¥è¦è¿”å›é”™è¯¯åŸå› \n\n### å¿«ç…§æµ‹è¯•ï¼ˆ`snapshot Test`ï¼‰\n\nå¿«ç…§æµ‹è¯•å°±æ˜¯è¿è¡Œæµ‹è¯•çš„æ—¶å€™ï¼ŒæŠŠç»“æœä¿å­˜ä¸€ä»½ï¼Œä¹‹åå†æ¥å¯¹æ¯”ï¼Œæ¯”å¯¹ä¸ä¸Šæµ‹è¯•å°±ä¸é€šè¿‡ã€‚\n\n### ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆ`E2E Test`ï¼‰\n\nç«¯åˆ°ç«¯æµ‹è¯•æ—¶æ¨¡æ‹Ÿç”¨æˆ·çš„æ•´ä¸ªäº¤äº’è¿‡ç¨‹ã€‚æ¯”å¦‚ï¼šç‚¹å‡»æŒ‰é’® => æ˜¾ç¤ºè¡¨å• => å¡«å†™æ•°æ® => ç‚¹å‡»æäº¤æŒ‰é’® => éªŒè¯æ•°æ®å‘é€ã€‚ \n\n## Electron æµ‹è¯•\n\n### å¤„ç†Electroné©±åŠ¨\n\nå¯ä»¥ä½¿ç”¨å®˜æ–¹æä¾›çš„`spectron`ï¼›ä¹Ÿå¯ä»¥[è‡ªå®šä¹‰é©±åŠ¨](https://www.electronjs.org/docs/tutorial/automated-testing-with-a-custom-driver)\n\n### é€‰æ‹©æµ‹è¯•æ¡†æ¶+å·¥å…·\n\n1. ava\n2. mocha+chai\n3. jest\n4. ...\n\n### ç®¡ç†æµ‹è¯•ç”¨ä¾‹\n\né€šå¸¸åœ¨é¡¹ç›®å»ºç«‹ä¸€ä¸ª`test`ç›®å½•ï¼Œä¸“é—¨å­˜æ”¾æµ‹è¯•ç”¨ä¾‹ã€‚\n\næŒ‰æ¨¡å—ã€åŠŸèƒ½åˆ†å¥½ç±»\n\n### åˆ›å»ºæµ‹è¯•è„šæœ¬\n\nåœ¨`package.json`åŠ å…¥`test`å‘½ä»¤ï¼Œç¼–å†™è‡ªå®šä¹‰è„šæœ¬ï¼Œtestå‘½ä»¤å»æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚\n\nè„šæœ¬ä¸»è¦ç”¨æ¥æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹\n\n## è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹\n\n### æµ‹è¯•å‡†å¤‡\n\næ•°æ®mockã€å‡†å¤‡ä¸Šä¸‹æ–‡ã€‚\n\n### æµ‹è¯•ç”¨ä¾‹æè¿°\n\nç”¨æ¥è¯´æ˜è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„\n\n### è¡Œä¸º\n\nè¦åšä»€ä¹ˆäº‹\n\n### æ–­è¨€\n\nå¾—åˆ°ä»€ä¹ˆç»“æœ\n\n### æµ‹è¯•åå¤„ç†\n\næ¸…ç†mockçš„æ•°æ®ï¼Œæ¸…ç†ä¸Šä¸‹æ–‡\n\n## Electronæµ‹è¯•ç¼–ç \n\n```javascript\nconst Application = require('spectron').Application\nconst electronPath = require('electron')\nconst path = require('path')\n\n// jest æµ‹è¯•å·¥å…·\ndescribe('Application lanuch', () => {\n    let app\n\tbeforeEach(() => {\n        app = new Application({\n            path: electronPath\n            args: [path.join(__dirname, '../')]\n        })\n    \treturn app.start()\n\t});\n    afterEach(() => {\n        if(app && app.isRunning()) return app.stop()\n    });\n\n\ttest('Check if the window is visible', () => {\n        expect(app.browserWindow.isVisible()).toBeTruthy()\n    });\n\n\ttest('Get the window\\'s title', () => {\n        expect(app.client.getTitle()).toBe('My App')\n    })\n})\n\n```\n\n","tags":["javascript","Electron","æ¡Œé¢ç«¯è½¯ä»¶"],"categories":["Electron"]},{"title":"Electron-é›†æˆåŸç”Ÿèƒ½åŠ›","url":"/posts/72ce1ec4.html","content":"\n## NAPI\n\nN-APIæ˜¯nodejsçš„ä¸€éƒ¨åˆ†ï¼Œç‹¬ç«‹äºv8 runtimeï¼Œç”¨æ¥åœ¨nodejsä¸­é›†æˆC++ï¼šåŒä¸€ABIï¼ˆApplication Binary Interfaceï¼‰ã€æ— éœ€é‡æ–°ç¼–è¯‘\n\n- æœ¬èº«æ˜¯åŸºäºCçš„API\n- C++å°è£… node-addon-api\n\n### ç¯å¢ƒé…ç½®\n\n`yarn global add windows-build-tools` : ç®¡ç†å‘˜èº«ä»½å®‰è£…\n\n`yarn global add node-gyp`:  gypå³generate your project\n\n### åˆå§‹åŒ–é¡¹ç›®\n\n1. åˆå§‹åŒ–ï¼š\n   1. `npm init -y`\n   2. `yarn add bindings node-addon-api -D`\n   3. `package.json`å¢åŠ `\"gyp\":true`\n2. ç›®å½•ç»“æ„\n```\n|- project\n|\t|- lib # c++æ–‡ä»¶\n|   |- fingerprint.cc\n|   |- binding.gyp\n|   |- index.js\n|   |- package.json\n```\n\n### binding.gyp\n\n`bindings`ç”¨æ¥åŠ è½½åŸç”Ÿæ¨¡å—(.nodeæ–‡ä»¶)ã€‚ä¸åŒå¹³å°ä¸åŒç‰ˆæœ¬rebuildå‡ºæ¥çš„ç›®å½•ç»“æ„å¯èƒ½ä¸ä¸€æ ·ã€‚é€šè¿‡`bindings`æ¥æŠ¹å¹³å·®å¼‚ã€‚\n\nç¼–å†™`binding.gyp`\n\n```json\n{\n\t\"targets\": [\n      {\n        \"target_name\": \"fingerprint\",  // åº”ç”¨åç§°\n        \"cflags!\": [\"-fno-exceptions\"],\n        \"cflags_cc!\": [\"-fno-exceptions\"],\n        \"sources\": [\"fingerprint.cc\"],  // éœ€è¦ç¼–è¯‘çš„æ–‡ä»¶\n        \"include_dirs\": [ // ç¼–è¯‘æ—¶éœ€è¦å¼•å…¥çš„å¤´æ–‡ä»¶\n          \"<!@(node -p \\\"require('node-addon-api').include\\\")\"\n        ],\n        \"defines\": [\"NAPI_DISABLE_CPP_EXCEPTIONS\"]\n    }\n  ]\n}\n```\n\n### C++å®ç°\n\n```c++\n// fingerprint.cc\n#include <napi.h>\n#include <iostream>\n#include <string>\n#include <stdlib.h>\n\nstd::string getFingerprint()\n{\n    srand(100);\n    std::string result = std::to_string(rand());\n    return result;\n}\n\n// å®šä¹‰ä¸€ä¸ªmethodï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªè®¾å¤‡æŒ‡çº¹ï¼ˆéšæœºæ•°mockï¼‰\nNapi::String Method(const Napi::CallbackInfo &info)\n{\n    Napi::Env env = info.Env();\n    std::string fingerprint = getFingerprint();\n    return Napi::String::New(env, fingerprint);\n}\n\n// åˆå§‹åŒ–\n// ç›¸å½“äº module.exports = Method\nNapi::Object Init(Napi::Env env, Napi::Object exports)\n{\n    exports.Set(Napi::String::New(env, \"getFingerprint\"),\n                Napi::Function::New(env, Method));\n    return exports;\n}\n\n// æš´éœ²æ¨¡å—\n// æ¨¡å—å fingerprintï¼ŒInitè¿›è¡Œåˆå§‹åŒ–\nNODE_API_MODULE(fingerprint, Init)\n```\n\n### æ„å»º\n\nä½¿ç”¨`node-gyp rebuild`è¿›è¡Œæ„å»ºï¼Œåœ¨æ ¹ç›®å½•ä¸­ä¼šç”Ÿæˆ`build`ç›®å½•ã€‚\n\nç„¶åç¼–å†™index.jsï¼Œæ¥å¯¼å‡ºæ¨¡å—\n\n```javascript\nconst fingerprint = require(\"bindings\")(\"fingerprint\");\n\nmodule.exports = fingerprint;\n```\n\n### ä½¿ç”¨\n\né€šå¸¸åšæ³•æ˜¯ï¼Œå°†å†™å¥½çš„node addonå‘å¸ƒåˆ°npmä¸Šã€‚åœ¨å…¶å®ƒé¡¹ç›®ä¸­å°±å¯ä»¥é€šè¿‡`npm`æˆ–è€…`yarn`å®‰è£…ï¼Œç„¶åå°±`require`ä½¿ç”¨\n\n```javascript\nconst fp = require(\"fingerprint\"); // fingerprintæ˜¯npmåŒ…å\n\nconsole.log(fp.getFingerprint());\n```\n\n## é›†æˆDLLï¼ˆåŠ¨æ€é“¾æ¥åº“ï¼‰ \n\n`node-ffi-napi`ï¼Œé»‘ç›’è°ƒç”¨\n\n```javascript\nconst FFI = require('ffi-napi')\n\nconst user32 = new FFI.libraray('user32', {\n    'finDWindowA': ['int32', ['string', 'string']],\n    'ShowWindow': ['int32', ['int32', 'int32']],\n})\n\nfunction showWechat() {\n    let res = user32.FindWindowA('weChatMainWinForPC', null)\n    let show = user32.showWindow(res, 5)\n}\n\nmodule.exports = showWechat\n```\n\nå¸¸è§é”™è¯¯ï¼š\n\nDynamic Linking Error: Win32 error 126\n\n- dll è·¯å¾„æ²¡å†™å¯¹ã€arch æ²¡é€‰å¯¹ã€dll å¼•ç”¨æœ‰é—®é¢˜\n\nDynamic Linking Error: Win32 error 127\n\n- ä¼ å‚æœ‰é—®é¢˜ã€dll æ²¡æœ‰è¿™ä¸ªå‡½æ•°\n\n## AppleScript\n\nmacä¸Šï¼Œè¿˜å¯ä»¥é€šè¿‡`AppleScript`ä½¿ç”¨è·å¾—åŸç”Ÿèƒ½åŠ›\n\n[AppleScriptè¯­æ³•æ–‡æ¡£](https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/introduction/ASLR_intro.html)\n\n[node-applescript](https://github.com/TooTallNate/node-applescript)\n\n```javascript\nconst applescript = require('applescript')\nconst script = 'tell application \"WeChat\" to activate end'\napplescript.execString(script, (err, res) => {\n    if(err) {\n        console.log(err)\n        return\n    }\n    console.log(res)\n})\n```\n\n## é›†æˆRUST\n\né€šè¿‡[Neon](https://neon-bindings.com/docs/intro)æ¥å°†RUSTç¨‹åºé›†æˆåˆ°`nodejs`ä¸­ã€‚","tags":["javascript","Electron","æ¡Œé¢ç«¯è½¯ä»¶","C++","Rust"],"categories":["Electron"]},{"title":"Electron-ä½“éªŒä¼˜åŒ–","url":"/posts/60bc3abb.html","content":"\nElectronå†…ç½®äº†`Chromium`æµè§ˆå™¨ã€‚åœ¨åŸç”Ÿä½“éªŒä¸Šï¼Œä¸€ç›´è¢«è¯Ÿç—…ã€‚åœ¨å¼€å‘Electronç¨‹åºæ—¶ï¼Œè¦æ ¼å¤–å…³æ³¨ä½“éªŒä¼˜åŒ–ã€‚\n\n## æ€§èƒ½ä¼˜åŒ–\n\n### æ ¸å¿ƒæ¨¡å—ä¼˜å…ˆåŠ è½½\n\nä¸å†åœ¨å…¥å£æ–‡ä»¶æŠŠæ‰€æœ‰å†…å®¹éƒ½åŠ è½½è¿›æ¥ï¼Œåªéœ€è¦åŠ è½½ç¨‹åºçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå…¶å®ƒéƒ¨åˆ†æŒ‰éœ€åŠ è½½\n\n```javascript\nfunction compute(a, b) {\n    const calculator = require('./calculator')\n    return calculator.complex(a, b)\n}\n\n// æ‰§è¡Œæ ¸å¿ƒå†…å®¹\n// ...\n\n// æ‰§è¡Œéæ ¸å¿ƒå†…å®¹\ncompute(0x12f2, 0xff21)\n```\n\nåœ¨`Typescript`é€šè¿‡`dynamic import`å®ç°\n\n```typescript\nasync function compute(a, b) {\n    const calculator = await import('./calculator')\n    return calculator.complex(a, b)\n}\n\n// æ‰§è¡Œæ ¸å¿ƒå†…å®¹\n// ...\n\n// æ‰§è¡Œéæ ¸å¿ƒå†…å®¹\ncompute(0x12f2, 0xff21)\n```\n\n### Webæ€§èƒ½ä¼˜åŒ–\n\næ¯•ç«Ÿæœ¬è´¨ä¸Šè¿˜æ˜¯Webï¼Œæ‰€ä»¥Webæ€§èƒ½çš„ä¼˜åŒ–æŠ€å·§éƒ½å¯ä»¥åº”ç”¨å¾—åˆ°`Electron`ã€‚å¦‚æœä½¿ç”¨`SPA`ï¼Œè¦æ ¼å¤–æ³¨æ„æ‰“åŒ…ä¼˜åŒ–ã€‚\n\n### çª—å£é¢„çƒ­ ä¸ çª—å£æ± ã€çª—å£å¸¸é©»\n\n- çª—å£é¢„çƒ­ï¼šæå‰åˆ›å»ºçª—å£ï¼ŒåŠ è½½å¿…è¦çš„èµ„æºï¼ˆä¸æ˜¾ç¤ºï¼‰ï¼Œç­‰éœ€è¦æ—¶ç›´æ¥æ˜¾ç¤ºå³å¯ã€‚è¿™æ ·çš„åšæ³•æ˜¯ä»¥ç©ºé—´æ¢æ—¶é—´ã€‚\n- çª—å£æ± ï¼šä¸è¦é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çª—å£ï¼Œå½“éœ€è¦åŠ è½½æ–°é¡µé¢æ—¶ä»å½“å‰çš„çª—å£æ± ä¸­é€‰æ‹©çª—å£\n- çª—å£å¸¸é©»ï¼šå¯¹äºä¸šåŠ¡æ— å…³çš„ã€é€šç”¨çš„çª—å£ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨**å¸¸é©»æ¨¡å¼**ï¼Œä¾‹å¦‚é€šçŸ¥ï¼Œå›¾ç‰‡æŸ¥çœ‹å™¨ã€‚è¿™äº›çª—å£ä¸€æ—¦åˆ›å»ºå°±ä¸ä¼šé‡Šæ”¾ï¼Œæ‰“å¼€æ•ˆæœä¼šæ›´å¥½ã€‚\n\n### ç½‘ç»œèµ„æºç¼“å­˜\n\nPWA\n\n### ä¸»è¿›ç¨‹ä¿æŒè½»é‡\n\n`Electron`ç¨‹åºä¸­ï¼Œä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹æœ‰ç€`Sync IPC`ï¼ˆåŒæ­¥IPCï¼‰æ“ä½œã€‚å¦‚æœä¸»è¿›ç¨‹ä¸­æœ‰å¯†é›†è®¡ç®—ï¼Œä¼šå¯¼è‡´æ¸²æŸ“è¿›ç¨‹UIé˜»å¡ã€‚\n\nå¯ä»¥ä½¿ç”¨å¤šè¿›ç¨‹ï¼Œå‚è€ƒnodeçš„[clusteræ¨¡å—](http://nodejs.cn/api/cluster.html)\n\næˆ–è€…é€šè¿‡`web worker`æ¥å®ç°å¤šçº¿ç¨‹ï¼Œä½†æ˜¯`web worker`åªèƒ½åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨ï¼Œæ‰€ä»¥**å¯¹äºå¯†é›†è®¡ç®—ï¼Œå¯ä»¥å•ç‹¬å¼€ä¸ªæ¸²æŸ“è¿›ç¨‹(å¼€å¯ä¸€ä¸ªä¸æ˜¾ç¤ºçš„çª—å£)æ¥å¤„ç†**ã€‚\n\nè¿˜æœ‰ï¼š**ä¸è¦ä½¿ç”¨remoteæ¨¡å—ï¼ä¸è¦ä½¿ç”¨remoteæ¨¡å—ï¼ä¸è¦ä½¿ç”¨remoteæ¨¡å—ï¼**ï¼Œ`remoteæ¨¡å—`æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä½¿ç”¨åŒæ­¥IPCï¼Œæ‰€ä»¥ä¹Ÿä¼šå¾ˆå®¹æ˜“é€ æˆé˜»å¡\n\n### é¢„åŠ è½½\n\n#### Electron\n\nelectronä¸­ï¼Œåœ¨åˆ›å»º`BrowserWindow`æ—¶å¯ä»¥æŒ‡å®š`preload`å­—æ®µæ¥é¢„åŠ è½½ä¸€æ®µè„šæœ¬\n\n#### Browser\n\nä½¿ç”¨`requestIdleCallback`ï¼Œè®©æµè§ˆå™¨ç©ºé—²æ—¶æ‰§è¡Œä¸€äº›ä¼˜å…ˆçº§è¾ƒä½çš„ä»»åŠ¡ã€‚\n\nå½“æµè§ˆå™¨ç©ºé—²æ—¶ï¼Œä¼šè°ƒç”¨`requestIdleCallback`æ³¨å†Œçš„å›è°ƒå‡½æ•°ï¼Œä½†æ˜¯æœ‰å¯èƒ½æµè§ˆå™¨ä¸€ç›´å¾ˆç¹å¿™æ²¡æœ‰ç©ºé—²ï¼Œè¿™æ˜¯éœ€è¦æŒ‡å®š`timeout`ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´å¼ºåˆ¶æ‰§è¡Œ\n\n```javascript\nvar handle = window.requestIdleCallback(callback[, options])\n```\n\n**callback**ï¼šå›è°ƒï¼Œå³ç©ºé—²æ—¶éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¯¥å›è°ƒå‡½æ•°æ¥æ”¶ä¸€ä¸ª`IdleDeadline`å¯¹è±¡ä½œä¸ºå…¥å‚ã€‚å…¶ä¸­`IdleDeadline`å¯¹è±¡åŒ…å«ï¼š\n\n- `didTimeout`ï¼Œå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºä»»åŠ¡æ˜¯å¦è¶…æ—¶ï¼Œç»“åˆ `timeRemaining` ä½¿ç”¨ã€‚\n- `timeRemaining()`ï¼Œè¡¨ç¤ºå½“å‰å¸§å‰©ä½™çš„æ—¶é—´ï¼Œä¹Ÿå¯ç†è§£ä¸ºç•™ç»™ä»»åŠ¡çš„æ—¶é—´è¿˜æœ‰å¤šå°‘ã€‚\n\n**options**ï¼šç›®å‰ options åªæœ‰ä¸€ä¸ªå‚æ•°\n\n- `timeout`ã€‚è¡¨ç¤ºè¶…è¿‡è¿™ä¸ªæ—¶é—´åï¼Œå¦‚æœä»»åŠ¡è¿˜æ²¡æ‰§è¡Œï¼Œåˆ™å¼ºåˆ¶æ‰§è¡Œï¼Œä¸å¿…ç­‰å¾…ç©ºé—²ã€‚\n\n### åŸç”Ÿæ¨¡å—\n\n`ndoejs`å¯ä»¥é›†æˆ`C++`ã€`RUST`ç­‰ï¼Œç”¨æ¥ä¼˜åŒ–æ€§èƒ½ï¼Œè¯¦æƒ…è§[Electron-é›†æˆåŸç”Ÿèƒ½åŠ›](https://zxffan.github.io/posts/72ce1ec4.html)\n\n## å¯åŠ¨ä¼˜åŒ–\n\n#### V8 snapshot\n\n[`atom`é€šè¿‡`v8 snapshot`ä¼˜åŒ–å¯åŠ¨æ—¶é—´](https://blog.atom.io/2017/04/18/improving-startup-time.html)\n\n`v8 snapshot`ä¼šå°†`javascript`è¾“å‡ºæˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ–‡ä»¶çš„å†…å®¹æ˜¯`javascript`ä»£ç åœ¨å†…å­˜ä¸­çš„è¡¨ç°å½¢å¼å³æ•°æ®å †\n\nè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶çš„æ‰§è¡Œé€Ÿåº¦æ—¶å¿«äº`javascript`ä»£ç çš„ã€‚\n\nåœ¨Electronä¸­å°†ä¸€äº›å¯åŠ¨æ—¶çš„æ ¸å¿ƒä»£ç è¿›è¡Œ`v8å¿«ç…§`ï¼Œè¿™æ ·å¯ä»¥èµ·åˆ°ä¼˜åŒ–å¯åŠ¨é€Ÿåº¦çš„ç›®çš„\n\n> è¯´æ˜ï¼š\n>\n> 1. `v8 snapshot`ä¸­çš„ä»£ç æ˜¯å¤„äºä¸€ä¸ªè£¸éœ²çš„v8ä¸Šä¸‹æ–‡ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´åªèƒ½ä½¿ç”¨`plain javascript`è€Œæ— æ³•è°ƒç”¨`Electron`å’Œ`nodejs`çš„APIï¼ŒAtomå›¢é˜Ÿçš„[electron-link](https://github.com/atom/electron-link)å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Š**è§„é¿**è¿™ä¸ªé—®é¢˜\n> 2. ç”Ÿæˆ`v8 snapshot`å¯ä»¥é€šè¿‡[electron-mksnapshot](https://github.com/electron/mksnapshot)æ¥å®ç°\n\n#### V8 code cache\n\n`nodjes v12`å¯¹å†…éƒ¨æ¨¡å—åšäº†`code cache`ï¼Œå¯¹å¯åŠ¨é€Ÿåº¦æå‡å¾ˆæ˜æ˜¾ã€‚\n\n## ç™½å±é—®é¢˜\n\n### ä¸ºä»€ä¹ˆä¼šæœ‰ç™½å±\n\n![Electronç”Ÿå‘½å‘¨æœŸ](../..//images/Electronç”Ÿå‘½å‘¨æœŸ.png)\n\nåœ¨`show`ï¼ˆçª—å£æ˜¾ç¤ºï¼‰åˆ°`ready-to-show`ï¼ˆé¡µé¢åŠ è½½å®Œæ¯•ï¼‰ä¹‹é—´è¿˜éœ€è¦ç»å†ä»¥ä¸‹è¿‡ç¨‹\n\n1. preloadè§£æï¼Œåˆ›å»º`BrowserWindow`è®¾ç½®çš„\n2. è§£æHTMLç»“æ„\n3. åŠ è½½å¤–éƒ¨è„šæœ¬ï¼ˆ`script`ï¼‰ä»¥åŠæ ·å¼è¡¨æ–‡ä»¶ï¼ˆ`link`ï¼‰\n4. è§£æå¹¶æ‰§è¡Œè„šæœ¬\n5. `Dom Tree`æ„å»ºå®Œæ¯•\n6. èµ„æºæ–‡ä»¶ï¼ˆå›¾ç‰‡ã€éŸ³è§†é¢‘ï¼‰åŠ è½½\n7. é¡µé¢åŠ è½½å®Œæˆ\n\nåªæœ‰å®Œæˆè¿™äº›è¿‡ç¨‹ï¼Œçª—å£æ‰èƒ½æ˜¾ç¤ºå†…å®¹ã€‚æ‰€ä»¥è¿™æ®µæ—¶é—´çª—å£ä¼šä¸€ç›´ç™½å±ã€‚å¦‚æœä½¿ç”¨`vue`æˆ–`react`è¿™ç§`SPA`æ¡†æ¶ï¼Œä¹Ÿä¼šå‡ºç°é¦–å±åŠ è½½è¿‡æ…¢çš„æƒ…å†µã€‚\n\n### è§£å†³æ–¹æ³•ä¸€â€”â€”ä¸æ˜¾ç¤ºçª—å£\n\nåˆ›å»º`BrowserWindow`æ—¶ï¼Œè®¾ç½®`show:false`å³ä¸æ˜¾ç¤ºçª—å£\n\nç­‰åˆ°`ready-to-show`äº‹ä»¶è§¦å‘æ—¶æ‰æ˜¾ç¤º\n\n```javascript\nconst win = new BrowserWindow({\n    widht: 600,\n    height: 300,\n    show: false\n})\n\nwin.on('ready-to-show', () => {\n    win.show()\n})\n```\n\n### è§£å†³æ–¹æ³•äºŒâ€”â€”éª¨æ¶å±\n\næœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ç›´æ¥ç»™çª—å£æ˜¾ç¤ºä¸ªåº•è‰²\n\n```javascript\nconst win = new BrowserWindow({\n    widht: 600,\n    height: 300,\n    show: false,\n    background: '#2e2c29'\n})\n```\n\næ¯”è¾ƒå¥½çš„æ–¹æ³•å°±æ˜¯ä¸“é—¨è®¾è®¡ä¸€å¥—éª¨æ¶å±ã€‚åˆ©ç”¨`BroswerView`æ¥æ˜¾ç¤ºéª¨æ¶å±ã€‚\n\nå½“çª—å£åˆ›å»ºæ—¶ï¼Œåˆ›å»º`BrowserView`æ¥åŠ è½½éª¨æ¶å±é¡µé¢ï¼Œå°†`BrowserView`è®¾ç½®åˆ°`BrowserWindow`ä¸Šå¹¶é®ç½©ä½ï¼Œå½“éª¨æ¶å±é¡µå‡†å¤‡å¥½åæ—¶æ˜¾ç¤ºéª¨æ¶å±ã€‚å½“æ¸²æŸ“è¿›ç¨‹å‘é€æ¥ä¸€ä¸ª`stop-loading`æ¶ˆæ¯æ—¶ï¼Œç§»é™¤`BrowserView`\n\n```javascript\nconst mainWindow = new BrowserWindow({\n    width: 800,\n    height: 600,\n    webPreferences: {\n      preload: path.join(__dirname, \"preload.js\"),\n    },\n    show: false, // é»˜è®¤ä¸æ˜¾ç¤ºçª—å£\n});\n\nlet view = new BrowserView();\nmainWindow.setBrowserView(view);\nview.setBounds({ x: 0, y: 0, width: 800, height: 600 }); // é®æŒ¡ä½çª—å£\nview.webContents.loadFile(\"loading.html\"); // åŠ è½½éª¨æ¶å±é¡µé¢\n\n// å½“éª¨æ¶å±åŠ è½½å®Œæˆåæ˜¾ç¤ºçª—å£\nview.webContents.on(\"dom-ready\", () => {\n    console.log(\"show\");\n    mainWindow.show();\n});\n\n// å½“æ¸²æŸ“è¿›ç¨‹å‘æ¥stop-loadingæ¶ˆæ¯æ—¶ï¼Œç§»é™¤éª¨æ¶å±ï¼Œæ˜¾ç¤ºçœŸæ­£é¡µé¢\nipcMain.on(\"stop-loading\", () => {\n    console.log(\"stop\");\n    mainWindow.removeBrowserView(view);\n});\n```\n\n## æ€§èƒ½æ£€æµ‹\n\nChrome DevTools Performance\n\n## æ”¯æŒå¿«æ·é”®\n\n[ç³»ç»Ÿå¿«æ·é”®](http://www.electronjs.org/docs/api/global-shortcut)\n\n```javascript\nconst { app, globalShortcut } = require('electron')\n\napp.on('ready', () => {\n  // æ³¨å†Œä¸€ä¸ª 'CommandOrControl+X' çš„å…¨å±€å¿«æ·é”®\n  const ret = globalShortcut.register('CommandOrControl+X', () => {\n    console.log('CommandOrControl+X is pressed')\n  })\n\n  if (!ret) {\n    console.log('registration failed')\n  }\n\n  // æ£€æŸ¥å¿«æ·é”®æ˜¯å¦æ³¨å†ŒæˆåŠŸ\n  console.log(globalShortcut.isRegistered('CommandOrControl+X'))\n})\n\napp.on('will-quit', () => {\n  // æ³¨é”€å¿«æ·é”®\n  globalShortcut.unregister('CommandOrControl+X')\n\n  // æ³¨é”€æ‰€æœ‰å¿«æ·é”®\n  globalShortcut.unregisterAll()\n})\n```\n\n## æœ¬åœ°åŒ–ï¼ˆi18nï¼‰\n\nElectronç¨‹åºåœ¨`ready`äº‹ä»¶åï¼Œå¯ä»¥é€šè¿‡`app.getLocale()`æ¥è·å¾—`localå€¼`(å¦‚`zh-CN`)ï¼Œ[è¯¦ç»†åˆ—è¡¨](http://www.electronjs.org/docs/api/locales)\n\né€šè¿‡[i18nnext](https://github.com/i18next/i18next)æ¥å®ç°å›½é™…åŒ–\n\n[Electronä½¿ç”¨i18nnext](https://phrase.com/blog/posts/building-an-electron-app-with-internationalization-i18n/#Switching_Locale_from_the_Menu)\n\n## å¼€æœºè‡ªå¯\n\né€šè¿‡`app.setLoginItemSettings`æ¥è®¾ç½®å¼€æœºè‡ªå¯\n\n```javascript\napp.setLoginItemSettings({\n  openAtLogin: true, // Boolean åœ¨ç™»å½•æ—¶å¯åŠ¨åº”ç”¨ é»˜è®¤false\n  openAsHidden: true, // Boolean (å¯é€‰) mac è¡¨ç¤ºä»¥éšè—çš„æ–¹å¼å¯åŠ¨åº”ç”¨ã€‚~~~~\n  // path: '', String (å¯é€‰) Windows - åœ¨ç™»å½•æ—¶å¯åŠ¨çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚é»˜è®¤ä¸º process.execPath.\n  // args: [] String Windows - è¦ä¼ é€’ç»™å¯æ‰§è¡Œæ–‡ä»¶çš„å‘½ä»¤è¡Œå‚æ•°ã€‚é»˜è®¤ä¸ºç©ºæ•°ç»„ã€‚æ³¨æ„ç”¨å¼•å·å°†è·¯å¾„æ¢è¡Œã€‚\n})\n```\n\n","tags":["javascript","Electron","æ¡Œé¢ç«¯è½¯ä»¶"],"categories":["Electron"]},{"title":"Electron-é¡¹ç›®æ‰“åŒ…","url":"/posts/acb10ea6.html","content":"\n## æ‰“åŒ…åˆ†ä¸ºå‡ æ­¥ï¼Ÿ\n\n1. ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ ï¼š\n\n2. æ·»åŠ ä¸šåŠ¡ä»£ç ï¼šæ„å»ºå¥½çš„å‰ç«¯èµ„æºæ·»åŠ åˆ°resources appï¼Œelectronå£³å­ä¸ä¸šåŠ¡ä»£ç ç»“åˆ\n\n3. ä¿®æ”¹æ–‡ä»¶ä¿¡æ¯ï¼šä¿®æ”¹ åº”ç”¨åç§°ï¼Œè®¾ç½®å›¾æ ‡ç­‰\n\n4. åˆ¶ä½œé•œåƒï¼šå‹ç¼©æ–‡ä»¶ï¼Œåˆ¶ä½œé•œåƒï¼ˆdmg-builderã€nsisï¼‰\n\n## æ‰“åŒ…å·¥å…·\n\n|              | electron-builder                             | electron-forge                               |\n| ------------ | -------------------------------------------- | -------------------------------------------- |\n| ç­¾å         | ***                                          | ***                                          |\n| å®‰è£…åŒ…ç±»å‹   | ***                                          | ***                                          |\n| åŸç”Ÿæ¨¡å—ç¼–è¯‘ | ***                                          | ***                                          |\n| å®šåˆ¶åŒ–       | ***                                          | *                                            |\n| ä¸Šæ‰‹æˆæœ¬     | **                                           | *                                            |\n| boilerplate  | x                                            | ***                                          |\n| è·¨å¹³å°æ„å»º   | Linuxã€windows                               | x                                            |\n| ç¤¾åŒºæ´»è·ƒåº¦   | ***                                          | **                                           |\n| åœºæ™¯         | æ‰“åŒ…å’Œå‘å¸ƒçš„å®Œæˆè§£å†³æ–¹æ¡ˆï¼ŒåŸºæœ¬é€‚ç”¨äºæ‰€æœ‰åœºæ™¯ | åˆ›å»ºåˆ°å‘å¸ƒçš„ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆï¼Œé€‚åˆä»0åˆ°1çš„é¡¹ç›® |\n\næ¨èä½¿ç”¨`electron-builder`\n\n## æ‰“åŒ…å‡†å¤‡\n\n1. è¯ä¹¦\n   1. mac: å¼€å‘è€…è¯ä¹¦\n   2. windowï¼šèµ›é—¨é“å…‹(Symantec)ã€WoSign\n2. å¯¹äºç³»ç»Ÿçš„æœºå™¨ï¼ˆmacæ‰“macosçš„åŒ…ï¼Œwindowsæ‰“winçš„åŒ…ï¼Œlinuxæ‰“linuxçš„åŒ…ï¼‰\n3. è½¯ä»¶æ‰€éœ€å›¾ç‰‡\n   1. macï¼š \n      1. è½¯ä»¶å›¾æ ‡ã€icnsæ ¼å¼ï¼Œé€šè¿‡ [image2icon](http://www.img2icnsapp.com/) æˆ–è€… [iconutil](https://www.npmjs.com/package/iconutil) ç”Ÿæˆ\n      2. dmg èƒŒæ™¯å›¾\n      3. å®‰è£…åŒ…å›¾æ ‡\n   2. Windows\n      1. ico\n      2. installerIcon-å®‰è£…å›¾æ ‡\n      3. unInstallerIcon-å¸è½½å›¾æ ‡\n\n## ä½¿ç”¨electron-builderæ¥æ‰“åŒ…\n\n### å®‰è£…ç›¸å…³ä¾èµ–\n\n- `npm i -g --production window-build-tool`ï¼ˆç”¨ç®¡ç†å‘˜æƒé™å®‰è£…ï¼Œwindowå¿…å¤‡ï¼‰\n- é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œ`npm i electron-builder -S`\n- åœ¨`package.json`ä¸­ï¼Œæ·»åŠ `\"postinstall\": \"electron-builder install-app-deps\"`ã€‚æ¯å½“ä½¿ç”¨`npm install`æˆ–è€…`yarn add`æ—¶ï¼Œä¼šè‡ªåŠ¨å®‰è£…åŒ¹é…å½“å‰electronç‰ˆæœ¬çš„ä¾èµ–ã€‚\n\n### é…ç½®æ–¹å¼\n\nåœ¨`package.json`ä¸­åŠ å…¥buildå±æ€§\n\nä½¿ç”¨`electron-builder.yml`\n\né€šè¿‡ç¼–ç¨‹æ—¶API\n\n### é…ç½®é¡¹\n\nåœ¨`package.json`æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹\n\n```json\n\"build\"ï¼š {\n    \"appId\": \"com.xxx.xxx\",\n    \"productName\": \"åº”ç”¨åç§°\",\n    \"directories\": {  // ç›®å½•é…ç½®\n        \"app\": \"dist\", // æ‰“åŒ…çš„ä»£ç ç›®å½•\n        \"buildResources\": \"resource\", // æ„å»ºåŒ…çš„èµ„æºç›®å½•\n        \"output\": \"release\" // å­˜æ”¾äº§åŒ…çš„ç›®å½•\n    },\n    \"asar\": true, // asaråŠ å¯†ï¼Œä¿æŠ¤æºä»£ç \n    \"copyright\": \"Copyright xxxx\",\n    \n    \"mac\": {\n       \"target\": [\"dmg\", \"zip\"],  // åŒ…æ ¼å¼ï¼Œzipç”¨äºè‡ªåŠ¨æ›´æ–°\n\t\t\"icon\": \"resources/icon.icns\" // logoåœ°å€\n    },\n    \"dmg\": {\n        \"background\": \"resources/background.png\", // èƒŒæ™¯å›¾\n        \"window\": { \"width\": 540,  \"height\": 380}, // å®‰è£…çª—å£å¤§å°\n        \"contents\": [ // dmgå†…å®¹åæ ‡\n          {\"x\": 410, \"y\": 190,  \"type\": \"link\", \"path\": \"/Applications\"},\n          {\"x\": 130,\"y\": 190,\"type\": \"ï¬le\"}\n        ],\n        \"iconSize\": 128, // logoå¤§å°\n   },\n   \"win\": {\n       \"icon\": \"resources/icon.ico\", // logoåœ°å€\n       \"target\": [ \"nsis\", \"squirrel\"] // nsisåŒ…ï¼Œsquirrelæ˜¯ä¸€ä»¶å®‰è£…åŒ…\n   },\n   \"nsis\": {\n       \"oneClick\": false,  // ä¸€é”®å®‰è£…\n       \"language\": \"2052\", // 2052ä»£è¡¨ä¸­æ–‡\n       \"perMachine\": true, // æ˜¯å¦ä¸ºæœºå™¨ä¸Šæ‰€æœ‰ç”¨æˆ·å®‰è£…\n       \"allowToChangeInstallationDirectory\": true // å…è®¸æ”¹å˜å®‰è£…ç›®å½•\n   },\n   \"squirrelWindows\": {\n       \"loadingGif\": \"resources/loading.gif\", // å®‰è£…åŠ¨æ€å›¾\n       \"iconUrl\": \"https://xxxxx.com/icon.ico\" // å¿…é¡»æ˜¯è¿œç¨‹çš„\n   }\n}\n```\n\n> nsisæ—¶windowsä¸‹çš„åŒ…å®‰è£…å™¨ï¼Œå¯ä»¥åšåˆ°å¾ˆç»†è‡´çš„å®šåˆ¶ã€‚\n>\n> å¦‚æœä½¿ç”¨squirrelæ¥æ‰“åŒ…ï¼Œéœ€è¦å®‰è£…`electron-builder-squirrel-windows`\n\nåœ¨`scripts`ä¸­åŠ ä¸Š`\"pack\": \"electron-builder\"`\n\nå¦‚æœä½¿ç”¨ç¼–ç¨‹æ—¶APIï¼Œåˆ™æ–°å»ºä¸€ä¸ªjsæˆ–tsæ–‡ä»¶\n\n```javascript\n// js\nconst { build } = require(\"electron-builder\");\n\nbuild({\n    config: {\n        appId: \"com.xxx.xxx\",\n        productName: \"åº”ç”¨åç§°\",\n        // ...ä»¥ä¸‹çœç•¥\n    }\n})\n\n// buildå‡½æ•°è¿”å›ä¸€ä¸ªpromise\n// å¯ä»¥ å€ŸåŠ© electron-builderçš„ç±»å‹å£°æ˜æ–‡ä»¶æ¥æŸ¥çœ‹å®ƒæœ‰å“ªäº›æ–¹æ³•å’Œå‚æ•°ç±»å‹\n```\n\nç„¶åç”¨nodeæ‰§è¡Œè¿™ä¸ªjsæ–‡ä»¶ã€‚å¦‚æœæ˜¯tsæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ts-nodeï¼Œæˆ–è€…å…ˆç”¨tscç¼–è¯‘å†ç”¨nodeæ‰§è¡Œã€‚\n\n`electron-builder`æ›´è¯¦ç»†çš„é…ç½®è¯·æŸ¥é˜…[å®˜ç½‘](https://www.electron.build/configuration/configuration)\n\n## æ€»ç»“\n\n1. å‘å¸ƒäº§å“æ³¨æ„ç‰ˆæœ¬å·çš„å‡çº§\n   1. `npm version patch`ï¼šè‡ªåŠ¨å‡çº§patch\n   2. `npm version minor`ï¼šè‡ªåŠ¨å‡çº§minorï¼Œpathä¼šæ¸…0\n   3. `npm version major`ï¼šè‡ªåŠ¨å‡çº§majorï¼Œminorå’Œpatchä¼šæ¸…0\n\n2. è¯ä¹¦\n   1. windowsä¸‹æ²¡æœ‰è¯ä¹¦ï¼Œå¯èƒ½ä¼šè¢«æ€è½¯è¯¯æ€\n   2. macä¸‹æ²¡æœ‰è¯ä¹¦ï¼Œæ— æ³•å®ç°è‡ªåŠ¨æ›´æ–°\n   3. windowsä¸‹æ‰“åŒ…å¯ä»¥é€šè¿‡ä¿®æ”¹nsisæ¥è‡ªå®šä¹‰å®‰è£…é€»è¾‘\n   4. å¼€æºè½¯ä»¶å¯ä»¥åŸºäº Travis, AppVeyor æŒç»­é›†æˆ","tags":["javascript","Electron","æ¡Œé¢ç«¯"],"categories":["Electron"]},{"title":"Electron-è´¨é‡ç›‘æ§","url":"/posts/34a04fbb.html","content":"\n##  Electronè´¨é‡ä¿è¯\n\n|          | å¼€å‘                                                         | æµ‹è¯•                                                   | ä¸Šçº¿                 | ç›‘æ§                                     |\n| -------- | ------------------------------------------------------------ | ------------------------------------------------------ | -------------------- | ---------------------------------------- |\n| æ¸²æŸ“è¿›ç¨‹ | ä»£ç é™æ€æ£€æŸ¥ï¼šeslint<br />å¼ºç±»å‹è¯­è¨€ï¼štypescript<br />Code review | å•å…ƒæµ‹è¯•<br />æ€§èƒ½æµ‹è¯•<br />UIè‡ªåŠ¨åŒ–æµ‹è¯•<br />å†’çƒŸæµ‹è¯• | ç°åº¦å‘å¸ƒ<br />å›æ»š   | æ€§èƒ½ç›‘æ§<br />å¼‚å¸¸ç›‘æ§<br />ç”¨æˆ·è¡Œä¸ºç›‘æ§ |\n| ä¸»è¿›ç¨‹   | åŒä¸Š                                                         | Electronæµ‹è¯•(Spectron)                                 | åŠŸèƒ½å¼€å…³<br />çƒ­ä¿®å¤ | **å´©æºƒç›‘æ§**                             |\n\n## å´©æºƒç›‘æ§æ¨¡å‹\n\n![electroné”™è¯¯æ”¶é›†](../../images/electroné”™è¯¯æ”¶é›†æ¨¡å‹.png)\n\nElectronå†…ç½®`crashReporter`æ¨¡å—ï¼Œå¯ä»¥ç”¨æ¥ç›‘æ§ä¸»è¿›ç¨‹å’Œæ¸²æŸ“æ£€æŸ¥çš„é”™è¯¯ã€‚ç„¶åå°†é”™è¯¯æŠ¥å‘Šå‘é€ç»™æœåŠ¡å™¨çš„`crashæ”¶é›†æœåŠ¡`\n\nå´©æºƒæŠ¥å‘Šå°†å‘é€ä¸‹é¢ `multipart/form-data` `POST` å‹çš„æ•°æ®ç»™ `submitURL`:\n\n- `ver` String - Electron çš„ç‰ˆæœ¬.\n- `platform` String - ä¾‹å¦‚ 'win32'.\n- `process_type` String - ä¾‹å¦‚ 'renderer'.\n- `guid` String - ä¾‹å¦‚ '5e1286fc-da97-479e-918b-6bfb0c3d1c72'.\n- `_version` String - `package.json` é‡Œçš„ç‰ˆæœ¬å·.\n- `_productName` String - `crashReporter` `options` å¯¹è±¡ä¸­çš„äº§å“åå­—\n- `prod` String - Name of the underlying product. In this case Electron.\n- `_companyName` String - `crashReporter` `options` å¯¹è±¡ä¸­çš„å…¬å¸åç§°\n- `upload_file_minidump` File - `minidump` æ ¼å¼çš„å´©æºƒæŠ¥å‘Š\n- All level one properties of the `extra` object in the `crashReporter` `options` object.\n\nä¸Šè¿°æ•°æ®ä¸­çš„`upload_file_minidump`æ˜¯ä¸ªminidumpæ ¼å¼çš„æ–‡ä»¶ã€‚ç›´æ¥æ—¶æ— æ³•æ‰“å¼€çš„ã€‚éœ€è¦ç»“åˆ`electron-symbols`ä»¥åŠ`node-minidump`ï¼Œåé¢å†è¯´ã€‚\n\n## å®ç°ç›‘æ§\n\n### æœåŠ¡ç«¯\n\nä½¿ç”¨`koa`æ­å»ºä¸€ä¸ªcrashæ”¶é›†æœåŠ¡\n\n\n```javascript\nconst Koa = require('koa')\nconst app = new Koa()\nconst Router = require('koa-router')\nconst multer = require('koa-multer') // å¤„ç†æ–‡ä»¶ä¸Šä¼ çš„åº“\nconst uploadCrash = multer({ dest: 'crash/' }) // è®¾ç½®é”™è¯¯æŠ¥å‘Šå­˜æ”¾ç›®å½•\n\nconst router = new Router()\n\nrouter.post('/crash', uploadCrash.single('upload_file_minidum'), (ctx, next) => {\n    // TODO é”™è¯¯ä¿¡æ¯å­˜å‚¨åˆ°DB\n    ctx.request.file // minidumpæ–‡ä»¶\n})\n\napp.use(router.routes())\n    .use(router.allowedMethods())\n\napp.listen(33855)\n```\n\n### ELectronç«¯\n\né…ç½®`crashReporter`\n\n```javascript\n// crash.js\nconst { crashReporter } = require('electron')\n\nfunction init() {\n    crashReporter.start({\n        crashReporter.start({\n        \tproductName: '',\n        \tcompanyName: '',\n        \tsubmitURL: 'æœåŠ¡å™¨ å¤„ç†å¼‚å¸¸æ¥å£åœ°å€'\n    \t})\n    })\n}\nmodules.exports = { init }\n\n// main.js\napp.on('will-finish-lanuching', () => {\n    require('./crash-reporter').init()\n})\n```\n\n### è§£æé”™è¯¯æ—¥å¿—\n\næœåŠ¡ç«¯æ”¶åˆ°çš„æ˜¯`minidump`æ–‡ä»¶ã€‚éœ€è¦ä½¿ç”¨`symbols`ä»¥åŠ`node-minidump`æ¥è§£ææ—¥å¿—\n\nå…ˆä¸‹è½½å¯¹åº”electronç‰ˆæœ¬å’Œå¯¹åº”osçš„symbolsï¼Œ[ä¸‹è½½åœ°å€](https://github.com/electron/electron/releases)\n\n![symbolsä¸‹è½½](../../images/symbolsä¸‹è½½.png)\n\nå»ºç«‹ä¸€ä¸ªnodeé¡¹ç›®ï¼ˆä¹Ÿå¯ä»¥é›†æˆåˆ°crashæ”¶é›†æœåŠ¡ä¸­ï¼‰ã€‚å®‰è£…`node-minimap`\n\næ‰§è¡Œ`yarn add minidump`\n\n```javascript\nconst minidump = require('node-minidump')\nconst fs = require('fs')\nminidump.addSymbolPath('./symbols/electron-v10.0.0-beta.12-darwin-x64-symbols.zip') // æŒ‡å®šä¸‹è½½çš„symbolsè·¯å¾„\n\n// æŒ‡å®šminidumpæ–‡ä»¶åœ°å€\nminidump.walkStack('./e19fb34bc3rf6812', (err, res) => {\n    // res è§£æç»“æœ\n    fs.writeFileSync('./res.txt', res) // å†™å…¥æ–‡ä»¶\n})\n```\n\n## ç›‘æ§æŠ€å·§\n\næ¸²æŸ“è¿›ç¨‹å´©æºƒåæç¤ºç”¨æˆ·é‡æ–°åŠ è½½\né€šè¿‡ `preload`ç»Ÿä¸€åˆå§‹åŒ–å´©æºƒç›‘æ§\nä¸»è¿›ç¨‹ã€æ¸²æŸ“è¿›ç¨‹é€šè¿‡ `process.crash()`å¯ä»¥æ¨¡æ‹Ÿå´©æºƒ\n\né€šè¿‡`process`è¿›è¡Œå¼‚å¸¸ç›‘æ§\n\n```javascript\nprocess.on('uncaughtException', () => {\n    // ä¸ŠæŠ¥å¼‚å¸¸\n})\n```\n\n","tags":["javascript","Electron","æ¡Œé¢ç«¯è½¯ä»¶"],"categories":["Electron"]},{"title":"Electron-åº”ç”¨æ›´æ–°","url":"/posts/e7227c9a.html","content":"\n## è½¯ä»¶æ›´æ–°æ–¹å¼\n\n### æ‰‹åŠ¨æ›´æ–°\n\nç”¨æˆ·æ‰‹åŠ¨ä¸‹è½½ã€å®‰è£…æ–°åŒ…ã€‚\n\næ‰‹åŠ¨æ›´æ–°ç®€å•ç¨³å®šï¼Œé€‚åˆæ›´æ–°é¢‘ç‡ä½ï¼Œç”¨æˆ·ç²˜æ€§é«˜çš„åœºæ™¯ï¼Œé€šå¸¸ä½œä¸ºå…¶å®ƒå‡çº§æŠ€æœ¯çš„`é™çº§æ–¹æ¡ˆ`ã€‚\n\næµç¨‹ï¼š\n\n1. æ›´æ–°æœåŠ¡ï¼šåŒ¹é…å®¢æˆ·ç«¯ç‰ˆæœ¬ï¼Œç”¨æˆ·ä¿¡æ¯\n2. æ£€æŸ¥æ›´æ–°å™¨ï¼šè¿”å›åŒ…åœ°å€ï¼Œæ›´æ–°æ–‡æ¡ˆ\n3. æç¤ºï¼šæ–°åŠŸèƒ½å‡çº§\n4. æ‰‹åŠ¨æ“ä½œï¼šè·³è½¬æµè§ˆå™¨ï¼Œæ‰“å¼€å®‰è£…åŒ…è¦†ç›–\n\n### æ–‡ä»¶è¦†ç›–\n\nç¨‹åºè‡ªåŠ¨æ›¿æ¢æ–‡ä»¶ä»¥å®ç°æ›´æ–°ã€‚\n\nä¸ç¨³å®šï¼Œå¯èƒ½ä¼šå†™å…¥å¤±è´¥ã€‚é€‚åˆ`æ‰“è¡¥ä¸`çš„åœºæ™¯\n\næµç¨‹ï¼š\n\n1. æ›´æ–°æœåŠ¡ï¼šåŒ¹é…å®¢æˆ·ç«¯ç‰ˆæœ¬ï¼Œç”¨æˆ·ä¿¡æ¯\n2. æ£€æŸ¥æ›´æ–°å™¨ï¼šè¿”å›åŒ…åœ°å€ï¼Œæ›´æ–°æ–‡æ¡ˆ\n3. æç¤ºï¼šæ–°åŠŸèƒ½å‡çº§\n4. ç¨‹åºæ“ä½œï¼šåŠèµ·å­ç¨‹åºï¼Œå…³é—­åº”ç”¨ï¼Œå°†è¡¥ä¸å¤åˆ¶åˆ°åº”ç”¨ç›®å½•ï¼Œé‡æ–°å¯åŠ¨\n\n### è‡ªåŠ¨æ›´æ–°\n\nåå°ä¸‹è½½æ–‡ä»¶ï¼Œé‡å¯å³æ–°ç‰ˆ\n\nç¨³å®šï¼Œå¿«ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥ã€‚é€‚åˆæ›´æ–°é¢‘ç‡é«˜çš„åœºæ™¯ï¼Œä»¥åŠå¯¹ç”¨æˆ·ä½“éªŒè¦æ±‚é«˜çš„åœºæ™¯\n\næµç¨‹ï¼šæ›´æ–°æœåŠ¡ => æ£€æŸ¥æ›´æ–°å™¨ => ä¸‹è½½æ–°åŒ… => é‡å¯åº”ç”¨åŠ è½½æ–°åŒ…\n\n### åº”ç”¨å•†åº—\n\né€šè¿‡å„å¹³å°åº”ç”¨å•†åº—å‘å¸ƒï¼Œä¾‹å¦‚Microsoft storeå’Œmac app store\n\nç»Ÿä¸€ã€ç¨³å®š\n\n### å¯¹æ¯”\n\n| æ›´æ–°æ–¹å¼ | æ‰‹åŠ¨æ›´æ–°                                         | æ–‡ä»¶è¦†ç›–                             | è‡ªåŠ¨æ›´æ–°             | åº”ç”¨å•†åº—           |\n| -------- | ------------------------------------------------ | ------------------------------------ | -------------------- | ------------------ |\n| ä¼˜ç‚¹     | ç®€å•ã€ç¨³å®š                                       | ä¸‹è½½è¿‡ç¨‹å¿«                           | ç¨³å®šã€å¿«ã€æ‰“æ‰°å°‘     | ç»Ÿä¸€ã€ç¨³å®š         |\n| ç¼ºç‚¹     | è¿‡ç¨‹ç¹çã€æ…¢ã€å½±å“ä½¿ç”¨ã€                         | å®ç°å¤æ‚ã€ç¨³å®šæ€§å·®ã€æ–‡ä»¶å†™å…¥å¯èƒ½å¤±è´¥ | å®ç°å¤æ‚             | å—åº”ç”¨å•†åº—å±€é™     |\n| ä½¿ç”¨åœºæ™¯ | ä½é¢‘æ›´æ–°ã€ç”¨æˆ·ç²˜æ€§é«˜ã€ä½œä¸ºå„ç§å‡çº§æŠ€æœ¯çš„é™çº§æ–¹æ¡ˆ | æ‰“è¡¥ä¸                               | é«˜é¢‘æ›´æ–°ã€ä½“éªŒè¦æ±‚é«˜ | éœ€è¦ä¸Šæ¶å•†åº—çš„è½¯ä»¶ |\n\n## Electronæ›´æ–°æ–¹å¼\n\n### WebåŒ–\n\nå°†æ¸²æŸ“è¿›ç¨‹ï¼ˆä¸šåŠ¡ï¼‰ä»£ç ï¼Œæ”¾ç½®è¿œç¨‹æœåŠ¡å™¨ã€‚Electroné€šè¿‡loadURLåŠ è½½\n\nè¿™æ ·çš„è¯ï¼Œåªè¦æ›´æ–°æœåŠ¡å™¨çš„ä»£ç å°±èƒ½å®ç°ç³»ç»Ÿæ›´æ–°ã€‚\n\nç¼ºç‚¹ï¼šæ— æ³•ç¦»çº¿ä½¿ç”¨ï¼ŒElectronå£³å­æ— æ³•æ›´æ–°ã€‚\n\n### æ–‡ä»¶è¦†ç›–\n\nElectronæ£€æµ‹æœåŠ¡å™¨çš„releaseç‰ˆæœ¬ä¸æœ¬åœ°æ˜¯å¦ä¸€è‡´ï¼Œè‹¥æœ‰æ–°ç‰ˆæœ¬æç¤ºå‡çº§ã€‚æ‹‰å»æœåŠ¡å™¨ç¨‹åºå¹¶è¦†ç›–æœ¬åœ°ï¼Œç„¶åé‡å¯ã€‚\n\nç›¸å…³å®ç°è¯·å‚è€ƒå¼ é‘«æ—­çš„[æ–‡æ¡£](https://www.zhangxinxu.com/wordpress/2017/06/how-electron-online-update-hot-fix/?replytocom=361528)\n\n### Electron-Updater\n\nElectron-Updateræ˜¯ç”±electron-builderæå‡ºçš„\n\n ä¼˜ç‚¹\n\n1. æ¥å…¥ç®€å•\n2. Windows æ”¯æŒç­¾åéªŒè¯\n3. æ”¯æŒè¿›åº¦æ¡\n4. åŸºäº electron-builder éå¸¸å®¹æ˜“ä½¿ç”¨\n\n ç¼ºç‚¹\n\n1. Windows æ›´æ–°ä½“éªŒæ²¡æœ‰å†…ç½®çš„å¥½\n2. Windows å­˜åœ¨æƒé™é—®é¢˜\n\nè¯¦è§ https://www.electron.build/auto-update.html\n\n### å¢é‡æ›´æ–°\n\nåªæ›´æ–°éœ€è¦æ›´æ–°çš„åœ°æ–¹\n\nåŸç†ï¼š å½“å‰ç‰ˆæœ¬ä¸æœ€æ–°ç‰ˆæœ¬åšdiffç®—æ³•ï¼Œå°†ä¸åŒçš„åœ°æ–¹æ‰“åŒ…æˆpatchï¼Œæ›´æ–°å°±åªæ›´æ–°patchéƒ¨åˆ†ã€‚\n\nå¢é‡æŠ€æœ¯ï¼š\n\n1. bsdiff/bspatchï¼šé€‚ç”¨äºŒè¿›åˆ¶æ–‡ä»¶ã€å¼€æºã€å…è´¹ã€å¹¿æ³›ä½¿ç”¨ï¼ˆå°¤å…¶ç§»åŠ¨ç«¯ï¼‰\n2. Xdelta3ï¼šé€‚ç”¨äºäºŒè¿›åˆ¶\n3. Courgetteï¼šè°·æ­Œæå‡ºçš„æ–¹æ¡ˆï¼Œæ˜¯bsdiffçš„ä¼˜åŒ–\n4. RTPatchï¼šå•†ä¸šä»˜è´¹\n\nå¯¹æ¯”å‚è€ƒï¼šhttps://www.shangyexin.com/2018/09/28/delta_algorithm/\n\n## ç°åº¦å‘å¸ƒ\n\nç°åº¦å‘å¸ƒå°±æ˜¯è®©ä¸€éƒ¨åˆ†ç”¨æˆ·ç»§ç»­ä½¿ç”¨åŸæ¥çš„äº§å“åŠŸèƒ½ï¼Œå¯¹å¦ä¸€éƒ¨åˆ†ç”¨æˆ·é€æ¸å¼€å‘æ–°åŠŸèƒ½ã€‚ç„¶åé’ˆå¯¹æ–°åŠŸèƒ½åœ¨åšå®Œå–„å’Œä¼˜åŒ–ã€‚ç­‰åˆ°ç°åº¦å‘å¸ƒå®Œæˆåï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å°†ä½¿ç”¨æ–°çš„äº§å“åŠŸèƒ½ã€‚\n\n## Electronæ›´æ–°å®æˆ˜\n\n### æ›´æ–°å‡†å¤‡\n\nå‡†å¤‡è¯ä¹¦ï¼ŒMacä¸‹è‡ªåŠ¨æ›´æ–°å¿…é¡»è¦è¯ä¹¦ã€‚æ‰“åŒ…æ—¶å€™é…ç½®ã€‚\n\n### ä½¿ç”¨å†…ç½®çš„[autoUpdater](https://www.electronjs.org/docs/api/auto-updater)æ¨¡å—\n\nElectronå®˜æ–¹æ›´æ–°æ–¹æ³•æ˜¯åŸºäºå†…ç½®çš„[Squirrel](https://github.com/Squirrel)æ¡†æ¶å’ŒElectronçš„[autoUpdater](https://www.electronjs.org/docs/api/auto-updater)æ¨¡å—ã€‚\n\n#### autoUpdateræ¨¡å—ç®€ä»‹\n\n```typescript\nconst { autoUpdater: updater } = require('electron')\n\n// è®¾ç½®æ›´æ–°æœåŠ¡å™¨åœ°å€\nupdater.setFeedURL({\n    url: 'æ›´æ–°æœåŠ¡å™¨åœ°å€',\n    headers: 'HTTPè¯·æ±‚å¤´',\n    serverType: 'default' // json or default \n})\n\n// è·å–å½“å‰æ›´æ–°æœåŠ¡å™¨åœ°å€\nupdater.getFeedURL()\n\n// æ£€æŸ¥æ›´æ–°ï¼Œè®¿é—®æ›´æ–°æœåŠ¡å™¨åœ°å€\n// è°ƒç”¨checkForUpdatesä¹‹å‰å¿…é¡»è®¾ç½®setFeedURL\nupdater.checkForUpdates()\n\n// æ­¤æ–¹æ³•huiå…³é—­æ‰€æœ‰åº”ç”¨çª—å£ï¼Œç„¶åè‡ªåŠ¨è°ƒç”¨app.quit()\n// è¿™ä¸ªæ–¹æ³•é€šå¸¸åœ¨ update-downloaded äº‹ä»¶è§¦å‘åè°ƒç”¨\nupdater.quitAndInstall()\n\n\n// å¼€å§‹æ£€æŸ¥æ›´æ–°æ—¶è§¦å‘\nupdater.on('check-for-update', () => {\n    // TODO...\n})\n\n// æ£€æŸ¥æ›´æ–°åï¼Œå‘ç°æœ‰æ–°ç‰ˆæœ¬åè§¦å‘è¯¥äº‹ä»¶\n// è¯¥äº‹ä»¶è§¦å‘åï¼Œä¼šè‡ªåŠ¨ä¸‹è½½æœ€æ–°ç‰ˆæœ¬\nupdater.on('update-avaliable', () => {\n    // TODO...\n})\n\n// æ£€æŸ¥æ›´æ–°åï¼Œæ²¡æœ‰å‘ç°æ–°ç‰ˆæœ¬ï¼ˆè¿”å›204ï¼‰åè§¦å‘è¯¥äº‹ä»¶\nupdater.on('update-not-avaliable', () => {\n    // TODO...\n})\n\n// æœ€æ–°ç‰ˆä¸‹è½½å®Œæˆåè§¦å‘è¯¥äº‹ä»¶\n// åœ¨ Windows ä¸Šåªæœ‰ releaseName æ˜¯æœ‰æ•ˆçš„ã€‚\nupdater.on('update-downloaded', (e, releaseNotes, releaseName, releaseDate, updateURL) => {\n    // TODO...\n    // æ˜¾ç¤ºæç¤ºæ¡†ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦è‡ªåŠ¨æ›´æ–°\n})\n\n// ç”¨æˆ·è°ƒç”¨quitAndInstall åè§¦å‘\nupdater.on('before-quit-for-update', () => {\n    // TODO...\n})\n\n// æ›´æ–°å‘ç”Ÿé”™è¯¯æ—¶ï¼Œè§¦å‘\nupdater.on('error', (error) => {\n    // TODO...\n})\n```\n\n#### æ›´æ–°æµç¨‹\n\n##### macæ›´æ–°\n\nElectronå®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å»æ£€æŸ¥æ˜¯å¦æœ‰æœ€æ–°ç‰ˆæœ¬ã€‚å¦‚æœæœ‰ï¼ŒæœåŠ¡ç«¯éœ€è¦è¿”å›**ç›¸åº”æ•°æ®**ï¼Œæ²¡æœ‰å°±è¿”å›`204`çŠ¶æ€ç \n\nmacä¸‹æœåŠ¡ç«¯éœ€è¦è¿”å›è¿™æ ·çš„`json`ç»“æ„\n\n```json\n{\n\t\"url\": \"https://mycompany.example.com/myapp/releases/myrelease\", // urlä¸ºåŒ…ä¸‹è½½åœ°å€\n\t\"name\": \"My Release Name\",\n\t\"notes\": \"Theses are some release notes innit\",\n\t\"pub_date\": \"2013-09-18T12:29:53+01:00\" \n}\n```\n\nç„¶åElectronå®¢æˆ·ç«¯å°±ä¼šè‡ªåŠ¨è¯·æ±‚`url`åœ°å€å»ä¸‹è½½\n\n\n\n##### windowsæ›´æ–°\n\nElectronå®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å»æ£€æŸ¥æ˜¯å¦æœ‰æœ€æ–°ç‰ˆæœ¬ã€‚å¦‚æœæœ‰ï¼ŒæœåŠ¡ç«¯éœ€è¦è¿”å›**ç›¸åº”æ•°æ®**ï¼Œæ²¡æœ‰å°±è¿”å›`204`çŠ¶æ€ç \n\nwindowä¸‹éœ€è¦è¿”å›RELEASESæ–‡ä»¶å†…å®¹ï¼ˆä½¿ç”¨Squirrelæ‰“åŒ…ç”Ÿæˆçš„ï¼‰ï¼Œå¦‚`BBC6F98A5CD32C675AAB6737A5F67176248B900C appName-1.0.1-full.nupkg 62177782`\n\nå®¢æˆ·ç«¯æ”¶åˆ°æ•°æ®å‘ç°æœ‰æœ€æ–°ç‰ˆæœ¬ï¼Œåˆä¼šè¯·æ±‚`feedURL/*.nupkg`åœ°å€ã€‚æ‰€ä»¥æœåŠ¡ç«¯è¦å“åº”ç›¸åº”çš„è¯·æ±‚ã€‚\n\nåœ¨Electronä¸»è¿›ç¨‹åŠ ä¸Š`if(require('electron-squirrel-startup')) return`ã€‚ä½œç”¨æ˜¯ï¼šå¦‚æœåœ¨ç¨‹åºå®‰è£…æ—¶ã€æ›´æ–°æ—¶ä»¥åŠå¸è½½æ—¶å¯åŠ¨ç¨‹åºï¼Œå°±ç›´æ¥è¿”å›ï¼ˆæˆ–è€…`app.quit()`ï¼‰ã€‚å³ä¸å¯ç”¨ç¨‹åºï¼ˆå¦åˆ™ä¼šæŠ¥é”™ï¼‰\n\nwindowæ›´æ–°æ³¨æ„ï¼š \n\n1. å®‰è£…åŒ…ä¸èƒ½ä½¿ç”¨ NSISï¼Œéœ€è¦ä½¿ç”¨ Squirrel\n2. æ›´æ–°éœ€è¦ Squirrel é…å¥—çš„ nupkg åŒ…\n\n#### æœåŠ¡ç«¯\n\nå®‰è£…æ¨¡å—ï¼š`yarn add koa koa-router koa-static-server compare-versions`\n\n```javascript\nconst Koa = require('koa')\nconst app = new Koa()\nconst Router - require('koa-router')\nconst serve = require('koa-static-server')\nconst compareVersions = require('compare-versions')\n\n// è·å–æœ€æ–°ç‰ˆæœ¬é€šå¸¸ä¼šå»æŸ¥è¯¢æ•°æ®åº“ï¼Œè¿™é‡Œå°±ç›´æ¥mockäº†\nfunction getNewVersion(version) {\n    if(!version) return null\n    let maxVersion = {\n        name: '1.0.1',\n        pub_date: '2020-02-01T12:26:53+1:00',\n        notes: 'æ–°å¢åŠŸèƒ½AAA',\n        url: 'http://128.0.0.1:33855/public/xxxx-1.0.1-mac.zip'\n    }\n    if(compareVersions.compare(maxVersion.name, version, '>')) return maxVersion\n    return null\n}\n\n// for mac\nrouter.get('/darwin', (ctx, next) => {\n    // å¤„ç†Macæ›´æ–°ï¼Œ?version=1.0&uid=123\n    let {version} = ctx.query\n    let newVersion = getNewVersion(version)\n    if(newVersion) {\n        ctx.body = newVersion\n    } else {\n        ctx.status = 204 // 204ä»£è¡¨æ²¡æœ‰æ•°æ®\n    }\n})\n\n// for win\nrouter.get('/win32', (ctx, next) => {\n    let {version} = ctx.query\n    let newVersion = getNewVersion(version)\n    if(newVersion) {\n        ctx.body = 'BBC6F23A34BC123BA123C900 xxxx-1.0.1-full.nupkg 62177782'\n    } else {\n        ctx.status = 204 // 204ä»£è¡¨æ²¡æœ‰æ•°æ®\n    }\n})\n\n// é‡å®šå‘å»ä¸‹è½½\nrouter.get('/win32/*.nupkg', (ctx, next) => {\n    ctx.redirect(`/public/${ctx.params[0].nupkg}`)\n})\n\napp.use(server(rootDir: 'public', rootPath: '/public'))\n\napp.use(router.routes())\n\napp.listen(3385)\n```\n\n#### Electronç«¯\n\n```javascript\n// update.js\n\nconst { autoUpdater, app, dialog } = require('electron')\n\nif(process.platform === 'darwin') {\n    autoUpdater.setFeedURL(`http://127.0.0.1:33855/darwin?version=${app.getVersion()}`)\n} else {\n    autoUpdater.setFeedURL(`http://127.0.0.1:33855/win32?version=${app.getVersion()}`)\n}\n\n// å®šæ—¶è½®è°ƒ or æœåŠ¡ç«¯æ¨é€\nautoUpdater.checkForUpdater()\n\nautoUpdater.on('update-avaliable', () => {\n    console.log('update-avaliable')\n})\n\nautoUpdater.on('update-downloaded', (e, notes, version) => {\n    app.whenReady().then(() => {\n         // æç¤ºç”¨æˆ·æ›´æ–°\n        let clickId = dialog.showMessageBoxSync({\n            type: 'info',\n            title: 'å‡çº§æç¤º',\n            message: 'å­˜åœ¨æœ€æ–°ç‰ˆï¼Œæ˜¯å¦ç«‹å³å‡çº§',\n            buttons: ['é©¬ä¸Šå‡çº§', 'å–æ¶ˆ'],\n            cancelId: 1, // æ‰‹åŠ¨é‡å¯ ä¸º cancel\n        })\n\n        if(clickId === 0) {\n            autoUpdater.quiteAndInstall()\n        }\n    }) \n})\n\nautoUpdater.on('error', err => {\n    console.log('error:', error)\n})\n\n// main.js\nconst isDev = require('electron-is-dev')\nif(require('electron-squirrel-startup')) app.quit()\n\napp.on(\"will-finish-launching\", () => {\n    !isDev && require('./update.js')\n})\n```\n\n### ä½¿ç”¨Electron-Updater\n\n`electron-updater`æ˜¯åŸºäº`electron-builder`çš„æ›´æ–°æ–¹æ¡ˆã€‚\n\n#### electron-updateræ¨¡å—ç®€ä»‹\n\n```javascript\nconst { autoUpdater: updater } = require('electron')\n\n// è®¾ç½®æ›´æ–°æœåŠ¡å™¨åœ°å€\n// optionså¯ä»¥æ˜¯ä¸€ä¸ªurlå­—ç¬¦ä¸² è¡¨ç¤º å®‰è£…åŒ…helatest.ymlæ‰€åœ¨æœåŠ¡å™¨åœ°å€\n// ä¹Ÿå¯ä»¥æ˜¯ä¸ªå¯¹è±¡\nupdater.setFeedURL(options) \n\n// è·å–å½“å‰æ›´æ–°æœåŠ¡å™¨åœ°å€\nupdater.getFeedURL()\n\n// æ£€æŸ¥æ›´æ–°ï¼Œè®¿é—®æ›´æ–°æœåŠ¡å™¨åœ°å€\n// è°ƒç”¨checkForUpdatesä¹‹å‰å¿…é¡»è®¾ç½®setFeedURL\n// è‹¥æœ‰æ›´æ–°ä¸ä¼šè‡ªåŠ¨ä¸‹è½½\nupdater.checkForUpdates()\n\n// æ£€æŸ¥æ›´æ–°ï¼Œè‹¥æœ‰æ›´æ–°è‡ªä¼šè‡ªåŠ¨ä¸‹è½½å¹¶é€šçŸ¥\nupdater.checkForUpdatesAndNotify()\n\n// æ‰‹åŠ¨ä¸‹è½½\n// è¿”å›promise\nupdater.downloadUpdate()\n\n// æ­¤æ–¹æ³•huiå…³é—­æ‰€æœ‰åº”ç”¨çª—å£ï¼Œç„¶åè‡ªåŠ¨è°ƒç”¨app.quit()\n// è¿™ä¸ªæ–¹æ³•é€šå¸¸åœ¨ update-downloaded äº‹ä»¶è§¦å‘åè°ƒç”¨\nupdater.quitAndInstall()\n\n// æ›´æ–°é€šé“\n// alpha beta ltsç­‰\n// é»˜è®¤ latest\nupdater.channel = 'latest'\n\n// checkForUpdatesæˆ– checkForUpdatesAndNotifyè°ƒç”¨åè§¦å‘\nupdater.on('checking-for-update', () => {\n    // TODO...\n})\n\n// æ£€æŸ¥åï¼Œæœ‰æœ€æ–°ç‰ˆæœ¬æ—¶ï¼Œè§¦å‘\nupdater.on('update-available', (info) => {\n    // TODO...\n})\n\n// æ£€æŸ¥åï¼Œæ²¡æœ‰æœ€æ–°ç‰ˆæœ¬æ—¶ï¼Œè§¦å‘\nupdater.on('update-not-available', () => {\n    // TODO...\n})\n\n// ä¸‹è½½è¿‡ç¨‹ä¸­ è½®è°ƒ è§¦å‘\nupdater.on('download-progress', (progress, bytesPerSecond, percent, total, transferred) => {\n    // TODO...\n})\n\n// ä¸‹è½½å®Œæˆåè§¦å‘\nupdater.on('update-downloaded', (info) => {\n    // TODO...\n})\n\n// æ›´æ–°å‘ç”Ÿé”™è¯¯æ—¶ï¼Œè§¦å‘\nupdater.on('error', (error) => {\n    // TODO...\n})\n\n```\n\n`electro-updater`çš„`autoUpdater`å’Œelectroå†…ç½®çš„`autoUpdater`æ¨¡å—å¾ˆç›¸ä¼¼ï¼Œä½†å‰è€…æ¯”åè€…è¦å¼ºå¤§ä¸å°‘ï¼Œå‰è€…å¯ä»¥æ˜¾ç¤ºæ›´æ–°è¿›åº¦ã€‚\n\n#### æ›´æ–°æµç¨‹\n\n![electron-upadteræ›´æ–°æµç¨‹](../../images/electron-updateræ›´æ–°æµç¨‹.webp)\n\nå‡ ç‚¹è¡¥å……ï¼š\n\n1. åœ¨electron-builderæ‰“åŒ…é…ç½®ä¸­ï¼Œä¸€å®šè¦é…ç½®`public`å­—æ®µï¼Œé…ç½®å¥½åæ‰èƒ½ç”Ÿæˆ`latest.yml`æ–‡æ¡£ã€‚\n\n```json\n\"publish\": [\n    {\n        \"provider\": \"generic\",\n        \"url\": \"http://127.0.0.1:8000/\"  // æ”¾ç½®å®‰è£…åŒ…å’Œlatest.ymlçš„æœåŠ¡å™¨åœ°å€\n    }\n],\n```\n\n2. å°†æ‰“åŒ…åçš„`latest.yml`ä»¥åŠå®‰è£…åŒ…ã€‚æ”¾ç½®åˆ°æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥ä½¿ç”¨`nginx`æ¥æ­å»ºæ–‡ä»¶æœåŠ¡å™¨ã€‚Electronæ£€æŸ¥æ›´æ–°å°±æ˜¯æ£€æŸ¥è¿™ä¸ª`latest.yml`æ–‡ä»¶\n\n#### Electronç«¯\n\n```javascript\n// update.js\nconst { autoUpdater: updater } = require('electron-updater')\n\nupdater.setFeedURL('http://127.0.0.1:8000')\n\nupdater.checkForUpdatesAndNotify()\n\nupdater.on('update-available', () => {\n    // TODO å¯ä»¥åœ¨è¿™æé†’ç”¨æˆ·æ›´æ–°\n})\n\nupdater.on('download-progress', (progress, bytesPerSecond, percent, total, transferred) => {\n    // TODO æ˜¾ç¤ºè¿›åº¦æ¡\n})\n\nupdater.on('update-downloaded', () => {\n    updater.quitAndInstall()\n})\n\nupdater.on('error', error => {\n    // TODO handle error\n})\n\n// main.js\napp.on(\"will-finish-launching\", () => {\n    require('./update.js')\n})\n```\n\n#### Nginxæ–‡ä»¶æœåŠ¡å™¨\n\n```nginx\nautoindex on;# æ˜¾ç¤ºç›®å½•\nautoindex_exact_size on;# æ˜¾ç¤ºæ–‡ä»¶å¤§å°\nautoindex_localtime on;# æ˜¾ç¤ºæ–‡ä»¶æ—¶é—´\n\nserver {\n    listen       8000 default_server;\n    listen       [::]:8000 default_server;\n    server_name  _;\n    root         /www/update/demo;  # æ–‡ä»¶è·¯å¾„\n\n    location / {\n    }\n\n    error_page 404 /404.html;\n    location = /40x.html {\n    }\n\n    error_page 500 502 503 504 /50x.html;\n    location = /50x.html {\n    }\n}\n```\n\n","tags":["javascript","Electron","æ¡Œé¢ç«¯è½¯ä»¶"],"categories":["Electron"]},{"title":"æµè§ˆå™¨ä¸­çš„éŸ³è§†é¢‘","url":"/posts/4dbf3745.html","content":"\n## æµè§ˆå™¨å¦‚ä½•é‡‡é›†æ‘„åƒå¤´å’Œéº¦å…‹é£\n\næµè§ˆå™¨å¯ä»¥é€šè¿‡`navigator`ä¸Šçš„`mediaDevices`å±æ€§æ¥è·å–éŸ³è§†é¢‘æµæ•°æ®ã€‚`navigator.mediaDevices`è¿”å›ä¸€ä¸ª[MediaDevices](https://developer.mozilla.org/zh-CN/docs/Web/API/MediaDevices)å¯¹è±¡\n\n![mediaDeviceå…¼å®¹æ€§](../../images/mediaDeviceå…¼å®¹æ€§.png)\n\n```javascript\nconst constraints = {\n    audio: true,\n    video: true,\n}\nnavigator.mediaDevices.getUserMedia(constraints).then(stream => {\n    videoElement.srcObject = stream\n    videoElement.onloadedmetadata = () => {\n        videoElement.play()\n    }\n})\n```\n\né€šè¿‡`getUserMedia`å¯ä»¥è·å–æ‘„åƒå¤´è§†é¢‘ä»¥åŠéº¦å…‹é£çš„éŸ³é¢‘ï¼Œå®ƒæ¥å—ä¸€ä¸ª[MediaStreamConstraints](https://developer.mozilla.org/zh-CN/docs/Web/API/MediaStreamConstraints)å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚å¹¶è¿”å›ä¸€ä¸ª[MediaStream](https://developer.mozilla.org/zh-CN/docs/Web/API/MediaStream)å¯¹è±¡\n\n## æµè§ˆå™¨å¦‚ä½•é‡‡é›†æ¡Œé¢\n\n`navigator.mediaDevices`è¿˜æœ‰ä¸€ä¸ª`getDisplayMedia`æ–¹æ³•ï¼Œç”¨æ¥é‡‡é›†æ¡Œé¢ï¼ˆåŒ…æ‹¬éŸ³è§†é¢‘ï¼‰ã€‚ç”¨æ³•å’Œå‚æ•°ä¸`getUserMedia`ä¸€è‡´\n\n```javascript\nconst constraints = {\n    audio: true,\n    video: true,\n}\nnavigator.mediaDevices.getDisplayMedia(constraints).then(stream => {\n    videoElement.srcObject = stream\n    videoElement.onloadedmetadata = () => {\n        videoElement.play()\n    }\n})\n```\n\n## å¦‚ä½•å½•åˆ¶æµ\n\nå½•åˆ¶éŸ³è§†é¢‘æµéœ€è¦é€šè¿‡[MediaRecorder](https://developer.mozilla.org/zh-CN/docs/Web/API/MediaRecorder)å¯¹è±¡\n\nä¸‹ä¾‹æ˜¯å½•åˆ¶éº¦å…‹é£\n\n```javascript\nlet recorder\nnavigator.mediaDevices.getUserMedia(constraints).then(stream => {\n    const mimeType = 'video/mp4'\n    if (MediaRecorder.isTypeSupported(mimeType)) { // åˆ¤æ–­æ˜¯å¦æ”¯æŒè¯¥ç±»å‹\n        recorder = new MediaRecorder(stream, {\n            audioBitsPerSecond : 128000, // éŸ³é¢‘çš„æ¯”ç‰¹ç‡ 128kbps\n            videoBitsPerSecond : 2500000, // è§†é¢‘çš„æ¯”ç‰¹ç‡ 2.5Mbps\n            mimeType\n        })\n        // å½“recorder.stop() è°ƒç”¨åï¼Œ è§¦å‘è¯¥äº‹ä»¶\n        recorder.ondataavailable = e => {\n            // e.data  blobå¯¹è±¡\n            // ...\n        }\n        \n        recorder.start()\n    }\n})\n```\n\n## å¦‚ä½•è§£æéŸ³é¢‘\n\næœ‰æ—¶å€™ä¼šé‡åˆ°éŸ³é¢‘å¯è§†åŒ–çš„éœ€æ±‚ï¼Œæ¯”å¦‚æ’­æ”¾å™¨å¯èƒ½ä¼šæ˜¾ç¤ºéŸ³é¢‘çš„æ³¢å½¢ã€‚è¿™æ—¶å°±éœ€è¦å€ŸåŠ©[AudoContext](https://developer.mozilla.org/zh-CN/docs/Web/API/AudioContext)å¯¹è±¡æ¥å®ç°ã€‚\n\nç›´æ¥ä¸Šä»£ç \n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <title>audio analyser</title>\n  </head>\n  <body>\n    <canvas id=\"canvas\"></canvas>\n    <script>\n      navigator.mediaDevices\n        .getUserMedia({\n          audio: true,\n        })\n        .then((stream) => { // è·å–éº¦å…‹é£çš„éŸ³é¢‘æµ\n            const audioCtx = new AudioContext(); \n            const source = audioCtx.createMediaStreamSource(stream);\n            // åˆ›å»º éŸ³é¢‘åˆ†æå™¨\n            const analyser = audioCtx.createAnalyser();\n\t\t\t\t\n            analyser.fftSize = 2048;\n            const bufferLength = analyser.frequencyBinCount;\n          \t// éŸ³é¢‘æ•°æ®ä¼šæ”¾åœ¨ dataArrayä¸­\n            const dataArray = new Uint8Array(bufferLength);\n\t\t\t\n            source.connect(analyser);\n            analyser.connect(audioCtx.destination);\n\n            function draw() {\n                const canvas = document.querySelector(\"#canvas\");\n                const ctx = canvas.getContext(\"2d\");\n\n                const WIDTH = canvas.width;\n                const HEIGHT = canvas.height;\n\t\t\t\t\n                // å–å‡ºéŸ³é¢‘æ•°æ®ï¼Œæ”¾åˆ°dataArrayä¸­\n                analyser.getByteTimeDomainData(dataArray); \n\t\t\t\t\n                // ** ç»˜åˆ¶æ³¢å½¢ start\n                ctx.fillStyle = \"rgb(200, 200, 200)\";\n                ctx.fillRect(0, 0, WIDTH, HEIGHT);\n\n                ctx.lineWidth = 1;\n                ctx.strokeStyle = \"rgb(0, 0, 0)\";\n\n                var sliceWidth = (WIDTH * 1.0) / bufferLength;\n                var x = 0;\n\n                ctx.beginPath();\n                for (var i = 0; i < bufferLength; i++) {\n                    let v = dataArray[i] / 128.0,\n                        y = (v * HEIGHT) / 2;\n\n                    if (i === 0) ctx.moveTo(x, y);\n                    else ctx.lineTo(x, y);\n\n                    x += sliceWidth;\n                }\n\n                ctx.lineTo(canvas.width, canvas.height / 2);\n                ctx.stroke();\n                // ** ç»˜åˆ¶æ³¢å½¢ end\n\n                requestAnimationFrame(draw); // ç»˜åˆ¶ä¸‹ä¸€å¸§\n            }\n\n            draw();\n        })\n        .catch((err) => {\n            console.log(err);\n        });\n    </script>\n  </body>\n</html>\n\n```\n\n","tags":["javascript","ç½‘ç»œ","WebRTC","audio","video"],"categories":["Media"]},{"title":"WebRTC Introduction","url":"/posts/c51bfcb4.html","content":"\n\n## webRTCç®€ä»‹\n\n### ä»€ä¹ˆæ˜¯webRTCï¼Ÿ\n\nç½‘ç»œå®æ—¶é€šä¿¡ï¼ˆWeb Real Time Communicationï¼‰ï¼Œç”¨æ¥å®ç°æµè§ˆå™¨ä¹‹é—´çš„å®æ—¶é€šä¿¡ã€‚é€šå¸¸ç”¨æ¥ä¼ è¾“éŸ³è§†é¢‘æµï¼Œå®ç°è§†é¢‘èŠå¤©ã€ç›´æ’­ç­‰åŠŸèƒ½ã€‚\n\n### å…¼å®¹æ€§\n\n![pic](../../images/webrtcå…¼å®¹æ€§.png)\n\nieï¼Ÿieå°±ä¸åº”è¯¥æœ‰è¿™ç§éœ€æ±‚ï¼ï¼\n\n## webRTCä¸­æ¶‰åŠåˆ°çš„æ¦‚å¿µ\n\n1. sdpï¼šsdpæè¿°äº†å„ç«¯çš„èƒ½åŠ›ï¼ˆä¾‹å¦‚æ”¯æŒçš„éŸ³è§†é¢‘è§£æ”¾ã€ä¼ è¾“åè®®ç­‰ä¿¡æ¯ï¼‰ã€‚å»ºç«‹webRTCè¿æ¥æ—¶ï¼Œä¸¤ç«¯ä¼šäº¤æ¢å¯¹æ–¹çš„sdpã€‚è¿™æ ·å°±çŸ¥é“å¯¹æ–¹çš„ä¿¡æ¯ã€‚\n   1. offerï¼šé€šå¸¸å…ˆå‘é€sdpä¸€æ–¹çš„sdpè¢«ç§°ä¸ºoffer\n   2. answerï¼šå¦ä¸€æ–¹æ”¶åˆ°offeråå‘é€çš„sdpè¢«ç§°ä¸ºanswer\n2. ice candidateï¼šåŒ…å«äº† WebRTC ä¸è¿œç«¯é€šä¿¡æ—¶ä½¿ç”¨çš„åè®®ã€IP åœ°å€å’Œç«¯å£ç­‰æ•°æ®ã€‚å½“åŒç«¯äº¤æ¢å®Œsdpæ•°æ®åï¼Œå°±ä¼šæ”¶é›†candidateä¿¡æ¯ã€‚åŒæ ·åŒç«¯ä¹Ÿè¦äº¤æ¢candidateæ•°æ®\n3. NATï¼š ç½‘ç»œåœ°å€è½¬æ¢ã€‚ç”±äºipv4åœ°å€ä¸å¤Ÿç”¨ï¼Œæˆ‘ä»¬çš„ä¸ªäººpcåœ¨æœ¬åœ°ä½¿ç”¨çš„æ˜¯å†…ç½‘ipï¼ˆä¾‹å¦‚:192.168.1.2ï¼‰ã€‚å½“è®¿é—®å…¬ç½‘ä¸Šçš„èµ„æºæ˜¯ï¼Œè¯·æ±‚ç»è¿‡è·¯ç”±å™¨æ—¶ï¼Œä¼šå°†å†…ç½‘åœ°å€è½¬æ¢æˆå…¬ç½‘åœ°å€ï¼Œå†å‘ç»™ç›®çš„æœåŠ¡å™¨\n4. p2pï¼šç‚¹å¯¹ç‚¹ï¼ˆpeer to peerï¼‰ã€‚æŒ‡è¿æ¥åŒç«¯ç›´æ¥é€šä¿¡ï¼Œä¸éœ€è¦ç»è¿‡ä¸­é—´æœåŠ¡å™¨ã€‚webRTCå°±èƒ½å®ç°p2pï¼Œåªæœ‰å½“p2på¤±è´¥æ‰ä¼šé‡‡ç”¨æœåŠ¡å™¨ä¸­ç»§\n\n\n## å»ºç«‹è¿æ¥\n\n### è¿æ¥æµç¨‹\n\n![è¿æ¥æµç¨‹](../../images/rtcè¿æ¥æ—¶åºå›¾.png)\n\n### ç¼–ç \n\n```typescript\n// A ç«¯\n\nfunction sendToB() {\n    // ...å‘é€ç»™B\n}\nfunction onMsgFromB(callback) {\n    // è·å¾—æ¥è‡ªBçš„æ•°æ®\n}\n\nfunction getStreamFromA() {\n    // è·å–Açš„éŸ³è§†é¢‘æµ\n}\n\n// 1. å…ˆå»ºç«‹rtcè¿æ¥\nconst pc = new RTCpeerConnection()\n// 2. æ·»åŠ éŸ³è§†é¢‘æµ\nconst stream = getStreamFromA()\nfor (const track of stream.getTracks()) {\n    pc.addTrack(track);\n}\n\n// 3. åˆ›å»ºoffer\npc.createOffer().then(offer => {\n    // 4.è®¾ç½®æœ¬åœ°\n    pc.setLocalDescription(offer)\n    // 5. å°†offerå‘é€ç»™B\n    sendToB({type: 'offer', data: offer})\n})\n\nonMsgFromB(({type, data}) => {\n    if(type === 'answer') {\n        // 12.è®¾ç½®è¿œç¨‹answer\n        pc.setRemoteDescription(data)\n    }\n})\n\npc.ontrack = (e) => {\n    const stream = e.streams[0]\n    video.srcObject = stream // æ’­æ”¾æµ\n}\n\n\n// Bç«¯\nfunction sendToA() {\n    // ...å‘é€ç»™A\n}\nfunction onMsgFromA(callback) {\n    // è·å¾—æ¥è‡ªAçš„æ•°æ®\n}\nfunction getStreamFromA() {\n    // è·å–Bçš„éŸ³è§†é¢‘æµ\n}\n// 6. å…ˆå»ºç«‹rtcè¿æ¥\nconst pc = new RTCpeerConnection()\n\n// 7. æ·»åŠ éŸ³è§†é¢‘æµ\nconst stream = getStreamFromA()\nfor (const track of stream.getTracks()) {\n    pc.addTrack(track);\n}\n\nonMsgFromB(({type, data}) => {\n    if(type === 'offer') {\n        // 8. è®¾ç½®offer\n        pc.setRemoteDescription(data)\n        // 9.åˆ›å»ºanswer\n        pc.createAnswer().then(answer => {\n            // 10.è®¾ç½®æœ¬åœ°\n            pc.setLocalDescription(answer)\n            // 11. å°†answerå‘é€ç»™A\n            sendToB({type: 'answer', data: answer})\n        })\n    }\n})\n\npc.ontrack = (e) => {\n    const stream = e.streams[0]\n    video.srcObject = stream // æ’­æ”¾æµ\n}\n```\n\n> æ·»åŠ æµç”¨çš„æ˜¯addTrackæ²¡æœ‰ä½¿ç”¨addStreamï¼ˆå³å°†åºŸå¼ƒï¼‰ã€‚addtrack å’Œ ontrack æ˜¯æœ€æ–°çš„APIã€‚\n>\n> è§†é¢‘æµçš„è·å–ï¼Œè¯·å‚è€ƒå¦ä¸€ç¯‡æ–‡ç« [æµè§ˆå™¨ä¸­çš„éŸ³è§†é¢‘](https://zxffan.github.io/posts/4dbf3745.html)\n\n## candidate\n\nåŒç«¯äº¤æ¢sdpåï¼Œå¹¶æœªçœŸæ­£å»ºç«‹è¿æ¥ã€‚ç„¶åè¿˜éœ€è¦æ”¶é›†åŒæ–¹çš„candidateï¼ˆä¸æ­¢ä¸€ä¸ªå“¦ï¼‰å¹¶äº¤æ¢ã€‚ç„¶åæµè§ˆå™¨ä¼šæŒ‰ç…§candidateåˆ—è¡¨é€ä¸€æµ‹è¯•è¿é€šæ€§ï¼Œç›´åˆ°æœ‰ä¸€æ¡candidateè¿æ¥ï¼ŒwebRTCè¿æ¥æ‰ç®—çœŸæ­£çš„å»ºç«‹ã€‚\n\n### è¿æ¥æµç¨‹\n\n![ice candidate](../../images/ice_candidate.png)\n\nSTUNå’ŒTURNä¸‹é¢ä¼šå±•å¼€ï¼Œæš‚ä¸”ç†è§£ä¸ºéƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šçš„æœåŠ¡ï¼Œç”¨æ¥è·å–æ•°æ®ç”Ÿæˆcandidateçš„ã€‚\n\n### ç¼–ç \n\n```typescript\n// åŸºäºä¸Šé¢ä¿®æ”¹\n// 1. è¯·æ±‚ï¼Œ RTCpeerConnectionä¼šè‡ªå·±åš\n\n// A ç«¯\n// 2. æœåŠ¡å™¨ï¼ˆSTUN/TURNï¼‰è¿”å›candidate\npc.onicecandidate = (iceEvent) => {\n    // 3. å‘é€iceEvent(æˆ–è€…ç›´æ¥å‘é€candidateä¹Ÿå¯ä»¥)ç»™Bç«¯\n    sendToB({type: 'candidate', data: iceEvent})\n}\nonMsgFromB(({type, data}) => {\n    \n    // ...\n    \n    if(type === 'candidate') {\n        pc.addIceCandidate(data.candidate)\n    }\n})\n\n// B ç«¯\n\n// 5. æœåŠ¡å™¨ï¼ˆSTUN/TURNï¼‰è¿”å›candidate\npc.onicecandidate = (iceEvent) => {\n    // 6. å‘é€iceEventfç»™Aç«¯\n    sendToA({type: 'candidate', data: iceEvent})\n}\nonMsgFromB(({type, data}) => {\n  \n    // ...\n    \n    if(type === 'candidate') {\n        // 4. è®¾ç½®Aç«¯å‘æ¥çš„çš„candidate\n        pc.addIceCandidate(data.candidate)\n    }\n})\n```\n\n## STUN/TURN\n\nSTUNå’ŒTURNæ˜¯ä¸¤ä¸ªæœåŠ¡ï¼ŒRTCPeerConnectionä¼šè‡ªåŠ¨è¯·æ±‚è¿™ä¸¤ä¸ªæœåŠ¡æ¥è·å–candidateã€‚\n\n```typescript\n// åŸºäºä¸Šé¢çš„ä»£ç \n\n// Aç«¯ & Bç«¯\n\n// å»ºç«‹RTCpeerConnectionæ—¶ï¼Œé…ç½®æœåŠ¡åœ°å€\nconst pc = new RTCpeerConnection({\n  iceServers: [\n    { urls: \"stun:47.94.xxx.xx:3478\" },\n    { urls: \"turn:47.94.xxx.xx:3478\", username: \"usrname\", credential: \"password\" },\n  ],\n})\n\n\n```\n\n### STUN\n\nä¸¤ä¸ªå¤„äºä¸åŒç½‘æ®µçš„å®¢æˆ·ç«¯éœ€è¦ç‚¹å¯¹ç‚¹é€šä¿¡å¿…é¡»çŸ¥é“å¯¹æ–¹çš„å…¬ç½‘ipï¼Œå¹¶ä¸”åœ¨åŒæ–¹çš„NATæ˜ å°„è¡¨ä¸­å¿…é¡»æœ‰ä¸€æ¡æ˜ å°„è®°å½•ã€‚STUNæœåŠ¡ç”¨æ¥è·å–å…¬ç½‘åœ°å€ã€‚å¤„äºä¸åŒç½‘æ®µçš„ä¸¤å°å®¢æˆ·ç«¯ï¼Œéœ€è¦è®¿é—®STUNæœåŠ¡æ¥è·å–å…¶å…¬ç½‘åœ°å€ã€‚\n\n### TURN\n\nå½“ç‚¹å¯¹ç‚¹é€šä¿¡å¤±è´¥åï¼Œå°†ä¼šé‡‡ç”¨ä¸­ç»§çš„æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯æ•°æ®èµ°æœåŠ¡å™¨è½¬å‘ã€‚TURNå°±æ˜¯ç”¨æ¥å®ç°ä¸­ç»§çš„ã€‚\n\n### éƒ¨ç½²STUN/TURN\n\n`conturn`åº”è¯¥æ˜¯æ¯”è¾ƒçŸ¥åçš„STUN/TURNæœåŠ¡å™¨ã€‚\n\nå¦‚ä½•éƒ¨ç½²è¯·è‡ªè¡ŒæŸ¥é˜…èµ„æ–™ï¼Œæˆ–å‚è€ƒå®˜æ–¹[git repo](https://github.com/coturn/coturn)\n\n### candidateåˆ—è¡¨\n\nä»¥ä¸‹æµ‹è¯•ï¼ŒAç«¯ï¼ˆ192.168.1.134ï¼‰å’ŒBç«¯ï¼ˆ192.168.1.134ï¼‰éƒ½æ˜¯æˆ‘æœ¬æœºã€‚\n\nwebRTCçš„candidateåˆ†ä¸ºä¸‰ç±»\n\n- host ç±»å‹ï¼Œå³æœ¬æœºå†…ç½‘çš„ IP å’Œç«¯å£\n- srflx ç±»å‹, å³æœ¬æœº NAT æ˜ å°„åçš„å¤–ç½‘çš„ IP å’Œç«¯å£\n- relay ç±»å‹ï¼Œå³ä¸­ç»§æœåŠ¡å™¨çš„ IP å’Œç«¯å£\n\n![candidate-list](../../images/candidate-list.png)\n\n1. webRTCä¼šå…ˆæµ‹è¯•hostç±»å‹çš„candidateã€‚è¿™ç§ç±»å‹æ—¶æœ€å®¹æ˜“æ”¶é›†çš„ã€‚å°±ç®—æ²¡æœ‰é…ç½®STUN/TURNä¹Ÿèƒ½æ”¶é›†åˆ°ã€‚å¦‚æœæµ‹é€šäº†å°±æ²¡å¿…è¦å¾€ä¸‹æµ‹è¯•äº†ã€‚\n2. srflxç±»å‹çš„candidateåŒ…å«å…¬ç½‘ipä¿¡æ¯ã€‚å®ƒæ˜¯ä»stunæœåŠ¡å™¨è·å–çš„ã€‚\n3. å½“å‰ä¸¤ç§éƒ½æ²¡è¿é€šï¼Œå°±ä¼šæµ‹è¯•relayç±»å‹çš„candidateï¼Œä¹Ÿå°±æ˜¯é€šè¿‡turnæœåŠ¡è¿›è¡Œä¸­ç»§ã€‚\n\n## ä¿¡ä»¤æœåŠ¡\n\nå‰é¢å†™äº†è¿™ä¹ˆä¸€æ®µä»£ç \n\n```typescript\n// Aç«¯\nfunction sendToB() {\n    // ...å‘é€ç»™B\n}\nfunction onMsgFromB(callback) {\n    // è·å¾—æ¥è‡ªBçš„æ•°æ®\n}\n\n// Bç«¯åŒç†\n```\n\nåŸ‹äº†ä¸€ä¸ªä¼ç¬”ï¼ŒsendToBå¦‚ä½•å®ç°ã€‚ç­”æ¡ˆå°±æ˜¯ä¿¡ä»¤æœåŠ¡\n\n### æ¦‚å¿µ\n\nä¿¡ä»¤æœåŠ¡å°±æ˜¯åœ¨é€šä¿¡çš„åŒç«¯ä¹‹é—´æ­å»ºçš„ä¸€ä¸ªç”¨äºå»ºç«‹webRTCè¿æ¥çš„æœåŠ¡ï¼Œç”¨äºè½¬å‘sdpã€candidateç­‰ã€‚\n\nä¿¡ä»¤æœåŠ¡å¯ä»¥æ˜¯ä¸€ä¸ªwebSocketæœåŠ¡ï¼Œç”¨æ¥è¿›è¡ŒAã€Bç«¯ä¹‹é—´çš„åª’ä½“åå•†ã€‚\n\n> åª’ä½“åå•†å°±æ˜¯æŒ‡äº¤æ¢sdpå’Œcandidateçš„è¿‡ç¨‹\n\n### æµç¨‹\n\n![ä¿¡ä»¤æœåŠ¡](../../images/ä¿¡ä»¤æœåŠ¡.png)\n\n### ç¼–ç \n\n```typescript\nconst WebSocket = require(\"ws\");\nconst wss = new WebSocket.Server({ port: 3001 });\nconst code2Ws = new Map();\n\nwss.on(\"connection\", (ws, request) => {\n  ws.isAlive = true;\n  let code;\n  ws.sendData = (event, data) => {\n    ws.send(JSON.stringify({ event, data }));\n  };\n\n  ws.sendError = (msg) => ws.sendData(\"error\", msg);\n\n  ws.on(\"message\", (message) => {\n    try {\n      const parsedMsg = JSON.parse(message);\n      const { event, data } = parsedMsg;\n\n      switch (event) {\n        case \"login\":\n          //  ä¸ºå®¢æˆ·ç«¯ç”Ÿæˆå”¯ä¸€æ ‡è¯†ï¼Œä¹Ÿå¯ä»¥ç”±å®¢æˆ·ç«¯å‘é€æ ‡è¯†ï¼ˆå¦‚macåœ°å€ï¼‰\n          code = data.code || Math.floor(Math.random() * (9999999 - 1000000)) + 100000 + \"\";\n          code2Ws.set(code, ws); // è®°å½•\n          ws.sendData(\"login\", { code }); // èŒƒå›´æ ‡è¯†\n          break;\n        case \"communicate\":\n          const remote = data.remote; // éœ€è¦é€šä¿¡çš„å®¢æˆ·ç«¯æ ‡è¯†\n          if (code2Ws.has(remote)) { // å­˜åœ¨å°±å»ºç«‹ä¸¤ç«¯ä¹‹é—´çš„æ˜ å°„å…³ç³»\n            ws.sendData(\"communicate\", { success: true }); // é€šçŸ¥Aç«¯\n            ws.sendRemote = code2Ws.get(remote).sendData;\n            code2Ws.get(remote).sendRemote = ws.sendData;\n            ws.sendRemote(\"communicate\", { remote: code }); // é€šçŸ¥Bç«¯\n          } else {\n            ws.sendData(\"communicate\", { success: false }); // æ²¡æœ‰ï¼Œåˆ™é€šçŸ¥Aï¼Œå¤±è´¥\n          }\n          break;\n        case \"forward\":\n          ws.sendRemote && ws.sendRemote(data); // è½¬å‘æ¶ˆæ¯\n          break;\n      }\n    } catch (e) {\n      ws.sendError(\"message invalid\");\n      return;\n    }\n  });\n  \n  // è¿æ¥å…³é—­ å°±åˆ é™¤å½“å‰å®¢æˆ·ç«¯çš„æ ‡è¯†\n  ws.on(\"close\", () => {\n    code2Ws.delete(code);\n  });\n});\n\n// å®šæ—¶æ£€æµ‹è¿æ¥\nconst interval = setInterval(function ping() {\n  wss.clients.forEach(function each(ws) {\n    if (ws.isAlive === false) return ws.terminate();\n\n    ws.isAlive = false;\n  });\n}, 5 * 60 * 1000);\n\nwss.on(\"close\", function close() {\n  clearInterval(interval);\n});\n\n```\n\n## æ•°æ®é€šé“ï¼ˆRTCDataChannelï¼‰\n\nåª’ä½“åå•†ä¸€æ—¦å®Œæˆå°±å¯ä»¥å…³é—­ä¸ä¿¡ä»¤æœåŠ¡çš„è¿æ¥å³å…³é—­webSocketè¿æ¥ã€‚ä¹‹åçš„æ•°æ®ä¼ è¾“å¯ä»¥é€šè¿‡`æ•°æ®é€šé“`æ¥ä¼ è¾“ã€‚\n\n### æ¦‚å¿µ\n\nå»ºç«‹webRTCè¿æ¥çš„ä¸¤ç«¯èƒ½å¤Ÿå¼€è¾Ÿä¸€ä¸ªæ•°æ®é€šé“ï¼Œç”¨æ¥ä¼ è¾“ééŸ³è§†é¢‘æµæ•°æ®ï¼Œæ¯”å¦‚æ–‡å­—èŠå¤©ã€æ–‡ä»¶ä¼ è¾“ã€è¿œç¨‹æ¡Œé¢ã€æ¸¸æˆæ§åˆ¶ã€P2P åŠ é€Ÿç­‰ã€‚\n\n###  åŒå‘é€šä¿¡\n\nRTCDataChannelå¯ä»¥å®ç°åŒå‘é€šä¿¡ï¼Œæœ‰ä¸¤ç§æ¨¡å¼\n\n- `In-band`(é»˜è®¤)ï¼šå‡è®¾é€šä¿¡åŒæ–¹ä¸­çš„ä¸€æ–¹è°ƒç”¨ createDataChannel åˆ›å»º RTCDataChannel å¯¹è±¡æ—¶ï¼Œå°† options å‚æ•°ä¸­çš„ negotiated å­—æ®µè®¾ç½®ä¸º falseï¼Œåˆ™é€šä¿¡çš„å¦ä¸€æ–¹å°±å¯ä»¥é€šè¿‡å®ƒçš„ RTCPeerConnection å¯¹è±¡çš„ ondatachannel äº‹ä»¶æ¥å¾—åˆ°ä¸å¯¹æ–¹é€šä¿¡çš„ RTCDataChannel å¯¹è±¡äº†ï¼Œè¿™ç§æ–¹å¼å°±æ˜¯ In-band åå•†æ–¹å¼ã€‚\n- `Out-fo-band`ï¼šè¿™ç§æ–¹å¼ä¸å†æ˜¯ä¸€ç«¯è°ƒç”¨ createDataChannelï¼Œå¦ä¸€ç«¯ç›‘å¬ ondatachannel äº‹ä»¶ï¼Œä»è€Œå®ç°åŒæ–¹çš„æ•°æ®é€šä¿¡ï¼›è€Œæ˜¯ä¸¤ç«¯éƒ½è°ƒç”¨ createDataChannel æ–¹æ³•åˆ›å»º RTCDataChannel å¯¹è±¡ï¼Œå†é€šè¿‡ ID ç»‘å®šæ¥å®ç°åŒæ–¹çš„æ•°æ®é€šä¿¡ã€‚\n\n### å®ç°\n\n#### In-band\n\n```typescript\n// Aç«¯\nconst pc = new RTCPeerConnection({ negotiated: true });\nconst dc = pc.createDataChannel(\"my channel\");\n\ndc.onmessage = function (event) {\n    console.log(\"received: \" + event.data);\n};\n\ndc.onopen = function () {\n    console.log(\"datachannel open\");\n};\n\ndc.onclose = function () {\n    console.log(\"datachannel close\");\n};\n\n// Bç«¯\npc.ondatachannel = (e) => {\n    const dc = e.channel // è·å–\n    dc.onmessage = (e) => {\n        console.log(e.data)\n    };\n};\n```\n\n#### out-of-band\n\n```typescript\n// A ç«¯\nconst pc = createDataChannel({ negotiated: true, id: 0 });\nconst dc = pc.createDataChannel(\"my channel\");\n\ndc.onmessage = function (event) {\n    console.log(\"received: \" + event.data);\n};\n\ndc.onopen = function () {\n    console.log(\"datachannel open\");\n};\n\ndc.onclose = function () {\n    console.log(\"datachannel close\");\n};\n\n// B ç«¯\nconst pc = createDataChannel({ negotiated: true, id: 0 });\nconst dc = pc.createDataChannel(\"my channel\");\n\ndc.onmessage = function (event) {\n    console.log(\"received: \" + event.data);\n};\n\ndc.onopen = function () {\n    console.log(\"datachannel open\");\n};\n\ndc.onclose = function () {\n    console.log(\"datachannel close\");\n};\n```\n\n>æ³¨æ„ï¼šRTCDataChannelå¯¹è±¡éœ€è¦åœ¨åª’ä½“åå•†å‰åˆ›å»ºã€‚\n\n## æ€»ç»“\n\næœ¬æ–‡åªè®¨è®ºå¦‚ä½•ä½¿ç”¨webRTCå»ºç«‹ä¸€å¯¹ä¸€é€šä¿¡ã€‚æ²¡æœ‰æ¶‰åŠåˆ°å¤šå¯¹å¤šåœºæ™¯ã€‚\n\nç¨ç¨æƒ³æƒ³ï¼Œå¦‚æœè€ƒè™‘å¤šå¯¹å¤šçš„è¯ï¼Œä¿¡ä»¤æœåŠ¡å™¨åº”è¯¥è®¾è®¡æˆä¸€ä¸ªæˆ¿é—´è€Œä¸æ˜¯ç°åœ¨è¿™ç§æ˜ å°„è¡¨ï¼Œæ•°æ®æµåº”è¯¥ä¹Ÿè¦é€šè¿‡ä¸€ä¸ªæµåª’ä½“æœåŠ¡å™¨ï¼Œåº”è¯¥ä¸èƒ½æ˜¯p2päº†ã€‚å¾…æˆ‘å…ˆç ”ç©¶ä¸€ä¸‹ï¼Œæœ‰æ—¶é—´å†å†™ä¸€ç¯‡å…³äºå®ç°å¤šå¯¹å¤šçš„æ–¹æ¡ˆã€‚\n\n","tags":["javascript","ç½‘ç»œ","WebRTC"],"categories":["Media"]},{"title":"æ­£åˆ™è¡¨è¾¾å¼","url":"/posts/2f57a694.html","content":"\n## REGEXPå¯¹è±¡\n\nä¸¤ç§å®ä¾‹åŒ–RegExpå¯¹è±¡\n\n1. å­—é¢é‡\n2. æ„é€ å‡½æ•°\n\n```javascript\n// å­—é¢é‡\nvar reg = /\\bis\\b/  // \\bè¡¨ç¤ºå•è¯è¾¹ç•Œ\n\n'He is a boy. This is a dog. Where is she?'.replace(reg, 'IS') // åªä¼šæ›¿æ¢ä¸€å¤„\n// He IS a boy. This is a dog. Where is she\n\nreg = /\\bis\\b/g // g ä»£è¡¨ global\n'He is a boy. This is a dog. Where is she?'.replace(reg, 'IS') // æŒ‡æŒ¥æ›¿æ¢ä¸€å¤„\n// He IS a boy. This IS a dog. Where IS she\n\n\n\n// æ„é€ å‡½æ•°\nvar  reg = new RegExp('\\\\bis\\\\b', 'g')\n'He is a boy. This is a dog. Where is she?'.replace(reg, 'IS') // æŒ‡æŒ¥æ›¿æ¢ä¸€å¤„\n// He IS a boy. This IS a dog. Where IS she\n```\n\n## ä¿®é¥°ç¬¦\n\n1. gï¼šglobal å…¨æ–‡æœç´¢\n2. iï¼šå¿½ç•¥å¤§å°å†™\n3. mï¼šå¤šè¡Œæœç´¢\n\n## å…ƒå­—ç¬¦\n\næ­£åˆ™è¡¨è¾¾å¼æœ‰ä¸¤ç§åŸºæœ¬å­—ç¬¦ç±»å‹ç»„æˆ\n\n1. æ„¿æ„æ–‡æœ¬å­—ç¬¦ abc\n2. å…ƒå­—ç¬¦ï¼ˆå«æœ‰ç‰¹æ®Šå«ä¹‰çš„éå­—æ¯å­—ç¬¦ï¼‰\n\n## å­—ç¬¦ç±»\n\nå…ƒå­—ç¬¦[]æ¥æ„å»ºä¸€ä¸ªç±»ï¼Œæ¥åŒ¹é…ä¸€ç±»å­—ç¬¦\n\n[abc]æ¥åŒ¹é…aæˆ–bæˆ–c\n\n^å¯ä»¥åˆ›å»ºåå‘ç±»ï¼Œ\\[^abc]è¡¨ç¤ºä¸æ˜¯aæˆ–bæˆ–cçš„å­—ç¬¦\n\n## èŒƒå›´ç±»\n\n[a-z]è¡¨ç¤ºaåˆ°zçš„ä»»æ„å­—ç¬¦ï¼ˆåŒ…å«aå’Œzï¼‰\n\n[a-zA-z]\n\n[0-9]\n\n[0-9-]åŒ¹é…0åˆ°9å’Œæ¨ªçº¿-\n\n## é¢„å®šä¹‰ç±»\n\n| å­—ç¬¦ | ç­‰ä»·ç±»          | å«ä¹‰                             |\n| ---- | --------------- | -------------------------------- |\n| .    | [^\\r\\n]         | é™¤äº†å›è½¦ç¬¦å’Œæ¢è¡Œç¬¦ä¹‹å¤–çš„æ‰€æœ‰å­—ç¬¦ |\n| \\d   | [0-9]           | æ•°å­—å­—ç¬¦                         |\n| \\D   | [^0-9]          | éæ•°å­—å­—ç¬¦                       |\n| \\s   | [\\t\\n\\x0B\\f\\r]  | ç©ºç™½ç¬¦                           |\n| \\S   | [^\\t\\n\\x0B\\f\\r] | éç©ºç™½ç¬¦                         |\n| \\w   | [a-zA-Z_0-9]    | å•è¯å­—ç¬¦ï¼ˆæ•°å­—ã€å­—æ¯ä¸‹åˆ’çº¿ï¼‰     |\n| \\W   | [^a-zA-Z_0-9]   | éå•è¯å­—ç¬¦                       |\n\n## è¾¹ç•Œ\n\n| å­—ç¬¦ | å«ä¹‰       |\n| ---- | ---------- |\n| ^    | ä»¥xxxå¼€å§‹  |\n| $    | ä»¥xxxç»“æŸ  |\n| \\b   | å•è¯è¾¹ç•Œ   |\n| \\B   | éå•è¯è¾¹ç•Œ |\n\n## é‡è¯\n\n| å­—ç¬¦  | å«ä¹‰                     |\n| ----- | ------------------------ |\n| ï¼Ÿ    | å‡ºç°é›¶æ¬¡æˆ–ä¸€æ¬¡           |\n| +     | å‡ºç°ä¸€æ¬¡æˆ–å¤šæ¬¡           |\n| *     | å‡ºç°é›¶æ¬¡æˆ–å¤šæ¬¡ï¼ˆä»»æ„æ¬¡ï¼‰ |\n| {n}   | å‡ºç°næ¬¡                  |\n| {n,m} | å‡ºç°nåˆ°mæ¬¡               |\n| {n,}  | è‡³å°‘å‡ºç°næ¬¡              |\n\n## è´ªå©ªæ¨¡å¼å’Œéè´ªå©ªæ¨¡å¼\n\n```javascript\n'12345678'.replace(/\\d{3,6}/g, 'X') // ä¼šå°½é‡å¤šåœ°åŒ¹é…-è´ªå©ªæ¨¡å¼\n// X78\n\n// åœ¨é‡è¯åé¢åŠ ä¸Š?-éè´ªå©ªæ¨¡å¼\n'12345678'.replace(/\\d{3,6}?/g, 'X') // éè´ªå©ªæ¨¡å¼\n// XX78\n```\n\n## åˆ†ç»„\n\nä½¿ç”¨()å®ç°åˆ†ç»„çš„åŠŸèƒ½\n\n```javascript\n'a1b2c3d4'.replace(/[a-z]\\d{3}/g, 'X')\n// a1b2c3d4\n\n'a1b2c3d4'.replace(/([a-z]\\d){3}/g, 'X')\n// Xd4\n```\n\n## æˆ–\n\nä½¿ç”¨|å¯ä»¥å®ç°æˆ–çš„æ•ˆæœ\n\n## åå‘å¼•ç”¨\n\n2015-12-25 => 12-25-2015\n\n```js\n'2015-12-25'.replace(/(\\d{4})-(\\d{2})-(\\d{2})/g, '$2-$3-$1')\n// 12-25-2015\n```\n\n## å¿½ç•¥åˆ†ç»„\n\nä½¿ç”¨?:æ¥å¿½ç•¥åˆ†ç»„\n\n(?:Byron).(ok)\n\n$1æŒ‡çš„æ˜¯ ok\n\n## æ–­è¨€\n\næ­£åˆ™è¡¨è¾¾å¼ä»æ–‡æœ¬å¤´éƒ¨å‘å°¾éƒ¨å¼€å§‹è§£æï¼Œæ–‡æœ¬å°¾éƒ¨æ–¹å‘ï¼Œæˆä¸ºâ€œæ­£å‘â€\n\næ­£å‘æ–­è¨€å°±æ˜¯åœ¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ°è§„åˆ™çš„æ—¶å€™ï¼Œå‘å‰æ£€æŸ¥æ˜¯å¦ç¬¦åˆæ–­è¨€\n\nJavaScriptä¸æ”¯æŒåå‘æ–­è¨€\n\nES2018ï¼ˆES9ï¼‰æ–°å¢åå‘æ–­è¨€\n\nç¬¦åˆå’Œä¸ç¬¦åˆç‰¹å®šæ–­è¨€æˆä¸ºè‚¯å®š/æ­£å‘åŒ¹é…å’Œå¦å®š/åå‘åŒ¹é…\n\n| åç§°         | æ­£åˆ™           | å«ä¹‰ |\n| ------------ | -------------- | ---- |\n| æ­£å‘æ–­è¨€     | exp(?=assert)  |      |\n| å¦å®šæ­£å‘æ–­è¨€ | exp(?!assert)  |      |\n| åå‘æ–­è¨€     | exp(?<=assert) |      |\n| å¦å®šåå‘æ–­è¨€ | exp(?<!assert) |      |\n|              |                |      |\n\n```javascript\n'a2*34v8'.replace(/\\w(?=\\d)/g, 'X')\n// X2*34X8\n\n'a2*34vv'.replace(/\\w(?!\\d)/g, 'X')\n// aX*3XXX\n\nvar match = /(?<=\\D)\\d+/.exec('$123.89')\nconsole.log( match[0] ); // 123\n\nvar match = /(?<!\\D)\\d+/.exec('$123.89')\nconsole.log( match[0] ); // 23\n\n```\n\n## å¯¹è±¡å±æ€§\n\nglobal: æ˜¯å¦å…¨æ–‡æœç´¢ï¼Œé»˜è®¤false\n\nignore caseï¼šæ˜¯å¦å¤§å°å†™æ•æ„Ÿï¼Œé»˜è®¤false\n\nmultilineï¼šå¤šè¡Œæœç´¢ï¼Œé»˜è®¤false\n\nlastIndexï¼šæ˜¯å½“å‰ç™½è¡¨è¾¾å¼åŒ¹é…å†…å®¹æœ€åä¸€ä¸ªå­—ç¬¦çš„ä¸‹ä¸€ä¸ªä½ç½®\n\nsourceï¼šæ­£åˆ™è¡¨è¾¾å¼çš„æ–‡æœ¬å­—ç¬¦ä¸²\n\n## æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹æ³•\n\n### testæ–¹æ³•\n\næ£€æµ‹å­—ç¬¦ä¸²ä¸­æ˜¯å¦æœ‰åŒ¹é…æ­£åˆ™çš„å†…å®¹ï¼Œè‹¥æœ‰è¿”å›trueï¼Œæ²¡æœ‰è¿”å›false\n\n```javascript\nvar reg1 = /\\w/\nvar reg2 = /\\w/g\n\nreg1.test('a') // true\nreg2.test('$') // false\n\nwhile(reg2.test('ab')) {\n    console.log(reg2.lastIndex)\n}\n// 1\n// 2\n```\n\n**å‘**\n\nä½¿ç”¨testæ—¶ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¸è¦ä½¿ç”¨gï¼ˆå…¨å±€åŒ¹é…ï¼‰ï¼Œå¦‚ä¸‹\n\n```javascript\nvar reg = /\\w/g\nundefined\nreg.test(\"wom\")\n// true\nreg.test(\"wom\")\n// true\nreg.test(\"wom\")\n// true\nreg.test(\"wom\")\n// false\nreg.test(\"wom\")\n// true\n```\n\nç¬¬å››æ¬¡åŒ¹é…å˜æˆäº†falseï¼Œè¿™æ˜¯å› ä¸ºæ¯æ¬¡åŒ¹é…éƒ½ä¼šæ”¹å˜regçš„lastIndexå±æ€§ã€‚ä¸‹æ¬¡åŒ¹é…åœ¨ä»lastIndexä½ç½®å¼€å§‹åŒ¹é…ã€‚ç¬¬å››æ¬¡åŒ¹é…å‰lastIndexä¸º3ï¼Œä»indexä¸º3çš„ä½ç½®å¼€å¯åŒ¹é…æ‰€ä»¥åŒ¹é…ä¸åˆ°ï¼Œè¿™æ¬¡åŒ¹é…å®ŒålastIndexåˆæ”¹æˆ0æ‰€ä»¥ä¸‹æ¬¡åˆèƒ½åŒ¹é…åˆ°ã€‚\n\n### execæ–¹æ³•\n\næœªåŒ¹é…åˆ°è¿”å›nullï¼ŒåŒ¹é…åˆ°è¿”å›ä¸€ä¸ªç»“æœæ•°ç»„\n\nè¿”å›çš„æ•°ç»„\n\n1. ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…çš„æ–‡æœ¬\n2. ç¬¬äºŒä¸ªå…ƒç´ æ˜¯ä¸RegExpObjectçš„ç¬¬ä¸€ä¸ªå­è¡¨è¾¾å¼ç›¸åŒ¹é…çš„æ–‡æœ¬ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œå­è¡¨è¾¾å¼å°±æ˜¯åˆ†ç»„ï¼Œä¹Ÿå°±æ˜¯æŒ‡åˆ†ç»„åŒ¹é…çš„æ–‡æœ¬\n3. ç¬¬ä¸‰ä¸ªå…ƒç´ æ˜¯ä¸RegExpå¯¹è±¡çš„ç¬¬äºŒä¸ªå­è¡¨è¾¾å¼ç›¸åŒ¹é…çš„æ–‡æœ¬ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œä¾æ­¤ç±»æ¨\n\n```javascript\nvar reg1 = /\\d(\\w)(\\w)\\d/\nvar reg2 = /\\d(\\w)(\\w)\\d/g\n\nvar ts = \"ab1cd2fg3hi4jk5mop\"\n\n// éå…¨å±€åŒ¹é…-ä¸å­˜åœ¨lastIndex\nvar ret = reg1.exec(ts)\nconsole.log(ret)\n/* è¾“å‡º\nÂ [\"1cd2\", \"c\", \"d\", index: 2, input: \"ab1cd2fg3hi4jk5mop\", groups: undefined]\n*/\n\n\n\n// å…¨å±€åŒ¹é…-éœ€è¦å¾ªç¯ï¼Œæ¯æ¬¡åŒ¹é…ä¿®æ”¹lastIndexçš„å€¼\nvar ret\nwhile(ret = reg2.exec(ts)) {\n  console.log(ret)\n}\n/*\n[\"1cd2\", \"c\", \"d\", index: 2, input: \"ab1cd2fg3hi4jk5mop\", groups: undefined]\n\n[\"3hi4\", \"h\", \"i\", index: 8, input: \"ab1cd2fg3hi4jk5mop\", groups: undefined]\n*/\n```\n\n## å­—ç¬¦ä¸²å¯¹è±¡çš„æ–¹æ³•\n\n### searchæ–¹æ³•\n\nsearch()ç”¨äºæ£€ç´¢å­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å­å­—ç¬¦ä¸²ï¼Œæˆ–æ£€ç´¢ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…çš„å­å­—ç¬¦ä¸²\n\næ–¹æ³•è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…ç»“æœindexï¼ŒæŸ¥ä¸åˆ°è¿”å›-1\n\n### matchæ–¹æ³•\n\nmatch()æ–¹æ³•å°†æ£€ç´¢å­—ç¬¦ä¸²ï¼Œä»¥æ‰¾åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä¸regexpåŒ¹é…çš„æ–‡æœ¬\n\nregexpæ˜¯å¦å…·æœ‰æ ‡å¿—gå¯¹ç»“æœå½±å“å¾ˆå¤§ï¼Œ\n\n1. å¦‚æœregexpæ²¡æœ‰æ ‡å¿—ä½gï¼Œé‚£ä¹ˆmatchï¼ˆï¼‰æ–¹æ³•å°±åªèƒ½åœ¨å­—ç¬¦ä¸²ä¸­æ‰§è¡Œä¸€æ¬¡åŒ¹é…å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä»»ä½•åŒ¹é…çš„æ–‡æœ¬ï¼Œå°†è¿”å›null \n\n```javascript\nvar reg1 = /\\d(\\w)(\\w)\\d/\nvar reg2 = /\\d(\\w)(\\w)\\d/g\n\nvar ts = \"ab1cd2fg3hi4jk5mop\"\n\nts.match(reg1)\n//[\"1cd2\", \"c\", \"d\", index: 2, input: \"ab1cd2fg3hi4jk5mop\", groups: undefined]\n```\n\n2. å¦åˆ™å®ƒå°†è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­å­˜æ”¾äº†ä¸å®ƒæ‰¾åˆ°çš„åŒ¹é…æ–‡æœ¬æœ‰å…³çš„ä¿¡æ¯\n\n```javascript\nts.match(reg2)\n//Â [\"1cd2\", \"3hi4\"]\n```\n\n### splitæ–¹æ³•\n\n```js\n'a1b2c3d4'.split(/\\d/)\n// ['a', 'b', 'c', 'd']\n```\n\n### replaceæ–¹æ³•\n\n```js\n'a1b'.replace('1', 2) // a2b\n\n'a1b1c1'.replace('1', '2') // a2b1c1\n'a1b1c1'.replace(/1/g, '2') // a2b2c2\n\n'a1b2c3d4'.replace(/\\d/g, function(match, index, origin) {\n  console.log(match,index,origin);\n  return +match + 1\n})\n/*\n1 1 a1b2c3d4\n2 3 a1b2c3d4\n3 5 a1b2c3d4\n4 7 a1b2c3d4\n\"a2b3c4d5\"\n*/\n```","tags":["javascript","regExp"],"categories":["JavaScript"]},{"title":"HTTPSå·¥ä½œæµç¨‹","url":"/posts/ef0f9b3a.html","content":"## HTTPä¸HTTPS\n\nHTTP(è¶…æ–‡æœ¬ä¼ è¾“åè®®)ï¼Œæœ‰ç€ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·ï¼Œé‚£å°±æ˜¯å†…å®¹æ˜¯**æ˜æ–‡ä¼ è¾“**çš„ï¼Œæ²¡æœ‰ç»è¿‡ä»»ä½•åŠ å¯†ï¼Œè€Œè¿™äº›æ˜æ–‡æ•°æ®ä¼šç»è¿‡**WiFiã€è·¯ç”±å™¨ã€è¿è¥å•†ã€æœºæˆ¿**ç­‰å¤šä¸ªç‰©ç†è®¾å¤‡èŠ‚ç‚¹ï¼Œå¦‚æœåœ¨è¿™ä¸­é—´ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹è¢«ç›‘å¬ï¼Œä¼ è¾“çš„å†…å®¹å°±ä¼šå®Œå…¨æš´éœ²ï¼Œï¼Œè¿™ä¸€æ”»å‡»æ‰‹æ³•å«åšMITMï¼ˆMan In The Middleï¼‰**ä¸­é—´äºº**æ”»å‡»ã€‚\n\nå¸¸è§çš„å¦‚è¿è¡Œå•†åŠ«æŒï¼Œæ¨é€å¹¿å‘Š\n\n![åŠ«æŒ](../../images/network/è¿è¥å•†åŠ«æŒ.webp)\n\n## HTTPSå·¥ä½œæµç¨‹\n\n![https](../../images/network/HTTP-process.webp)\n\n1. å®¢æˆ·ç«¯å‘é€HTTPSè¯·æ±‚ï¼ˆé»˜è®¤ç«¯å£443ï¼‰\n2. æœåŠ¡ç«¯æœ‰ä¸€å¥—`CAæ•°å­—è¯ä¹¦`ï¼Œè¯ä¹¦å«æœ‰ä¸€ä¸ª`å…¬é’¥public`ã€‚æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚ï¼Œä¼šå°†è¿™ä¸ªè¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ã€‚æœåŠ¡ç«¯è¿˜æœ‰ä¸€ä¸ª`ç§é’¥private`ï¼Œç§é’¥æ˜¯ä¸€ç›´ä¿å­˜å†æœåŠ¡ç«¯ä¸å…¬å¼€çš„ã€‚\n3. å®¢æˆ·ç«¯æ”¶åˆ°è¯ä¹¦ï¼Œæ ¡éªŒåˆæ³•æ€§ï¼Œä¸»è¦åŒ…æ‹¬æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…ã€è¯ä¹¦çš„åŸŸåä¸è¯·æ±‚çš„åŸŸåæ˜¯å¦åŒ¹é…ï¼Œä¸Šä¸€çº§è¯ä¹¦æ˜¯å¦æœ‰æ•ˆï¼ˆé€’å½’åˆ¤æ–­ï¼Œç›´åˆ°åˆ¤æ–­åˆ°ç³»ç»Ÿå†…ç½®æˆ–æµè§ˆå™¨é…ç½®å¥½çš„æ ¹è¯ä¹¦ï¼‰ï¼Œå¦‚æœä¸é€šè¿‡ï¼Œåˆ™æ˜¾ç¤ºHTTPSè­¦å‘Šä¿¡æ¯ï¼Œå¦‚æœé€šè¿‡åˆ™ç»§ç»­ã€‚\n4. å®¢æˆ·ç«¯å…ˆç”Ÿæˆä¸€æ®µ`éšæœºkey`ï¼Œå†åˆ©ç”¨è¯ä¹¦ä¸­çš„`å…¬é’¥public`åŠ å¯†è¿™æ®µ`éšæœºkey`ï¼Œå¹¶å°†è¿™ä¸ª`éšæœºkeyå¯†æ–‡`å‘é€ç»™æœåŠ¡ç«¯ã€‚\n5. æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ª`éšæœºkeyå¯†æ–‡`æ–‡åï¼Œé€šè¿‡`ç§é’¥private`æ¥è§£å¯†ï¼Œè·å–å®¢æˆ·ç«¯çœŸæ­£çš„`éšæœºkey`\n6. æœåŠ¡ç«¯ä½¿ç”¨`éšæœºkey`æ¥åŠ å¯†éœ€è¦ä¼ è¾“çš„HTTPæ•°æ®ï¼Œå¹¶å‘é€ç»™å®¢æˆ·ç«¯\n7. å®¢æˆ·ç«¯å†ç”¨`éšæœºkey`æ¥è§£å¯†æœåŠ¡ç«¯ä¼ è¾“è¿‡æ¥çš„å¯†æ–‡ï¼Œè·å–çœŸæ­£çš„æ•°æ®\n8. åç»­HTTPSè¯·æ±‚ä½¿ç”¨ä¹‹å‰äº¤æ¢å¥½çš„`éšæœºKey`è¿›è¡Œå¯¹ç§°åŠ è§£å¯†ã€‚\n\n>  ç”±äºéšæœºkeyæ˜æ–‡æ²¡æœ‰å†ç½‘ç»œä¸Šä¼ è¾“ï¼Œæ‰€ä»¥\"ä¸­é—´äºº\"å¹¶ä¸çŸ¥é“ç”¨äºåŠ å¯†å’Œè§£å¯†çš„éšæœºkeyï¼Œå› æ­¤æ˜¯å®‰å…¨çš„\n\n## å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†\n\nHTTPSçš„å·¥ä½œæµç¨‹å…¶å®å°±æ˜¯ éå¯¹ç§°åŠ å¯†+å¯¹ç§°åŠ å¯†ã€‚\n\n- éå¯¹ç§°åŠ å¯†ï¼šå…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†\n\n- å¯¹ç§°åŠ å¯†ï¼šéšæœºkeyåŠ å¯†è§£å¯†\n\n**éå¯¹ç§°åŠ è§£å¯†è€—æ—¶è¦è¿œå¤§äºå¯¹ç§°åŠ è§£å¯†**ï¼Œå¯¹æ€§èƒ½æœ‰å¾ˆå¤§æŸè€—\n\n## CAé¢å‘æœºæ„\n\nä¸Šè¿°çš„HTTPSå·¥ä½œæµç¨‹ä¸­çš„CAè¯ä¹¦éªŒè¯ååˆ†é‡è¦ã€‚å¦‚æœæ²¡æœ‰å®ƒï¼Œä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š\n\n![åŠ«æŒ](../../images/network/httpsåŠ«æŒ.webp)\n\n1. æœåŠ¡ç«¯å‘é€å…¬é’¥A1ç»™å®¢æˆ·ç«¯ï¼Œä¸­é—´äººæŠŠæœåŠ¡ç«¯çš„å…¬é’¥æ›¿æ¢ä¸ºè‡ªå·±çš„å…¬é’¥B1\n2. å®¢æˆ·ç«¯é€šè¿‡å…¬é’¥B1åŠ å¯†ç”ŸæˆKå¯†æ–‡ï¼Œå¹¶å‘é€ç»™æœåŠ¡ç«¯\n3. ä¸­é—´äººé€šè¿‡è‡ªå·±çš„ç§é’¥B2è§£å¯†Kå¯†æ–‡å¾—åˆ°Kï¼Œå†ç”¨å…¬é’¥A1åŠ å¯†ï¼Œå‘é€ç»™æœåŠ¡ç«¯\n4. å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡çš„Kï¼Œå·²è¢«ä¸­é—´äººè·å–ï¼Œæ‰€ä»¥ä¸å†å®‰å…¨\n\nå‡ºç°è¿™ä¸€é—®é¢˜çš„æ ¸å¿ƒåŸå› æ˜¯**å®¢æˆ·ç«¯æ— æ³•ç¡®è®¤æ”¶åˆ°çš„å…¬é’¥æ˜¯ä¸æ˜¯çœŸçš„æ˜¯æœåŠ¡ç«¯å‘æ¥çš„**ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œäº’è”ç½‘å¼•å…¥äº†ä¸€ä¸ªå…¬ä¿¡æœºæ„ï¼Œè¿™å°±æ˜¯CAã€‚\n\n1. CAæœºæ„æ‹¥æœ‰è‡ªå·±çš„ä¸€å¯¹å…¬é’¥å’Œç§é’¥\n2. CAæœºæ„åœ¨é¢å‘è¯ä¹¦æ—¶å¯¹è¯ä¹¦æ˜æ–‡ä¿¡æ¯è¿›è¡Œå“ˆå¸Œ\n3. å°†å“ˆå¸Œå€¼ç”¨`ç§é’¥`è¿›è¡Œ**åŠ ç­¾**ï¼Œå¾—åˆ°æ•°å­—ç­¾å\n\næ˜æ–‡æ•°æ®å’Œæ•°å­—ç­¾åç»„æˆè¯ä¹¦ï¼Œä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚\n\n1. å®¢æˆ·ç«¯å¾—åˆ°è¯ä¹¦ï¼Œåˆ†è§£æˆæ˜æ–‡éƒ¨åˆ†Textå’Œæ•°å­—ç­¾åSig1\n2. ç”¨CAæœºæ„çš„å…¬é’¥è¿›è¡Œ**è§£ç­¾**ï¼Œå¾—åˆ°Sig2ï¼ˆç”±äºCAæœºæ„æ˜¯ä¸€ç§å…¬ä¿¡èº«ä»½ï¼Œå› æ­¤åœ¨ç³»ç»Ÿæˆ–æµè§ˆå™¨ä¸­ä¼šå†…ç½®CAæœºæ„çš„è¯ä¹¦å’Œå…¬é’¥ä¿¡æ¯ï¼‰\n3. ç”¨è¯ä¹¦é‡Œå£°æ˜çš„å“ˆå¸Œç®—æ³•å¯¹æ˜æ–‡Textéƒ¨åˆ†è¿›è¡Œå“ˆå¸Œå¾—åˆ°T\n4. å½“è‡ªå·±è®¡ç®—å¾—åˆ°çš„å“ˆå¸Œå€¼Tä¸**è§£ç­¾**åçš„Sig2**ç›¸ç­‰**ï¼Œè¡¨ç¤ºè¯ä¹¦å¯ä¿¡ï¼Œ**æ²¡æœ‰è¢«ç¯¡æ”¹**","tags":["NetWork","HTTP"],"categories":["NetWork"]},{"title":"æ‰‹å†™webpackçš„plugin","url":"/posts/b6d2303e.html","content":"## æ¦‚è¿°\n\n> ä¸€å¥è¯ï¼šæœ¬è´¨ä¸Šæ¥è¯´ï¼Œ plugin å°±æ˜¯é€šè¿‡ç›‘å¬ compiler çš„æŸäº› hook ç‰¹å®šæ—¶æœºï¼Œç„¶åå¤„ç† statsã€‚\n\né¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹ Webpack æ’ä»¶éœ€è¦åŒ…å«çš„å‡ ä¸ªæ¡ä»¶ï¼š \n\n- Webapck çš„æ’ä»¶å¿…é¡»è¦æ˜¯ä¸€ä¸ªç±»ï¼› \n- è¯¥ç±»å¿…é¡»åŒ…å«ä¸€ä¸ª apply çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ compiler å¯¹è±¡å‚æ•°ï¼› \n- è¯¥ç±»å¯ä»¥ä½¿ç”¨ Webpack çš„ compiler å’Œ Compilation å¯¹è±¡çš„é’©å­ï¼› \n- ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„é’©å­ç³»ç»Ÿã€‚\n\n```javascript\nclass MyPlugin {\n  constructor(options) {\n    // è‡ªå®šä¹‰é…ç½®\n    this.options = options\n  }\n\tapply(compiler) {\n    compiler.hooks.done.tap('MyPlugin', () => {})\n    \n    compiler.hooks.emit.tapPromise('MyPlugin', compilation => {\n      // è¿”å›ä¸€ä¸ª Promiseï¼Œåœ¨æˆ‘ä»¬çš„å¼‚æ­¥ä»»åŠ¡å®Œæˆæ—¶ resolveâ€¦â€¦\n      return new Promise((resolve, reject) => {\n        setTimeout(function() {\n          console.log('å¼‚æ­¥å·¥ä½œå®Œæˆâ€¦â€¦');\n          \tresolve();\n          }, 1000);\n        });\n      });\n\t}\n}\n\nmodule.exports = MyPlugin\n```\n\n## å®˜æ–¹DEMOâ€”â€”FileListPlugin\n\n```js\nclass FileListPlugin {\n    apply(compiler) {\n        // emit æ˜¯å¼‚æ­¥ hookï¼Œä½¿ç”¨ tapAsync è§¦åŠå®ƒï¼Œè¿˜å¯ä»¥ä½¿ç”¨ tapPromise/tap(åŒæ­¥)\n        compiler.hooks.emit.tapAsync('FileListPlugin', (compilation, callback) => {\n            // åœ¨ç”Ÿæˆæ–‡ä»¶ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªå¤´éƒ¨å­—ç¬¦ä¸²ï¼š\n            var filelist = 'In this build:\\n\\n';\n\n            // éå†æ‰€æœ‰ç¼–è¯‘è¿‡çš„èµ„æºæ–‡ä»¶ï¼Œ\n            // å¯¹äºæ¯ä¸ªæ–‡ä»¶åç§°ï¼Œéƒ½æ·»åŠ ä¸€è¡Œå†…å®¹ã€‚\n            for (var filename in compilation.assets) {\n                filelist += '- ' + filename + '\\n';\n            }\n\n            // å°†è¿™ä¸ªåˆ—è¡¨ä½œä¸ºä¸€ä¸ªæ–°çš„æ–‡ä»¶èµ„æºï¼Œæ’å…¥åˆ° webpack æ„å»ºä¸­ï¼š\n            compilation.assets['filelist.md'] = {\n                source: function() {\n                    return filelist;\n                },\n                size: function() {\n                    return filelist.length;\n                }\n            };\n\n            callback();\n        });\n    }\n}\n```\n\n## è‡ªå®šä¹‰ Pluginâ€”â€”prefetch-webpack-plugin\n\n### å®ç°ç›®æ ‡\n\nå‡å¦‚æˆ‘ä»¬æœ‰ä¸ª `lazy.js` æ¨¡å—éœ€è¦ Prefetchï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ä½¿ç”¨å¦‚ä¸‹é…ç½®\n\n```javascript\n// ä¸‹é¢æ˜¯é­”æ³•æ³¨é‡Š ï¼ˆmagic commentsï¼‰\nimport(/* webpackPrefetch: true */ './lazy');\n```\n\næœ‰äº†è¿™ä¸ªæ³¨é‡Šï¼Œåœ¨è·å– chunk å¯¹è±¡çš„æ—¶å€™ï¼Œå°±å¯ä»¥æ‹¿åˆ°å®ƒçš„è¿™ä¸ªæ ‡æ³¨ï¼Œä»è€Œæ ¹æ®è¿™ä¸ªæ³¨é‡Šç»™é¡µé¢å¢åŠ `<link rel=\"prefetch\">`æ ‡ç­¾ã€‚\n\n> Tipsï¼š \n>\n> - `/* webpackPrefetch: true */` ï¼šæŠŠä¸»åŠ è½½æµç¨‹åŠ è½½å®Œæ¯•ï¼Œåœ¨ç©ºé—²æ—¶åœ¨åŠ è½½å…¶å®ƒï¼Œç­‰å†ç‚¹å‡»å…¶ä»–æ—¶ï¼Œåªéœ€ è¦ä»ç¼“å­˜ä¸­è¯»å–å³å¯ï¼Œæ€§èƒ½æ›´å¥½ï¼Œæ¨èä½¿ç”¨ï¼›èƒ½å¤Ÿæé«˜ä»£ç åˆ©ç”¨ç‡ï¼ŒæŠŠä¸€äº›äº¤äº’åæ‰èƒ½ç”¨åˆ°çš„ä»£ç å†™åˆ°å¼‚ æ­¥ç»„ä»¶é‡Œï¼Œé€šè¿‡æ‡’åŠ è½½çš„å½¢å¼ï¼Œå»æŠŠè¿™å—çš„ä»£ç é€»è¾‘åŠ è½½è¿›æ¥ï¼Œæ€§èƒ½æå‡ï¼Œé¡µé¢è®¿é—®é€Ÿåº¦æ›´å¿«ï¼›*\n> - `/* webpackPreload: true */` : å’Œä¸»åŠ è½½æµç¨‹ä¸€èµ·å¹¶è¡ŒåŠ è½½ã€‚\n\n### åŸç†å’Œå®ç°æ­¥éª¤\n\n1. é¦–å…ˆæˆ‘ä»¬åº”è¯¥åˆ©ç”¨`compiler.compilation`è¿™ä¸ªé’©å­ï¼Œå¾—åˆ°`Compilation`å¯¹è±¡ï¼›\n2. ç„¶ååœ¨`Compilation`å¯¹è±¡ä¸­ç›‘å¬ html-webpack-plugin çš„é’©å­ï¼Œæ‹¿åˆ° HTML å¯¹è±¡ï¼Œè¿™é‡Œéœ€è¦åŒºåˆ† html-webpack-plugin çš„ç‰ˆæœ¬ï¼š\n   1. åœ¨`3.x`ç‰ˆæœ¬ï¼Œhtml-webpack-plugin çš„é’©å­æ˜¯ç›´æ¥æŒ‚åœ¨ Compilation å¯¹è±¡ä¸Šçš„ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯`compilation.hooks.htmlWebpackPluginAfterHtmlProcessing`ï¼›\n   2. åœ¨`4.x`ç‰ˆæœ¬ï¼ˆæˆªç¨¿æœ€æ–°ç‰ˆæœ¬æ˜¯ 4.0-beta.3ï¼‰ä¸­ï¼Œhtml-webpack-plugin è‡ªå·±ä½¿ç”¨`Tapable`å®ç°äº†è‡ªå®šä¹‰é’©å­ï¼Œéœ€è¦ä½¿ç”¨`HtmlWebpackPlugin.getHooks(compilation)`çš„æ–¹å¼è·å–è‡ªå®šä¹‰çš„é’©å­ã€‚\n3. ç„¶åæˆ‘ä»¬ä»`Compilation`å¯¹è±¡ä¸­è¯»å–å½“å‰ HTML é¡µé¢çš„æ‰€æœ‰`chunks`ï¼Œç­›é€‰å¼‚æ­¥åŠ è½½çš„ chunk æ¨¡å—ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µï¼š\n   1. ç”Ÿæˆå¤šä¸ª HTML é¡µé¢ï¼Œé‚£ä¹ˆ html-webpack-plugin æ’ä»¶ä¼šè®¾ç½®`chunks`é€‰é¡¹ï¼Œæˆ‘ä»¬éœ€è¦ä» `Compilation.chunks`æ¥é€‰å– HTML é¡µé¢çœŸæ­£ç”¨åˆ°çš„ chunksï¼Œç„¶ååœ¨ä» chunks ä¸­è¿‡æ»¤å‡º Prefetch chunkï¼›\n   2. å¦‚æœæ˜¯å•é¡µåº”ç”¨ï¼Œé‚£ä¹ˆä¸å­˜åœ¨`chunks`é€‰é¡¹ï¼Œè¿™æ—¶å€™é»˜è®¤`chunks='all'`ï¼Œæˆ‘ä»¬éœ€è¦ä»å…¨éƒ¨ `Compilation.chunks` ä¸­è¿‡æ»¤å‡º Prefetch chunkã€‚\n4. æœ€åç»“åˆ Webpack é…ç½®çš„`publicPath`å¾—åˆ°å¼‚æ­¥ chunk çš„å®é™…çº¿ä¸Šåœ°å€ï¼Œç„¶åä¿®æ”¹ html-webpack-plugin é’©å­å¾—åˆ°çš„ HTML å¯¹è±¡ï¼Œç»™ HTML çš„``æ·»åŠ ``å†…å®¹ã€‚\n\n","tags":["javascript","webpack","æ¶æ„"],"categories":["Webpack"]},{"title":"æ‰‹å†™webpackçš„loader","url":"/posts/e0efe5dc.html","content":"## æ¦‚è¿°\n\nwebpackçš„loaderæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå‡½æ•°\n\n```javascript\nmodule.exports = function(content, sourcemap) {\n  // å¤„ç† content æ“ä½œ...\n  \n  this.callback(null, content) // æˆ–è€… return content\n}\n```\n\n> this æ˜¯ webpack è°ƒç”¨ loader æ—¶å€™ä¼ å…¥çš„è‡ªå®šä¹‰çš„ç‰¹æ®Šä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥ä¸åº”è¯¥ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼\n\nthis.callback å¯ä»¥ä¼ å…¥å››ä¸ªå‚æ•°ï¼ˆå…¶ä¸­åä¸¤ä¸ªå‚æ•°å¯ä»¥çœç•¥ï¼‰ï¼Œåˆ†åˆ«æ˜¯ï¼š \n\n- error ï¼šå½“ loader å‡ºé”™æ—¶å‘å¤–æŠ›å‡ºä¸€ä¸ª Error å¯¹è±¡ï¼ŒæˆåŠŸåˆ™ä¼ å…¥ null ï¼›\n- content ï¼šç»è¿‡ loader ç¼–è¯‘åéœ€è¦å¯¼å‡ºçš„å†…å®¹ï¼Œç±»å‹å¯ä»¥æ˜¯ä¸º String æˆ–è€… Buffer ï¼› \n- sourceMap ï¼šä¸ºæ–¹ä¾¿è°ƒè¯•ç”Ÿæˆçš„ç¼–è¯‘åå†…å®¹çš„ source mapï¼› \n- ast : æœ¬æ¬¡ç¼–è¯‘ç”Ÿæˆçš„ AST é™æ€è¯­æ³•æ ‘ï¼Œä¹‹åæ‰§è¡Œçš„ loader å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ª ASTï¼Œå¯ä»¥çœå»é‡å¤ç”Ÿæˆ AST çš„ è¿‡ç¨‹ã€‚\n\n## loader å¼‚æ­¥å¤„ç†æ•°æ®\n\nç¬¬ä¸€ç§æ–¹å¼æ˜¯æ˜¯ä½¿ç”¨ `async/await` å¼‚æ­¥å‡½æ•°å†™æ³•\n\n```javascript\nmodule.exports = async function(content) {\n  function timeout(delay) {\n    return new Promise((resolve, reject) => {\n      setTimeout(() => {\n      \t// æ¨¡æ‹Ÿä¸€äº›å¼‚æ­¥æ“ä½œå¤„ç† content\n        resolve(content);\n        }, delay);\n      });\n    }\n    const data = await timeout(1000);\n    return data;\n};\n\n```\n\nç¬¬äºŒç§æ–¹å¼æ˜¯ä½¿ç”¨ `this.async` æ–¹æ³•è·å–ä¸€ä¸ªå¼‚æ­¥çš„ callback ï¼Œç„¶åè¿”å›å®ƒã€‚\n\n```javascript\nmodule.exports = function(content) {\n  function timeout(delay) {\n    return new Promise((resolve, reject) => {\n      setTimeout(() => {\n        // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ\n        resolve(content)\n      }, delay)\n    })\n  }\n  const callback = this.async()\n  timeout(1000).then(data => {\n    callback(null, data)\n  })\n}\n```\n\n> this.async è·å–çš„ callbackï¼Œå‚æ•°ä¹Ÿæ˜¯è·Ÿ this.callback çš„å‚æ•°ä¸€è‡´ï¼Œå³ errorï¼Œcontentï¼Œsourcemap å’Œ astã€‚\n\n## å¤„ç†äºŒè¿›åˆ¶æ•°æ®\n\nåƒ file-loader è¿™æ ·çš„ Loaderï¼Œå®é™…å¤„ç†çš„å†…å®¹æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œé‚£ä¹ˆå°±éœ€è¦é€šè¿‡è®¾ç½® `moudle.exports.raw = true;` æ¥å‘Šè¯‰ Webpack ç»™ loader ä¼ å…¥äºŒè¿›åˆ¶æ ¼å¼çš„æ•°æ®ã€‚\n\n```javascript\nmodule.exports = function(source) {\n  if (source instanceof Buffer) {\n    // ä¸€ç³»åˆ—çš„æ“ä½œ\n    return source // æœ¬èº«ä¹Ÿå¯ä»¥è¿”å›äºŒè¿›åˆ¶æ•°æ®æä¾›ç»™ä¸‹ä¸€ä¸ªloader\n  }\n}\nmodule.exports.raw = true // ä¸è®¾ç½®ï¼Œå°±ä¼šæ‹¿åˆ°å­—ç¬¦ä¸²\n```\n\n## loader çš„ pitch\n\nloader çš„æ‰§è¡Œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œpitché˜¶æ®µloaderä»å·¦åˆ°å³é“¾å¼è°ƒç”¨ã€‚è€ŒNormalé˜¶æ®µæ˜¯ä»å³åˆ°å·¦çš„é“¾å¼è°ƒç”¨ã€‚\n\n![loader_pitch](../images/framework/loader-pitch.webp)\n\nåœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œloader å¹¶ä¸ä¾èµ–ä¸Šä¸€ä¸ª loader çš„ç»“æœï¼Œè€Œåªå…³å¿ƒåŸè¾“å…¥å†…å®¹ã€‚è¿™æ—¶å€™ï¼Œè¦ æ‹¿åˆ°ä¸€å¼€å§‹çš„æ–‡ä»¶åŸå†…å®¹ï¼Œå°±éœ€è¦ä½¿ç”¨ `module.exports.pitch = function();`\n\n```javascript\nmodule.exports.pitch = function(remainingRequest, precedingRequest, data) {\n  if (somothingFlag()) {\n  \treturn 'module.exports = require(' + JSON.stringify('-!' + remaining) + ');'\n  }\n  data.value = 1\n}\n```\n\npitchå‡½æ•°çš„dataï¼Œåœ¨æ‰§è¡Œé˜¶æ®µä¹Ÿä¼šæš´éœ²åœ¨ `this.data` ä¹‹ä¸‹ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºåœ¨å¾ªç¯æ—¶ï¼Œæ•è·å’Œå…±äº«å‰é¢çš„ä¿¡æ¯ã€‚\n\n## loader ç»“æœç¼“å­˜\n\nWebpack å¢é‡ç¼–è¯‘æœºåˆ¶ä¼šè§‚å¯Ÿæ¯æ¬¡ç¼–è¯‘æ—¶çš„å˜æ›´æ–‡ä»¶ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒWebpack ä¼šå¯¹ loader çš„æ‰§è¡Œç»“æœè¿›è¡Œç¼“ å­˜ï¼Œè¿™æ ·èƒ½å¤Ÿå¤§å¹…åº¦æå‡æ„å»ºé€Ÿåº¦ï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨å…³é—­å®ƒï¼š\n\n```javascript\nmodule.exports = function(content) {\n  this.cacheable(false)\n  return content\n}\n```\n\n## loader å·¥å…·åº“\n\n### loader-utils\n\nloader-utils æä¾›äº†å„ç§è·Ÿ loader é€‰é¡¹ï¼ˆoptionsï¼‰ç›¸å…³çš„å·¥å…·å‡½æ•°\n\n```javascript\nconst { getOptionsï¼ŒstringifyRequest, parseQuery } = require('loader-utils');\n\nmodule.exports = function(content) {\n  // getOptions ç”¨äºåœ¨loaderé‡Œè·å–ä¼ å…¥çš„optionsï¼Œè¿”å›çš„æ˜¯å¯¹è±¡å€¼ã€‚\n  const options = getOptions(this);\n  \n  // stringifyRequestè½¬æ¢è·¯å¾„ï¼Œé¿å…require()æˆ–impotæ—¶ä½¿ç”¨çš„ç»å¯¹è·¯å¾„\n  stringifyRequest(this, './test.js'); // Result => \"\\\"./test.js\\\"\"\n  \n  // parseQueryè·å–queryå‚æ•°çš„\n  parseQuery('?name=kev&age=14') // Result => {name: 'kev', age: '14'}\n}\n```\n\n### schema-utils\n\nschema-utils æ˜¯ loader å’Œ plugin çš„å‚æ•°è®¤è¯å™¨ï¼Œæ£€æµ‹ä¼ å…¥çš„å‚æ•°æ˜¯å¦ç¬¦åˆé¢„æœŸ\n\n```javascript\nconst validateOptions = require('schema-utils');\n// ä¸‹é¢æ˜¯ä¸€ä¸ªschemaæè¿°\nconst schema = {\n  type: 'object',\n  properties: {\n    name: {\n    \ttype: 'string'\n  \t},\n    test: {\n      anyOf: [{type: 'array'}, {type: 'string'}, {instanceof: 'RegExp'}]\n    },\n    transform: {\n      instanceof: 'Function'\n    },\n    sourceMap: {\n      type: 'boolean'\n    }\n  },\n  additionalProperties: false\n};\n\nmodule.exports = function(source) {\n  // éªŒè¯å‚æ•°çš„ç±»å‹æ˜¯å¦æ­£ç¡®ã€‚\n  validateOptions(schema, options, 'loader name');\n};\n```\n\n## loader ä¸Šä¸‹æ–‡\n\nloader ä¸­ this ç›¸å…³çš„å…¶å®ƒæ–¹æ³•å’Œå±æ€§ \n\n- this.context : å½“å‰å¤„ç†è½¬æ¢çš„æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼› \n- this.resource : å½“å‰å¤„ç†è½¬æ¢çš„æ–‡ä»¶å®Œæ•´è¯·æ±‚è·¯å¾„ï¼ŒåŒ…æ‹¬ querystringï¼› this.resourcePath : å½“å‰å¤„ç†è½¬æ¢çš„æ–‡ä»¶çš„è·¯å¾„ï¼› \n- this.resourceQuery : å½“å‰å¤„ç†æ–‡ä»¶çš„ querystringï¼› \n- this.target : Webpack é…ç½®çš„ targetï¼› \n- this.loadMoudle : å¤„ç†æ–‡ä»¶æ—¶ï¼Œéœ€è¦ä¾èµ–å…¶å®ƒæ–‡ä»¶çš„å¤„ç†ç»“æœæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ this.loadMoudle(request: strin g, callback: function(err, source, sourceMap, module)) å»è·å–åˆ°ä¾èµ–æ–‡ä»¶çš„å¤„ç†ç»“æœï¼› \n- this.resolve : è·å–æŒ‡å®šæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼›\n- this.addDependency : ä¸ºå½“å‰å¤„ç†æ–‡ä»¶æ·»åŠ ä¾èµ–æ–‡ä»¶ï¼Œä»¥ä¾¿ä¾èµ–æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°è°ƒç”¨ Loader è½¬æ¢è¯¥æ–‡ä»¶ï¼Œ this.addDependency(file: string) ï¼› \n- this.addContextDependency : ä¸ºå½“å‰å¤„ç†æ–‡ä»¶æ·»åŠ ä¾èµ–æ–‡ä»¶ç›®å½•ï¼Œä»¥ä¾¿ä¾èµ–æ–‡ä»¶ç›®å½•é‡Œæ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°è°ƒ ç”¨ Loader è½¬æ¢è¯¥æ–‡ä»¶ï¼Œ this.addContextDependency(dir: string) ï¼› \n- this.clearDependencies : æ¸…é™¤å½“å‰æ­£åœ¨å¤„ç†æ–‡ä»¶çš„æ‰€æœ‰ä¾èµ–ï¼› \n- this.emitFile : è¾“å‡ºä¸€ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨çš„æ–¹æ³•ä¸º this.emitFile(name: string, content: Buffer | string, so urceMap: {...}) ï¼› \n- this.emitError ï¼šå‘é€ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ã€‚\n\n## markdown-loader\n\n```javascript\nconst showdown = require('showdown') // ç¬¬ä¸‰æ–¹å·¥å…·ï¼ŒæŠŠmdè½¬æˆhtml\nconst { getOptions } = require('loader-utils')\n\nmodule.exports = function(content) {\n  // è·å–options\n  const options = getOptions(this)\n\n  // è·å–cache\n  this.cacheable()\n\n  // åˆå§‹åŒ–showdownè½¬æ¢å™¨\n  const converter = new showdown.Converter(options)\n\n  // å¤„ç†content\n  content = converter.makeHtml(content)\n\n  // è¿”å›ç»“æœ\n  this.callback(null, content)\n}\n\n```","tags":["javascript","webpack","æ¶æ„"],"categories":["Webpack"]},{"title":"WebpackåŸç†","url":"/posts/e2b02a9e.html","content":"## Webpackå·¥ä½œæµç¨‹\n\n### ç±»æ¯”\n\nWebpack å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªå·¥å‚è½¦é—´ï¼Œ `plugin` å’Œ `loader` æ˜¯è½¦é—´ä¸­çš„ä¸¤ç±»æœºå™¨ï¼Œå·¥å‚æœ‰ä¸€ä¸ªè½¦é—´ä¸»ä»»å’Œä¸€ä¸ªç”Ÿ äº§è½¦é—´ã€‚è½¦é—´ä¸»ä»»å« `Compiler` ï¼Œè´Ÿè´£æŒ‡æŒ¥ç”Ÿäº§è½¦é—´æœºå™¨ `Compilation` è¿›è¡Œç”Ÿäº§åŠ³åŠ¨ï¼Œ `Compilation` ä¼šé¦–å…ˆå°† è¿›æ¥çš„åŸææ–™ï¼ˆ `entry` ï¼‰ä½¿ç”¨ä¸€ç§å«åš `loader` çš„æœºå™¨è¿›è¡ŒåŠ å·¥ï¼Œç”Ÿäº§å‡ºæ¥çš„äº§å“å°±æ˜¯ `Chunk` ï¼› `Chunk` ç”Ÿäº§å‡º æ¥ä¹‹åï¼Œä¼šè¢«ç»„è£…æˆ `Bundle` ï¼Œç„¶åé€šè¿‡ä¸€ç±» `plugin` çš„æœºå™¨ç»§ç»­åŠ å·¥ï¼Œå¾—åˆ°æœ€åçš„ `Bundle` ï¼Œç„¶åè¿è¾“åˆ°å¯¹åº” çš„ä»“åº“ï¼ˆ`output`ï¼‰ã€‚è¿™ä¸ªå·¥å‚çš„ç”Ÿäº§çº¿å°±æ˜¯ `Tapable`ï¼Œå‚å­è¿ä½œçš„æ•´ä¸ªæµç¨‹éƒ½æ˜¯ç”Ÿäº§çº¿æ§åˆ¶çš„ï¼Œè½¦é—´ä¸­æœ‰å¥½å‡  æ¡ç”Ÿäº§çº¿ï¼Œæ¯ä¸ªç”Ÿäº§çº¿æœ‰å¾ˆå¤šçš„æ“ä½œæ­¥éª¤ï¼ˆ `hook` ï¼‰ï¼Œä¸€æ­¥æ“ä½œå®Œæ¯•ï¼Œä¼šè¿›å…¥åˆ°ä¸‹ä¸€æ­¥æ“ä½œï¼Œç›´åˆ°ç”Ÿäº§çº¿å…¨æµ ç¨‹å®Œæˆï¼Œå†å°†äº§å‡ºä¼ ç»™ä¸‹ä¸€ä¸ªäº§å“çº¿å¤„ç†ã€‚æ•´ä¸ªè½¦é—´ç”Ÿäº§çº¿ä¹Ÿç»„æˆäº†ä¸€æ¡æœ€å¤§çš„ç”Ÿäº§çº¿ã€‚\n\n### å·¥ä½œæµç¨‹\n\n#### ä¸‰ä¸ªé˜¶æ®µ\n\n- å‡†å¤‡é˜¶æ®µï¼šä¸»è¦ä»»åŠ¡æ˜¯åˆ›å»º Compiler å’Œ Compilation å¯¹è±¡ï¼›\n- ç¼–è¯‘é˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µä»»åŠ¡æ˜¯å®Œæˆ modules è§£æï¼Œå¹¶ä¸”ç”Ÿæˆ chunksï¼›\n  - module è§£æï¼šåŒ…å«äº†ä¸‰ä¸ªä¸»è¦æ­¥éª¤ï¼Œåˆ›å»ºå®ä¾‹ã€loaders åº”ç”¨å’Œä¾èµ–æ”¶é›†ï¼›\n  - chunks ç”Ÿæˆï¼Œä¸»è¦æ­¥éª¤æ˜¯æ‰¾åˆ°æ¯ä¸ª chunk æ‰€éœ€è¦åŒ…å«çš„ modules ã€‚ \n- äº§å‡ºé˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µçš„ä¸»è¦ä»»åŠ¡æ˜¯æ ¹æ® chunks ç”Ÿæˆæœ€ç»ˆæ–‡ä»¶ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼šæ¨¡æ¿ Hash æ›´æ–°ï¼Œæ¨¡æ¿æ¸²æŸ“ chunkï¼Œç”Ÿæˆæ–‡ä»¶ã€‚\n\n#### ç»†åŒ–\n\n1. åˆå§‹åŒ–å‚æ•°ï¼šåŒ…æ‹¬ä»é…ç½®æ–‡ä»¶å’Œ shell ä¸­è¯»å–å’Œåˆå¹¶å‚æ•°ï¼Œç„¶åå¾—å‡ºæœ€ç»ˆå‚æ•°ï¼›**shell ä¸­çš„å‚æ•°è¦ä¼˜äºé…ç½®æ–‡ä»¶çš„**\n2. ä½¿ç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„å‚æ•°**å®ä¾‹åŒ–ä¸€ä¸ª Compiler ç±»**ï¼Œæ³¨å†Œæ‰€æœ‰çš„æ’ä»¶ï¼Œç»™å¯¹åº”çš„ Webpack æ„å»ºç”Ÿå‘½å‘¨æœŸç»‘å®š Hook\n3. å¼€å§‹ç¼–è¯‘ï¼šæ‰§è¡Œ Compiler ç±»çš„ run æ–¹æ³•å¼€å§‹æ‰§è¡Œç¼–è¯‘\n4. compiler.run æ–¹æ³•è°ƒç”¨ compiler.compile ï¼Œåœ¨ compile å†…**å®ä¾‹åŒ–ä¸€ä¸ª Compilation ç±»**ï¼Œ Compilation æ˜¯åšæ„ å»ºæ‰“åŒ…çš„äº‹æƒ…ï¼Œä¸»è¦äº‹æƒ…åŒ…æ‹¬ï¼š \n   1. æŸ¥æ‰¾å…¥å£ï¼šæ ¹æ® entry é…ç½®ï¼Œæ‰¾å‡ºå…¨éƒ¨çš„å…¥å£æ–‡ä»¶\n   2. ç¼–è¯‘æ¨¡å—ï¼šæ ¹æ®æ–‡ä»¶ç±»å‹å’Œ loader é…ç½®ï¼Œä½¿ç”¨å¯¹åº” loader å¯¹æ–‡ä»¶è¿›è¡Œè½¬æ¢å¤„ç†\n   3. è§£ææ–‡ä»¶çš„ AST è¯­æ³•æ ‘\n   4. æ‰¾å‡ºæ–‡ä»¶ä¾èµ–å…³ç³»\n   5. é€’å½’ç¼–è¯‘ä¾èµ–çš„æ¨¡å—\n5. é€’å½’å®Œåå¾—åˆ°æ¯ä¸ªæ–‡ä»¶çš„æœ€ç»ˆç»“æœï¼Œæ ¹æ® entry é…ç½®ç”Ÿæˆä»£ç å— chunk\n6. è¾“å‡ºæ‰€æœ‰ chunk åˆ°å¯¹åº”çš„ output è·¯å¾„\n\n![webpackå·¥ä½œæµç¨‹](../../images/framework/webpack-proceed.png)\n\n## Tapable\n\n### æ¦‚è¿°\n\n`Tapable`æ˜¯webpackçš„æ ¸å¿ƒæ¨¡å—ã€‚å…¶åŸç†å’Œnodejsçš„`EventEmitter` ç±»ä¼¼ï¼Œä½†æ˜¯åŠŸèƒ½æ›´å¼ºå¤§ï¼ŒåŒ…æ‹¬å¤šç§ç±»å‹ï¼Œé€šè¿‡**äº‹ä»¶çš„æ³¨å†Œå’Œç›‘å¬**ï¼Œè§¦å‘ Webpack ç”Ÿå‘½å‘¨æœŸä¸­çš„å‡½æ•°æ–¹æ³•ã€‚tapable éƒ½æ˜¯æ”¾åˆ°å¯¹è±¡çš„ hooks ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬å«å®ƒä»¬ é’©å­ã€‚\n\n```javascript\n// webpack 4.29.6\n// lib/compiler\nclass Compiler extends Tapable {\n  constructor(context) {\n    super();\n    this.hooks = {\n      shouldEmit: new SyncBailHook(['compilation']),\n      done: new AsyncSeriesHook(['stats']),\n      additionalPass: new AsyncSeriesHook([]),\n      beforeRun: new AsyncSeriesHook(['compiler']),\n      run: new AsyncSeriesHook(['compiler']),\n      emit: new AsyncSeriesHook(['compilation']),\n      afterEmit: new AsyncSeriesHook(['compilation']),\n      thisCompilation: new SyncHook(['compilation', 'params']),\n      compilation: new SyncHook(['compilation', 'params']),\n      normalModuleFactory: new SyncHook(['normalModuleFactory']),\n      contextModuleFactory: new SyncHook(['contextModulefactory']),\n      beforeCompile: new AsyncSeriesHook(['params']),\n      compile: new SyncHook(['params']),\n      make: new AsyncParallelHook(['compilation']),\n      afterCompile: new AsyncSeriesHook(['compilation']),\n      watchRun: new AsyncSeriesHook(['compiler']),\n      failed: new SyncHook(['error']),\n      invalid: new SyncHook(['filename', 'changeTime']),\n      watchClose: new SyncHook([]),\n      environment: new SyncHook([]),\n      afterEnvironment: new SyncHook([]),\n      afterPlugins: new SyncHook(['compiler']),\n      entryOption: new SyncBailHook(['context', 'entry'])\n    };\n  }\n}\n\n```\n\n### Tapableä¸­Hookç±»å‹\n\nHook ç±»å‹å¯ä»¥åˆ†ä¸ºåŒæ­¥ï¼ˆ Sync ï¼‰å’Œå¼‚æ­¥ï¼ˆ Async ï¼‰ï¼Œå¼‚æ­¥åˆåˆ†ä¸ºå¹¶è¡Œå’Œä¸²è¡Œï¼š\n\n![tapable_hook](../../images/framework/tapable_hook.png)\n\næ ¹æ®ä½¿ç”¨æ–¹å¼æ¥åˆ†ï¼Œåˆå¯ä»¥åˆ†ä¸º Basic ã€ Waterfall ã€ Bail å’Œ Loop å››ç±»ï¼Œæ¯ç±» Hook éƒ½æœ‰è‡ªå·±çš„ä½¿ç”¨è¦ç‚¹ï¼š\n\n| ç±»å‹      | ä½¿ç”¨è¦ç‚¹                                                                                  | hook                                                               |\n| --------- | ----------------------------------------------------------------------------------------- | ------------------------------------------------------------------ |\n| Basic     | åŸºç¡€ç±»å‹ï¼Œä¸å…³å¿ƒç›‘å¬å‡½æ•°çš„è¿”å›å€¼ï¼Œä¸æ ¹æ®è¿”å›å€¼åšäº‹æƒ…                                      | `SyncHook` ã€ `AsyncParallelHook` å’Œ `AsyncSeriesHook`             |\n| Bail      | ä¿é™©å¼ï¼Œåªè¦ç›‘å¬å‡½æ•°ä¸­æœ‰è¿”å›å€¼ï¼ˆä¸ä¸º undefined ï¼‰ï¼Œåˆ™è·³è¿‡ä¹‹åçš„ç›‘å¬å‡½æ•°ï¼ˆç±»æ¯”Array.findï¼‰ | `SyncBailHook `ã€ `AsyncSeriesBailHook` ã€ `AsyncParallelBailHook` |\n| Waterfall | ç€‘å¸ƒå¼ï¼Œä¸Šä¸€æ­¥çš„è¿”å›å€¼(éundefined)ç»§ç»­äº¤ç»™ä¸‹ä¸€æ­¥å¤„ç†å’Œä½¿ç”¨ï¼ˆç±»æ¯”Array.reduceï¼‰           | `SyncWaterfallHook` å’Œ `AsyncSeriesWaterfallHook`                  |\n| Loop      | å¾ªç¯ç±»å‹ï¼Œå¦‚æœè¯¥ç›‘å¬å‡½æ•°è¿”å› true åˆ™è¿™ä¸ªç›‘å¬å‡½æ•°ä¼šåå¤æ‰§è¡Œï¼Œå¦‚æœè¿”å› undefined åˆ™é€€å‡ºå¾ªç¯ | `SyncLoopHook`                                                     |\n\n### TapableåŸç†è§£æ\n\nTapableæ‰§è¡Œåˆ†ä¸ºå››æ­¥\n\n1. ä½¿ç”¨ tap* å¯¹äº‹ä»¶è¿›è¡Œæ³¨å†Œç»‘å®šã€‚æ ¹æ®ç±»å‹ä¸åŒï¼Œæä¾›ä¸‰ç§ç»‘å®šçš„æ–¹å¼ï¼š `tap` ã€ `tapPromise` ã€ `tapAsync` ï¼Œå…¶ä¸­ `tapPromise` ã€ `tapAsync` ä¸ºå¼‚æ­¥ç±» Hook çš„ç»‘å®šæ–¹æ³•\n2. ä½¿ç”¨ call* å¯¹äº‹ä»¶è¿›è¡Œè§¦å‘ï¼Œæ ¹æ®ç±»å‹ä¸åŒï¼Œä¹Ÿæä¾›äº†ä¸‰ç§è§¦å‘çš„æ–¹å¼ï¼š `call` ã€ `promise` ã€ `callAsync` \n3. ç”Ÿæˆå¯¹åº”ç±»å‹çš„ä»£ç ç‰‡æ®µï¼ˆè¦æ‰§è¡Œçš„ä»£ç å®é™…æ˜¯æ‹¼å­—ç¬¦ä¸²æ‹¼å‡ºæ¥çš„ï¼‰\n4. ç”Ÿæˆç¬¬ä¸‰æ­¥ç”Ÿæˆçš„ä»£ç ç‰‡æ®µã€‚\n\n### æ€»ç»“ \n\nTapable æ˜¯ Webpack çš„æ ¸å¿ƒæ¨¡å—ï¼ŒWebpack çš„æ‰€æœ‰å·¥ä½œæµç¨‹éƒ½æ˜¯é€šè¿‡ Tapable æ¥å®ç°çš„ã€‚Tapable æœ¬è´¨ä¸Šæ˜¯æä¾› äº†å¤šç§ç±»å‹çš„äº‹ä»¶ç»‘å®šæœºåˆ¶ï¼Œæ ¹æ®ä¸åŒçš„æµç¨‹ç‰¹ç‚¹å¯ä»¥é€‰æ‹©ä¸åŒç±»å‹çš„ Hook æ¥ä½¿ç”¨ã€‚Tapable çš„æ ¸å¿ƒå®ç°åœ¨ç»‘å®š äº‹ä»¶é˜¶æ®µè·Ÿæˆ‘ä»¬å¹³æ—¶çš„è‡ªå®šä¹‰ JavaScriptäº‹ä»¶ç»‘å®šï¼ˆä¾‹å¦‚EventEmitterï¼‰æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œä½†æ˜¯åœ¨äº‹ä»¶è§¦å‘æ‰§è¡Œçš„æ—¶ å€™ï¼Œä¼šä¸´æ—¶ç”Ÿæˆå¯ä»¥æ‰§è¡Œçš„å‡½æ•°ä»£ç ç‰‡æ®µã€‚é€šè¿‡è¿™ç§å®ç°æ–¹å¼ï¼ŒTapable å®ç°äº†å¼ºå¤§çš„äº‹ä»¶æµç¨‹æ§åˆ¶èƒ½åŠ›ï¼Œä¹Ÿå¢åŠ  äº†å¦‚ waterfall / parallel ç³»åˆ—æ–¹æ³•ï¼Œå®ç°äº†å¼‚æ­¥/å¹¶è¡Œç­‰äº‹ä»¶æµçš„æ§åˆ¶èƒ½åŠ›ã€‚\n\n## Compiler å’Œ Compilation\n\ncompilerå’Œcompilationéƒ½ç»§æ‰¿Tapableï¼Œä¸åŒç‚¹æ˜¯Compileræ˜¯æ¯ ä¸ª Webpack çš„é…ç½®ï¼Œå¯¹åº”ä¸€ä¸ªCompilerå¯¹è±¡ï¼Œè®°å½•ç€æ•´ä¸ª Webpack çš„ç”Ÿå‘½å‘¨æœŸï¼›åœ¨æ„å»ºçš„è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡æ„å»ºéƒ½ ä¼šäº§ç”Ÿä¸€æ¬¡Compilationï¼ŒCompilationåˆ™æ˜¯æ„å»ºå‘¨æœŸçš„äº§ç‰©ã€‚\n\n### Compiler\n\næ¯æ¬¡æ‰§è¡Œwebpackæ„å»ºçš„æ—¶å€™ï¼Œwebpackå†…éƒ¨éƒ½ä¼šå®ä¾‹åŒ–ä¸€ä¸ª`Compiler`å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å®ƒçš„`run`æ–¹æ³•å¼€å§‹ä¸€æ¬¡å®Œæ•´çš„ç¼–è¯‘è¿‡ç¨‹ã€‚\n\n```javascript\nconst webpack = require('webpack')\nconst webpackConfig = require('./webpack.config.js')\n\n// åªä¼ å…¥config\nconst compiler = webapck(webpackConfig)\n\n// æ‰§è¡Œ\ncompiler.run()\n\n// ä¸Šé¢ä¸¤å¥ç­‰ä»·äº\nwebpack(webpackConfig, callback)\n```\n\n> ä½¿ç”¨`webpack-dev-server`APIæ–¹å¼æ—¶ï¼Œåªéœ€è¦å°†compilerå¯¹è±¡ç»™dev serverå³å¯ï¼Œä¸éœ€è¦æ‰‹åŠ¨æ‰§è¡Œ`compiler.run()`ï¼›å¦‚æœéœ€è¦æ‰‹åŠ¨å®ä¾‹åŒ–`Compiler`å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡`const Compiler = webpack.Compiler`æ¥è·å–å®ƒçš„ç±»ã€‚\n\n### Compileré’©å­\n\n| é’©å­å               | Tapable ç±»å‹      | è§¦å‘æ—¶æœº                                                         | ä¼ å…¥ callback çš„å‚æ•°               |\n| :------------------- | :---------------- | :--------------------------------------------------------------- | :--------------------------------- |\n| entryOption          | SyncBailHook      | åœ¨ webpack ä¸­çš„ entry é…ç½®å¤„ç†è¿‡ä¹‹å                             | `context`ï¼Œ`entry`                 |\n| afterPlugins         | SyncHook          | åˆå§‹åŒ–å®Œå†…ç½®æ’ä»¶ä¹‹å                                             | `compiler`                         |\n| afterResolvers       | SyncHook          | resolver å®Œæˆä¹‹åï¼ˆåé¢è§£é‡Šresolveræ˜¯ä»€ä¹ˆï¼‰                      | `compiler`                         |\n| environment          | SyncHook          | å‡†å¤‡ç¼–è¯‘ç¯å¢ƒï¼Œwebpack pluginsé…ç½®åˆå§‹åŒ–å®Œæˆä¹‹å                  | `compiler`                         |\n| afterEnvironment     | SyncHook          | ç¼–è¯‘ç¯å¢ƒå‡†å¤‡å¥½ä¹‹å                                               | `compiler`                         |\n| beforeRun            | AsyncSeriesHook   | å¼€å§‹æ­£å¼ç¼–è¯‘ä¹‹å‰                                                 | `compiler`                         |\n| run                  | AsyncSeriesHook   | å¼€å§‹ç¼–è¯‘ä¹‹åï¼Œè¯»å– records ä¹‹å‰ï¼›ç›‘å¬æ¨¡å¼è§¦å‘`watch-run`         | `compiler`                         |\n| watchRun             | AsyncSeriesHook   | ç›‘å¬æ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªæ–°çš„ç¼–è¯‘è§¦å‘ä¹‹å                                 | `compiler`                         |\n| normalModuleFactory  | SyncHook          | NormalModuleFactory åˆ›å»ºä¹‹å                                     | `normalModuleFactory`å®ä¾‹          |\n| contextModuleFactory | SyncHook          | ContextModuleFactory åˆ›å»ºä¹‹å                                    | `contextModuleFactory`å®ä¾‹         |\n| beforeCompile        | AsyncSeriesHook   | compilation å®ä¾‹åŒ–éœ€è¦çš„å‚æ•°åˆ›å»ºå®Œæ¯•ä¹‹å                         | `compilationParams`                |\n| compile              | SyncHook          | ä¸€æ¬¡ compilation ç¼–è¯‘åˆ›å»ºä¹‹å‰                                    | `compilationParams`                |\n| thisCompilation      | SyncHook          | è§¦å‘ compilation äº‹ä»¶ä¹‹å‰æ‰§è¡Œ                                    | `compilation`ï¼Œ`compilationParams` |\n| compilation          | SyncHook          | compilationåˆ›å»ºæˆåŠŸä¹‹å                                          | `compilation`ï¼Œ`compilationParams` |\n| make                 | AsyncParallelHook | å®Œæˆç¼–è¯‘ä¹‹å‰                                                     | `compilation`                      |\n| afterCompile         | AsyncSeriesHook   | å®Œæˆç¼–è¯‘å’Œå°å­˜ï¼ˆsealï¼‰ç¼–è¯‘äº§å‡ºä¹‹å                               | `compilation`                      |\n| shouldEmit           | SyncBailHook      | å‘å¸ƒæ„å»ºåèµ„æºä¹‹å‰è§¦å‘ï¼Œå›è°ƒå¿…é¡»è¿”å›`true`/`false`ï¼Œ`true`åˆ™ç»§ç»­ | `compilation`                      |\n| emit                 | AsyncSeriesHook   | ç”Ÿæˆèµ„æºåˆ° output ç›®å½•ä¹‹å‰                                       | `compilation`                      |\n| afterEmit            | AsyncSeriesHook   | ç”Ÿæˆèµ„æºåˆ° output ç›®å½•ä¹‹å                                       | `compilation`                      |\n| done                 | AsyncSeriesHook   | compilationå®Œæˆä¹‹å                                              | `stats`                            |\n| failed               | SyncHook          | compilationå¤±è´¥                                                  | `error`                            |\n| invalid              | SyncHook          | ç›‘å¬æ¨¡å¼ä¸‹ï¼Œç¼–è¯‘æ— æ•ˆæ—¶                                           | `fileName`ï¼Œ`changeTime`           |\n| watchClose           | SyncHook          | ç›‘å¬æ¨¡å¼åœæ­¢                                                     | æ—                                  |\n\n> Tipsï¼šæ•´ä¸ª`Compiler`å®Œæ•´åœ°å±•ç°äº† Webpack çš„æ„å»ºæµç¨‹ï¼š\n>\n> - å‡†å¤‡é˜¶æ®µï¼šrunä¹‹å‰åšçš„äº‹æƒ…éƒ½å±äºå‡†å¤‡é˜¶æ®µï¼Œè¿™é˜¶æ®µçš„calbackå…¥å‚ä»¥compilerä¸ºä¸»ï¼› \n> - ç¼–è¯‘é˜¶æ®µï¼šè¿™é˜¶æ®µä»¥compilationçš„é’©å­ä¸ºä¸»ï¼Œcalbackå…¥å‚ä»¥compilationä¸ºä¸»ï¼› \n> - äº§å‡ºé˜¶æ®µï¼šè¿™é˜¶æ®µä»compilationå¼€å§‹ï¼Œæœ€åå›åˆ°Compileré’©å­ä¸Šï¼Œcalbackä¼ å…¥å‚æ•°æ˜¯è·Ÿç»“æœç›¸å…³çš„æ•°æ®ï¼ŒåŒ…æ‹¬statsã€error\n\né’©å­çš„è°ƒç”¨éœ€è¦ä½¿ç”¨`tap`ã€`tapPromise`æˆ–`tapAsync`\n\n```javascript\ncompiler.hooks.someHook.tap('MyPlugin', params => {    /* ... */ });\n```\n\næ³¨è§£1: Resolver\n\nCompiler çš„ Resolver æ˜¯æŒ‡æ¥è‡ªäºenhanced-resolveæ¨¡å—ï¼Œå®ƒä¸»è¦åŠŸèƒ½æ˜¯ä¸€ä¸ªæä¾›å¼‚æ­¥require.resolve()ï¼Œå³ä»å“ªé‡Œå»æŸ¥æ‰¾æ–‡ä»¶çš„è·¯å¾„ï¼Œå¯ä»¥é€šè¿‡Webpackçš„resolveå’ŒresolveLoaderæ¥é…ç½®ã€‚Compilerç±»æœ‰ä¸‰ç§ç±»å‹çš„å†…ç½® Resolverï¼š\n\n- Normalï¼šé€šè¿‡ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ï¼Œè§£æä¸€ä¸ªæ¨¡å—ï¼› \n- Contextï¼šé€šè¿‡ç»™å®šçš„ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰è§£æä¸€ä¸ªæ¨¡å—ï¼› \n- Loaderï¼šè§£æä¸€ä¸ª webpack loaderã€‚\n\næ³¨è§£2ï¼š ï¼š`thisCompilation`å’Œ`compilation`\n\nè¿™é‡Œä¸ºä»€ä¹ˆä¼šæœ‰ thisCompilationå’Œcompilation ä¸¤ä¸ªé’©å­å‘¢ï¼Ÿå…¶å®æ˜¯è·Ÿå­ç¼–è¯‘ï¼ˆchild compilerï¼‰æœ‰å…³ï¼Œ Compiler å®ä¾‹é€šè¿‡ createChildCompiler æ–¹æ³•å¯ä»¥åˆ›å»ºå­ç¼–è¯‘å®ä¾‹ childCompilerã€‚åˆ›å»ºchildCompileræ—¶ï¼ŒchildCompilerä¼šå¤åˆ¶ compiler å®ä¾‹çš„ä»»åŠ¡ç‚¹ç›‘å¬å™¨ã€‚compilationçš„é’©å­ä¼šè¢«å¤åˆ¶ï¼Œè€Œ çš„é’©å­ä¼šè¢«å¤åˆ¶ï¼Œè€Œ thisCompilation é’©å­åˆ™ é’©å­åˆ™ä¸ä¼šè¢«å¤åˆ¶ã€‚\n\n### Compilation\n\nåœ¨ Compilation é˜¶æ®µï¼Œæ¨¡å—ä¼šè¢«åŠ è½½(loaded)ã€å°å­˜(sealed)ã€ä¼˜åŒ–(optimized)ã€åˆ†å—(chunked)ã€å“ˆå¸Œ(hashed)å’Œé‡æ–°åˆ›å»º(restored)ï¼ŒCompilation å¯¹è±¡åŒ…å«äº†å½“å‰çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºã€å˜åŒ–çš„æ–‡ä»¶ç­‰ã€‚å½“ Webpack ä»¥ç›‘å¬ï¼ˆwatchï¼‰æ¨¡å¼è¿è¡Œæ—¶ï¼Œæ¯å½“æ£€æµ‹åˆ°ä¸€ä¸ªæ–‡ä»¶å˜åŒ–ï¼Œä¸€æ¬¡æ–°çš„ Compilation å°†è¢«åˆ›å»ºã€‚Compilation å¯¹è±¡ä¹Ÿæä¾›äº†å¾ˆå¤šäº‹ä»¶å›è°ƒä¾›æ’ä»¶åšæ‰©å±•ï¼Œé€šè¿‡ Compilation ä¹Ÿèƒ½è¯»å–åˆ° Compiler å¯¹è±¡ã€‚\n\n#### Compilationé’©å­\n\ncompilationå…ˆä»å•ä¸ª module å¼€å§‹å¤„ç†ï¼ŒæŸ¥æ‰¾ä¾èµ–å…³ç³»ï¼Œ æœ€åå®Œæˆå•ä¸ªmodule å¤„ç†ï¼Œå®Œæˆå…¨éƒ¨modules ä¹‹åï¼Œå¼€å§‹ chunks é˜¶æ®µå¤„ç†ï¼Œæœ€ååœ¨æ ¹æ®ä¼˜åŒ–é…ç½®ï¼ŒæŒ‰éœ€ç”Ÿæˆ assetsã€‚\n\nå¸¦â˜…æ˜¯æ¯”è¾ƒé‡è¦çš„\n\n| é’©å­å                    | Tapable ç±»å‹      | è§¦å‘æ—¶æœº                                                                  | ä¼ å…¥ callback çš„å‚æ•°                             |\n| :------------------------ | :---------------- | :------------------------------------------------------------------------ | :----------------------------------------------- |\n| buildModule               | SyncHook          | åœ¨æ¨¡å—æ„å»ºå¼€å§‹ä¹‹å‰è§¦å‘                                                    | `module`                                         |\n| rebuildModule             | SyncHook          | åœ¨é‡æ–°æ„å»ºä¸€ä¸ªæ¨¡å—ä¹‹å‰è§¦å‘                                                | `module`                                         |\n| failedModule              | SyncHook          | æ¨¡å—æ„å»ºå¤±è´¥æ—¶æ‰§è¡Œ                                                        | `module`ï¼Œ`error`                                |\n| succeedModule             | SyncHook          | æ¨¡å—æ„å»ºæˆåŠŸæ—¶æ‰§è¡Œ                                                        | `module`                                         |\n| finishModules             | SyncHook          | æ‰€æœ‰æ¨¡å—éƒ½å®Œæˆæ„å»º                                                        | `module`                                         |\n| finishRebuildingModule    | SyncHook          | ä¸€ä¸ªæ¨¡å—å®Œæˆé‡æ–°æ„å»º                                                      | `module`                                         |\n| seal                      | SyncHook          | â˜…ç¼–è¯‘ï¼ˆcompilationï¼‰åœæ­¢æ¥æ”¶æ–°æ¨¡å—æ—¶è§¦å‘                                  | `module`                                         |\n| unseal                    | SyncHook          | ç¼–è¯‘ï¼ˆcompilationï¼‰å¼€å§‹æ¥æ”¶æ–°æ¨¡å—æ—¶è§¦å‘                                   | `module`                                         |\n| optimizeDependencies      | SyncBailHook      | ä¾èµ–ä¼˜åŒ–å¼€å§‹æ—¶è§¦å‘                                                        | `modules`                                        |\n| afterOptimizeDependencies | SyncHook          | ä¾èµ–ä¼˜åŒ–ç»“æŸæ—¶è§¦å‘                                                        | `modules`                                        |\n| optimize                  | SyncHook          | â˜…ä¼˜åŒ–é˜¶æ®µå¼€å§‹æ—¶è§¦å‘                                                       | `modules`                                        |\n| optimizeModules           | SyncBailHook      | â˜…æ¨¡å—çš„ä¼˜åŒ–                                                               | `modules`                                        |\n| afterOptimizeModules      | SyncHook          | æ¨¡å—ä¼˜åŒ–ç»“æŸæ—¶è§¦å‘                                                        | `modules`                                        |\n| optimizeChunks            | SyncBailHook      | â˜…ä¼˜åŒ– chunks                                                              | `chunks`                                         |\n| afterOptimizeChunks       | SyncHook          | chunk ä¼˜åŒ–å®Œæˆä¹‹åè§¦å‘                                                    | `chunks`                                         |\n| optimizeTree              | AsyncSeriesHook   | å¼‚æ­¥ä¼˜åŒ–ä¾èµ–æ ‘                                                            | `chunks`ï¼Œ`modules`                              |\n| afterOptimizeTree         | SyncHook          | å¼‚æ­¥ä¼˜åŒ–ä¾èµ–æ ‘å®Œæˆæ—¶                                                      | `chunks`ï¼Œ`modules`                              |\n| optimizeChunkModules      | SyncBailHook      | ä¼˜åŒ–å•ä¸ªchunkä¸­çš„ modules å¼€å§‹                                            | `chunks`                                         |\n| afterOptimizeChunkModules | SyncHook          | ä¼˜åŒ–å•ä¸ªchunkä¸­çš„ modules ç»“æŸ                                            | `chunks`                                         |\n| shouldRecord              | SyncHook          |                                                                           | `chunks`                                         |\n| reviveModules             | SyncHook          | ä» records ä¸­æ¢å¤æ¨¡å—ä¿¡æ¯                                                 | `modules`ï¼Œ`records`                             |\n| optimizeModuleOrder       | SyncHook          | å°†æ¨¡å—ä»æœ€é‡è¦çš„åˆ°æœ€ä¸é‡è¦çš„è¿›è¡Œæ’åº                                      | `chunks`                                         |\n| beforeModuleIds           | SyncHook          | å¤„ç† modulesId ä¹‹å‰                                                       | `modules`                                        |\n| moduleIds                 | SyncHook          | å¤„ç† modulesId                                                            | `modules`                                        |\n| optimizeModuleIds         | SyncHook          | ä¼˜åŒ– modulesId                                                            | `chunks`                                         |\n| afterOptimizeModuleIds    | SyncHook          | ä¼˜åŒ– modulesIdä¹‹å                                                        | `chunks`                                         |\n| reviveChunks              | SyncHook          | ä» records ä¸­æ¢å¤ chunk ä¿¡æ¯                                              | `modules`ï¼Œ`records`                             |\n| optimizeChunkOrder        | SyncHook          | å°† chunk ä»æœ€é‡è¦çš„åˆ°æœ€ä¸é‡è¦çš„è¿›è¡Œæ’åº                                   | `chunks`                                         |\n| beforeOptimizeChunkIds    | SyncHook          | chunk id ä¼˜åŒ–ä¹‹å‰è§¦å‘                                                     | `chunks`                                         |\n| optimizeChunkIds          | SyncHook          | chunk id ä¼˜åŒ–å¼€å§‹è§¦å‘                                                     | `chunks`                                         |\n| afterOptimizeChunkIds     | SyncHook          | chunk id ä¼˜åŒ–ç»“æŸè§¦å‘                                                     | `chunks`                                         |\n| recordModules             | SyncHook          | å°†æ¨¡å—ä¿¡æ¯å­˜å‚¨åˆ° records                                                  | `modules`ï¼Œ`records`                             |\n| recordChunks              | SyncHook          | å°† chunk ä¿¡æ¯å­˜å‚¨åˆ° records                                               | `chunks`ï¼Œ`records`                              |\n| beforeHash                | SyncHook          | åœ¨ç¼–è¯‘è¢«å“ˆå¸Œï¼ˆhashedï¼‰ä¹‹å‰                                                | -                                                |\n| afterHash                 | SyncHook          | åœ¨ç¼–è¯‘è¢«å“ˆå¸Œï¼ˆhashedï¼‰ä¹‹å                                                | -                                                |\n| record                    | SyncHook          | å°† compilation ç›¸å…³ä¿¡æ¯å­˜å‚¨åˆ° records ä¸­                                  | `compilation`ï¼Œ`records`                         |\n| beforeChunkAssets         | SyncHook          | åœ¨åˆ›å»º chunk èµ„æºï¼ˆassetï¼‰ä¹‹å‰                                            | `chunks`                                         |\n| additionalChunkAssets     | SyncHook          | ä¸º chunk åˆ›å»ºé™„åŠ èµ„æºï¼ˆassetï¼‰                                            | `chunks`                                         |\n| additionalAssets          | AsyncSeriesHook   | â˜…ä¸ºç¼–è¯‘ï¼ˆcompilationï¼‰åˆ›å»ºé™„åŠ èµ„æºï¼ˆassetï¼‰                               | -                                                |\n| optimizeChunkAssets       | AsyncSeriesHook   | â˜…ä¼˜åŒ–æ‰€æœ‰ chunk èµ„æºï¼ˆassetï¼‰                                             | `chunks`                                         |\n| afterOptimizeChunkAssets  | SyncHook          | chunk èµ„æºï¼ˆassetï¼‰å·²ç»è¢«ä¼˜åŒ–                                             | `chunks`                                         |\n| optimizeAssets            | AsyncSeriesHook   | â˜…ä¼˜åŒ–å­˜å‚¨åœ¨ compilation.assets ä¸­çš„æ‰€æœ‰èµ„æºï¼ˆassetï¼‰                      | `assets`                                         |\n| afterOptimizeAssets       | SyncHook          | ä¼˜åŒ–compilation.assets ä¸­çš„æ‰€æœ‰èµ„æºï¼ˆassetï¼‰ä¹‹å                          | `assets`                                         |\n| moduleAsset               | SyncHook          | ä¸€ä¸ªæ¨¡å—ä¸­çš„ä¸€ä¸ªèµ„æºè¢«æ·»åŠ åˆ°ç¼–è¯‘ä¸­                                        | `module`ï¼Œ`filename`                             |\n| chunkAsset                | SyncHook          | ä¸€ä¸ª chunk ä¸­çš„ä¸€ä¸ªèµ„æºè¢«æ·»åŠ åˆ°ç¼–è¯‘ä¸­                                     | `chunk`ï¼Œ`filename`                              |\n| assetPath                 | SyncWaterfallHook | asset è·¯å¾„ç¡®è®¤ä¹‹å                                                        | `filename`ï¼Œ`data`                               |\n| childCompiler             | SyncHook          | å­ç¼–è¯‘ï¼ˆcompilerï¼‰è§¦å‘                                                    | `childCompiler`ï¼Œ`compilerName`ï¼Œ`compilerIndex` |\n| normalModuleLoader        | SyncHook          | â˜…æ™®é€šæ¨¡å— loaderï¼ŒçœŸæ­£ï¼ˆä¸€ä¸ªæ¥ä¸€ä¸ªåœ°ï¼‰åŠ è½½æ¨¡å—å›¾ï¼ˆgraphï¼‰ä¸­æ‰€æœ‰æ¨¡å—çš„å‡½æ•° | `loaderContext`ï¼Œ`module`                        |\n\n#### Stats\n\nåœ¨webpackçš„å›è°ƒå‡½æ•°â€”â€”`webpack(cofnig, (err, stats) => {})`ä¸­ä¼šå¾—åˆ°statså¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å®é™…æ¥è‡ªäº`Compilation.getStats()`ï¼Œè¿”å›çš„æ˜¯ä¸»è¦å«æœ‰`modules`ã€`chunks`å’Œ`assets`ä¸‰ä¸ªå±æ€§å€¼çš„å¯¹è±¡ã€‚\n\n- modulesï¼š è®°å½•äº†æ‰€æœ‰è§£æåçš„æ¨¡å—\n- chunksï¼šè®°å½•äº†æ‰€æœ‰chunk\n- assetsï¼šè®°å½•äº†æ‰€æœ‰è¦ç”Ÿæˆçš„æ–‡ä»¶\n\nStatså¯¹è±¡æœ¬è´¨æ˜¯æ¥è‡ªäº`lib/Stats.js`çš„ç±»çš„å®ä¾‹ã€‚å¸¸ç”¨çš„æ–¹æ³•ï¼š\n\n- stats.hasWarnings()\n- stats.hasErrors()\n- stats.toJson()\n- stats.toString()\n\n#### Statså¯¹è±¡æ•°æ®ç»“æ„\n\nåœ¨webpackçš„å›è°ƒä¸­è·å–statsï¼Œç„¶åå†è°ƒç”¨`toJson`æ–¹æ³•è·å–statsçš„æ•°æ®æ¥å£\n\n```javascript\nwebpack(config, (err, stats) => {\n    console.log(stats.toJson())\n})\n```\n\nStatså¯¹è±¡å¯ä»¥é€šè¿‡`webpack-cli`æ‰“åŒ…æˆä¸€ä¸ªjsonæ–‡ä»¶ï¼š`webpack --profile --json > compilation-stats.json`\n\næ•°æ®ç»“æ„å¦‚ä¸‹ï¼š\n\n```json\n{\n    \"version\": \"4.29.6\", // ç”¨æ¥ç¼–è¯‘çš„ webpack çš„ç‰ˆæœ¬\n    \"hash\": \"11593e3b3ac85436984a\", // ç¼–è¯‘ä½¿ç”¨çš„ hash\n    \"time\": 2469, // ç¼–è¯‘è€—æ—¶ (ms)\n    \"filteredModules\": 0, // å½“ `exclude`ä¼ å…¥`toJson` å‡½æ•°æ—¶ï¼Œç»Ÿè®¡è¢«æ— è§†çš„æ¨¡å—çš„æ•°é‡\n    \"outputPath\": \"/\", // path to webpack è¾“å‡ºç›®å½•çš„ path è·¯å¾„\n    \"assetsByChunkName\": {\n        // ç”¨ä½œæ˜ å°„çš„ chunk çš„åç§°\n        \"main\": \"web.js?h=11593e3b3ac85436984a\",\n        \"named-chunk\": \"named-chunk.web.js\",\n        \"other-chunk\": [\"other-chunk.js\", \"other-chunk.css\"]\n    },\n    \"assets\": [\n        // asset å¯¹è±¡ (asset objects) çš„æ•°ç»„\n    ],\n    \"chunks\": [\n        // chunk å¯¹è±¡ (chunk objects) çš„æ•°ç»„\n    ],\n    \"modules\": [\n        // æ¨¡å—å¯¹è±¡ (module objects) çš„æ•°ç»„\n    ],\n    \"errors\": [\n        // é”™è¯¯å­—ç¬¦ä¸² (error string) çš„æ•°ç»„\n    ],\n    \"warnings\": [\n        // è­¦å‘Šå­—ç¬¦ä¸² (warning string) çš„æ•°ç»„\n    ]\n}\n```\n\n> stats.toJsonå¯ä»¥æŒ‡å®šè¦ä¸è¦è¾“å‡ºå¯¹åº”çš„æ•°æ®ã€‚ä¾‹å¦‚ä¸æƒ³è¾“å‡º modules å’Œ chunksï¼Œå¯ä»¥ä½¿ç”¨stats. toJson({modules: false, chunks: false})\n\n#### module\n\nåœ¨æ¯ä¸ª module ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å®ƒçš„æ‰€æœ‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥åˆ†ä¸ºå››å¤§ç±»ï¼š\n\n1. åŸºæœ¬ä¿¡æ¯ï¼šåŒ…æ‹¬æœ€åŸºæœ¬çš„å†…å®¹ã€å¤§å°ã€idï¼›\n2. ä¾èµ–å…³ç³»ï¼š`module.reasons`å¯¹è±¡æè¿°äº†è¿™ä¸ªæ¨¡å—è¢«åŠ å…¥ä¾èµ–å›¾è¡¨çš„ç†ç”±ï¼ŒåŒ…å«äº†å¼•å…¥çš„æ–¹å¼ã€å¼•å…¥çš„ module ä¿¡æ¯åŠå…¶å¯¹åº”ä»£ç åœ¨ç¬¬å‡ è¡Œç¬¬å‡ åˆ—ç­‰ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªè®¡ç®—å‡º module ä¹‹é—´çš„ä¾èµ–å…³ç³»å›¾è¡¨ï¼ˆgraphï¼‰ï¼›\n3. chunks å’Œ assets å…³ç³»ï¼š`module.chunks`å’Œ`module.assets`åŒ…å«åˆ° chunks å’Œ assets ä¸­çš„å¯¹åº” id ç­‰ï¼›\n4. è¢« webpack å¤„ç†çš„åçš„ä¿¡æ¯ï¼šåŒ…å«`module.failed`ã€`module.errors`ã€`module.warnings`ç­‰ã€‚\n\n```json\n{\n    \"assets\": [\n        // assetå¯¹è±¡ (asset objects)çš„æ•°ç»„\n    ],\n    \"built\": true, // è¡¨ç¤ºè¿™ä¸ªæ¨¡å—ä¼šå‚ä¸ Loaders , è§£æ, å¹¶è¢«ç¼–è¯‘\n    \"cacheable\": true, // è¡¨ç¤ºè¿™ä¸ªæ¨¡å—æ˜¯å¦ä¼šè¢«ç¼“å­˜\n    \"chunks\": [\n        // åŒ…å«è¿™ä¸ªæ¨¡å—çš„ chunks çš„ id\n    ],\n    \"errors\": 0, // å¤„ç†è¿™ä¸ªæ¨¡å—å‘ç°çš„é”™è¯¯çš„æ•°é‡\n    \"failed\": false, // ç¼–è¯‘æ˜¯å¦å¤±è´¥\n    \"id\": 0, // è¿™ä¸ªæ¨¡å—çš„ID (ç±»ä¼¼äº `module.id`)\n    \"identifier\": \"(webpack)\\\\test\\\\browsertest\\\\lib\\\\index.web.js\", // webpackå†…éƒ¨ä½¿ç”¨çš„å”¯ä¸€çš„æ ‡è¯†\n    \"name\": \"./lib/index.web.js\", // å®é™…æ–‡ä»¶çš„åœ°å€\n    \"optional\": false, // æ¯ä¸€ä¸ªå¯¹è¿™ä¸ªæ¨¡å—çš„è¯·æ±‚éƒ½ä¼šåŒ…è£¹åœ¨ `try... catch` å†… (ä¸ESMæ— å…³)\n    \"prefetched\": false, // è¡¨ç¤ºè¿™ä¸ªæ¨¡å—æ˜¯å¦ä¼šè¢« prefetched\n    \"profile\": {\n        // æœ‰å…³ `--profile` flag çš„è¿™ä¸ªæ¨¡å—ç‰¹æœ‰çš„ç¼–è¯‘æ•°æ® (ms)\n        \"building\": 73, // è½½å…¥å’Œè§£æ\n        \"dependencies\": 242, // ç¼–è¯‘ä¾èµ–\n        \"factory\": 11 // è§£å†³ä¾èµ–\n    },\n    \"reasons\": [\n        // è§ä¸‹æ–‡æè¿°\n    ],\n    \"size\": 3593, // é¢„ä¼°æ¨¡å—çš„å¤§å° (byte)\n    \"source\": \"// Should not break it...\\r\\nif(typeof...\", // å­—ç¬¦ä¸²åŒ–çš„è¾“å…¥\n    \"warnings\": 0 // å¤„ç†æ¨¡å—æ—¶è­¦å‘Šçš„æ•°é‡\n}\n```\n\nå…¶ä¸­`module.reasons`æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š\n\n```json\n{\n    \"loc\": \"33:24-93\", // å¯¼è‡´è¿™ä¸ªè¢«åŠ å…¥ä¾èµ–å›¾æ ‡çš„ä»£ç è¡Œæ•°\n    \"module\": \"./lib/index.web.js\", // æ‰€åŸºäºæ¨¡å—çš„ç›¸å¯¹åœ°å€ context\n    \"moduleId\": 0, // æ¨¡å—çš„ ID\n    \"moduleIdentifier\": \"(webpack)\\\\test\\\\browsertest\\\\lib\\\\index.web.js\", // æ¨¡å—çš„åœ°å€\n    \"moduleName\": \"./lib/index.web.js\", // å¯è¯»æ€§æ›´å¥½çš„æ¨¡å—åç§° (ç”¨äº \"æ›´å¥½çš„æ‰“å° (pretty-printing)\")\n    \"type\": \"require.context\", // ä½¿ç”¨çš„è¯·æ±‚çš„ç§ç±» (type of request)\n}\n```\n\n#### chunk\n\nåœ¨æ¯ä¸ª chunk ä¸­ï¼Œä¿¡æ¯ä¹Ÿå¯ä»¥åˆ†ä¸ºå››å¤§ç±»ï¼š\n\n1. åŸºæœ¬ä¿¡æ¯ï¼šåŒ…æ‹¬æœ€åŸºæœ¬çš„å†…å®¹ã€å¤§å°ã€idï¼›\n2. æ¥æºï¼š`chunk.origins`å¯¹è±¡æè¿°äº†è¿™ä¸ªæ¨¡å—è¢«åŠ å…¥çš„ç†ç”±ï¼ŒåŒ…å«äº†å¼•å…¥çš„æ–¹å¼ã€å¼•å…¥çš„ module ä¿¡æ¯åŠå…¶å¯¹åº”ä»£ç åœ¨ç¬¬å‡ è¡Œç¬¬å‡ åˆ—ç­‰ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªè®¡ç®—å‡º module ä¹‹é—´çš„ä¾èµ–å…³ç³»å›¾è¡¨ï¼ˆgraphï¼‰ï¼›\n3. å¼•ç”¨å…³ç³»ï¼š`chunk.parents`å’Œ`chunk.children`è¢«å¼•ç”¨å’Œå¼•ç”¨çš„ idsï¼›\n4. åŒ…å«å’Œè¢«åŒ…å«ï¼š`chunk.files`å’Œ`chunk.modules`åŒ…å«åˆ° assets å’Œè‡ªå·±åŒ…å« modules ä¸­ä¿¡æ¯ç­‰ã€‚\n\n```json\n{\n    \"entry\": true, // è¡¨ç¤ºè¿™ä¸ª chunk æ˜¯å¦åŒ…å« webpack çš„è¿è¡Œæ—¶\n    \"files\": [\n        // ä¸€ä¸ªåŒ…å«è¿™ä¸ª chunk çš„æ–‡ä»¶åçš„æ•°ç»„\n    ],\n    \"filteredModules\": 0, // è§ä¸Šæ–‡çš„ ç»“æ„\n    \"id\": 0, // è¿™ä¸ª chunk çš„id\n    \"initial\": true, // è¡¨ç¤ºè¿™ä¸ª chunk æ˜¯å¼€å§‹å°±è¦åŠ è½½è¿˜æ˜¯ æ‡’åŠ è½½(lazy-loading)\n    \"modules\": [\n        // æ¨¡å—å¯¹è±¡ (module objects)çš„æ•°ç»„\n        \"web.js?h=11593e3b3ac85436984a\"\n    ],\n    \"names\": [\n        // åŒ…å«åœ¨è¿™ä¸ª chunk å†…çš„ chunk çš„åå­—çš„æ•°ç»„\n    ],\n    \"origins\": [\n        // ä¸‹æ–‡è¯¦è¿°\n    ],\n    \"parents\": [], // çˆ¶ chunk çš„ ids\n    // ç”Ÿæˆ assets çš„åŸå› \n    \"reason\": \"split chunk (cache group: asyncVendors) (name: async)\",\n    \"hash\": \"170746935298270ad813\",\n    // è‡ªå·±å¼•ç”¨è°\n    \"children\": [],\n    // å¼•ç”¨çš„é¡ºåº\n    \"childrenByOrder\": {},\n    \"modules\": [],\n    \"rendered\": true, // è¡¨ç¤ºè¿™ä¸ª chunk æ˜¯å¦ä¼šå‚ä¸è¿›ç¼–è¯‘\n    \"size\": 188057 // chunk çš„å¤§å°(byte)\n}\n```\n\n`chunk.origins`å¯¹åº”çš„æ ¼å¼å¦‚ä¸‹ï¼š\n\n```json\n{\n    \"loc\": \"\", // å…·ä½“æ˜¯å“ªè¡Œç”Ÿæˆäº†è¿™ä¸ªchunk\n    \"module\": \"(webpack)\\\\test\\\\browsertest\\\\lib\\\\index.web.js\", // æ¨¡å—çš„ä½ç½®\n    \"moduleId\": 0, // æ¨¡å—çš„ID\n    \"moduleIdentifier\": \"(webpack)\\\\test\\\\browsertest\\\\lib\\\\index.web.js\", // æ¨¡å—çš„åœ°å€\n    \"moduleName\": \"./lib/index.web.js\", // æ¨¡å—çš„ç›¸å¯¹åœ°å€\n    \"name\": \"main\", // chunkçš„åç§°\n    \"reasons\": [\n        // æ¨¡å—å¯¹è±¡ä¸­`reason`çš„æ•°ç»„\n    ]\n}\n```\n\n#### asset\n\n`asset`ç›¸å¯¹ç®€å•ä¸€äº›ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n\n```json\n{\n    \"chunkNames\": [], // è¿™ä¸ª asset åŒ…å«çš„ chunk\n    \"chunks\": [10, 6], // è¿™ä¸ª asset åŒ…å«çš„ chunk çš„ id\n    \"emitted\": true, // è¡¨ç¤ºè¿™ä¸ª asset æ˜¯å¦ä¼šè®©å®ƒè¾“å‡ºåˆ° output ç›®å½•\n    \"name\": \"10.web.js\", // è¾“å‡ºçš„æ–‡ä»¶å\n    \"size\": 1058 // æ–‡ä»¶çš„å¤§å°\n}\n```","tags":["javascript","webpack","æ¶æ„"],"categories":["Webpack"]}]